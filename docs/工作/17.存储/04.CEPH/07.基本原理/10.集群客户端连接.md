---
title: é›†ç¾¤å®¢æˆ·ç«¯è¿æ¥

categories: 
  - ğŸ’» å·¥ä½œ
  - å­˜å‚¨
  - CEPH
  - åŸºæœ¬åŸç†
date: 2020-05-23 11:02:28
tags: null
permalink: /pages/665914/
---

# 1. æŸ¥çœ‹ FS å®¢æˆ·ç«¯è¿æ¥
```plain
$ ceph daemon mds.0 session ls
[
    {
        "id": 5122511,
        "num_leases": 0,
        "num_caps": 655,
        "state": "open",
        "replay_requests": 0,
        "completed_requests": 1,
        "reconnecting": false,
        "inst": "client.9762766 10.9.1.2:0\/4202511977",
        "client_metadata": {
            "ceph_sha1": "b1e0532418e4631af01acbc0cedd426f1905f4af",
            "ceph_version": "ceph version 0.94.10 (b1e0532418e4631af01acbc0cedd426f1905f4af)",
            "entity_id": "log_cephfs",
            "hostname": "ac_xxx-client00.gz01",
            "mount_point": "\/mnt\/log"
        }
    }
]

$ ceph daemon mds.0 session ls  | grep "hostname\|inst"
        "inst": "client.9762766 10.9.1.2:0\/4202511977",
            "hostname": "ac_xxx-client00.gz01",
```
**è¯´æ˜ï¼š**
 - idï¼šclient å”¯ä¸€ id
 - num_capsï¼šclient è·å–çš„ caps
 - instï¼šclient ç«¯çš„ ip å’Œç«¯å£é“¾æ¥ä¿¡æ¯
 - ceph_versionï¼šclient ç«¯çš„ ceph-fuse ç‰ˆæœ¬ï¼Œè‹¥ä½¿ç”¨ kernel clientï¼Œåˆ™ä¸º kernel_version
 - hostnameï¼šclient ç«¯çš„ä¸»æœºå
 - mount_pointï¼šclient åœ¨ä¸»æœºä¸Šå¯¹åº”çš„ mount point
 - pidï¼šclient ç«¯ ceph-fuse è¿›ç¨‹çš„ pid

# 2. æŸ¥çœ‹ RBD å—å­˜å‚¨å®¢æˆ·ç«¯è¿æ¥
```plain
# æŸ¥çœ‹å­˜å‚¨æ± ä¸‹é¢æ‰€æœ‰é•œåƒ
$ rbd ls test_pool
test_image
test_image_test
 
# æŸ¥çœ‹é•œåƒæŒ‚è½½çš„å®¢æˆ·ç«¯
$ rbd status test_pool/test_image
Watchers:
    watcher=10.9.1.2:0/671061150 client.8012074 cookie=140171290999856 
```

# 3. æŸ¥çœ‹ RGW å®¢æˆ·ç«¯è¿æ¥
```plain
# æŸ¥çœ‹æ—¥å¿—æ ¼å¼
$  tail /var/log/ceph/ceph-client.rgw.op-xxx-ceph00.log
2018-07-23 19:17:32.546214 7f8779fcb700  1 civetweb: 0x7f87a80266e0: 10.9.1.2 - - [23/Jul/2018:19:17:32 +0800] "HEAD /epp-xxx/2018-07-23/VjFfMTAwMDAwMV9NQUxPSEI1TVAyMEJMSkZNMkg4TUVKSzJSNg/03%3A50%3A25.824Z/308357/SCfn3qka.png.lz4 HTTP/1.1" 200 0 - Boto/2.49.0 Python/3.6.3 Linux/3.10.0-514.16.1.el7.x86_64
2018-07-23 19:17:32.548567 7f8779fcb700  1 ====== starting new request req=0x7f8779fc5710 =====
2018-07-23 19:17:32.561416 7f8779fcb700  1 ====== req done req=0x7f8779fc5710 op status=0 http_status=200 ======
2018-07-23 19:17:32.561462 7f8779fcb700  1 civetweb: 0x7f87a80266e0: 10.9.1.2 - - [23/Jul/2018:19:17:32 +0800] "GET /epp-xxx/2018-07-23/VjFfMTAwMDAwMV9NQUxPSEI1TVAyMEJMSkZNMkg4TUVKSzJSNg/03%3A50%3A25.824Z/308357/SCfn3qka.png.lz4 HTTP/1.1" 200 0 - Boto/2.49.0 Python/3.6.3 Linux/3.10.0-514.16.1.el7.x86_64 
 
 
# ç»Ÿè®¡è®¿é—®çš„å®¢æˆ·ç«¯
cat /var/log/ceph/ceph-client.rgw.op-xxx-ceph00.log | grep civetweb | awk -F ' ' '{print $7}' | sort | uniq  -c
   2297 10.9.1.2
```
