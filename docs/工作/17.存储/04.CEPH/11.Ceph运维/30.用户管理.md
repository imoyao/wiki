---
title: ç”¨æˆ·ç®¡ç†

tags: ceph
categories: 
  - ğŸ’» å·¥ä½œ
  - å­˜å‚¨
  - CEPH
  - Ceph è¿ç»´
date: 2020-05-23 11:02:28
permalink: /pages/a96989/
---
# ä¸€ã€ è¯´æ˜
- Ceph æŠŠæ•°æ®ä»¥å¯¹è±¡çš„å½¢å¼å­˜äºå„å­˜å‚¨æ± ä¸­ï¼›

- Ceph ç”¨æˆ·å¿…é¡»å…·æœ‰è®¿é—®å­˜å‚¨æ± çš„æƒé™æ‰èƒ½å¤Ÿè¯»å†™æ•°æ®ï¼›

- Ceph ç”¨æˆ·å¿…é¡»å…·æœ‰æ‰§è¡Œæƒé™æ‰èƒ½å¤Ÿä½¿ç”¨ Ceph çš„ç®¡ç†å‘½ä»¤ï¼›

# äºŒã€ æˆæƒèƒ½åŠ›
Ceph ç”¨ â€œèƒ½åŠ›â€ï¼ˆ capabilities, caps ï¼‰è¿™ä¸ªæœ¯è¯­æ¥æè¿°ç»™è®¤è¯ç”¨æˆ·çš„æˆæƒï¼Œè¿™æ ·æ‰èƒ½ä½¿ç”¨ Monã€OSD å’Œ MDS çš„åŠŸèƒ½ï¼›

èƒ½åŠ›ä¹Ÿç”¨äºé™åˆ¶å¯¹æŸä¸€å­˜å‚¨æ± å†…çš„æ•°æ®æˆ–æŸä¸ªå‘½åç©ºé—´çš„è®¿é—®ï¼›

Ceph ç®¡ç†å‘˜ç”¨æˆ·å¯åœ¨åˆ›å»ºæˆ–æ›´æ–°æ™®é€šç”¨æˆ·æ—¶èµ‹äºˆä»–ç›¸åº”çš„èƒ½åŠ›ï¼›

èƒ½åŠ›çš„è¯­æ³•ç¬¦åˆä¸‹é¢çš„å½¢å¼ï¼š
```plain
{daemon-type} 'allow {capability}' [{daemon-type} 'allow {capability}']
```
- Monitor èƒ½åŠ›ï¼š Monitor èƒ½åŠ›åŒ…æ‹¬ r ã€ w ã€ x å’Œ allow profile {cap}ï¼Œä¾‹å¦‚ï¼š

```plain
mon 'allow rwx'
mon 'allow profile osd'
```
- OSD èƒ½åŠ›ï¼š OSD èƒ½åŠ›åŒ…æ‹¬ r ã€ w ã€ x ã€ class-read ã€ class-write å’Œ profile osd ï¼›

å¦å¤–ï¼Œ OSD èƒ½åŠ›è¿˜æ”¯æŒå­˜å‚¨æ± å’Œå‘½åç©ºé—´çš„é…ç½®ï¼›
```plain
osd 'allow {capability}' [pool={poolname}] [namespace={namespace-name}]
```
- MDS èƒ½åŠ›ï¼š MDS èƒ½åŠ›æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ allow æˆ–è€…ç©ºç™½ï¼Œä¹Ÿä¸ä¼šè§£ææ›´å¤šé€‰é¡¹ï¼›

```plain
mds 'allow'
```
æ³¨æ„ï¼š Ceph å¯¹è±¡ç½‘å…³å®ˆæŠ¤è¿›ç¨‹ï¼ˆ radosgw ï¼‰æ˜¯ Ceph å­˜å‚¨é›†ç¾¤çš„ä¸€ç§å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥å®ƒæ²¡è¢«è¡¨ç¤ºæˆä¸€ç§ç‹¬ç«‹çš„ Ceph å­˜å‚¨é›†ç¾¤å®ˆæŠ¤è¿›ç¨‹ç±»å‹ï¼›
ä¸‹é¢æè¿°äº†å„ç§èƒ½åŠ›ï¼š

```shell
allow
æè¿°: åœ¨å®ˆæŠ¤è¿›ç¨‹çš„è®¿é—®è®¾ç½®ä¹‹å‰ï¼Œä»…å¯¹ MDS éšå« rwï¼›
r
æè¿°: æˆäºˆç”¨æˆ·è¯»æƒé™ï¼Œå¯¹ monitor å…·æœ‰è¯»æƒé™æ‰èƒ½è·å– CRUSH mapï¼›
w
æè¿°: æˆäºˆç”¨æˆ·å†™å¯¹è±¡çš„æƒé™;
x
æè¿°: æˆäºˆç”¨æˆ·è°ƒç”¨ç±»æ–¹æ³•çš„èƒ½åŠ›ï¼Œå³åŒæ—¶æœ‰è¯»å’Œå†™ï¼Œä¸”èƒ½åœ¨ monitor ä¸Šæ‰§è¡Œ auth æ“ä½œï¼›
class-read
æè¿°: æˆäºˆç”¨æˆ·è°ƒç”¨ç±»è¯»å–æ–¹æ³•çš„èƒ½åŠ›ï¼Œ x çš„å­é›†ï¼›
class-write
æè¿°: æˆäºˆç”¨æˆ·è°ƒç”¨ç±»å†™å…¥æ–¹æ³•çš„èƒ½åŠ›ï¼Œ x çš„å­é›†ï¼›
*
æè¿°: æˆæƒæ­¤ç”¨æˆ·è¯»ã€å†™å’Œæ‰§è¡ŒæŸå®ˆæŠ¤è¿›ç¨‹/å­˜å‚¨æ± ï¼Œä¸”å…è®¸æ‰§è¡Œç®¡ç†å‘½ä»¤ï¼›
profile osd
æè¿°: æˆæƒä¸€ä¸ªç”¨æˆ·ä»¥ OSD èº«ä»½è¿æ¥å…¶å®ƒ OSD æˆ– Monitorã€‚æˆäºˆ OSD ä»¬å…è®¸å…¶å®ƒ OSD å¤„ç†å¤åˆ¶ã€å¿ƒè·³æµé‡å’ŒçŠ¶æ€æŠ¥å‘Šï¼›
profile mds
æè¿°: æˆæƒä¸€ä¸ªç”¨æˆ·ä»¥ MDS èº«ä»½è¿æ¥å…¶å®ƒ MDS æˆ– Monitorï¼›
profile bootstrap-osd
æè¿°: æˆæƒç”¨æˆ·è‡ªä¸¾å¼•å¯¼ä¸€ä¸ª OSD ï¼›æˆäºˆéƒ¨ç½²å·¥å…·ï¼Œåƒ ceph-disk ã€ceph-deploy ç­‰ç­‰ï¼Œè¿™æ ·å®ƒä»¬åœ¨è‡ªä¸¾å¼•å¯¼ OSD æ—¶å°±æœ‰æƒé™å¢åŠ å¯†é’¥äº†ï¼›
profile bootstrap-mds
æè¿°: æˆæƒç”¨æˆ·è‡ªä¸¾å¼•å¯¼ä¸€ä¸ª MDSï¼›æˆäºˆä¾‹å¦‚ ceph-deploy çš„éƒ¨ç½²å·¥å…·ï¼Œè¿™æ ·å®ƒä»¬åœ¨è‡ªä¸¾å¼•å¯¼ MDS æ—¶å°±æœ‰æƒé™å¢åŠ å¯†é’¥äº†ï¼›
```

# ä¸‰ã€ç®¡ç†ç”¨æˆ·
ç”¨æˆ·ç®¡ç†åŠŸèƒ½å¯ä»¥è®© Ceph å­˜å‚¨é›†ç¾¤çš„ç®¡ç†å‘˜æœ‰èƒ½åŠ›å»åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤é›†ç¾¤çš„æ™®é€šç”¨æˆ·ï¼›

å½“åˆ›å»ºæˆ–åˆ é™¤ä¸€ä¸ªç”¨æˆ·æ—¶ï¼Œå¯èƒ½éœ€è¦æŠŠ keys åˆ†å‘ç»™å„å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åŠ å…¥åˆ° keyring æ–‡ä»¶ä¸­ï¼›

## 3.1 ç½—åˆ—ç”¨æˆ·
å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç½—åˆ—ç”¨æˆ·ï¼š
```plain
ceph auth list
```
Ceph ä¼šåˆ—å‡ºé›†ç¾¤ä¸­çš„æ‰€æœ‰ç”¨æˆ·ï¼›

ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåªæœ‰ 2 ä¸ª OSD çš„ç®€å•ç¯å¢ƒä¸­ï¼Œceph auth list å°†ä¼šè¾“å…¥ç±»ä¼¼ä¸‹é¢çš„å†…å®¹ï¼š

```plain
installed auth entries:

osd.0
        key: AQCvCbtToC6MDhAATtuT70Sl+DymPCfDSsyV4w==
        caps: [mon] allow profile osd
        caps: [osd] allow *
osd.1
        key: AQC4CbtTCFJBChAAVq5spj0ff4eHZICxIOVZeA==
        caps: [mon] allow profile osd
        caps: [osd] allow *
client.admin
        key: AQBHCbtT6APDHhAA5W00cBchwkQjh3dkKsyPjw==
        caps: [mds] allow
        caps: [mon] allow *
        caps: [osd] allow *
client.bootstrap-mds
        key: AQBICbtTOK9uGBAAdbe5zcIGHZL3T/u2g6EBww==
        caps: [mon] allow profile bootstrap-mds
client.bootstrap-osd
        key: AQBHCbtT4GxqORAADE5u7RkpCN/oo4e5W0uBtw==
        caps: [mon] allow profile bootstrap-osd
```

æ³¨æ„ï¼šTYPE.ID è¿™ç§ç”¨æˆ·è¡¨ç¤ºæ–¹æ³•ï¼Œæ¯”å¦‚ osd.0 è¡¨ç¤ºç”¨æˆ·ç±»å‹æ˜¯ osd ä¸”å…¶ ID æ˜¯ 0 ï¼Œ client.admin è¡¨ç¤ºç”¨æˆ·ç±»å‹æ˜¯ client ä¸”å…¶ ID æ˜¯ admin ï¼ˆå³é»˜è®¤çš„ client.admin ç”¨æˆ·ï¼‰ï¼›

å¦å¤–ï¼Œæ¯ä¸ªç”¨æˆ·æ¡ç›®éƒ½æœ‰ä¸€ä¸ª `key: <value>`å¯¹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ª caps: æ¡ç›®ï¼›


## 3.2 è·å–ç”¨æˆ·
è·å–æŸä¸€ç‰¹å®šç”¨æˆ·çš„ä¿¡æ¯ï¼š
```plain
ceph auth get {TYPE.ID}
```
ä¾‹å¦‚ï¼š
```plain
ceph auth get client.admin
```
è¿˜å¯ä»¥ç»™å‘½ä»¤åŠ ä¸Š `-o {filename}` é€‰é¡¹æŠŠè¾“å…¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼›

## 3.3 å¢åŠ ç”¨æˆ·
å¢åŠ ä¸€ä¸ªç”¨æˆ·å°±æ˜¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·åï¼ˆå³ TYPE.IDï¼‰ã€ä¸€ä¸ªå¯†é’¥å’Œä»»ä½•åŒ…å«åœ¨åˆ›å»ºå‘½ä»¤ä¸­çš„èƒ½åŠ›ï¼›

æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æ–°å¢ä¸€ä¸ªç”¨æˆ·ï¼š

- ceph auth addï¼šæ­¤å‘½ä»¤æ˜¯æœ€æƒå¨çš„æ–°å¢ç”¨æˆ·æ–¹å¼ï¼›å®ƒå›æ–°å»ºä¸€ä¸ªç”¨æˆ·ï¼Œäº§ç”Ÿä¸€ä¸ª key ï¼Œå¹¶èµ‹äºˆç”¨æˆ·ä»»ä½•ç»™å®šçš„èƒ½åŠ›ï¼›
- ceph auth get-or-createï¼šè¿™ç§æ–¹å¼é€šå¸¸æ˜¯æœ€ä¾¿æ·çš„ä¸€ç§ï¼Œå› ä¸ºå®ƒçš„è¿”å›å€¼æ˜¯åŒ…å«ç”¨æˆ·åï¼ˆåœ¨æ–¹æ‹¬å·å†…ï¼‰å’Œå¯†é’¥çš„æ ¼å¼ï¼›å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œè¯¥å‘½ä»¤ä¼šè¿”å›å¯†é’¥æ–‡ä»¶æ ¼å¼çš„ç”¨æˆ·åå’Œå¯†é’¥ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ -o {filename} é€‰é¡¹æŠŠè¾“å…¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼›
- ceph auth get-or-create-keyï¼šè¯¥å‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºç”¨æˆ·ï¼Œä½†æ˜¯åªä¼šè¿”å›ç”¨æˆ·çš„å¯†é’¥ã€‚å¯¹äºæŸäº›åªéœ€è¦å¯†é’¥çš„ç”¨æˆ·ï¼ˆå¦‚ libvirt ï¼‰æ¥è¯´æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œè¯¥å‘½ä»¤ä»…ä»…è¿”å›ç”¨æˆ·çš„å¯†é’¥ï¼›å¯ä»¥ä½¿ç”¨ -o {filename} é€‰é¡¹æŠŠè¾“å…¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼›

ä¸‹é¢æ˜¯å‡ ä¸ªä¾‹å­ï¼š

```plain
ceph auth add client.john mon 'allow r' osd 'allow rw pool=liverpool'
ceph auth get-or-create client.paul mon 'allow r' osd 'allow rw pool=liverpool'
ceph auth get-or-create client.george mon 'allow r' osd 'allow rw pool=liverpool' -o george.keyring
ceph auth get-or-create-key client.ringo mon 'allow r' osd 'allow rw pool=liverpool' -o ringo.key
```
## 3.4 ä¿®æ”¹ç”¨æˆ·çš„èƒ½åŠ›
ceph auth caps å‘½ä»¤å…è®¸ä½ æŒ‡å®šç”¨æˆ·å¹¶æ”¹å˜ç”¨æˆ·çš„èƒ½åŠ›ï¼›

è®¾å®šæ–°çš„èƒ½åŠ›ä¼šè¦†ç›–å½“å‰çš„èƒ½åŠ›ï¼›

æŸ¥çœ‹å½“å‰çš„èƒ½åŠ›å¯ä»¥ä½¿ç”¨ ceph auth get USERTYPE.USERID å‘½ä»¤ï¼›

è¦å¢åŠ èƒ½åŠ›ï¼Œä½ åº”è¯¥åœ¨å¦‚ä¸‹æ ¼å¼çš„å‘½ä»¤ä¸­åŒ…å«å½“å‰å·²ç»å­˜åœ¨çš„èƒ½åŠ›ï¼š
```plain
ceph auth caps USERTYPE.USERID {daemon} 'allow [r|w|x|*|...] [pool={pool-name}] [namespace={namespace-name}]' [{daemon} 'allow [r|w|x|*|...] [pool={pool-name}] [namespace={namespace-name}]']
```
ä¾‹å¦‚ï¼š
```plain
ceph auth get client.john
ceph auth caps client.john mon 'allow r' osd 'allow rw pool=liverpool'
ceph auth caps client.paul mon 'allow rw' osd 'allow rwx pool=liverpool'
ceph auth caps client.brian-manager mon 'allow *' osd 'allow *'
```
è¦ç§»é™¤æŸä¸ªèƒ½åŠ›ï¼Œä½ å¯èƒ½éœ€è¦è¿›è¡Œé‡ç½®ã€‚å¦‚æœä½ æƒ³å–æ¶ˆæŸä¸ªç”¨æˆ·å¯¹ç‰¹å®šå®ˆæŠ¤è¿›ç¨‹çš„æ‰€æœ‰è®¿é—®æƒé™ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²ï¼›æ¯”å¦‚ï¼š
```plain
ceph auth caps client.ringo mon ' ' osd ' '
```
## 3.5 åˆ é™¤ç”¨æˆ·
æƒ³è¦åˆ é™¤ä¸€ä¸ªç”¨æˆ·ï¼Œå¯ä»¥ç”¨ ceph auth del å‘½ä»¤ï¼š
```plain
ceph auth del {TYPE}.{ID}
```
å…¶ä¸­ï¼Œ {TYPE} æ˜¯ clientï¼Œosdï¼Œmon æˆ– mds çš„å…¶ä¸­ä¸€ç§ï¼›

{ID} æ˜¯ç”¨æˆ·çš„åå­—æˆ–å®ˆæŠ¤è¿›ç¨‹çš„ ID ï¼›

## 3.6 æ‰“å°ç”¨æˆ·çš„å¯†é’¥
æ‰“å°æŸä¸ªç”¨æˆ·çš„æˆæƒå¯†é’¥åˆ°æ ‡å‡†è¾“å‡ºç•Œé¢ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
```plain
ceph auth print-key {TYPE}.{ID}
```
å…¶ä¸­ï¼Œ {TYPE} æ˜¯ clientï¼Œosdï¼Œmon æˆ– mds çš„å…¶ä¸­ä¸€ç§ï¼›

{ID} æ˜¯ç”¨æˆ·çš„åå­—æˆ–å®ˆæŠ¤è¿›ç¨‹çš„ ID ï¼›

å½“éœ€è¦å¾€å®¢æˆ·ç«¯è½¯ä»¶ä¸­æ³¨å…¥ Ceph ç”¨æˆ·ï¼ˆå¦‚ libvirtï¼‰çš„å¯†é’¥æ—¶ï¼Œæ‰“å°ç”¨æˆ·çš„å¯†é’¥æ—¶å¾ˆæœ‰ç”¨çš„ï¼›
```plain
mount -t ceph serverhost:/ mountpoint -o name=client.user,secret=`ceph auth print-key client.user`
```
## 3.7 å¯¼å…¥ç”¨æˆ·
ä½¿ç”¨ ceph auth import å‘½ä»¤å¹¶æŒ‡å®šå¯†é’¥æ–‡ä»¶ï¼Œå¯ä»¥å¯¼å…¥ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·ï¼š
```plain
ceph auth import -i /path/to/keyring
```
æ¯”å¦‚ï¼š
```plain
sudo ceph auth import -i /etc/ceph/ceph.keyring
```
# å››ã€ç§˜é’¥ç®¡ç†
å½“ä½ é€šè¿‡å®¢æˆ·ç«¯è®¿é—® Ceph é›†ç¾¤æ—¶ï¼ŒCeph å®¢æˆ·ç«¯ä¼šä½¿ç”¨æœ¬åœ°çš„ keyring æ–‡ä»¶ï¼›é»˜è®¤ä½¿ç”¨ä¸‹åˆ—è·¯å¾„å’Œåç§°çš„ keyring æ–‡ä»¶ï¼š
 - /etc/ceph/$cluster.$name.keyring
 - /etc/ceph/$cluster.keyring
 - /etc/ceph/keyring
 - /etc/ceph/keyring.bin

ä¹Ÿå¯ä»¥åœ¨ ceph.conf ä¸­å¦è¡ŒæŒ‡å®š keyring çš„è·¯å¾„ï¼Œä½†ä¸æ¨èè¿™æ ·åšï¼›

$cluster å…ƒå˜é‡æ˜¯ä½ çš„ Ceph é›†ç¾¤åç§°ï¼Œé»˜è®¤åç§°æ˜¯ ceph ï¼›

$name å…ƒå˜é‡æ˜¯ç”¨æˆ·ç±»å‹å’Œ ID ï¼›

æ¯”å¦‚ç”¨æˆ·æ˜¯ client.adminï¼Œé‚£å°±å¾—åˆ° ceph.client.admin.keyring ï¼›

æœ¬å°èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨ ceph-authtool å·¥å…·æ¥ä»å®¢æˆ·ç«¯ç®¡ç† keyring ï¼›

## 4.1 åˆ›å»ºå¯†é’¥
åˆ›å»ºä¸€ä¸ªç©ºçš„ keyring æ–‡ä»¶ï¼Œä½¿ç”¨ --create-keyring æˆ– -C é€‰é¡¹ï¼›æ¯”å¦‚ï¼š
```plain
ceph-authtool --create-keyring /path/to/keyring
```
åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªç”¨æˆ·çš„ keyring æ–‡ä»¶ï¼Œæ¨èä½¿ç”¨ $cluster.keyring ä½œä¸ºæ–‡ä»¶åï¼Œå¹¶å­˜æ”¾äº /etc/ceph ç›®å½•ä¸‹ï¼›

è¿™æ ·å°±æ— éœ€åœ¨æœ¬åœ°çš„ ceph.conf æ–‡ä»¶ä¸­æŒ‡å®š keyring çš„è·¯å¾„äº†ï¼›
```plain
sudo ceph-authtool -C /etc/ceph/ceph.keyring
```
åˆ›å»ºä»…åŒ…å«ä¸€ä¸ªç”¨æˆ·çš„ keyring æ–‡ä»¶æ—¶ï¼Œå»ºè®®ä½¿ç”¨é›†ç¾¤åã€ç”¨æˆ·ç±»å‹å’Œç”¨æˆ·åç§°ä½œä¸ºæ–‡ä»¶åï¼Œå¹¶å­˜æ”¾äº /etc/ceph ç›®å½•ä¸‹ï¼›

## 4.2 ç»™å¯†é’¥æ–‡ä»¶ä¸­å¢åŠ ç”¨æˆ·
ä¸ºäº†è·å–æŸä¸ªç”¨æˆ·çš„ keyring æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ ceph auth get å‘½ä»¤åŠ  -o é€‰é¡¹ï¼Œä»¥ keyring æ–‡ä»¶æ ¼å¼æ¥ä¿å­˜è¾“å‡ºï¼›æ¯”å¦‚ï¼š

```plain
ceph auth get client.admin -o /etc/ceph/ceph.client.admin.keyring
```
å½“ä½ æƒ³è¦å‘ keyring æ–‡ä»¶ä¸­å¯¼å…¥æŸä¸ªç”¨æˆ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ ceph-authtool æ¥æŒ‡å®šç›®çš„å’Œæº keyring æ–‡ä»¶ï¼›

æ¯”å¦‚ï¼š

```plain
ceph-authtool /etc/ceph/ceph.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
```
## 4.3 åˆ›å»ºç”¨æˆ·
å¯ä»¥åœ¨ Ceph å®¢æˆ·ç«¯ç›´æ¥åˆ›å»ºç”¨æˆ·ã€å¯†é’¥å’Œèƒ½åŠ›ï¼›ç„¶åå†å¯¼å…¥ Ceph é›†ç¾¤ï¼›

æ¯”å¦‚ï¼š

```plain
ceph-authtool -n client.ringo --cap osd 'allow rwx' --cap mon 'allow rwx' /etc/ceph/ceph.keyring
```
åˆ›å»º keyring æ–‡ä»¶ã€å¢åŠ ç”¨æˆ·ä¹Ÿå¯ä»¥åŒæ—¶è¿›è¡Œï¼›

æ¯”å¦‚ï¼š

```plain
ceph-authtool -C /etc/ceph/ceph.keyring -n client.ringo --cap osd 'allow rwx' --cap mon 'allow rwx' --gen-key
```
ä¸Šè¿°æ­¥éª¤ä¸­ï¼Œæ–°ç”¨æˆ· client.ringo ä»…å­˜åœ¨äº keyring æ–‡ä»¶ä¸­ï¼Œè¿˜éœ€è¦æŠŠæ–°ç”¨æˆ·åŠ å…¥åˆ° Ceph é›†ç¾¤ä¸­ï¼›
```plain
ceph auth add client.ringo -i /etc/ceph/ceph.keyring
```
## 4.4 ä¿®æ”¹ç”¨æˆ·èƒ½åŠ›
ä¿®æ”¹è®°å½•åœ¨ keyring æ–‡ä»¶ä¸­çš„ç”¨æˆ·èƒ½åŠ›æ—¶ï¼Œéœ€è¦æŒ‡å®š keyring ã€ç”¨æˆ·å’Œæ–°çš„èƒ½åŠ›é€‰é¡¹ï¼›

æ¯”å¦‚ï¼š

```plain
ceph-authtool /etc/ceph/ceph.keyring -n client.ringo --cap osd 'allow rwx' --cap mon 'allow rwx'
```
æ›´æ–° Ceph å­˜å‚¨é›†ç¾¤çš„ç”¨æˆ·ï¼Œä½ å¿…é¡»æ›´æ–° keyring æ–‡ä»¶ä¸­å¯¹åº”ç”¨æˆ·å…¥å£çš„ä¿¡æ¯ï¼›
```plain
ceph auth import -i /etc/ceph/ceph.keyring
```
# äº”ã€å‘½ä»¤è¡Œä½¿ç”¨æ–¹æ³•
Ceph æ”¯æŒé€šè¿‡ä¸‹åˆ—æ–¹å¼ä½¿ç”¨ç”¨æˆ·åç§°å’Œå¯†é’¥ï¼š

--id | --user

æè¿°ï¼š Ceph é€šè¿‡ç±»å‹å’Œ ID æ¥ç¡®å®šç”¨æˆ·ï¼Œå¦‚ TYPE.ID æˆ– client.admin, client.user1 ï¼›ä½¿ç”¨ --id æˆ– --user é€‰é¡¹æŒ‡å®šç”¨æˆ·çš„ IDï¼Œæ¯”å¦‚ï¼ŒæŒ‡å®šä½¿ç”¨ client.foo ç”¨æˆ·ï¼š
```plain
ceph --id foo --keyring /path/to/keyring health
ceph --user foo --keyring /path/to/keyring health
```
--name | -n

æè¿°ï¼š ä½¿ç”¨ --name æˆ– -n é€‰é¡¹æŒ‡å®šç”¨æˆ·çš„å…¨åï¼ˆ TYPE.ID ï¼‰ï¼Œæ¯”å¦‚ï¼š
```plain
ceph --name client.foo --keyring /path/to/keyring health
ceph -n client.foo --keyring /path/to/keyring health
```
--keyring

æè¿°ï¼š æŒ‡å®šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç”¨æˆ·åŠå…¶å¯†é’¥çš„ keyring æ–‡ä»¶è·¯å¾„ï¼› --secret é€‰é¡¹æä¾›åŒæ ·çš„åŠŸèƒ½ï¼Œä½†å¯¹ Ceph RADOS Gateway ä¸ç”Ÿæ•ˆï¼ˆ --secret é€‰é¡¹æœ‰å…¶ä»–çš„ä½œç”¨ï¼‰ï¼›æ¯”å¦‚ï¼š
```plain
rbd map --id foo --keyring /path/to/keyring mypool/myimage
```
