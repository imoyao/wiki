---
title: Linux ä¸‹å¦‚ä½•å®‰è£… Redisï¼Ÿ
tags: 
  - Redis
  - NoSQL
  - æ•°æ®åº“
  - HOWTO
categories: 
  - ğŸ’» å·¥ä½œ
  - æ•°æ®åº“
  - redis
date: 2019-04-11 10:03:08
permalink: /redis/install/
---
`Redis`æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„`key-value`æ•°æ®åº“ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•å¦‚ä½•åœ¨`Linux`ç³»ç»Ÿä¸Šè¿›è¡Œå®‰è£…ï¼Œä»¥åŠä¸º`Python`å¼€å‘å®‰è£…å¯¹åº”çš„`redis`æ¨¡å—ã€‚

<!--more-->

## å®éªŒç¯å¢ƒ

- `Linux`ç‰ˆæœ¬

    ```plain
    Ubuntu 18.04 LTS && NeoKylin 3.2
    ```

- `Python`ç‰ˆæœ¬

    ```plain
    Python 2.7.15rc1 && Python 2.6.6
    ```

- `Redis`ç‰ˆæœ¬

    ```plain
    redis-5.0.4
    ```

- `redis-py`ç‰ˆæœ¬

    ```plain
    redis-3.2.1 && redis-2.10.6
    ```


## ä¸‹è½½

ä¸‹è½½åœ°å€ï¼š`http://redis.io/download`ï¼Œä¸‹è½½æœ€æ–°ç¨³å®šç‰ˆæœ¬æºç ã€‚

æœ¬æ–‡ä½¿ç”¨çš„ç‰ˆæœ¬ä¸º `redis-5.0.4`ã€‚

## å®‰è£…

### Ubuntu

1. è§£å‹ç¼©

    é¦–å…ˆè¦è§£å‹`Redis`å‹ç¼©åŒ…ã€‚è¿›å…¥å‹ç¼©åŒ…ä¸‹è½½çš„è·¯å¾„ï¼Œæ‰§è¡Œï¼š
    
    ```shell
    tar xzf redis-5.0.4.tar.gz
    ```
2. ä½¿ç”¨`GCC`ç¼–è¯‘æºç 

    ```shell
    cd redis-5.0.4
    make
    ```
3. å®‰è£…`Redis`

    ```shell
    make install
    ```
4. éªŒè¯

    ```shell
    root@local:~/temp# redis-server -v
    Redis server v=5.0.4 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=3dcf53963ddc396a
    root@local:~/temp# whereis redis-server
    redis-server: /usr/local/bin/redis-server
    ```

è‡³æ­¤ï¼Œ`Redis`å®‰è£…å®Œæˆã€‚

### CentOs

1. ç¼–è¯‘å®‰è£…

    ```shell
    make $$ make install
    ```
    æ­¤æ—¶æŠ¥é”™
    ```shell
    CC adlist.o
    /bin/sh: cc: command not found
    make[1]: *** [adlist.o] Error 127
    make[1]: Leaving directory `/root/temp/redis-5.0.4/src'
    make: *** [all] Error 2
    ```

2. å®‰è£… gcc

    ```shell
    yum install gcc -y
    ```
    
3. é‡æ–° make

    ```shell
    make
    ```
    æ­¤æ—¶æŠ¥é”™
    ```shell
    In file included from adlist.c:34:
    zmalloc.h:50:31: error: jemalloc/jemalloc.h: No such file or directory
    zmalloc.h:55:2: error: #error "Newer version of jemalloc required"
    make[1]: *** [adlist.o] Error 1
    make[1]: Leaving directory `/root/temp/redis-5.0.4/src'
    make: *** [all] Error 2
    ```
    åœ¨æ„å»º`Redis`æ—¶é€‰æ‹©éé»˜è®¤å†…å­˜åˆ†é…å™¨æ˜¯é€šè¿‡è®¾ç½®`MALLOC`ç¯å¢ƒå˜é‡å®Œæˆçš„ï¼Œ é»˜è®¤æƒ…å†µä¸‹ Redis æ˜¯ä½¿ç”¨`malloc`ä¸º`libc`ç¼–è¯‘å’Œé“¾æ¥çš„ã€‚
    è€Œ`libc`å¹¶ä¸æ˜¯`Linux`ä¸Šé»˜è®¤çš„åˆ†é…å™¨ï¼Œé»˜è®¤çš„æ˜¯ `jemalloc`, å› ä¸º `jemalloc` è¢«è¯æ˜æ¯”`libc`æœ‰æ›´å°‘çš„ç¢ç‰‡é—®é¢˜ï¼ˆ`fragmentation problems`ï¼‰ã€‚
    ä½†æ˜¯å¦‚æœä½ æ²¡æœ‰`jemalloc` è€Œåªæœ‰`libc` å½“ç„¶ `make` å‡ºé”™ã€‚ æ‰€ä»¥æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š
    
    - ~~æ–¹æ³•ä¸€~~ï¼ˆä¸æ¨èï¼‰
    
    ```shell
    make MALLOC=libc
    ```
    
    ---
    - æ–¹æ³•äºŒ
    
    ```shell
    cd deps/
    make hiredis jemalloc linenoise lua geohash-int
    ```
    
    åŸå› å‚è§ï¼š [æµ…è°ˆ redis é‡‡ç”¨ä¸åŒå†…å­˜åˆ†é…å™¨ tcmalloc å’Œ jemalloc](http://www.jb51.net/article/100575.htm)
    
    >å¯¹äº`tcmalloc`ï¼Œ`jemalloc`å’Œ`libc`å¯¹åº”çš„ä¸‰ä¸ªå†…å­˜åˆ†é…å™¨ã€‚å…¶æ€§èƒ½å’Œç¢ç‰‡ç‡å¦‚ä½•å‘¢ï¼Ÿ
    >ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•æµ‹è¯•ç»“æœï¼Œä½¿ç”¨`Redis`è‡ªå¸¦çš„`redis-benchmark`å†™å…¥ç­‰é‡æ•°æ®è¿›è¡Œæµ‹è¯•ï¼Œæ•°æ®æ‘˜è‡ªé‡‡ç”¨ä¸åŒåˆ†é…å™¨æ—¶`Redis info`ä¿¡æ¯ã€‚
    >æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé‡‡ç”¨`tcmalloc`æ—¶ç¢ç‰‡ç‡æ˜¯æœ€ä½çš„ï¼Œä¸º`1.01`ï¼Œ`jemalloc`ä¸º`1.02`ï¼Œè€Œ`libc`çš„åˆ†é…å™¨ç¢ç‰‡ç‡ä¸º`1.31`ï¼Œ

4. ç¼–è¯‘å®‰è£…

    ```shell
    make $$ make install
    ```

5. éªŒè¯

 ```shell
    redis-server -v
    Redis server v=5.0.4 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=b139020f90f1d493
    whereis redis-server
    redis-server: /usr/local/bin/redis-server
 ```
è‡³æ­¤ï¼Œ`Redis`å®‰è£…å®Œæˆã€‚

## é…ç½®

é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®`Redis`æœåŠ¡å¼€æœºè‡ªå¯åŠ¨ã€‚

1. è®¾ç½®è‡ªå¯åŠ¨é…ç½®æ–‡ä»¶

    1. åˆ‡æ¢ç›®å½•
        
        ```shell
        cd utils/
        ```
    
    2. å¤åˆ¶è„šæœ¬æ–‡ä»¶
    
        ```shell
        cp redis_init_script /etc/init.d/redisd		## â‘ 		
        ```
    
        å°†`redis_init_script`æ–‡ä»¶é‡æ–°å‘½åä¸º`redisd`ï¼Œä½œä¸ºç³»ç»Ÿå¯åŠ¨æœåŠ¡åï¼ˆä»¥`d`ç»“å°¾è¡¨ç¤ºæ˜¯è‡ªå¯åŠ¨æœåŠ¡ï¼Œçº¦å®šä¿—æˆï¼‰ã€‚
    
    4. ä¿®æ”¹é…ç½®
    
        ```shell
        vi /etc/init.d/redisd
        ```
    
        ä¿®æ”¹`redisd`æ–‡ä»¶ï¼Œæ³¨æ„è¦åœ¨æ–‡ä»¶å¤´éƒ¨åŠ ä¸Šä¸¤å¥æ³¨é‡Šæ¥è®¾å®šè¯¥æœåŠ¡çš„è¿è¡Œçº§åˆ«
    
        ```shell
        #!/bin/sh
        # chkconfig:   2345 90 10
        ```

2.  è®¾ç½®`Redis`æ§åˆ¶è„šæœ¬çš„é…ç½®æ–‡ä»¶

    1. åˆ‡æ¢ç›®å½•
    
        ```shell
        cd -
        cd ..
        ```
    
    2. åœ¨`redis`å®‰è£…ç›®å½•ä¸‹ï¼Œæ‰¾åˆ°`redis.conf`æ–‡ä»¶
    
        ```shell
        ls
        ```
        
        å¦‚ä¸‹
        
        ```shell
        00-RELEASENOTES  INSTALL     runtest           tests
        BUGS             Makefile    runtest-cluster   utils
        CONTRIBUTING     MANIFESTO   runtest-sentinel
        COPYING          README.md   sentinel.conf
        deps             redis.conf  src
        ```
    
    3. å¤åˆ¶é…ç½®æ–‡ä»¶å¹¶é‡å‘½å
        
        ```shell
        cp redis.conf /etc/redis/6379.conf    ## â‘¡
        ```

    4. ç¼–è¾‘`Redis`é…ç½®æ–‡ä»¶
    
        1. è®¾ç½®`daemonize`ä¸º`yes`ï¼Œä½¿æœåŠ¡å¯ä»¥åå°è¿è¡Œï¼š
        
            ```shell
            # nu:136
            daemonize yes
            ```
    
        2. è®¾ç½®`log`æ–‡ä»¶è·¯å¾„ï¼š
        
            ```shell
            # nu:171
            logfile /var/log/redis/redis-server.log
            ```
        
        3. è®¾ç½®æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼š
        
            ```shell
            # nu:263
            dir /var/lib/redis
            ```
    
    5. ä¿å­˜é€€å‡ºï¼Œå¹¶åˆ›å»ºç›¸åº”çš„ç›®å½•ç»“æ„ï¼š
    
        ```shell
        mkdir /var/log/redis
        touch /var/log/redis/redis-server.log
        mkdir /var/lib/redis
        ```

3. è®¾ç½®å¼€æœºè‡ªå¯

    #### Ubuntu
    
    ```shell
    # èµ‹æƒ
    chmod +x /etc/init.d/redisd
    # æ›´æ–°ç³»ç»Ÿå¯åŠ¨é¡¹
    update-rc.d redisd defaults
    ```
    
    #### CentOS
    
    ```shell
    [root@master init.d]# chmod +x ./redisd
    [root@master init.d]# chkconfig redisd on
    ```

## é™„ï¼šå¸¸ç”¨`redis`ç®¡ç†å‘½ä»¤

- å¯åŠ¨`Redis`æœåŠ¡ï¼š

```shell
service redisd start
[root@master init.d]# service redisd start
Starting Redis server...
# éªŒè¯
[root@master init.d]# ps aux|grep redis|grep -v grep
root      6728  0.1  0.4  55572  9820 ?        Ssl  11:03   0:00 /usr/local/bin/redis-server 127.0.0.1:6379 
```

- å…³é—­æœåŠ¡ï¼š

```shell
[root@master init.d]# service redisd stop
Stopping ...
Redis stopped
[root@master init.d]# ps aux|grep redis|grep -v grep

```

- é‡å¯æœåŠ¡ï¼š

```shell
service redisd restart

```

- åœ¨æ§åˆ¶å°ä¸­ç™»å½•`redis`å®¢æˆ·ç«¯ï¼š

```plain
[root@master init.d]# redis-cli
# æµ‹è¯•redisè¿é€šæ€§
127.0.0.1:6379> ping
PONG
127.0.0.1:6379> set hello world
OK
127.0.0.1:6379> get hello
"world"

```

## å®‰è£…æä¾›`Python`æ”¯æŒ

### pip å®‰è£…

```shell
pip install redis
```

### æºç å®‰è£…

å»`https://pypi.org/project/redis/`ä¸‹è½½æºç ï¼Œ`Ubuntu`ä¸Šä½¿ç”¨æœ€æ–°ç‰ˆæœ¬`redis 3.2.1`

1. è§£å‹

    ```shell
    tar -xzvf redis-3.2.1.tar.gz
    ```

2. åˆ‡æ¢ç›®å½•
    
    ```shell
    cd redis-3.2.1
    ```

3. å®‰è£…

    ```shell
    python setup.py install
    ```
4. éªŒè¯
    
    ```shell
    root@local:~/temp/redis-3.2.1# python
    Python 2.7.15rc1 (default, Apr 15 2018, 21:51:34) 
    [GCC 7.3.0] on linux2
    Type "help", "copyright", "credits" or "license" for more information.
    >>> import redis
    >>> import redis
    >>> 
    >>> r = redis.Redis(host='localhost', port=6379, db=0)
    >>> ret = r.get('hello')
    >>> print ret
    world
    ```

---

**å°æ’æ›²**

å…³äº redis-py çš„ Python ä½ç‰ˆæœ¬æ”¯æŒ

åœ¨`CentOS`ä¸Šå®‰è£…`redis-3.2.1`çš„æ—¶å€™ç”±äº`python`ç‰ˆæœ¬è¾ƒä½ï¼ˆ`2.6.6`ï¼‰å‡ºç°ä»¥ä¸‹é—®é¢˜
```shell
[root@master redis-3.2.1]# python setup.py install
Traceback (most recent call last):
  File "setup.py", line 4, in <module>
    from setuptools import setup
ImportError: No module named setuptools
```
å®‰è£…`setuptools-0.6c9`ä¹‹åæ‰§è¡Œ`python setup.py install`æŠ¥é”™ï¼š

```shell
Traceback (most recent call last):
  File "setup.py", line 7, in <module>
    from redis import __version__
  File "/root/temp/pyredis-3.2.1/redis/__init__.py", line 1, in <module>
    from redis.client import Redis, StrictRedis
  File "/root/temp/pyredis-3.2.1/redis/client.py", line 3046
    return {decode(encode(k)): v for k, v in iteritems(data)}
                                   ^
SyntaxError: invalid syntax
```
å»å®˜ç½‘æŸ¥çœ‹ï¼Œå‘ç°æœ€æ–°ç‰ˆç‰ˆæœ¬æ”¯æŒä¸ºï¼š
```shell
Meta
â€¦â€¦
 Tags: Redis, key-value store

Requires: Python >=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*
```
ä»¥åŠ
> Python Version Support
> redis-py 3.0 now supports Python 2.7 and Python 3.4+. Python 2.6 and 3.3 support has been dropped.

æœ€åå®‰è£…è¾ƒä½ç‰ˆæœ¬ï¼ˆ`redis-2.10.6`ï¼‰æˆåŠŸï¼Œæ­¥éª¤åŒä¸Šï¼Œä¸å†èµ˜è¿°ã€‚

è¯»è€…å¯ä»¥ä» [è¿™é‡Œ](https://pypi.org/project/redis/#history) è·å–å†å²ç‰ˆæœ¬ï¼š`https://pypi.org/project/redis/#history`

## å‚è€ƒé“¾æ¥

- [Redis Quick Start](https://redis.io/topics/quickstart)
- [Ubuntu å®‰è£… Redis å¹¶è®¾ç½®ä¸ºå¼€æœºè‡ªå¯åŠ¨æœåŠ¡](https://blog.csdn.net/softwave/article/details/53838194)
- [Python æ“ä½œ Redis æ•°æ®åº“](https://www.cnblogs.com/cnkai/p/7642787.html)

â‘ ï¼šå†…å®¹è§ redisd
â‘¡ï¼šå†…å®¹è§ 6379.conf