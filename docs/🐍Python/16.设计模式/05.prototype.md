---
title: åŸå‹æ¨¡å¼
date: 2023-11-09 17:11:33
permalink: /python/patterns/prototype/
categories:
  - ğŸPython
  - è®¾è®¡æ¨¡å¼
  - åˆ›å»ºå‹æ¨¡å¼
tags:
  - åˆ›å»ºå‹æ¨¡å¼
  - å·¥å‚æ–¹æ³•æ¨¡å¼
  - åŸå‹æ¨¡å¼
---

## TL;DR
> Creates new object instances by cloning prototype.
é€šè¿‡å…‹éš†åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡å®ä¾‹

## æ„å›¾

æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åŸåŸæœ¬æœ¬åœ°ä¸ºå¯¹è±¡åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå‡è®¾ä½ æƒ³åˆ›å»ºä¸€ä¸ªåº”ç”¨æ¥å­˜å‚¨ã€åˆ†äº«ã€ç¼–è¾‘ï¼ˆæ¯”å¦‚ï¼Œä¿®æ”¹ã€æ·»åŠ æ³¨é‡ŠåŠåˆ é™¤ï¼‰é£Ÿè°±ã€‚ç”¨æˆ·Bobæ‰¾åˆ°ä¸€ä»½è›‹ç³•é£Ÿè°±ï¼Œåœ¨åšäº†ä¸€äº›æ”¹å˜åï¼Œè§‰å¾—è‡ªå·±åšçš„è›‹ç³•éå¸¸ç¾å‘³ï¼Œæƒ³è¦ä¸æœ‹å‹Aliceåˆ†äº«è¿™ä¸ªé£Ÿè°±ã€‚ä½†æ˜¯è¯¥å¦‚ä½•åˆ†äº«é£Ÿè°±å‘¢ï¼Ÿå¦‚æœåœ¨ä¸Aliceåˆ†äº«ä¹‹åï¼ŒBobæƒ³å¯¹é£Ÿè°±åšè¿›ä¸€æ­¥çš„è¯•éªŒï¼ŒAliceæ‰‹é‡Œçš„é£Ÿè°±ä¹Ÿèƒ½è·Ÿç€å˜åŒ–å—ï¼ŸBobèƒ½
å¤ŸæŒæœ‰è›‹ç³•é£Ÿè°±çš„ä¸¤ä¸ªå‰¯æœ¬å—ï¼Ÿå¯¹è›‹ç³•é£Ÿè°±è¿›è¡Œçš„è¯•éªŒæ€§å˜æ›´ä¸åº”è¯¥å¯¹åŸæœ¬ç¾å‘³è›‹ç³•çš„é£Ÿè°±é€ æˆå½±å“ã€‚
è¿™æ ·çš„é—®é¢˜å¯ä»¥é€šè¿‡è®©ç”¨æˆ·å¯¹åŒä¸€ä»½é£Ÿè°±æŒæœ‰å¤šä¸ªç‹¬ç«‹çš„å‰¯æœ¬æ¥è§£å†³ã€‚æ¯ä¸ªå‰¯æœ¬è¢«ç§°ä¸ºä¸€ä¸ªå…‹éš†ï¼Œæ˜¯æŸä¸ªæ—¶é—´ç‚¹åŸæœ‰å¯¹è±¡çš„ä¸€ä¸ªå®Œå…¨å‰¯æœ¬ã€‚è¿™é‡Œæ—¶é—´æ˜¯ä¸€ä¸ªé‡è¦å› ç´ ã€‚å› ä¸ºå®ƒä¼šå½±å“å…‹éš†æ‰€åŒ…å«çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœBobåœ¨å¯¹è›‹ç³•é£Ÿè°±åšæ”¹è¿›ä»¥è‡»å®Œç¾ä¹‹å‰å°±ä¸Aliceåˆ†äº«äº†ï¼Œé‚£ä¹ˆAliceå°±ç»ä¸å¯èƒ½åƒBobé‚£æ ·çƒ˜çƒ¤å‡ºè‡ªå·±çš„ç¾å‘³è›‹ç³•ï¼Œåªèƒ½æŒ‰ç…§BobåŸæ¥æ‰¾åˆ°çš„é£Ÿè°±çƒ˜çƒ¤è›‹ç³•ã€‚
æ³¨æ„å¼•ç”¨ä¸å‰¯æœ¬ä¹‹é—´çš„åŒºåˆ«ã€‚å¦‚æœBobå’ŒAliceæŒæœ‰çš„æ˜¯åŒä¸€ä¸ªè›‹ç³•é£Ÿè°±å¯¹è±¡çš„ä¸¤ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆBobå¯¹é£Ÿè°±åšçš„ä»»ä½•æ”¹å˜ï¼Œå¯¹äºAliceçš„é£Ÿè°±ç‰ˆæœ¬éƒ½æ˜¯å¯è§çš„ï¼Œåä¹‹äº¦ç„¶ã€‚æˆ‘ä»¬æƒ³è¦çš„æ˜¯Bobå’ŒAliceå„è‡ªæŒæœ‰è‡ªå·±çš„å‰¯æœ¬ï¼Œè¿™æ ·ä»–ä»¬å¯ä»¥å„è‡ªåšå˜æ›´è€Œä¸ä¼šå½±å“å¯¹æ–¹çš„é£Ÿè°±ã€‚å®é™…ä¸ŠBobéœ€è¦è›‹ç³•é£Ÿè°±çš„ä¸¤ä¸ªå‰¯æœ¬ï¼šç¾å‘³ç‰ˆæœ¬å’Œè¯•éªŒç‰ˆæœ¬ã€‚

**åŸå‹æ¨¡å¼**æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œ ä½¿ä½ èƒ½å¤Ÿå¤åˆ¶å·²æœ‰å¯¹è±¡ï¼Œ è€Œåˆæ— éœ€ä½¿ä»£ç ä¾èµ–å®ƒä»¬æ‰€å±çš„ç±»ã€‚

![åŸå‹è®¾è®¡æ¨¡å¼](https://refactoringguru.cn/images/patterns/content/prototype/prototype.png)

## é—®é¢˜

å¦‚æœä½ æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å¸Œæœ›ç”Ÿæˆä¸å…¶å®Œå…¨ç›¸åŒçš„ä¸€ä¸ªå¤åˆ¶å“ï¼Œ ä½ è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ é¦–å…ˆï¼Œä½ å¿…é¡»æ–°å»ºä¸€ä¸ªå±äºç›¸åŒç±»çš„å¯¹è±¡ã€‚ ç„¶åï¼Œä½ å¿…é¡»éå†åŸå§‹å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œ å¹¶å°†æˆå‘˜å˜é‡å€¼å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­ã€‚

ä¸é”™ï¼ä½†æœ‰ä¸ªå°é—®é¢˜ã€‚å¹¶éæ‰€æœ‰å¯¹è±¡éƒ½èƒ½é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œå¤åˆ¶ï¼Œå› ä¸ºæœ‰äº›å¯¹è±¡å¯èƒ½æ‹¥æœ‰ç§æœ‰æˆå‘˜å˜é‡ï¼Œå®ƒä»¬åœ¨å¯¹è±¡æœ¬èº«ä»¥å¤–æ˜¯ä¸å¯è§çš„ã€‚

![ä»å¤–éƒ¨å¤åˆ¶å¯¹è±¡ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ](https://refactoringguru.cn/images/patterns/content/prototype/prototype-comic-1-zh.png)

â€œä»å¤–éƒ¨â€ å¤åˆ¶å¯¹è±¡[å¹¶é](https://refactoringguru.cn/cargo-cult)æ€»æ˜¯å¯è¡Œã€‚

ç›´æ¥å¤åˆ¶è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ã€‚ å› ä¸ºä½ å¿…é¡»çŸ¥é“å¯¹è±¡æ‰€å±çš„ç±»æ‰èƒ½åˆ›å»ºå¤åˆ¶å“ï¼Œ æ‰€ä»¥ä»£ç å¿…é¡»ä¾èµ–è¯¥ç±»ã€‚ å³ä½¿ä½ å¯ä»¥æ¥å—é¢å¤–çš„ä¾èµ–æ€§ï¼Œ é‚£è¿˜æœ‰å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š æœ‰æ—¶ä½ åªçŸ¥é“å¯¹è±¡æ‰€å®ç°çš„æ¥å£ï¼Œ è€Œä¸çŸ¥é“å…¶æ‰€å±çš„å…·ä½“ç±»ï¼Œ æ¯”å¦‚å¯å‘æ–¹æ³•çš„æŸä¸ªå‚æ•°ä¼ å…¥å®ç°äº†æŸä¸ªæ¥å£çš„ä»»ä½•å¯¹è±¡ã€‚

## è§£å†³æ–¹æ¡ˆ

åŸå‹æ¨¡å¼å°†å…‹éš†è¿‡ç¨‹å§”æ´¾ç»™è¢«å…‹éš†çš„å®é™…å¯¹è±¡ã€‚ æ¨¡å¼ä¸ºæ‰€æœ‰æ”¯æŒå…‹éš†çš„å¯¹è±¡å£°æ˜äº†ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œ è¯¥æ¥å£è®©ä½ èƒ½å¤Ÿå…‹éš†å¯¹è±¡ï¼Œ åŒæ—¶åˆæ— éœ€å°†ä»£ç å’Œå¯¹è±¡æ‰€å±ç±»è€¦åˆã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œ è¿™æ ·çš„æ¥å£ä¸­ä»…åŒ…å«ä¸€ä¸ª `å…‹éš†`æ–¹æ³•ã€‚

æ‰€æœ‰çš„ç±»å¯¹ `å…‹éš†`æ–¹æ³•çš„å®ç°éƒ½éå¸¸ç›¸ä¼¼ã€‚ è¯¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªå½“å‰ç±»çš„å¯¹è±¡ï¼Œ ç„¶åå°†åŸå§‹å¯¹è±¡æ‰€æœ‰çš„æˆå‘˜å˜é‡å€¼å¤åˆ¶åˆ°æ–°å»ºçš„ç±»ä¸­ã€‚ ä½ ç”šè‡³å¯ä»¥å¤åˆ¶ç§æœ‰æˆå‘˜å˜é‡ï¼Œ å› ä¸ºç»å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½å…è®¸å¯¹è±¡è®¿é—®å…¶åŒç±»å¯¹è±¡çš„ç§æœ‰æˆå‘˜å˜é‡ã€‚

æ”¯æŒå…‹éš†çš„å¯¹è±¡å³ä¸º_åŸå‹_ã€‚ å½“ä½ çš„å¯¹è±¡æœ‰å‡ åä¸ªæˆå‘˜å˜é‡å’Œå‡ ç™¾ç§ç±»å‹æ—¶ï¼Œ å¯¹å…¶è¿›è¡Œå…‹éš†ç”šè‡³å¯ä»¥ä»£æ›¿å­ç±»çš„æ„é€ ã€‚

![é¢„ç”ŸæˆåŸå‹](https://refactoringguru.cn/images/patterns/content/prototype/prototype-comic-2-zh.png)

é¢„ç”ŸæˆåŸå‹å¯ä»¥ä»£æ›¿å­ç±»çš„æ„é€ ã€‚

å…¶è¿ä½œæ–¹å¼å¦‚ä¸‹ï¼š åˆ›å»ºä¸€ç³»åˆ—ä¸åŒç±»å‹çš„å¯¹è±¡å¹¶ä¸åŒçš„æ–¹å¼å¯¹å…¶è¿›è¡Œé…ç½®ã€‚ å¦‚æœæ‰€éœ€å¯¹è±¡ä¸é¢„å…ˆé…ç½®çš„å¯¹è±¡ç›¸åŒï¼Œ é‚£ä¹ˆä½ åªéœ€å…‹éš†åŸå‹å³å¯ï¼Œ æ— éœ€æ–°å»ºä¸€ä¸ªå¯¹è±¡ã€‚

## çœŸå®ä¸–ç•Œç±»æ¯”

ç°å®ç”Ÿæ´»ä¸­ï¼Œ äº§å“åœ¨å¾—åˆ°å¤§è§„æ¨¡ç”Ÿäº§å‰ä¼šä½¿ç”¨åŸå‹è¿›è¡Œå„ç§æµ‹è¯•ã€‚ ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ åŸå‹åªæ˜¯ä¸€ç§è¢«åŠ¨çš„å·¥å…·ï¼Œ ä¸å‚ä¸ä»»ä½•çœŸæ­£çš„ç”Ÿäº§æ´»åŠ¨ã€‚

![ç»†èƒåˆ†è£‚](https://refactoringguru.cn/images/patterns/content/prototype/prototype-comic-3-zh.png)

ä¸€ä¸ªç»†èƒçš„åˆ†è£‚ã€‚

ç”±äºå·¥ä¸šåŸå‹å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„è‡ªæˆ‘å¤åˆ¶ï¼Œ å› æ­¤ç»†èƒæœ‰ä¸åˆ†è£‚ ï¼ˆè¿˜è®°å¾—ç”Ÿç‰©å­¦çŸ¥è¯†å—ï¼Ÿï¼‰ æˆ–è®¸æ˜¯æ›´æ°å½“çš„ç±»æ¯”ã€‚ æœ‰ä¸åˆ†è£‚ä¼šäº§ç”Ÿä¸€å¯¹å®Œå…¨ç›¸åŒçš„ç»†èƒã€‚ åŸå§‹ç»†èƒå°±æ˜¯ä¸€ä¸ªåŸå‹ï¼Œ å®ƒåœ¨å¤åˆ¶ä½“çš„ç”Ÿæˆè¿‡ç¨‹ä¸­èµ·åˆ°äº†æ¨åŠ¨ä½œç”¨ã€‚

## åŸå‹æ¨¡å¼ç»“æ„

### åŸºæœ¬å®ç°

![structure.png (500Ã—400)](https://refactoringguru.cn/images/patterns/diagrams/prototype/structure.png)

1.  **åŸå‹** ï¼ˆPrototypeï¼‰ æ¥å£å°†å¯¹å…‹éš†æ–¹æ³•è¿›è¡Œå£°æ˜ã€‚ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ å…¶ä¸­åªä¼šæœ‰ä¸€ä¸ªåä¸º `clone`å…‹éš†çš„æ–¹æ³•ã€‚
    
2.  **å…·ä½“åŸå‹** ï¼ˆConcrete Prototypeï¼‰ ç±»å°†å®ç°å…‹éš†æ–¹æ³•ã€‚ é™¤äº†å°†åŸå§‹å¯¹è±¡çš„æ•°æ®å¤åˆ¶åˆ°å…‹éš†ä½“ä¸­ä¹‹å¤–ï¼Œ è¯¥æ–¹æ³•æœ‰æ—¶è¿˜éœ€å¤„ç†å…‹éš†è¿‡ç¨‹ä¸­çš„æç«¯æƒ…å†µï¼Œ ä¾‹å¦‚å…‹éš†å…³è”å¯¹è±¡å’Œæ¢³ç†é€’å½’ä¾èµ–ç­‰ç­‰ã€‚
    
3.  **å®¢æˆ·ç«¯** ï¼ˆClientï¼‰ å¯ä»¥å¤åˆ¶å®ç°äº†åŸå‹æ¥å£çš„ä»»ä½•å¯¹è±¡ã€‚
    

### åŸå‹æ³¨å†Œè¡¨å®ç°

![structure-prototype-cache](https://refactoringguru.cn/images/patterns/diagrams/prototype/structure-prototype-cache.png)

1.  **åŸå‹æ³¨å†Œè¡¨** ï¼ˆPrototype Registryï¼‰ æä¾›äº†ä¸€ç§è®¿é—®å¸¸ç”¨åŸå‹çš„ç®€å•æ–¹æ³•ï¼Œ å…¶ä¸­å­˜å‚¨äº†ä¸€ç³»åˆ—å¯ä¾›éšæ—¶å¤åˆ¶çš„é¢„ç”Ÿæˆå¯¹è±¡ã€‚ æœ€ç®€å•çš„æ³¨å†Œè¡¨åŸå‹æ˜¯ä¸€ä¸ª `åç§° â†’ åŸå‹`çš„å“ˆå¸Œè¡¨ã€‚ ä½†å¦‚æœéœ€è¦ä½¿ç”¨åç§°ä»¥å¤–çš„æ¡ä»¶è¿›è¡Œæœç´¢ï¼Œ ä½ å¯ä»¥åˆ›å»ºæ›´åŠ å®Œå–„çš„æ³¨å†Œè¡¨ç‰ˆæœ¬ã€‚
    

## ä¼ªä»£ç 

åœ¨æœ¬ä¾‹ä¸­ï¼Œ **åŸå‹**æ¨¡å¼èƒ½è®©ä½ ç”Ÿæˆå®Œå…¨ç›¸åŒçš„å‡ ä½•å¯¹è±¡å‰¯æœ¬ï¼Œ åŒæ—¶æ— éœ€ä»£ç ä¸å¯¹è±¡æ‰€å±ç±»è€¦åˆã€‚

![åŸå‹æ¨¡å¼ç¤ºä¾‹çš„ç»“æ„](https://refactoringguru.cn/images/patterns/diagrams/prototype/example.png)

å…‹éš†ä¸€ç³»åˆ—ä½äºåŒä¸€ç±»å±‚æ¬¡ç»“æ„ä¸­çš„å¯¹è±¡ã€‚

æ‰€æœ‰å½¢çŠ¶ç±»éƒ½éµå¾ªåŒä¸€ä¸ªæä¾›å…‹éš†æ–¹æ³•çš„æ¥å£ã€‚ åœ¨å¤åˆ¶è‡ªèº«æˆå‘˜å˜é‡å€¼åˆ°ç»“æœå¯¹è±¡å‰ï¼Œ å­ç±»å¯è°ƒç”¨å…¶çˆ¶ç±»çš„å…‹éš†æ–¹æ³•ã€‚

```
// åŸºç¡€åŸå‹ã€‚
abstract class Shape is
    field X: int
    field Y: int
    field color: string

    // å¸¸è§„æ„é€ å‡½æ•°ã€‚
    constructor Shape() is
        // â€¦â€¦

    // åŸå‹æ„é€ å‡½æ•°ã€‚ä½¿ç”¨å·²æœ‰å¯¹è±¡çš„æ•°å€¼æ¥åˆå§‹åŒ–ä¸€ä¸ªæ–°å¯¹è±¡ã€‚
    constructor Shape(source: Shape) is
        this()
        this.X = source.X
        this.Y = source.Y
        this.color = source.color

    // cloneï¼ˆå…‹éš†ï¼‰æ“ä½œä¼šè¿”å›ä¸€ä¸ªå½¢çŠ¶å­ç±»ã€‚
    abstract method clone():Shape


// å…·ä½“åŸå‹ã€‚å…‹éš†æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡å¹¶å°†å…¶ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚ç›´åˆ°æ„é€ å‡½æ•°è¿
// è¡Œå®Œæˆå‰ï¼Œå®ƒéƒ½æ‹¥æœ‰æŒ‡å‘æ–°å…‹éš†å¯¹è±¡çš„å¼•ç”¨ã€‚å› æ­¤ï¼Œä»»ä½•äººéƒ½æ— æ³•è®¿é—®æœªå®Œå…¨ç”Ÿ
// æˆçš„å…‹éš†å¯¹è±¡ã€‚è¿™å¯ä»¥ä¿æŒå…‹éš†ç»“æœçš„ä¸€è‡´ã€‚
class Rectangle extends Shape is
    field width: int
    field height: int

    constructor Rectangle(source: Rectangle) is
        // éœ€è¦è°ƒç”¨çˆ¶æ„é€ å‡½æ•°æ¥å¤åˆ¶çˆ¶ç±»ä¸­å®šä¹‰çš„ç§æœ‰æˆå‘˜å˜é‡ã€‚
        super(source)
        this.width = source.width
        this.height = source.height

    method clone():Shape is
        return new Rectangle(this)


class Circle extends Shape is
    field radius: int

    constructor Circle(source: Circle) is
        super(source)
        this.radius = source.radius

    method clone():Shape is
        return new Circle(this)


// å®¢æˆ·ç«¯ä»£ç ä¸­çš„æŸä¸ªä½ç½®ã€‚
class Application is
    field shapes: array of Shape

    constructor Application() is
        Circle circle = new Circle()
        circle.X = 10
        circle.Y = 10
        circle.radius = 20
        shapes.add(circle)

        Circle anotherCircle = circle.clone()
        shapes.add(anotherCircle)
        // å˜é‡ `anotherCircleï¼ˆå¦ä¸€ä¸ªåœ†ï¼‰`ä¸ `circleï¼ˆåœ†ï¼‰`å¯¹è±¡çš„å†…
        // å®¹å®Œå…¨ä¸€æ ·ã€‚

        Rectangle rectangle = new Rectangle()
        rectangle.width = 10
        rectangle.height = 20
        shapes.add(rectangle)

    method businessLogic() is
        // åŸå‹æ˜¯å¾ˆå¼ºå¤§çš„ä¸œè¥¿ï¼Œå› ä¸ºå®ƒèƒ½åœ¨ä¸çŸ¥æ™“å¯¹è±¡ç±»å‹çš„æƒ…å†µä¸‹ç”Ÿæˆä¸€ä¸ªä¸
        // å…¶å®Œå…¨ç›¸åŒçš„å¤åˆ¶å“ã€‚
        Array shapesCopy = new Array of Shapes.

        // ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸çŸ¥æ™“å½¢çŠ¶æ•°ç»„ä¸­å…ƒç´ çš„å…·ä½“ç±»å‹ï¼ŒåªçŸ¥é“å®ƒä»¬éƒ½æ˜¯å½¢çŠ¶ã€‚
        // ä½†åœ¨å¤šæ€æœºåˆ¶çš„å¸®åŠ©ä¸‹ï¼Œå½“æˆ‘ä»¬åœ¨æŸä¸ªå½¢çŠ¶ä¸Šè°ƒç”¨ `cloneï¼ˆå…‹éš†ï¼‰`
        // æ–¹æ³•æ—¶ï¼Œç¨‹åºä¼šæ£€æŸ¥å…¶æ‰€å±çš„ç±»å¹¶è°ƒç”¨å…¶ä¸­æ‰€å®šä¹‰çš„å…‹éš†æ–¹æ³•ã€‚è¿™æ ·ï¼Œ
        // æˆ‘ä»¬å°†è·å¾—ä¸€ä¸ªæ­£ç¡®çš„å¤åˆ¶å“ï¼Œè€Œä¸æ˜¯ä¸€ç»„ç®€å•çš„å½¢çŠ¶å¯¹è±¡ã€‚
        foreach (s in shapes) do
            shapesCopy.add(s.clone())

        // `shapesCopyï¼ˆå½¢çŠ¶å‰¯æœ¬ï¼‰`æ•°ç»„ä¸­åŒ…å« `shapeï¼ˆå½¢çŠ¶ï¼‰`æ•°ç»„æ‰€æœ‰
        // å­å…ƒç´ çš„å¤åˆ¶å“ã€‚

```

## åŸå‹æ¨¡å¼é€‚åˆåº”ç”¨åœºæ™¯

å¦‚æœä½ éœ€è¦å¤åˆ¶ä¸€äº›å¯¹è±¡ï¼Œ åŒæ—¶åˆå¸Œæœ›ä»£ç ç‹¬ç«‹äºè¿™äº›å¯¹è±¡æ‰€å±çš„å…·ä½“ç±»ï¼Œ å¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼ã€‚

è¿™ä¸€ç‚¹è€ƒé‡é€šå¸¸å‡ºç°åœ¨ä»£ç éœ€è¦å¤„ç†ç¬¬ä¸‰æ–¹ä»£ç é€šè¿‡æ¥å£ä¼ é€’è¿‡æ¥çš„å¯¹è±¡æ—¶ã€‚ å³ä½¿ä¸è€ƒè™‘ä»£ç è€¦åˆçš„æƒ…å†µï¼Œ ä½ çš„ä»£ç ä¹Ÿä¸èƒ½ä¾èµ–è¿™äº›å¯¹è±¡æ‰€å±çš„å…·ä½“ç±»ï¼Œ å› ä¸ºä½ ä¸çŸ¥é“å®ƒä»¬çš„å…·ä½“ä¿¡æ¯ã€‚

åŸå‹æ¨¡å¼ä¸ºå®¢æˆ·ç«¯ä»£ç æä¾›ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œ å®¢æˆ·ç«¯ä»£ç å¯é€šè¿‡è¿™ä¸€æ¥å£ä¸æ‰€æœ‰å®ç°äº†å…‹éš†çš„å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œ å®ƒä¹Ÿä½¿å¾—å®¢æˆ·ç«¯ä»£ç ä¸å…¶æ‰€å…‹éš†çš„å¯¹è±¡å…·ä½“ç±»ç‹¬ç«‹å¼€æ¥ã€‚

å¦‚æœå­ç±»çš„åŒºåˆ«ä»…åœ¨äºå…¶å¯¹è±¡çš„åˆå§‹åŒ–æ–¹å¼ï¼Œ é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å¼æ¥å‡å°‘å­ç±»çš„æ•°é‡ã€‚ åˆ«äººåˆ›å»ºè¿™äº›å­ç±»çš„ç›®çš„å¯èƒ½æ˜¯ä¸ºäº†åˆ›å»ºç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚

åœ¨åŸå‹æ¨¡å¼ä¸­ï¼Œ ä½ å¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—é¢„ç”Ÿæˆçš„ã€ å„ç§ç±»å‹çš„å¯¹è±¡ä½œä¸ºåŸå‹ã€‚

å®¢æˆ·ç«¯ä¸å¿…æ ¹æ®éœ€æ±‚å¯¹å­ç±»è¿›è¡Œå®ä¾‹åŒ–ï¼Œ åªéœ€æ‰¾åˆ°åˆé€‚çš„åŸå‹å¹¶å¯¹å…¶è¿›è¡Œå…‹éš†å³å¯ã€‚

## å®ç°æ–¹å¼

1.  åˆ›å»ºåŸå‹æ¥å£ï¼Œ å¹¶åœ¨å…¶ä¸­å£°æ˜ `å…‹éš†`æ–¹æ³•ã€‚ å¦‚æœä½ å·²æœ‰ç±»å±‚æ¬¡ç»“æ„ï¼Œ åˆ™åªéœ€åœ¨å…¶æ‰€æœ‰ç±»ä¸­æ·»åŠ è¯¥æ–¹æ³•å³å¯ã€‚
    
2.  åŸå‹ç±»å¿…é¡»å¦è¡Œå®šä¹‰ä¸€ä¸ªä»¥è¯¥ç±»å¯¹è±¡ä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ã€‚ æ„é€ å‡½æ•°å¿…é¡»å¤åˆ¶å‚æ•°å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡å€¼åˆ°æ–°å»ºå®ä½“ä¸­ã€‚ å¦‚æœä½ éœ€è¦ä¿®æ”¹å­ç±»ï¼Œ åˆ™å¿…é¡»è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œ è®©çˆ¶ç±»å¤åˆ¶å…¶ç§æœ‰æˆå‘˜å˜é‡å€¼ã€‚
    
    å¦‚æœç¼–ç¨‹è¯­è¨€ä¸æ”¯æŒæ–¹æ³•é‡è½½ï¼Œ é‚£ä¹ˆä½ å¯èƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•æ¥å¤åˆ¶å¯¹è±¡æ•°æ®ã€‚ åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œæ­¤ç±»å¤„ç†æ¯”è¾ƒæ–¹ä¾¿ï¼Œ å› ä¸ºå®ƒåœ¨è°ƒç”¨ `new`è¿ç®—ç¬¦åä¼šé©¬ä¸Šè¿”å›ç»“æœå¯¹è±¡ã€‚
    
3.  å…‹éš†æ–¹æ³•é€šå¸¸åªæœ‰ä¸€è¡Œä»£ç ï¼š ä½¿ç”¨ `new`è¿ç®—ç¬¦è°ƒç”¨åŸå‹ç‰ˆæœ¬çš„æ„é€ å‡½æ•°ã€‚ æ³¨æ„ï¼Œ æ¯ä¸ªç±»éƒ½å¿…é¡»æ˜¾å¼é‡å†™å…‹éš†æ–¹æ³•å¹¶ä½¿ç”¨è‡ªèº«ç±»åè°ƒç”¨ `new`è¿ç®—ç¬¦ã€‚ å¦åˆ™ï¼Œ å…‹éš†æ–¹æ³•å¯èƒ½ä¼šç”Ÿæˆçˆ¶ç±»çš„å¯¹è±¡ã€‚
    
4.  ä½ è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­å¿ƒåŒ–åŸå‹æ³¨å†Œè¡¨ï¼Œ ç”¨äºå­˜å‚¨å¸¸ç”¨åŸå‹ã€‚
    
    ä½ å¯ä»¥æ–°å»ºä¸€ä¸ªå·¥å‚ç±»æ¥å®ç°æ³¨å†Œè¡¨ï¼Œ æˆ–è€…åœ¨åŸå‹åŸºç±»ä¸­æ·»åŠ ä¸€ä¸ªè·å–åŸå‹çš„é™æ€æ–¹æ³•ã€‚ è¯¥æ–¹æ³•å¿…é¡»èƒ½å¤Ÿæ ¹æ®å®¢æˆ·ç«¯ä»£ç è®¾å®šçš„æ¡ä»¶è¿›è¡Œæœç´¢ã€‚ æœç´¢æ¡ä»¶å¯ä»¥æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œ æˆ–è€…æ˜¯ä¸€ç»„å¤æ‚çš„æœç´¢å‚æ•°ã€‚ æ‰¾åˆ°åˆé€‚çš„åŸå‹åï¼Œ æ³¨å†Œè¡¨åº”å¯¹åŸå‹è¿›è¡Œå…‹éš†ï¼Œ å¹¶å°†å¤åˆ¶ç”Ÿæˆçš„å¯¹è±¡è¿”å›ç»™å®¢æˆ·ç«¯ã€‚
    
    æœ€åè¿˜è¦å°†å¯¹å­ç±»æ„é€ å‡½æ•°çš„ç›´æ¥è°ƒç”¨æ›¿æ¢ä¸ºå¯¹åŸå‹æ³¨å†Œè¡¨å·¥å‚æ–¹æ³•çš„è°ƒç”¨ã€‚
    

## åŸå‹æ¨¡å¼ä¼˜ç¼ºç‚¹
1. ä¼˜ç‚¹
-   ä½ å¯ä»¥å…‹éš†å¯¹è±¡ï¼Œ è€Œæ— éœ€ä¸å®ƒä»¬æ‰€å±çš„å…·ä½“ç±»ç›¸è€¦åˆã€‚
-   ä½ å¯ä»¥å…‹éš†é¢„ç”ŸæˆåŸå‹ï¼Œ é¿å…åå¤è¿è¡Œåˆå§‹åŒ–ä»£ç ã€‚
-   ä½ å¯ä»¥æ›´æ–¹ä¾¿åœ°ç”Ÿæˆå¤æ‚å¯¹è±¡ã€‚
-   ä½ å¯ä»¥ç”¨ç»§æ‰¿ä»¥å¤–çš„æ–¹å¼æ¥å¤„ç†å¤æ‚å¯¹è±¡çš„ä¸åŒé…ç½®ã€‚
2. ç¼ºç‚¹
-   å…‹éš†åŒ…å«å¾ªç¯å¼•ç”¨çš„å¤æ‚å¯¹è±¡å¯èƒ½ä¼šéå¸¸éº»çƒ¦ã€‚

## ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»

-   åœ¨è®¸å¤šè®¾è®¡å·¥ä½œçš„åˆæœŸéƒ½ä¼šä½¿ç”¨[å·¥å‚æ–¹æ³•æ¨¡å¼](https://refactoringguru.cn/design-patterns/factory-method) ï¼ˆè¾ƒä¸ºç®€å•ï¼Œ è€Œä¸”å¯ä»¥æ›´æ–¹ä¾¿åœ°é€šè¿‡å­ç±»è¿›è¡Œå®šåˆ¶ï¼‰ï¼Œ éšåæ¼”åŒ–ä¸ºä½¿ç”¨[æŠ½è±¡å·¥å‚æ¨¡å¼](https://refactoringguru.cn/design-patterns/abstract-factory)ã€ [åŸå‹æ¨¡å¼](https://refactoringguru.cn/design-patterns/prototype)æˆ–[ç”Ÿæˆå™¨æ¨¡å¼](https://refactoringguru.cn/design-patterns/builder) ï¼ˆæ›´çµæ´»ä½†æ›´åŠ å¤æ‚ï¼‰ã€‚
    
-   [æŠ½è±¡å·¥å‚æ¨¡å¼](https://refactoringguru.cn/design-patterns/abstract-factory)é€šå¸¸åŸºäºä¸€ç»„[å·¥å‚æ–¹æ³•](https://refactoringguru.cn/design-patterns/factory-method)ï¼Œ ä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨[åŸå‹æ¨¡å¼](https://refactoringguru.cn/design-patterns/prototype)æ¥ç”Ÿæˆè¿™äº›ç±»çš„æ–¹æ³•ã€‚
    
-   [åŸå‹](https://refactoringguru.cn/design-patterns/prototype)å¯ç”¨äºä¿å­˜[å‘½ä»¤æ¨¡å¼](https://refactoringguru.cn/design-patterns/command)çš„å†å²è®°å½•ã€‚
    
-   å¤§é‡ä½¿ç”¨[ç»„åˆæ¨¡å¼](https://refactoringguru.cn/design-patterns/composite)å’Œ[è£…é¥°æ¨¡å¼](https://refactoringguru.cn/design-patterns/decorator)çš„è®¾è®¡é€šå¸¸å¯ä»å¯¹äº[åŸå‹](https://refactoringguru.cn/design-patterns/prototype)çš„ä½¿ç”¨ä¸­è·ç›Šã€‚ ä½ å¯ä»¥é€šè¿‡è¯¥æ¨¡å¼æ¥å¤åˆ¶å¤æ‚ç»“æ„ï¼Œ è€Œéä»é›¶å¼€å§‹é‡æ–°æ„é€ ã€‚
    
-   [åŸå‹](https://refactoringguru.cn/design-patterns/prototype)å¹¶ä¸åŸºäºç»§æ‰¿ï¼Œ å› æ­¤æ²¡æœ‰ç»§æ‰¿çš„ç¼ºç‚¹ã€‚ å¦ä¸€æ–¹é¢ï¼Œ _åŸå‹_éœ€è¦å¯¹è¢«å¤åˆ¶å¯¹è±¡è¿›è¡Œå¤æ‚çš„åˆå§‹åŒ–ã€‚ [å·¥å‚æ–¹æ³•](https://refactoringguru.cn/design-patterns/factory-method)åŸºäºç»§æ‰¿ï¼Œ ä½†æ˜¯å®ƒä¸éœ€è¦åˆå§‹åŒ–æ­¥éª¤ã€‚
    
-   æœ‰æ—¶å€™[åŸå‹](https://refactoringguru.cn/design-patterns/prototype)å¯ä»¥ä½œä¸º[å¤‡å¿˜å½•æ¨¡å¼](https://refactoringguru.cn/design-patterns/memento)çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼Œ å…¶æ¡ä»¶æ˜¯ä½ éœ€è¦åœ¨å†å²è®°å½•ä¸­å­˜å‚¨çš„å¯¹è±¡çš„çŠ¶æ€æ¯”è¾ƒç®€å•ï¼Œ ä¸éœ€è¦é“¾æ¥å…¶ä»–å¤–éƒ¨èµ„æºï¼Œ æˆ–è€…é“¾æ¥å¯ä»¥æ–¹ä¾¿åœ°é‡å»ºã€‚
    
-   [æŠ½è±¡å·¥å‚](https://refactoringguru.cn/design-patterns/abstract-factory)ã€ [ç”Ÿæˆå™¨](https://refactoringguru.cn/design-patterns/builder)å’Œ[åŸå‹](https://refactoringguru.cn/design-patterns/prototype)éƒ½å¯ä»¥ç”¨[å•ä¾‹æ¨¡å¼](https://refactoringguru.cn/design-patterns/singleton)æ¥å®ç°ã€‚

## ç¤ºä¾‹ä»£ç 
```python
import copy


class SelfReferencingEntity:
    def __init__(self):
        self.parent = None

    def set_parent(self, parent):
        self.parent = parent


class SomeComponent:
    """
    Python provides its own interface of Prototype via `copy.copy` and
    `copy.deepcopy` functions. And any class that wants to implement custom
    implementations have to override `__copy__` and `__deepcopy__` member
    functions.
    """

    def __init__(self, some_int, some_list_of_objects, some_circular_ref):
        self.some_int = some_int
        self.some_list_of_objects = some_list_of_objects
        self.some_circular_ref = some_circular_ref

    def __copy__(self):
        """
        Create a shallow copy. This method will be called whenever someone calls
        `copy.copy` with this object and the returned value is returned as the
        new shallow copy.
        """

        # First, let's create copies of the nested objects.
        some_list_of_objects = copy.copy(self.some_list_of_objects)
        some_circular_ref = copy.copy(self.some_circular_ref)

        # Then, let's clone the object itself, using the prepared clones of the
        # nested objects.
        new = self.__class__(
            self.some_int, some_list_of_objects, some_circular_ref
        )
        new.__dict__.update(self.__dict__)

        return new

    def __deepcopy__(self, memo=None):
        """
        Create a deep copy. This method will be called whenever someone calls
        `copy.deepcopy` with this object and the returned value is returned as
        the new deep copy.

        What is the use of the argument `memo`? Memo is the dictionary that is
        used by the `deepcopy` library to prevent infinite recursive copies in
        instances of circular references. Pass it to all the `deepcopy` calls
        you make in the `__deepcopy__` implementation to prevent infinite
        recursions.
        """
        if memo is None:
            memo = {}

        # First, let's create copies of the nested objects.
        some_list_of_objects = copy.deepcopy(self.some_list_of_objects, memo)
        some_circular_ref = copy.deepcopy(self.some_circular_ref, memo)

        # Then, let's clone the object itself, using the prepared clones of the
        # nested objects.
        new = self.__class__(
            self.some_int, some_list_of_objects, some_circular_ref
        )
        new.__dict__ = copy.deepcopy(self.__dict__, memo)

        return new


if __name__ == "__main__":

    list_of_objects = [1, {1, 2, 3}, [1, 2, 3]]
    circular_ref = SelfReferencingEntity()
    component = SomeComponent(23, list_of_objects, circular_ref)
    circular_ref.set_parent(component)

    shallow_copied_component = copy.copy(component)

    # Let's change the list in shallow_copied_component and see if it changes in
    # component.
    shallow_copied_component.some_list_of_objects.append("another object")
    if component.some_list_of_objects[-1] == "another object":
        print(
            "Adding elements to `shallow_copied_component`'s "
            "some_list_of_objects adds it to `component`'s "
            "some_list_of_objects."
        )
    else:
        print(
            "Adding elements to `shallow_copied_component`'s "
            "some_list_of_objects doesn't add it to `component`'s "
            "some_list_of_objects."
        )

    # Let's change the set in the list of objects.
    component.some_list_of_objects[1].add(4)
    if 4 in shallow_copied_component.some_list_of_objects[1]:
        print(
            "Changing objects in the `component`'s some_list_of_objects "
            "changes that object in `shallow_copied_component`'s "
            "some_list_of_objects."
        )
    else:
        print(
            "Changing objects in the `component`'s some_list_of_objects "
            "doesn't change that object in `shallow_copied_component`'s "
            "some_list_of_objects."
        )

    deep_copied_component = copy.deepcopy(component)

    # Let's change the list in deep_copied_component and see if it changes in
    # component.
    deep_copied_component.some_list_of_objects.append("one more object")
    if component.some_list_of_objects[-1] == "one more object":
        print(
            "Adding elements to `deep_copied_component`'s "
            "some_list_of_objects adds it to `component`'s "
            "some_list_of_objects."
        )
    else:
        print(
            "Adding elements to `deep_copied_component`'s "
            "some_list_of_objects doesn't add it to `component`'s "
            "some_list_of_objects."
        )

    # Let's change the set in the list of objects.
    component.some_list_of_objects[1].add(10)
    if 10 in deep_copied_component.some_list_of_objects[1]:
        print(
            "Changing objects in the `component`'s some_list_of_objects "
            "changes that object in `deep_copied_component`'s "
            "some_list_of_objects."
        )
    else:
        print(
            "Changing objects in the `component`'s some_list_of_objects "
            "doesn't change that object in `deep_copied_component`'s "
            "some_list_of_objects."
        )

    print(
        f"id(deep_copied_component.some_circular_ref.parent): "
        f"{id(deep_copied_component.some_circular_ref.parent)}"
    )
    print(
        f"id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent): "
        f"{id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent)}"
    )
    print(
        "^^ This shows that deepcopied objects contain same reference, they "
        "are not cloned repeatedly."
    )
```
è¾“å‡º
```plain
Adding elements to `shallow_copied_component`'s some_list_of_objects adds it to `component`'s some_list_of_objects.
Changing objects in the `component`'s some_list_of_objects changes that object in `shallow_copied_component`'s some_list_of_objects.
Adding elements to `deep_copied_component`'s some_list_of_objects doesn't add it to `component`'s some_list_of_objects.
Changing objects in the `component`'s some_list_of_objects doesn't change that object in `deep_copied_component`'s some_list_of_objects.
id(deep_copied_component.some_circular_ref.parent): 4429472784
id(deep_copied_component.some_circular_ref.parent.some_circular_ref.parent): 4429472784
^^ This shows that deepcopied objects contain same reference, they are not cloned repeatedly.
```

```python
"""
*What is this pattern about?
This patterns aims to reduce the number of classes required by an
application. Instead of relying on subclasses it creates objects by
copying a prototypical instance at run-time.

This is useful as it makes it easier to derive new kinds of objects,
when instances of the class have only a few different combinations of
state, and when instantiation is expensive.

*What does this example do?
When the number of prototypes in an application can vary, it can be
useful to keep a Dispatcher (aka, Registry or Manager). This allows
clients to query the Dispatcher for a prototype before cloning a new
instance.

Below provides an example of such Dispatcher, which contains three
copies of the prototype: 'default', 'objecta' and 'objectb'.

*TL;DR
Creates new object instances by cloning prototype.
"""
from __future__ import annotations

from typing import Any


class Prototype:
    def __init__(self, value: str = "default", **attrs: Any) -> None:
        self.value = value
        self.__dict__.update(attrs)

    def clone(self, **attrs: Any) -> Prototype:
        """Clone a prototype and update inner attributes dictionary"""
        # Python in Practice, Mark Summerfield
        # copy.deepcopy can be used instead of next line.
        obj = self.__class__(**self.__dict__)
        obj.__dict__.update(attrs)
        return obj


class PrototypeDispatcher:
    def __init__(self):
        self._objects = {}

    def get_objects(self) -> dict[str, Prototype]:
        """Get all objects"""
        return self._objects

    def register_object(self, name: str, obj: Prototype) -> None:
        """Register an object"""
        self._objects[name] = obj

    def unregister_object(self, name: str) -> None:
        """Unregister an object"""
        del self._objects[name]


def main() -> None:
    """
    >>> dispatcher = PrototypeDispatcher()
    >>> prototype = Prototype()

    >>> d = prototype.clone()
    >>> a = prototype.clone(value='a-value', category='a')
    >>> b = a.clone(value='b-value', is_checked=True)
    >>> dispatcher.register_object('objecta', a)
    >>> dispatcher.register_object('objectb', b)
    >>> dispatcher.register_object('default', d)

    >>> [{n: p.value} for n, p in dispatcher.get_objects().items()]
    [{'objecta': 'a-value'}, {'objectb': 'b-value'}, {'default': 'default'}]

    >>> print(b.category, b.is_checked)
    a True
    """


if __name__ == "__main__":
    import doctest

    doctest.testmod()

```

```python
# coding: utf-8

import copy
from collections import OrderedDict


class Book:

    def __init__(self, name, authors, price, **rest):
        '''restçš„ä¾‹å­æœ‰ï¼šå‡ºç‰ˆå•†ï¼Œé•¿åº¦ï¼Œæ ‡ç­¾ï¼Œå‡ºç‰ˆæ—¥æœŸ'''
        self.name = name
        self.authors = authors
        self.price = price      # å•ä½ä¸ºç¾å…ƒ
        self.__dict__.update(rest)

    def __str__(self):
        mylist = []
        ordered = OrderedDict(sorted(self.__dict__.items()))
        for i in ordered.keys():
            mylist.append('{}: {}'.format(i, ordered[i]))
            if i == 'price':
                mylist.append('$')
            mylist.append('\n')
        return ''.join(mylist)


class Prototype:

    def __init__(self):
        self.objects = dict()

    def register(self, identifier, obj):
        self.objects[identifier] = obj

    def unregister(self, identifier):
        del self.objects[identifier]

    def clone(self, identifier, **attr):
        found = self.objects.get(identifier)
        if not found:
            raise ValueError('Incorrect object identifier: {}'.format(identifier))
        obj = copy.deepcopy(found)
        obj.__dict__.update(attr)
        return obj


def main():
    b1 = Book('The C Programming Language', ('Brian W. Kernighan', 'Dennis M.Ritchie'), price=118, publisher='Prentice Hall',
              length=228, publication_date='1978-02-22', tags=('C', 'programming', 'algorithms', 'data structures'))

    prototype = Prototype()
    cid = 'k&r-first'
    prototype.register(cid, b1)
    b2 = prototype.clone(cid, name='The C Programming Language(ANSI)', price=48.99,
                         length=274, publication_date='1988-04-01', edition=2)

    for i in (b1, b2):
        print(i)
    print('ID b1 : {} != ID b2 : {}'.format(id(b1), id(b2)))

if __name__ == '__main__':
    main()
```