---
title: Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ MySQLdb æ¨¡å—

tags: 
  - ç¼–ç 
  - é¢å‘å¯¹è±¡
top: 1
categories: 
  - ðŸ’» å·¥ä½œ
  - ðŸPython
  - å…¨æ ˆä¹‹è·¯
  - ç¬¬ä¸‰æ–¹åº“
date: 2020-05-23 18:21:46
permalink: /pylibs/8c2475/
---
# Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ MySQLdb æ¨¡å—

MySQLdb æ¨¡å—çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æä¾› Python æ“ä½œ MySQL æ•°æ®åº“çš„ä¸€ä¸ª API,é€šè¿‡ MySQLdb æ¨¡å—æˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œ**`å¢ž`,`åˆ `,`æ”¹`,`æŸ¥`,** ç­‰æ“ä½œ.

MySQLdb å·¥ä½œæµç¨‹å¦‚ä¸‹:

![mysqldb-01](/images/2016/12/1483022284.png)

 ## connection

 `connection`æ–¹æ³•ç”¨äºŽåˆ›å»ºå®¢æˆ·ç«¯ä¸Žæ•°æ®åº“çš„ç½‘ç»œè¿žæŽ¥.

 è¯­æ³•:

 ```python
MySQLdb.Connect(å‚æ•°)
 ```

**å‚æ•°**

|å‚æ•°|ç±»åž‹|è¯´æ˜Ž|
|:--:|:--|:--|
|host|å­—ç¬¦ä¸²|MySQL æœåŠ¡å™¨åœ°å€|
|port|æ•´åž‹|MySQL æœåŠ¡å™¨ç«¯å£å·|
|user|å­—ç¬¦ä¸²|MySQL æ•°æ®åº“ç”¨æˆ·å|
|passwd|å­—ç¬¦ä¸²|MySQL æ•°æ®åº“å¯†ç |
|db|å­—ç¬¦ä¸²|MySQL æ•°æ®åº“åº“å|
|charset|å­—ç¬¦ä¸²|è¿žæŽ¥æ‰€ä½¿ç”¨çš„å­—ç¬¦é›†|

**ä¾‹å¦‚:**

```python
# å¯¼å…¥MySQLdbæ¨¡å—
>>> import MySQLdb
# åˆ›å»ºä¸€ä¸ªConnectè¿žæŽ¥
>>> conn = MySQLdb.Connect(host='127.0.0.1', user='root', passwd='as', db='USER', port=3306, charset="utf8")
>>> cursor = conn.cursor()
>>> print(cursor)
<MySQLdb.cursors.Cursor object at 0x7f4af5e15550>
>>> print(conn)
<_mysql.connection open to '127.0.0.1' at 15b1518>
# å…³é—­è¿žæŽ¥
>>> conn.close()
>>> print(conn)
<_mysql.connection closed at 15b1518>
```

**connection å¯¹è±¡æ”¯æŒçš„æ–¹æ³•**

|æ–¹æ³•å|è¯´æ˜Ž|
|:--:|:--|
|cursor()|ä½¿ç”¨è¯¥è¿žæŽ¥åˆ›å»ºå¹¶è¿”å›žæ¸¸æ ‡|
|commit()|æäº¤å½“å‰äº‹åŠ¡|
|rollback()|å›žæ»šå½“å‰äº‹åŠ¡|
|close()|å…³é—­è¿žæŽ¥|

## cursor

`cursor`ç”¨æˆ·æ‰§è¡ŒæŸ¥è¯¢å’ŒèŽ·å–ç»“æžœ,æ‰§è¡Œæµç¨‹å¦‚ä¸‹:

![mysqldb-02](/images/2016/12/1483022315.png)

**cursor å¯¹è±¡æ‰€æ”¯æŒçš„æ–¹æ³•**

|å‚æ•°å|è¯´æ˜Ž|
|:--:|:--|
|execute("SQL")|æ‰§è¡Œçš„ SQL è¯­å¥|
|fetchone()|èŽ·å–ç»“æžœçš„ä¸‹ä¸€è¡Œ|
|fetchmany(size)|èŽ·å–ç»“æžœçš„ä¸‹å‡ è¡Œ|
|fetchall()|èŽ·å–ç»“æžœå‰©ä¸‹çš„æ‰€æœ‰è¡Œ|
|rowcount|æœ€è¿‘ä¸€æ¬¡ execute è¿”å›žæ•°æ®çš„è¡Œæ•°æˆ–å½±å“çš„è¡Œæ•°|
|close()|å…³é—­æ¸¸æ ‡å¯¹è±¡|

## äº‹åŠ¡

è®¿é—®é¢æ›´æ–°æ•°æ®åº“çš„ä¸€ä¸ªç¨‹åºæ‰§è¡Œå•å…ƒ,æ‰§è¡Œå•å…ƒæŒ‡çš„å°±æ˜¯å¾ˆå¤šæ“ä½œçš„é›†åˆ,é‡Œé¢çš„æ¯ä¸ªæ“ä½œéƒ½æ˜¯ç”¨æ¥è®¿é—®ä¸ªæ›´æ–°æ•°æ®åº“.

- åŽŸå­æ€§: äº‹åŠ¡ä¸­åŒ…æ‹¬çš„è¯¸å¤šæ“ä½œè¦ä¹ˆéƒ½åšè¦ä¹ˆéƒ½ä¸åš

æ¯”å¦‚é“¶è¡Œè½¬è´¦,A ç”¨æˆ·å‘ B ç”¨æˆ·è½¬è´¦ 100,A-100 å’Œ B+100 è¿™ä¸¤ä¸ªæ“ä½œ,è¦ä¹ˆéƒ½åš,è¦ä¹ˆéƒ½ä¸æ“ä½œ

1. ä¸€è‡´æ€§: äº‹åŠ¡å¿…é¡»ä½¿æ•°æ®åº“ä»Žä¸€è‡´æ€§çŠ¶æ€å˜åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€
2. éš”ç¦»æ€§: ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸èƒ½è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°
3. æŒä¹…æ€§: äº‹åŠ¡ä¸€æ—¦æäº¤,ä»–å¯¹æ•°æ®åº“çš„æ”¹å˜æ˜¯æ°¸ä¹…æ€§çš„

**å¼€å‘ä¸­æ€Žæ ·ä½¿ç”¨äº‹åŠ¡?**

1. å…³é—­è‡ªåŠ¨ commit: è®¾ç½® conn.autocommit(False),`MySQLdb`é»˜è®¤å·²ç»ä¸º`False`
2. æ­£å¸¸ç»“æŸäº‹åŠ¡: conn.commit()
3. å¼‚å¸¸ç»“æŸäº‹åŠ¡: conn.rollback()

## å®žä¾‹

- SELECT æŸ¥è¯¢æ•°æ®

å…ˆåˆ›å»ºä¸€ä¸ª`user`è¡¨:

```sql
CREATE DATABASE USER;
USE USER;
CREATE TABLE `user` (
`userid` INT(11) NOT NULL AUTO_INCREMENT,
`username` VARCHAR(100) DEFAULT NULL,
PRIMARY KEY (`userid`)
) ENGINE=INNODB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;
```

æ’å…¥ä»¥ä¸‹å†…å®¹

```sql
INSERT INTO user(userid, username) VALUES(1, 'name1');
INSERT INTO user(userid, username) VALUES(2, 'name2');
INSERT INTO user(userid, username) VALUES(3, 'name3');
INSERT INTO user(userid, username) VALUES(4, 'name4');
INSERT INTO user(userid, username) VALUES(5, 'name5');
```

æŸ¥çœ‹æ•°æ®

```bash
mysql> SELECT * FROM user;
+--------+----------+
| userid | username |
+--------+----------+
|      1 | name1    |
|      2 | name2    |
|      3 | name3    |
|      4 | name4    |
|      5 | name5    |
+--------+----------+
5 rows in set (0.00 sec)
```

```python
>>> import MySQLdb
>>> conn = MySQLdb.Connect(host='127.0.0.1', user='root', passwd='as', db='USER', port=3306, charset="utf8")
>>> cursor = conn.cursor()
>>> SQL = "SELECT * FROM user"
# è¿”å›žèŽ·å–åˆ°çš„å¤šå°‘è¡Œ
>>> cursor.execute(SQL)
5
# è¾“å‡ºèŽ·å–åˆ°çš„è¡Œæ•°
>>> print(cursor.rowcount)
5
# è¿”å›žç¬¬ä¸€æ¡æ•°æ®
>>> cursor.fetchone()
(1, 'name1')
# è¿”å›žä¸¤æ¡æ•°æ®
>>> cursor.fetchmany(2)
((2, 'name2'), (3, 'name3'))
# è¿”å›žå‰©ä¸‹çš„æ‰€æœ‰æ•°æ®
>>> cursor.fetchall()
((4, 'name4'), (5, 'name5'))
```

- insert/update/delete

æµç¨‹å›¾:

![mysqldb-03](/images/2016/12/1483022364.png)

```python
>>> import MySQLdb
>>> conn = MySQLdb.Connect(host='127.0.0.1', user='root', passwd='as', db='USER', port=3306, charset="utf8")
>>> cursor = conn.cursor()
>>> cursor.execute("INSERT INTO user(userid, username) VALUES(50, 'name50')")
1
>>> cursor.execute("UPDATE user SET username='as' WHERE userid=1")
1
>>> cursor.execute("DELETE FROM user WHERE userid=2")
1
>>> conn.commit()
>>> cursor.close()
>>> conn.close()
```

æŸ¥çœ‹æ•°æ®åº“è¡¨å†…å®¹

```bash
mysql> SELECT * FROM user;
+--------+----------+
| userid | username |
+--------+----------+
|      1 | as       |
|      3 | name3    |
|      4 | name4    |
|      5 | name5    |
|     50 | name50   |
+--------+----------+
5 rows in set (0.00 sec)
```
