---
title: Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ requests æ¨¡å—

tags: 
  - ç¼–ç 
  - é¢å‘å¯¹è±¡
top: 8
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - ç¬¬ä¸‰æ–¹åº“
date: 2020-05-23 18:21:46
permalink: /pages/3a2fb7/
---

# Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ requests æ¨¡å—

> Requests is the only Non-GMO HTTP library for Python, safe for human consumption.

å®˜æ–¹æ–‡æ¡£ï¼šhttp://docs.python-requests.org/en/master/

## å®‰è£…`Requests`æ¨¡å—

`Requests`æ¨¡å—å®˜æ–¹æä¾›äº†ä¸¤ç§æ–¹å¼å®‰è£…ï¼š

pip æ–¹å¼å®‰è£…

```bash
pip install requests
```

æºç æ–¹å¼å®‰è£…

```bash
git clone git://github.com/kennethreitz/requests.git
cd requests
python setup.py install
```

éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ

è¿›å…¥`python`è§£é‡Šçš„ï¼Œå¯¼å…¥æ¨¡å—è¯•è¯•ï¼Œå¦‚æœå¯¼å…¥æˆåŠŸåˆ™å®‰è£…æˆåŠŸï¼Œå¦åˆ™å°±éœ€è¦æ£€æŸ¥é‚£é‡Œæ‰§è¡Œé”™è¯¯äº†å‘¢ã€‚

```python
C:\Users\anshengme> python
Python 3.5.1 (v3.5.1:37a07cee5969, Dec  6 2016, 01:54:25) [MSC v.1900 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import requests
```

## ç¯å¢ƒå‡†å¤‡

å®‰è£…`gunicorn`å’Œ`httpbin`

```bash
sudo pip3 install gunicorn httpbin
```

å¯åŠ¨ä¸€ä¸ª`gunicorn`Server

```bash
â‡’  sudo gunicorn httpbin:app
[2016-10-27 11:45:08 +0800] [12175] [INFO] Starting gunicorn 19.6.0
[2016-10-27 11:45:08 +0800] [12175] [INFO] Listening at: https://blog.ansheng.me:8000 (12175)
[2016-10-27 11:45:08 +0800] [12175] [INFO] Using worker: sync
[2016-10-27 11:45:08 +0800] [12178] [INFO] Booting worker with pid: 12178
```

æ‰“å¼€æµè§ˆå™¨è¾“å…¥å°†ä¼šå¾—åˆ°ä»¥ä¸‹é¡µé¢ï¼Œç›¸å½“äºåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ª http server ä¾¿äºå­¦ä¹  requests æ¨¡å—

![requests-01](/images/2016/12/1483018481.png)

## ç®€å•çš„ä¸€ä¸ª requests å°ç¨‹åº

ä¸‹é¢çš„ä¸€ä¸ªå°ç¨‹åºä¼šé€šè¿‡`requests`è¯·æ±‚`'https://blog.ansheng.me:8000/ip'`è¿™ä¸ª URI é“¾æ¥ï¼Œè·å–åˆ°å¯¹åº”çš„æ•°æ®ã€‚

```python
#!/use/bin/env python3
# _*_ coding:utf-8 _*_
import requests

URL_IP = 'https://blog.ansheng.me:8000/ip'

def use_params_requests():
    # å‚æ•°
    params = {'params1': 'Hello', 'params2': 'World'}
    # å‘é€è¯·æ±‚
    response = requests.get(URL_IP, params=params)
    print("å“åº”çš„çŠ¶æ€ç ï¼š", response.status_code, response.reason)
    print("è¿”å›çš„å¤´éƒ¨ï¼š", response.headers)
    print("æŠŠè¿”å›çš„æ•°æ®è½¬æ¢ä¸ºjson:", response.json())
    print("å“åº”çš„æ–‡æœ¬ï¼š", response.text)

if __name__ == '__main__':
    use_params_requests()
```

## å‘é€è¯·æ±‚

é€šè¿‡ GITHUB æä¾›çš„ API è·å–ç”¨æˆ·ä¿¡æ¯

```python
#!/use/bin/env python3
# _*_ coding:utf-8 _*_
import requests
import json

URL = 'https://api.github.com'


def build_uri(endpoint):
    return '/'.join([URL, endpoint])


def better_print(json_str):
    return json.dumps(json.loads(json_str), indent=4)


def request_method():
    # è·å–ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯
    response = requests.get(build_uri('users/anshengme'))
    print(better_print((response.text)))

    print("\n")

    # è·å–ç”¨æˆ·çš„é‚®ç®±
    response = requests.get(build_uri('user/emails'), auth=("anshengme.com@gmail.com", "xxxxxx"))
    print(better_print((response.text)))


if __name__ == '__main__':
    request_method()
```

å¸¦å‚æ•°çš„è¯·æ±‚

```Python
# ä½¿ç”¨paramsä¼ å‚
def params_request():
    response = requests.get(build_uri('users'), params={'since': 11})
    print(better_print(response.text))
    print(response.request.headers)
    print(response.url)

# ä½¿ç”¨jsonä¼ å‚æ–¹å¼
def json_request():
    response = requests.get(build_uri('user'), auth=("username", "email"), json={"name": "asdas"})
    print(better_print(response.text))
```

å¼‚å¸¸å¤„ç†

```python
def timeout_request():
    try:
        response = requests.get(build_uri('user/emails'), timeout=10)
        response.raise_for_status()
    except Exception as e:
        print(e)
    else:
        print(response.text)
        print(response.status_code)
```

è‡ªå®šä¹‰ request

```python
from requests import Request, Session

def hard_request():
    s = Session()
    # åˆ›å»ºè¯·æ±‚
    headers = {'User-Agent': 'fake1.3.4'}
    req = Request('GET', build_uri('user/emails'), auth=('anshengme.com@gmail.com', 'xxxxxx'), headers=headers)
    prepped = req.prepare()
    print("è¯·æ±‚å¤´ã€‹ã€‹", prepped.headers)
    # å‘é€è¯·æ±‚
    resp = s.send(prepped)
    print(resp.status_code)
    print(resp.request.headers)
    print(resp.text)
```

## å®ä¾‹

ä¸‹è½½å›¾ç‰‡/æ–‡ä»¶

```python
#!/use/bin/env python3
# _*_ coding:utf-8 _*_
import requests
from contextlib import closing


# æµä¼ è¾“çš„æ¨¡å¼
def download_img():
    url = "http://www.sinaimg.cn/IT/cr/2016/0331/725124517.jpg"
    # headers = {
    #     'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36'}
    # response = requests.get(url, headers=headers, stream=True)
    response = requests.get(url, stream=True)
    print(response.status_code, response.reason)

    with open('github.jpg', 'wb') as fd:
        for chunk in response.iter_content(128):
            fd.write(chunk)

def download_img_improved():
    url = "http://www.sinaimg.cn/IT/cr/2016/0331/725124517.jpg"
    with closing(requests.get(url, stream=True)) as response:
        # æ‰“å¼€å¹¶å†™å…¥æ–‡ä»¶
        with open('github1.jpg', 'wb') as fd:
            for chunk in response.iter_content(128):
                fd.write(chunk)

download_img()
download_img_improved()
```

å¤„ç†å“åº”çš„äº‹ä»¶é’©å­

```python
#!/use/bin/env python3
# _*_ coding:utf-8 _*_
import requests

def get_key_info(response, *args, **kwargs):
    print(response.headers["Content-Type"])

def main():
    requests.get("https://www.baidu.com", hooks=dict(response=get_key_info))

if __name__ == "__main__":
    main()
```