---
title: Python å…¨æ ˆä¹‹è·¯ç³»åˆ—ä¹‹çº¿ç¨‹ä¸è¿›ç¨‹
tags: 
  - ç¼–ç 
  - threading
top: 1
categories: 
  - ğŸ’»å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - æ“ä½œç³»ç»Ÿ
date: 2020-05-23 18:21:46
permalink: /pages/5332c6/
---

## ä»€ä¹ˆæ˜¯çº¿ç¨‹

çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ï¼Œå®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­ï¼Œæ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½ï¼Œä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯è¿›ç¨‹ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚

åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹çš„æ•°æ®æ˜¯å¯ä»¥è¿›è¡Œäº’ç›¸è®¿é—®çš„ã€‚

çº¿ç¨‹çš„åˆ‡æ¢ä½¿ç”¨è¿‡ä¸Šä¸‹æ–‡æ¥å®ç°çš„ï¼Œæ¯”å¦‚æœ‰ä¸€æœ¬ä¹¦ï¼Œæœ‰ a å’Œ b è¿™ä¸¤ä¸ªäºº(ä¸¤ä¸ªçº¿ç¨‹)çœ‹ï¼Œa çœ‹å®Œä¹‹åè®°å½•å½“å‰çœ‹åˆ°é‚£ä¸€é¡µå“ªä¸€è¡Œï¼Œç„¶åäº¤ç»™ b çœ‹ï¼Œb çœ‹å®Œä¹‹åè®°å½•å½“å‰çœ‹åˆ°äº†é‚£ä¸€é¡µå“ªä¸€è¡Œï¼Œæ­¤æ—¶ a åˆè¦çœ‹äº†ï¼Œé‚£ä¹ˆ a å°±é€šè¿‡ä¸Šæ¬¡è®°å½•çš„å€¼(ä¸Šä¸‹æ–‡)ç›´æ¥æ‰¾åˆ°ä¸Šæ¬¡çœ‹åˆ°äº†å“ªé‡Œï¼Œç„¶åç»§ç»­å¾€ä¸‹çœ‹ã€‚

## ä»€ä¹ˆæ˜¯è¿›ç¨‹

ä¸€ä¸ªè¿›ç¨‹è‡³å°‘è¦åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨çš„å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹é‡Œé¢çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸»çº¿ç¨‹ï¼Œæ¯æ¬¡åœ¨è¿›ç¨‹å†…åˆ›å»ºçš„å­çº¿ç¨‹éƒ½æ˜¯ç”±ä¸»çº¿ç¨‹è¿›ç¨‹åˆ›å»ºå’Œé”€æ¯ï¼Œå­çº¿ç¨‹ä¹Ÿå¯ä»¥ç”±ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚

è¿›ç¨‹æ˜¯å¯¹å„ç§èµ„æºç®¡ç†å’Œè°ƒåº¦çš„é›†åˆï¼Œæ¯”å¦‚è¦è°ƒç”¨å†…å­˜ã€CPUã€ç½‘å¡ã€å£°å¡ç­‰ï¼Œè¿›ç¨‹è¦æ“ä½œä¸Šè¿°çš„ç¡¬ä»¶ä¹‹å‰éƒ½å¿…é¡»è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›ç¨‹é‡Œé¢å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹ï¼ŒQQ å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚

ç»§ç»­æ‹¿ QQ æ¥è¯´ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨æ‰“å¼€ QQ çš„èŠå¤©çª—å£ã€ä¸ªäººä¿¡æ¯çª—å£ã€è®¾ç½®çª—å£ç­‰ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ‰“å¼€çš„çª—å£éƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä»–ä»¬éƒ½åœ¨æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œæ¯”å¦‚èŠå¤©çª—å£è¿™ä¸ªçº¿ç¨‹å¯ä»¥å’Œå¥½å‹è¿›è¡Œäº’åŠ¨ï¼ŒèŠå¤©ï¼Œè§†é¢‘ç­‰ï¼Œä¸ªäººä¿¡æ¯çª—å£æˆ‘å¯ä»¥æŸ¥çœ‹ã€ä¿®æ”¹è‡ªå·±çš„èµ„æ–™ã€‚

ä¸ºäº†è¿›ç¨‹å®‰å…¨èµ·è§ï¼Œæ‰€ä»¥ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„æ•°æ®æ˜¯ä¸èƒ½å¤Ÿäº’ç›¸è®¿é—®çš„(é»˜è®¤æƒ…å†µä¸‹)ï¼Œæ¯”å¦‚è‡ªå·±å†™äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œç„¶åè®©åˆ«äººè¿è¡Œèµ·æ¥ï¼Œé‚£ä¹ˆæˆ‘çš„è¿™ä¸ªç¨‹åºå°±å¯ä»¥è®¿é—®ç”¨æˆ·å¯åŠ¨çš„å…¶ä»–åº”ç”¨ï¼Œæˆ‘å¯ä»¥é€šè¿‡æˆ‘è‡ªå·±çš„ç¨‹åºå»è®¿é—® QQï¼Œç„¶åæ‹¿åˆ°ä¸€äº›èŠå¤©è®°å½•ç­‰æ¯”è¾ƒéšç§˜çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¸å®‰å…¨äº†ï¼Œæ‰€ä»¥è¯´è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´çš„æ•°æ®æ˜¯ä¸å¯ä»¥äº’ç›¸è®¿é—®çš„ï¼Œè€Œä¸”æ¯ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜æ˜¯ç‹¬ç«‹çš„ã€‚

## è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«

1. çº¿ç¨‹æ˜¯æ‰§è¡Œçš„æŒ‡ä»¤é›†ï¼Œè¿›ç¨‹æ˜¯èµ„æºçš„é›†åˆ
2. çº¿ç¨‹çš„å¯åŠ¨é€Ÿåº¦è¦æ¯”è¿›ç¨‹çš„å¯åŠ¨é€Ÿåº¦è¦å¿«
3. ä¸¤ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé€Ÿåº¦æ˜¯ä¸€æ ·çš„
4. è¿›ç¨‹ä¸çº¿ç¨‹çš„è¿è¡Œé€Ÿåº¦æ˜¯æ²¡æœ‰å¯æ¯”æ€§çš„
5. çº¿ç¨‹å…±äº«åˆ›å»ºå®ƒçš„è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œè¿›ç¨‹çš„å†…å­˜æ˜¯ç‹¬ç«‹çš„ã€‚
6. ä¸¤ä¸ªçº¿ç¨‹å…±äº«çš„æ•°æ®éƒ½æ˜¯åŒä¸€ä»½æ•°æ®ï¼Œä¸¤ä¸ªå­è¿›ç¨‹çš„æ•°æ®ä¸æ˜¯å…±äº«çš„ï¼Œè€Œä¸”æ•°æ®æ˜¯ç‹¬ç«‹çš„;
7. åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹ä¹‹é—´å¯ä»¥ç›´æ¥äº¤æµï¼ŒåŒä¸€ä¸ªä¸»è¿›ç¨‹çš„å¤šä¸ªå­è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å¯ä»¥è¿›è¡Œäº¤æµï¼Œå¦‚æœä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´éœ€è¦é€šä¿¡ï¼Œå°±å¿…é¡»è¦é€šè¿‡ä¸€ä¸ªä¸­é—´ä»£ç†æ¥å®ç°;
8. ä¸€ä¸ªæ–°çš„çº¿ç¨‹å¾ˆå®¹æ˜“è¢«åˆ›å»ºï¼Œä¸€ä¸ªæ–°çš„è¿›ç¨‹åˆ›å»ºéœ€è¦å¯¹çˆ¶è¿›ç¨‹è¿›è¡Œä¸€æ¬¡å…‹éš†
9. ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ§åˆ¶å’Œæ“ä½œåŒä¸€ä¸ªè¿›ç¨‹é‡Œçš„å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹ä¸çº¿ç¨‹ä¹‹é—´æ²¡æœ‰éš¶å±å…³ç³»ï¼Œä½†æ˜¯è¿›ç¨‹åªèƒ½æ“ä½œå­è¿›ç¨‹
10. æ”¹å˜ä¸»çº¿ç¨‹ï¼Œæœ‰å¯èƒ½ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹çš„è¡Œä¸ºï¼Œä½†æ˜¯å¯¹äºçˆ¶è¿›ç¨‹çš„ä¿®æ”¹æ˜¯ä¸ä¼šå½±å“å­è¿›ç¨‹;

### ä¸€ä¸ªå¤šå¹¶å‘çš„å°è„šæœ¬

```python
import threading
import time
def princ(tring):
    print('task', tring)
    time.sleep(5)
# target=ç›®æ ‡å‡½æ•°ï¼Œ args=ä¼ å…¥çš„å‚æ•°
t1 = threading.Thread(target=princ, args=('t1',))
t1.start()
t2 = threading.Thread(target=princ, args=('t1',))
t2.start()
t3 = threading.Thread(target=princ, args=('t1',))
t3.start()
```

### å‚è€ƒæ–‡æ¡£

[è¿›ç¨‹ä¸çº¿ç¨‹çš„ä¸€ä¸ªç®€å•è§£é‡Š](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)
[Linux è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«](https://my.oschina.net/cnyinlinux/blog/422207)

## çº¿ç¨‹

> Thread module emulating a subset of Java's threading model.

è°ƒç”¨ threading æ¨¡å—è°ƒç”¨çº¿ç¨‹çš„ä¸¤ç§æ–¹å¼

### ç›´æ¥è°ƒç”¨

```python
import threading
import time

def princ(tring):
    print('task', tring)
    time.sleep(5)
# target=ç›®æ ‡å‡½æ•°ï¼Œ args=ä¼ å…¥çš„å‚æ•°
t1 = threading.Thread(target=princ, args=('t1',))
t1.start()
t2 = threading.Thread(target=princ, args=('t1',))
t2.start()
t3 = threading.Thread(target=princ, args=('t1',))
t3.start()
```

### é€šè¿‡ç±»è°ƒç”¨

```python
import threading
import time
class MyThreading(threading.Thread):
    def __init__(self, conn):
        super(MyThreading, self).__init__()
        self.conn = conn
    def run(self):
        print('run task', self.conn)
        time.sleep(5)
t1 = MyThreading('t1')
t2 = MyThreading('t2')
t1.start()
t2.start()
```

### å¤šçº¿ç¨‹

å¤šçº¿ç¨‹åœ¨ Python å†…å®é™…æ˜¯ä¸€ä¸ªå‡è±¡ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸º CPU çš„å¤„ç†é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹èµ·æ¥ä»¥ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œé€Ÿåº¦æ˜¯éå¸¸ä¹‹å¿«çš„ï¼Œåˆ©ç”¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ¥å¿«é€Ÿçš„åˆ‡æ¢ä»»åŠ¡ï¼Œä»¥è‡³äºæˆ‘ä»¬æ ¹æœ¬æ„Ÿè§‰ä¸åˆ°ã€‚

ä½†æ˜¯é¢‘ç¹çš„ä½¿ç”¨ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿæ˜¯è¦è€—è´¹ä¸€å®šçš„èµ„æºï¼Œå› ä¸ºå•çº¿ç¨‹åœ¨æ¯æ¬¡åˆ‡æ¢ä»»åŠ¡çš„æ—¶å€™éœ€è¦ä¿å­˜å½“å‰ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ã€‚

ä»€ä¹ˆæ—¶å€™ç”¨åˆ°å¤šçº¿ç¨‹ï¼Ÿ

é¦–å…ˆ IO æ“ä½œæ˜¯ä¸å ç”¨ CPU çš„ï¼Œåªæœ‰è®¡ç®—çš„æ—¶å€™æ‰ä¼šå ç”¨ CPU(è­¬å¦‚ 1+1=2)ï¼ŒPython ä¸­çš„å¤šçº¿ç¨‹ä¸é€‚åˆ CPU å¯†é›†å‹çš„ä»»åŠ¡ï¼Œé€‚åˆ IO å¯†é›†å‹çš„ä»»åŠ¡(sockt server)ã€‚

å¯åŠ¨å¤šä¸ªçº¿ç¨‹

ä¸»è¿›ç¨‹åœ¨å¯åŠ¨ä¹‹åä¼šå¯åŠ¨ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œä¸‹é¢çš„è„šæœ¬ä¸­è®©ä¸»çº¿ç¨‹å¯åŠ¨äº†å¤šä¸ªå­çº¿ç¨‹ï¼Œç„¶è€Œå¯åŠ¨çš„å­çº¿ç¨‹æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œè€Œæ˜¯ä¸»çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¹¶è¡Œæ‰§è¡Œã€‚

```python
for i in range(50):
    t = threading.Thread(target=princ, args=('t-%s' % (i),))
    t.start()
```

### **join()**

join()ä¼šé˜»å¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„çº¿ç¨‹ï¼Œç›´åˆ°è¢«è°ƒç”¨ `join()` çš„çº¿ç¨‹ç»ˆç»“â€”â€”ä¸ç®¡æ˜¯æ­£å¸¸ç»ˆç»“è¿˜æ˜¯æŠ›å‡ºæœªå¤„ç†å¼‚å¸¸ï¼Œæˆ–è€…ç›´åˆ°å‘ç”Ÿè¶…æ—¶ï¼Œè¶…æ—¶é€‰é¡¹æ˜¯å¯é€‰å‚æ•°ã€‚

å½“ timeout å‚æ•°å­˜åœ¨è€Œä¸”ä¸æ˜¯ None æ—¶ï¼Œå®ƒåº”è¯¥æ˜¯ä¸€ä¸ªç”¨äºæŒ‡å®šæ“ä½œè¶…æ—¶çš„ä»¥ç§’ä¸ºå•ä½çš„æµ®ç‚¹æ•°æˆ–è€…åˆ†æ•°ã€‚å› ä¸º `join()` æ€»æ˜¯è¿”å› None ï¼Œæ‰€ä»¥ä½ ä¸€å®šè¦åœ¨ `join()` åè°ƒç”¨ `is_alive()` æ‰èƒ½åˆ¤æ–­æ˜¯å¦å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœçº¿ç¨‹ä»ç„¶å­˜æ´»ï¼Œåˆ™ `join()` è¶…æ—¶ã€‚

å½“ `timeout` å‚æ•°ä¸å­˜åœ¨æˆ–è€…æ˜¯ `None` ï¼Œè¿™ä¸ªæ“ä½œä¼šé˜»å¡ç›´åˆ°çº¿ç¨‹ç»ˆç»“ã€‚

ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¢« `join()` å¾ˆå¤šæ¬¡ã€‚å¦‚æœå°è¯•åŠ å…¥å½“å‰çº¿ç¨‹ä¼šå¯¼è‡´æ­»é”ï¼Œ `join()` ä¼šå¼•èµ· `AssertionError` å¼‚å¸¸ã€‚å¦‚æœå°è¯• `join()` ä¸€ä¸ªå°šæœªå¼€å§‹çš„çº¿ç¨‹ï¼Œä¹Ÿä¼šæŠ›å‡ºç›¸åŒçš„å¼‚å¸¸ã€‚

`join()`æ–¹æ³•å¯ä»¥è®©ç¨‹åºç­‰å¾…æ¯ä¸€ä¸ªçº¿ç¨‹å®Œæˆä¹‹åå†å¾€ä¸‹æ‰§è¡Œï¼Œåˆç§°ä¸ºä¸²è¡Œæ‰§è¡Œã€‚

```python
import threading
import time
def princ(tring):
    print('task', tring)
    time.sleep(1)
for i in range(50):
    t = threading.Thread(target=princ, args=('t-%s' % (i),))
    t.start()
	# å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹ååœ¨æ‰§è¡Œåé¢çš„çº¿ç¨‹
    t.join()
```

è®©ä¸»çº¿ç¨‹é˜»å¡ï¼Œå­çº¿ç¨‹ç°åœ¨å¹¶è¡Œæ‰§è¡Œ

```python
import threading
import time

def princ(tring):
    print('task', tring)
    time.sleep(2)
# æ‰§è¡Œå­çº¿ç¨‹çš„æ—¶é—´
start_time = time.time()
# å­˜æ”¾çº¿ç¨‹çš„å®ä¾‹
t_objs = []
for i in range(50):
    t = threading.Thread(target=princ, args=('t-%s' % (i),))
    t.start()
	# ä¸ºäº†ä¸è®©åé¢çš„å­çº¿ç¨‹é˜»å¡ï¼ŒæŠŠå½“å‰çš„å­çº¿ç¨‹æ”¾å…¥åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­
    t_objs.append(t)
# å¾ªç¯æ‰€æœ‰å­çº¿ç¨‹å®ä¾‹ï¼Œç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•
for t in t_objs:
    t.join()
# å½“å‰æ—¶é—´å‡å»å¼€å§‹æ—¶é—´å°±ç­‰äºæ‰§è¡Œçš„è¿‡ç¨‹ä¸­éœ€è¦çš„æ—¶é—´
print(time.time() - start_time)
```

æŸ¥çœ‹ä¸»çº¿ç¨‹ä¸å­çº¿ç¨‹

```python
import threading
class MyThreading(threading.Thread):
    def __init__(self):
        super(MyThreading, self).__init__()
    def run(self):
        print('æˆ‘æ˜¯å­çº¿ç¨‹ï¼š ', threading.current_thread())
t = MyThreading()
t.start()
print('æˆ‘æ˜¯ä¸»çº¿ç¨‹ï¼š ', threading.current_thread())
```
è¾“å‡ºå¦‚ä¸‹ï¼š
```bash
C:\Python\Python35\python.exe E:/MyCodeProjects/è¿›ç¨‹ä¸çº¿ç¨‹/s3.py
æˆ‘æ˜¯å­çº¿ç¨‹ï¼š  <MyThreading(Thread-1, started 7724)>
æˆ‘æ˜¯ä¸»çº¿ç¨‹ï¼š  <_MainThread(MainThread, started 3680)>

Process finished with exit code 0
```

æŸ¥çœ‹å½“å‰è¿›ç¨‹çš„æ´»åŠ¨çº¿ç¨‹ä¸ªæ•°

```python
import threading
class MyThreading(threading.Thread):
    def __init__(self):
        super(MyThreading, self).__init__()
    def run(self):
        print('www.anshengme.com')
t = MyThreading()
t.start()
print('çº¿ç¨‹ä¸ªæ•°ï¼š ', threading.active_count())
```
è¾“å‡ºå¦‚ä¸‹ï¼š
```bash
C:\Python\Python35\python.exe E:/MyCodeProjects/è¿›ç¨‹ä¸çº¿ç¨‹/s3.py
www.anshengme.com
# ä¸€ä¸ªä¸»çº¿ç¨‹å’Œä¸€ä¸ªå­çº¿ç¨‹
çº¿ç¨‹ä¸ªæ•°ï¼š  2

Process finished with exit code 0
```
Event

Event æ˜¯çº¿ç¨‹é—´é€šä¿¡æœ€ç®€å•çš„æœºåˆ¶ä¹‹ä¸€ï¼šä¸€ä¸ªçº¿ç¨‹å‘é€ä¸€ä¸ª event ä¿¡å·ï¼Œå…¶ä»–çš„çº¿ç¨‹åˆ™ç­‰å¾…è¿™ä¸ªä¿¡å·ï¼Œç”¨äºä¸»çº¿ç¨‹æ§åˆ¶å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œã€‚ Event ç®¡ç†ä¸€ä¸ª flagï¼Œè¿™ä¸ª flag å¯ä»¥ä½¿ç”¨ set()è®¾ç½®æˆ True æˆ–è€…ä½¿ç”¨ clear()é‡ç½®ä¸º Falseï¼Œwait()åˆ™ç”¨äºåœ¨ flag ä¸º True ä¹‹å‰ä¿æŒé˜»å¡ã€‚flag é»˜è®¤ä¸º Falseã€‚

|é€‰é¡¹|æè¿°|
|:--|:--|
|`Event.wait([timeout])`|å µå¡çº¿ç¨‹ï¼Œç›´åˆ° Event å¯¹è±¡å†…éƒ¨æ ‡è¯†ä½è¢«è®¾ä¸º True æˆ–è¶…æ—¶ï¼ˆå¦‚æœæä¾›äº†å‚æ•° timeoutï¼‰|
|`Event.set()`|å°†æ ‡è¯†ä½è®¾ä¸º Ture|
|`Event.clear()`|å°†æ ‡è¯†ä¼´è®¾ä¸º False|
|`Event.isSet()`|åˆ¤æ–­æ ‡è¯†ä½æ˜¯å¦ä¸º Ture|

```python
#!/use/bin/env python
# _*_ coding: utf-8- _*_

import threading

def runthreading(event):
    print("Start...")
    event.wait()
    print("End...")
event_obj = threading.Event()
for n in range(10):
    t = threading.Thread(target=runthreading, args=(event_obj,))
    t.start()

event_obj.clear()
inp = input("True/False?>> ")
if inp == "True":
    event_obj.set()
````
ä»£ç å‚è§[æ­¤å¤„](./codes/t_event.py)

### å®ˆæŠ¤è¿›ç¨‹/çº¿ç¨‹(daemon)
å½“æˆ‘ä»¬é€šè¿‡`t.daemon = True`æˆ–è€…è°ƒç”¨ `t.setDaemon(True)` è®¾ç½®ä¸º Daemon æ—¶ï¼Œä¸»çº¿ç¨‹ç»“æŸä¼šä¸­æ–­å­çº¿ç¨‹ã€‚

æœ‰çš„çº¿ç¨‹ä¼šåšèƒŒæ™¯ä»»åŠ¡ï¼Œæ¯”å¦‚ `keepalive`ï¼Œæˆ–è€…å‘¨æœŸæ€§åœ°æ‰§è¡Œåƒåœ¾å›æ”¶ä»»åŠ¡ç­‰ã€‚è¿™äº›ä»»åŠ¡åªæœ‰å½“ä¸»ç¨‹åºè¿è¡Œçš„æ—¶å€™æ‰æœ‰ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶ä»–éå®ˆæŠ¤ç¨‹åºçº¿ç¨‹é€€å‡ºåå°†å…¶æ€æ­»ã€‚

å¦‚æœæ²¡æœ‰å®ˆæŠ¤çº¿ç¨‹ï¼Œæˆ‘ä»¬å°±å¿…é¡»è·Ÿè¸ªè¿™äº›çº¿ç¨‹ï¼Œå¹¶åœ¨ç¨‹åºå®Œå…¨é€€å‡ºä¹‹å‰å‘ŠçŸ¥å®ƒä»¬é€€å‡ºã€‚é€šè¿‡å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œè¿è¡Œçº¿ç¨‹ä¹‹åå°±ä¸ç”¨ç®¡äº†ï¼Œæ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹éƒ½ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚

ä¸€ä¸ªä¸»è¿›ç¨‹å¯ä»¥å¯åŠ¨å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œä½†æ˜¯ä¸»è¿›ç¨‹å¿…é¡»è¦ä¸€ç›´è¿è¡Œï¼Œå¦‚æœä¸»è¿›ç¨‹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆå®ˆæŠ¤è¿›ç¨‹ä¹Ÿä¼šéšä¹‹æŒ‚æ‰ã€‚

ç¨‹åºä¼šç­‰å¾…ä¸»çº¿ç¨‹(è¿›ç¨‹)æ‰§è¡Œå®Œæ¯•ï¼Œä½†æ˜¯ä¸ä¼šç­‰å¾…å®ˆæŠ¤è¿›ç¨‹(çº¿ç¨‹)æ‰§è¡Œç»“æŸï¼ˆå› ä¸ºè®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„ä»»åŠ¡å¯èƒ½æ˜¯ä¸€ç›´ä¸ä¼šç»ˆç»“çš„ï¼‰ã€‚

```python
import threading
import time

def princ(tring):
    print('task', tring)
    time.sleep(2)
for i in range(50):
    t = threading.Thread(target=princ, args=('t-%s' % (i),))
    t.setDaemon(True)  # æŠŠå½“å‰çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œè¦åœ¨startä¹‹å‰è®¾ç½®
    t.start()
```
**åœºæ™¯é¢„è®¾ï¼š** æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ª FTP æœåŠ¡ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·è¿æ¥ä¸Šå»çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œç°åœ¨å·²ç»æœ‰ 300 ä¸ªç”¨æˆ·è¿æ¥ä¸Šå»äº†ï¼Œå°±æ˜¯è¯´å·²ç»åˆ›å»ºäº† 300 ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œä½†æ˜¯çªç„¶ä¹‹é—´ FTP æœåŠ¡å®•æ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸ä¼šç­‰å¾…å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†é€€å‡ºï¼Œè€Œæ˜¯ç›´æ¥é€€å‡ºï¼Œå¦‚æœæ˜¯æ™®é€šçš„çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ä¼šç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†é€€å‡ºã€‚

```python
#!/use/bin/env python
# _*_ coding:utf-8 _*_

from multiprocessing import Process
import time

def runprocess(arg):
    print(arg)
    time.sleep(2)


p = Process(target=runprocess, args=(11,))
p.daemon=True
p.start()

print("end")
```
å‚è€ƒï¼š
[python - Daemon Threads Explanation - StackOverflow](https://stackoverflow.com/questions/190010/daemon-threads-explanation)
[python - setDaemon() method of threading.Thread - StackOverflow](https://stackoverflow.com/questions/5127401/setdaemon-method-of-threading-thread)

çº¿ç¨‹ä¹‹é—´çš„æ•°æ®äº¤äº’ä¸é”(äº’æ–¥é”)

`python2.x`éœ€è¦åŠ é”ï¼Œä½†æ˜¯åœ¨`python3.x`ä¸Šé¢å°±ä¸éœ€è¦äº†ã€‚

```python
# _*_ coding:utf-8 _*_
import threading
def princ():
    # è·å–é”
    lock.acquire()
    # åœ¨å‡½æ•°å†…å¯ä»¥ç›´æ¥ä¿®æ”¹å…¨å±€å˜é‡
    global number
    number += 1
    # ä¸ºäº†é¿å…è®©ç¨‹åºå‡ºç°ä¸²è¡Œï¼Œä¸èƒ½åŠ sleep
    # time.sleep(1)
    # é‡Šæ”¾é”
    lock.release()
# é”
lock = threading.Lock()
# ä¸»çº¿ç¨‹çš„number
number = 0
t_objs = []
for i in range(100):
    t = threading.Thread(target=princ)
    t.start()
    t_objs.append(t)
for t in t_objs:
    t.join()
print('Number:', number)
```

### é€’å½’é”(Lock/RLock)

```python
import threading
def run1():
    print("grab the first part data")
    lock.acquire()
    global num
    num += 1
    lock.release()
    return num
def run2():
    print("grab the second part data")
    lock.acquire()
    global num2
    num2 += 1
    lock.release()
    return num2
def run3():
    lock.acquire()
    res = run1()
    print('--------between run1 and run2-----')
    res2 = run2()
    lock.release()
    print(res, res2)
t_objs = []
if __name__ == '__main__':
    num, num2 = 0, 0
    lock = threading.RLock()  # RLock()ç±»ä¼¼åˆ›å»ºäº†ä¸€ä¸ªå­—å…¸ï¼Œæ¯æ¬¡é€€å‡ºçš„æ—¶å€™æ‰¾åˆ°å­—å…¸çš„å€¼è¿›è¡Œé€€å‡º
    # lock = threading.Lock()  # Lock()ä¼šé˜»å¡åœ¨è¿™å„¿
    for i in range(10):
        t = threading.Thread(target=run3)
        t.start()
        t_objs.append(t)
for t in t_objs:
    t.join()
print(num, num2)
```
### ä¿¡å·é‡(Semaphore)

`äº’æ–¥é”`åŒæ—¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹æ•°æ®ï¼Œè€Œ`Semaphore`æ˜¯åŒæ—¶å…è®¸ä¸€å®šæ•°é‡çš„çº¿ç¨‹æ›´æ”¹æ•°æ®

```python
import threading
import time
def run(n):
    semaphore.acquire()  # è·å–ä¿¡å·ï¼Œä¿¡å·å¯ä»¥æœ‰å¤šæŠŠé”
    time.sleep(1)  # ç­‰å¾…ä¸€ç§’é’Ÿ
    print("run the thread: %s\n" % n)
    semaphore.release()  # é‡Šæ”¾ä¿¡å·
t_objs = []
if __name__ == '__main__':
    semaphore = threading.BoundedSemaphore(5)  # å£°æ˜ä¸€ä¸ªä¿¡å·é‡ï¼Œæœ€å¤šå…è®¸5ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ
    for i in range(20):  # è¿è¡Œ20ä¸ªçº¿ç¨‹
        t = threading.Thread(target=run, args=(i,))  # åˆ›å»ºçº¿ç¨‹
        t.start()  # å¯åŠ¨çº¿ç¨‹
        t_objs.append(t)
for t in t_objs:
    t.join()
print('>>>>>>>>>>>>>')
```

ä»¥ä¸Šä»£ç ä¸­ï¼Œç±»ä¼¼ä¸åˆ›å»ºäº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæœ€å¤šæ”¾ 5 ä¸ªä»»åŠ¡ï¼Œæ¯æ‰§è¡Œå®Œæˆä¸€ä¸ªä»»åŠ¡å°±ä¼šå¾€åé¢å¢åŠ ä¸€ä¸ªä»»åŠ¡ã€‚

## å¤šè¿›ç¨‹

å¤šè¿›ç¨‹çš„èµ„æºæ˜¯ç‹¬ç«‹çš„ï¼Œä¸å¯ä»¥äº’ç›¸è®¿é—®ã€‚

å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹

```python
from multiprocessing import Process
import time
def f(name):
    time.sleep(2)
    print('hello', name)
if __name__ == '__main__':
    # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹
    p = Process(target=f, args=('bob',))
    # å¯åŠ¨
    p.start()
    # ç­‰å¾…è¿›ç¨‹æ‰§è¡Œå®Œæ¯•
    p.join()
```

åœ¨è¿›ç¨‹å†…å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹

```python
from multiprocessing import Process
import threading
def Thread(tring):
    print(tring)
def Proces(tring):
    print('hello', tring)
    t = threading.Thread(target=Thread, args=('Thread %s' % (tring),))  # åˆ›å»ºä¸€ä¸ªçº¿ç¨‹
    t.start()  # å¯åŠ¨å®ƒ
if __name__ == '__main__':
    p = Process(target=Proces, args=('World',))  # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹
    p.start()  # å¯åŠ¨
    p.join()  # ç­‰å¾…è¿›ç¨‹æ‰§è¡Œå®Œæ¯•
```

å¯åŠ¨ä¸€ä¸ªå¤šè¿›ç¨‹

```python
from multiprocessing import Process
import time
def f(name):
    time.sleep(2)
    print('hello', name)
if __name__ == '__main__':
    for n in range(10):  # åˆ›å»ºä¸€ä¸ªè¿›ç¨‹
        p = Process(target=f, args=('bob %s' % (n),))
        # å¯åŠ¨
        p.start()
        # ç­‰å¾…è¿›ç¨‹æ‰§è¡Œå®Œæ¯•
```

è·å–å¯åŠ¨è¿›ç¨‹çš„ PID

```python
# _*_ coding:utf-8 _*_
from multiprocessing import Process
import os
def info(tring):
    print(tring)
    print('module name:', __name__)
    print('çˆ¶è¿›ç¨‹çš„PID:', os.getppid())
    print('å­è¿›ç¨‹çš„PID:', os.getpid())
    print("\n")
def ChildProcess():
    info('\033[31;1mChildProcess\033[0m')
if __name__ == '__main__':
    info('\033[32;1mTheParentProcess\033[0m')
    p = Process(target=ChildProcess)
    p.start()
```
è¾“å‡ºç»“æœ
```bash
C:\Python\Python35\python.exe E:/MyCodeProjects/å¤šè¿›ç¨‹/s1.py
TheParentProcess
module name: __main__
# Pycharmçš„PID
çˆ¶è¿›ç¨‹çš„PID: 6888
# å¯åŠ¨çš„è„šæœ¬PID
å­è¿›ç¨‹çš„PID: 4660

ChildProcess
module name: __mp_main__
# è„šæœ¬çš„PID
çˆ¶è¿›ç¨‹çš„PID: 4660
# çˆ¶è¿›ç¨‹å¯åŠ¨çš„å­è¿›ç¨‹PID
å­è¿›ç¨‹çš„PID: 8452

Process finished with exit code 0
```

### è¿›ç¨‹é—´é€šä¿¡

é»˜è®¤æƒ…å†µä¸‹è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å¯ä»¥äº’ç›¸é€šä¿¡çš„ï¼Œè‹¥è¦å®ç°äº’ç›¸é€šä¿¡åˆ™éœ€è¦ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¦ä¸ªè¿›ç¨‹ä¹‹é—´é€šè¿‡ä¸­é—´ä»¶æ¥å®ç°é€šä¿¡ï¼Œä¸‹é¢æ˜¯è¿›ç¨‹é—´é€šä¿¡çš„å‡ ç§æ–¹å¼ã€‚

è¿›ç¨‹ Queue

```python
# _*_ coding:utf-8 _*_
from multiprocessing import Process, Queue
def ChildProcess(Q):
    Q.put(['Hello', None, 'World'])  # åœ¨Queueé‡Œé¢ä¸Šä¼ ä¸€ä¸ªåˆ—è¡¨
if __name__ == '__main__':
    q = Queue()  # åˆ›å»ºä¸€ä¸ªQueue
    p = Process(target=ChildProcess, args=(q,))  # åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶æŠŠQueueä¼ ç»™å­è¿›ç¨‹,ç›¸å½“äºå…‹éš†äº†ä¸€ä»½Queue
    p.start()  # å¯åŠ¨å­è¿›ç¨‹
    print(q.get())  # è·å–qä¸­çš„æ•°æ®
    p.join()
```

ç®¡é“(Pipes)

```python
# _*_ coding:utf-8 _*_
from multiprocessing import Process, Pipe
def ChildProcess(conn):
    conn.send(['Hello', None, 'World'])  # å†™ä¸€æ®µæ•°æ®
    conn.close()  # å…³é—­
if __name__ == '__main__':
    parent_conn, child_conn = Pipe()  # ç”Ÿæˆä¸€ä¸ªç®¡é“å®ä¾‹ï¼Œparent_conn, child_connç®¡é“çš„ä¸¤å¤´
    p = Process(target=ChildProcess, args=(child_conn,))
    p.start()
    print(parent_conn.recv())  # æ”¶å–æ¶ˆæ¯
    p.join()
```

æ•°æ®å…±äº«(Managers)

```python
# _*_ coding:utf-8 _*_
# _*_ coding:utf-8 _*_
from multiprocessing import Process, Manager
import os

def ChildProcess(Dict, List):
    Dict['k1'] = 'v1'
    Dict['k2'] = 'v2'
    List.append(os.getpid())  # è·å–å­è¿›ç¨‹çš„PID
    print(List)  # è¾“å‡ºåˆ—è¡¨ä¸­çš„å†…å®¹

if __name__ == '__main__':
    manager = Manager()  # ç”ŸæˆManagerå¯¹è±¡
    Dict = manager.dict()  # ç”Ÿæˆä¸€ä¸ªå¯ä»¥åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´ä¼ é€’å…±äº«çš„å­—å…¸
    List = manager.list()  # ç”Ÿæˆä¸€ä¸ªå­—å…¸

    ProcessList = []  # åˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œå­˜æ”¾è¿›ç¨‹çš„å¯¹è±¡ï¼Œç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œç”¨äº

    for i in range(10):  # ç”Ÿæˆæ˜¯ä¸ªå­è¿›ç¨‹
        p = Process(target=ChildProcess, args=(Dict, List))  # åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹
        p.start()  # å¯åŠ¨
        ProcessList.append(p)  # æŠŠå­è¿›ç¨‹æ·»åŠ åˆ°p_liståˆ—è¡¨ä¸­

    for res in ProcessList:  # å¾ªç¯æ‰€æœ‰çš„å­è¿›ç¨‹
        res.join()  # ç­‰å¾…æ‰§è¡Œå®Œæ¯•
    print('\n')
    print(Dict)
    print(List)
```
è¾“å‡ºç»“æœ
```python
C:\Python\Python35\python.exe E:/MyCodeProjects/å¤šè¿›ç¨‹/s4.py
[5112]
[5112, 3448]
[5112, 3448, 4584]
[5112, 3448, 4584, 2128]
[5112, 3448, 4584, 2128, 11124]
[5112, 3448, 4584, 2128, 11124, 10628]
[5112, 3448, 4584, 2128, 11124, 10628, 5512]
[5112, 3448, 4584, 2128, 11124, 10628, 5512, 10460]
[5112, 3448, 4584, 2128, 11124, 10628, 5512, 10460, 10484]
[5112, 3448, 4584, 2128, 11124, 10628, 5512, 10460, 10484, 6804]


{'k1': 'v1', 'k2': 'v2'}
[5112, 3448, 4584, 2128, 11124, 10628, 5512, 10460, 10484, 6804]

Process finished with exit code 0
```

é”(Lock)

```python
from multiprocessing import Process, Lock

def ChildProcess(l, i):
    l.acquire()  # è·å–é”
    print('hello world', i)
    l.release()  # é‡Šæ”¾é”

if __name__ == '__main__':
    lock = Lock()  # ç”ŸæˆLockå¯¹è±¡
    for num in range(10):
        Process(target=ChildProcess, args=(lock, num)).start()  # åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹
```

### è¿›ç¨‹æ± 

åŒä¸€æ—¶é—´å¯åŠ¨å¤šå°‘ä¸ªè¿›ç¨‹

```python
#!/use/bin/env python
# _*_ coding: utf-8 _*_

from multiprocessing import Pool
import time

def myFun(i):
    time.sleep(2)
    return i+100

def end_call(arg):
    print("end_call>>", arg)

p = Pool(5)  # å…è®¸è¿›ç¨‹æ± å†…åŒæ—¶æ”¾å…¥5ä¸ªè¿›ç¨‹
for i in range(10):
    p.apply_async(func=myFun, args=(i,),callback=end_call) # # å¹³è¡Œæ‰§è¡Œ,callbackæ˜¯ä¸»è¿›ç¨‹æ¥è°ƒç”¨
    # p.apply(func=Foo)  # ä¸²è¡Œæ‰§è¡Œ

print("end")
p.close()
p.join() # è¿›ç¨‹æ± ä¸­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åå†å…³é—­ï¼Œå¦‚æœæ³¨é‡Šï¼Œé‚£ä¹ˆç¨‹åºç›´æ¥å…³é—­ã€‚
```

## çº¿ç¨‹æ± 

ç®€å•å®ç°

```python
#!/usr/bin/env python
# -*- coding:utf-8 -*-
import threading
import queue
import time
class MyThread:
    def __init__(self,max_num=10):
        self.queue = queue.Queue()
        for n in range(max_num):
            self.queue.put(threading.Thread)
    def get_thread(self):
        return self.queue.get()
    def put_thread(self):
        self.queue.put(threading.Thread)
pool = MyThread(5)
def RunThread(arg,pool):
    print(arg)
    time.sleep(2)
    pool.put_thread()
for n in range(30):
    thread = pool.get_thread()
    t = thread(target=RunThread, args=(n,pool,))
    t.start()
```

å¤æ‚ç‰ˆæœ¬

```python
#!/usr/bin/env python
# -*- coding:utf-8 -*-

import queue
import threading
import contextlib
import time

StopEvent = object()

class ThreadPool(object):

    def __init__(self, max_num, max_task_num = None):
        if max_task_num:
            self.q = queue.Queue(max_task_num)
        else:
            self.q = queue.Queue()
        self.max_num = max_num
        self.cancel = False
        self.terminal = False
        self.generate_list = []
        self.free_list = []

    def run(self, func, args, callback=None):
        """
        çº¿ç¨‹æ± æ‰§è¡Œä¸€ä¸ªä»»åŠ¡
        :param func: ä»»åŠ¡å‡½æ•°
        :param args: ä»»åŠ¡å‡½æ•°æ‰€éœ€å‚æ•°
        :param callback: ä»»åŠ¡æ‰§è¡Œå¤±è´¥æˆ–æˆåŠŸåæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°1ã€ä»»åŠ¡å‡½æ•°æ‰§è¡ŒçŠ¶æ€ï¼›2ã€ä»»åŠ¡å‡½æ•°è¿”å›å€¼ï¼ˆé»˜è®¤ä¸ºNoneï¼Œå³ï¼šä¸æ‰§è¡Œå›è°ƒå‡½æ•°ï¼‰
        :return: å¦‚æœçº¿ç¨‹æ± å·²ç»ç»ˆæ­¢ï¼Œåˆ™è¿”å›Trueå¦åˆ™None
        """
        if self.cancel:
            return
        if len(self.free_list) == 0 and len(self.generate_list) < self.max_num:
            self.generate_thread()
        w = (func, args, callback,)
        self.q.put(w)

    def generate_thread(self):
        """
        åˆ›å»ºä¸€ä¸ªçº¿ç¨‹
        """
        t = threading.Thread(target=self.call)
        t.start()

    def call(self):
        """
        å¾ªç¯å»è·å–ä»»åŠ¡å‡½æ•°å¹¶æ‰§è¡Œä»»åŠ¡å‡½æ•°
        """
        current_thread = threading.currentThread()
        self.generate_list.append(current_thread)

        event = self.q.get()
        while event != StopEvent:

            func, arguments, callback = event
            try:
                result = func(*arguments)
                success = True
            except Exception as e:
                success = False
                result = None

            if callback is not None:
                try:
                    callback(success, result)
                except Exception as e:
                    pass

            with self.worker_state(self.free_list, current_thread):
                if self.terminal:
                    event = StopEvent
                else:
                    event = self.q.get()
        else:

            self.generate_list.remove(current_thread)

    def close(self):
        """
        æ‰§è¡Œå®Œæ‰€æœ‰çš„ä»»åŠ¡åï¼Œæ‰€æœ‰çº¿ç¨‹åœæ­¢
        """
        self.cancel = True
        full_size = len(self.generate_list)
        while full_size:
            self.q.put(StopEvent)
            full_size -= 1

    def terminate(self):
        """
        æ— è®ºæ˜¯å¦è¿˜æœ‰ä»»åŠ¡ï¼Œç»ˆæ­¢çº¿ç¨‹
        """
        self.terminal = True

        while self.generate_list:
            self.q.put(StopEvent)

        self.q.queue.clear()

    @contextlib.contextmanager
    def worker_state(self, state_list, worker_thread):
        """
        ç”¨äºè®°å½•çº¿ç¨‹ä¸­æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹æ•°
        """
        state_list.append(worker_thread)
        try:
            yield
        finally:
            state_list.remove(worker_thread)

# How to use

pool = ThreadPool(5)

def callback(status, result):
    # status, execute action status
    # result, execute action return value
    pass

def action(i):
    print(i)

for i in range(30):
    ret = pool.run(action, (i,), callback)

time.sleep(5)
print(len(pool.generate_list), len(pool.free_list))
print(len(pool.generate_list), len(pool.free_list))
pool.close()
pool.terminate()
```

## ä»€ä¹ˆæ˜¯ IO å¯†é›†å‹å’Œ CPU å¯†é›†å‹

IO å¯†é›†å‹(I/O bound)

é¢‘ç¹ç½‘ç»œä¼ è¾“ã€è¯»å–ç¡¬ç›˜åŠå…¶ä»– IO è®¾å¤‡ç§°ä¹‹ä¸º IO å¯†é›†å‹ï¼Œæœ€ç®€å•çš„å°±æ˜¯ç¡¬ç›˜å­˜å–æ•°æ®ï¼ŒIO æ“ä½œå¹¶ä¸ä¼šæ¶‰åŠåˆ° CPUã€‚

è®¡ç®—å¯†é›†å‹(CPU bound)

ç¨‹åºå¤§éƒ¨åˆ†åœ¨åšè®¡ç®—ã€é€»è¾‘åˆ¤æ–­ã€å¾ªç¯å¯¼è‡´ cpu å ç”¨ç‡å¾ˆé«˜çš„æƒ…å†µï¼Œç§°ä¹‹ä¸ºè®¡ç®—å¯†é›†å‹ï¼Œæ¯”å¦‚è¯´ python ç¨‹åºä¸­æ‰§è¡Œäº†ä¸€æ®µä»£ç `1+1`ï¼Œè¿™å°±æ˜¯åœ¨è®¡ç®— 1+1 çš„å€¼

## æ›´å¤šå‚è€ƒ

[threading â€” Manage Concurrent Operations Within a Process â€” PyMOTW 3](https://pymotw.com/3/threading/index.html)
[Python Tutorial: multithreading - creating threads - 2020](https://www.bogotobogo.com/python/Multithread/python_multithreading_creating_threads.php)