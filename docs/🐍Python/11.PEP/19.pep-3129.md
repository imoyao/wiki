---
title: '[è¯‘]PEP-3129 ç±»è£…é¥°å™¨'
tags: 
  - è£…é¥°å™¨
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - PEP
date: 2019-11-27 23:34:31
permalink: /peps/1b7f4a/
---
# [è¯‘]PEP-3129 ç±»è£…é¥°å™¨

**PEP åŸæ–‡ ï¼š** [https://www.python.org/dev/peps/pep-3129](https://www.python.org/dev/peps/pep-3129/)

**PEP æ ‡é¢˜ï¼š** Class Decorators

**PEP ä½œè€…ï¼š** Collin Winter

**åˆ›å»ºæ—¥æœŸï¼š** 2007-05-01

**åˆå…¥ç‰ˆæœ¬ï¼š** 3.0

**è¯‘è€…** ï¼š[è±Œè±†èŠ±ä¸‹çŒ«](https://zhuanlan.zhihu.com/pythonCat)ï¼ˆ**Python çŒ«** å…¬ä¼—å·ä½œè€…ï¼‰

**PEP ç¿»è¯‘è®¡åˆ’** ï¼šhttps://github.com/chinesehuazhou/peps-cn

## æ‘˜è¦

æœ¬ PEP æè®®æ¨å‡ºç±»è£…é¥°å™¨ï¼Œå®ƒæ˜¯å¯¹ PEP-318 å¼•å…¥çš„å‡½æ•°ä¸æ–¹æ³•ï¼ˆfunction and methodï¼‰è£…é¥°å™¨çš„æ‰©å±•ã€‚

## åŸç†é˜è¿°

å½“åˆè®¨è®ºå‡½æ•°è£…é¥°å™¨æ˜¯å¦è¯¥åœ¨ Python 2.4 ä¸­å¼•å…¥æ—¶ï¼Œç”±äºæœ‰å…ƒç±»ï¼Œæ‰€ä»¥ç±»è£…é¥°å™¨è¢«è§†ä¸ºæ™¦æ¶©ä¸”ä¸å¿…è¦çš„[1]ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨ Python 2.4.x ç³»åˆ—å‘è¡Œç‰ˆæœ¬çš„å‡ å¹´åï¼Œå¯¹å‡½æ•°è£…é¥°å™¨åŠå…¶ä½¿ç”¨çš„æ—¥ç›Šç†Ÿæ‚‰ä¹‹åï¼ŒBDFL å’Œç¤¾åŒºé‡æ–°è¯„ä¼°äº†ç±»è£…é¥°å™¨ï¼Œå¹¶å»ºè®®å°†å…¶åŒ…å«åœ¨ Python 3.0 ä¸­[2]ã€‚

è¿™ä¸ªæ”¹å˜çš„ç›®çš„æ˜¯ä½¿æŸäº›æ„é€ æ›´æ˜“äºè¡¨è¾¾ï¼Œå¹¶ä¸”å‡å°‘å¯¹ CPython è§£é‡Šå™¨çš„å®ç°ç»†èŠ‚çš„ä¾èµ–ã€‚å°½ç®¡å¯ä»¥ä½¿ç”¨å…ƒç±»æ¥å®ç°ç±»ä¼¼è£…é¥°å™¨ï¼ˆdecorator-likeï¼‰åŠŸèƒ½çš„ç±»ï¼Œä½†ç»“æœé€šå¸¸ä»¤äººä¸å¿«ï¼Œå®ç°èµ·æ¥ä¹Ÿå¾ˆè„†å¼±[3]ã€‚å¦å¤–ï¼Œå…ƒç±»æ˜¯è¦ç»§æ‰¿çš„ï¼Œè€Œç±»è£…é¥°å™¨åˆ™ä¸æ˜¯ï¼Œè¿™ä½¿å¾—å…ƒç±»ä¸é€‚åˆç±»è£…é¥°å™¨çš„æŸäº›ç‰¹å®šäºç±»çš„ä½¿ç”¨åœºæ™¯ã€‚è¯¸å¦‚ Zope ä¹‹ç±»çš„å¤§å‹ Python é¡¹ç›®æ­£åœ¨ç»å†è¿™äº›ç–¯ç‹‚çš„æ‰­æ›²ï¼Œå°±ä¸ºäº†å–å¾—ç±»è£…é¥°å™¨èƒ½åšåˆ°çš„æˆç»©ï¼Œè¿™ä¸€ç‚¹åè€Œä½¿ BDFL é’çä¸Šäº†ç±»è£…é¥°å™¨ã€‚

## è¯­ä¹‰

ç±»è£…é¥°å™¨çš„è¯­ä¹‰å’Œè®¾è®¡ç›®æ ‡ä¸å‡½æ•°è£…é¥°å™¨çš„è¯­ä¹‰å’Œè®¾è®¡ç›®æ ‡ç›¸åŒï¼ˆ[4]ï¼Œ[5]ï¼‰ï¼› å”¯ä¸€çš„åŒºåˆ«æ˜¯å®ƒåœ¨è£…é¥°ç±»è€Œä¸æ˜¯å‡½æ•°ã€‚ ä»¥ä¸‹ä¸¤ä¸ªç‰‡æ®µåœ¨è¯­ä¹‰ä¸Šæ˜¯ç›¸åŒçš„ï¼š

```python
class A:
  pass
A = foo(bar(A))


@foo
@bar
class A:
  pass
```

æœ‰å…³è£…é¥°å™¨çš„è¯¦ç»†è§£é‡Šï¼Œè¯·æŸ¥é˜… PEP-318ã€‚

## å®ç°

è°ƒæ•´ Python çš„è¯­æ³•ä»¥æ”¯æŒç±»ä¿®é¥°ç¬¦ï¼Œéœ€è¦ä¿®æ”¹ä¸¤ä¸ªè§„åˆ™å¹¶æ·»åŠ ä¸€ä¸ªæ–°è§„åˆ™ï¼š

```plain
funcdef: [decorators] 'def' NAME parameters ['->' test] ':' suite

compound_stmt: if_stmt | while_stmt | for_stmt | try_stmt |
               with_stmt | funcdef | classdef
```

éœ€è¦å˜æˆè¿™æ ·ï¼š

```plain
decorated: decorators (classdef | funcdef)

funcdef: 'def' NAME parameters ['->' test] ':' suite

compound_stmt: if_stmt | while_stmt | for_stmt | try_stmt |
               with_stmt | funcdef | classdef | decorated
```

æ·»åŠ  decorated æ˜¯å¿…è¦çš„ï¼Œä»¥é¿å…è¯­æ³•å‡ºç°å«ç³Šã€‚
å¿…é¡»ç›¸åº”åœ°ä¿®æ”¹ Python AST å’Œå­—èŠ‚ç ã€‚
Jack Diederich æä¾›äº†å‚è€ƒå®ç°[6]ã€‚

## éªŒæ”¶

åœ¨å‘å¸ƒæ­¤ PEP ä¹‹åï¼Œå‡ ä¹æ²¡æœ‰è®¨è®ºï¼Œè¿™æ„å‘³ç€æ¯ä¸ªäººéƒ½è§‰å¾—åº”è¯¥æ¥å—å®ƒã€‚

è¡¥ä¸å·²æäº¤ç»™ Subversionï¼Œç‰ˆæœ¬ä¸º 55430ã€‚

## å‚è€ƒèµ„æ–™

[1] http://www.python.org/dev/peps/pep-0318/#motivation

[2] https://mail.python.org/pipermail/python-dev/2006-March/062942.html

[3] https://mail.python.org/pipermail/python-dev/2006-March/062888.html

[4] http://www.python.org/dev/peps/pep-0318/#current-syntax

[5] http://www.python.org/dev/peps/pep-0318/#design-goals

[6] https://bugs.python.org/issue1671208

## ç‰ˆæƒ

æœ¬æ–‡æ¡£å·²ç»æ”¾ç½®åœ¨å…¬å…±é¢†åŸŸã€‚æºæ–‡æ¡£ï¼š

[https://github.com/python/peps/blob/master/pep-3129.txt](https://github.com/python/peps/blob/master/pep-3129.txt)
