---
title: å…³äº python ä¸­çš„ setup.py
date: 2021-01-19 14:28:33
tags: 
  - python
  - TODO
  - setup
categories: 
  - ğŸ’»å·¥ä½œ
  - ğŸPython
permalink: /python/setup/
author: Lingxian_kong
link: https://lingxiankong.github.io/2013-12-23-python-setup.html
---

å‰è¨€
--

å…¶å®å¯¹äº setup.py å’Œ setup.cfg çš„å…³æ³¨æ˜¯ä» OpenStack çš„æºç åŒ…ä¸­å¼€å§‹çš„ï¼ŒOpenStack æ¯ä¸ªç»„ä»¶çš„å‘å¸ƒæ—¶éƒ½æ˜¯ä¸€ä¸ª tar.gz åŒ…ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬ç›´æ¥ä» github ä¸Š clone ä»£ç åä¹Ÿä¼šå‘ç°ä¸¤ä¸ªæ–‡ä»¶çš„å­˜åœ¨ã€‚å½“é˜…è¯» Nova æˆ– Ceilometerï¼ˆå…¶ä»–ç»„ä»¶å¯èƒ½ä¹Ÿä¼šæ¶‰åŠï¼‰çš„ä»£ç æ—¶ï¼Œå‘ç° setup.cfg ä¸­å†…å®¹å¯¹äºä»£ç çš„ç†è§£æœ‰å¾ˆå¤§çš„å½±å“ã€‚é‚£ä¹ˆï¼Œåˆ°åº• setup.py å’Œ setup.cfg æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ

setup.py
--------

æˆ‘ä»¬ä»ä¾‹å­å¼€å§‹ã€‚å‡è®¾ä½ è¦åˆ†å‘ä¸€ä¸ªå« foo çš„æ¨¡å—ï¼Œæ–‡ä»¶å foo.pyï¼Œé‚£ä¹ˆ setup.py å†…å®¹å¦‚ä¸‹ï¼š
```python
from distutils.core import setup
setup(name='foo',
        version='1.0',
        py_modules=['foo'],
        )   
```
ç„¶åï¼Œè¿è¡Œ`python setup.py sdist`ä¸ºæ¨¡å—åˆ›å»ºä¸€ä¸ªæºç åŒ…
```bash
root@network:/kong/setup# python setup.py sdist
running sdist
running check
warning: check: missing required meta-data: url	
warning: check: missing meta-data: either (author and author_email) or (maintainer and maintainer_email) must be supplied
warning: sdist: manifest template 'MANIFEST.in' does not exist (using default file list)
warning: sdist: standard file not found: should have one of README, README.txt
writing manifest file 'MANIFEST'
creating foo-1.0
making hard links in foo-1.0...
hard linking foo.py -> foo-1.0
hard linking setup.py -> foo-1.0
creating dist
Creating tar archive
removing 'foo-1.0' (and everything under it)
```

åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œä¼šåˆ›å»º`dist`ç›®å½•ï¼Œé‡Œé¢æœ‰ä¸ªæ–‡ä»¶åä¸º`foo-1.0.tar.gz`ï¼Œè¿™ä¸ªå°±æ˜¯å¯ä»¥åˆ†å‘çš„åŒ…ï¼ˆå¦‚æœä½¿ç”¨å‘½ä»¤`python setup.py bdist_egg`ï¼Œé‚£ä¹ˆä¼šåœ¨ dist ç›®å½•ä¸­ç”Ÿæˆ foo-1.0-py2.7.egg åŒ…ï¼Œsetup.py ä¸­ç¬¬ä¸€å¥å¼•å…¥éœ€è¦æ”¹ä¸º`from setuptools import setup`ï¼‰ã€‚ä½¿ç”¨è€…æ‹¿åˆ°è¿™ä¸ªåŒ…åï¼Œè§£å‹ï¼Œåˆ° foo-1.0 ç›®å½•ä¸‹æ‰§è¡Œï¼š`python setup.py install`ï¼Œé‚£ä¹ˆï¼Œfoo.py å°±ä¼šè¢«æ‹·è´åˆ° python ç±»è·¯å¾„ä¸‹ï¼Œå¯ä»¥è¢«å¯¼å…¥ä½¿ç”¨ï¼ˆå¦‚æœå®‰è£…æ˜¯ egg æ–‡ä»¶ï¼Œä¼šæŠŠ egg æ–‡ä»¶æ‹·è´åˆ° dist-packages ç›®å½•ä¸‹ï¼‰ã€‚

```bash
root@network:/kong/setup/dist/foo-1.0# python setup.py install
running install
running build
running build_py
creating build
creating build/lib.linux-x86_64-2.7
copying foo.py -> build/lib.linux-x86_64-2.7
running install_lib
copying build/lib.linux-x86_64-2.7/foo.py -> /usr/local/lib/python2.7/dist-packages
byte-compiling /usr/local/lib/python2.7/dist-packages/foo.py to foo.pyc
running install_egg_info
Removing /usr/local/lib/python2.7/dist-packages/foo-1.0.egg-info
Writing /usr/local/lib/python2.7/dist-packages/foo-1.0.egg-info
root@network:/kong/setup/dist/foo-1.0# ll /usr/local/lib/python2.7/dist-packages/foo
foo-1.0.egg-info  foo.py            foo.pyc   
```

å¯¹äº Windowsï¼Œå¯ä»¥æ‰§è¡Œ`python setup.py bdist_wininst`ç”Ÿæˆä¸€ä¸ª exe æ–‡ä»¶ï¼›è‹¥è¦ç”Ÿæˆ RPM åŒ…ï¼Œæ‰§è¡Œ`python setup.py bdist_rpm`ï¼Œä½†ç³»ç»Ÿå¿…é¡»æœ‰ rpm å‘½ä»¤çš„æ”¯æŒã€‚å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰æ ¼å¼çš„æ”¯æŒï¼š
```bash
root@network:/kong/setup# python setup.py bdist --help-formats
List of available distribution formats:
    --formats=rpm      RPM distribution
    --formats=gztar    gzip'ed tar file
    --formats=bztar    bzip2'ed tar file
    --formats=ztar     compressed tar file
    --formats=tar      tar file
    --formats=wininst  Windows executable installer
    --formats=zip      ZIP file
    --formats=msi      Microsoft Installer
    
```
setup å‡½æ•°è¿˜æœ‰ä¸€äº›å‚æ•°ï¼š

1ã€`packages`  
å‘Šè¯‰ Distutils éœ€è¦å¤„ç†é‚£äº›åŒ…ï¼ˆåŒ…å«`__init__.py`çš„æ–‡ä»¶å¤¹ï¼‰  
2ã€`package_dir`  
å‘Šè¯‰ Distutils å“ªäº›ç›®å½•ä¸‹çš„æ–‡ä»¶è¢«æ˜ å°„åˆ°å“ªä¸ªæºç åŒ…ï¼Œæ„Ÿè§‰å¥½åƒæ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„çš„å®šä¹‰ã€‚ä¸€ä¸ªä¾‹å­ï¼š`package_dir = {'': 'lib'}`ï¼Œè¡¨ç¤ºä»¥ lib ä¸ºä¸»ç›®å½•ã€‚  
3ã€`ext_modules`  
æ˜¯ä¸€ä¸ªåŒ…å« Extension å®ä¾‹çš„åˆ—è¡¨ï¼ŒExtension çš„å®šä¹‰ä¹Ÿæœ‰ä¸€äº›å‚æ•°ã€‚  
4ã€`ext_package`  
å®šä¹‰ extension çš„ç›¸å¯¹è·¯å¾„  
5ã€`requires`  
å®šä¹‰ä¾èµ–å“ªäº›æ¨¡å—  
6ã€`provides`  
å®šä¹‰å¯ä»¥ä¸ºå“ªäº›æ¨¡å—æä¾›ä¾èµ–  
7ã€`scripts`  
æŒ‡å®š python æºç æ–‡ä»¶ï¼Œå¯ä»¥ä»å‘½ä»¤è¡Œæ‰§è¡Œã€‚åœ¨å®‰è£…æ—¶æŒ‡å®š`--install-script`  
8ã€`package_data`  
é€šå¸¸åŒ…å«ä¸åŒ…å®ç°ç›¸å…³çš„ä¸€äº›æ•°æ®æ–‡ä»¶æˆ–ç±»ä¼¼äº readme çš„æ–‡ä»¶ã€‚
```toml
package_data = {'': ['*.txt'], 'mypkg': ['data/*.dat'],}
```

è¡¨ç¤ºåŒ…å«æ‰€æœ‰ç›®å½•ä¸‹çš„ txt æ–‡ä»¶å’Œ mypkg/data ç›®å½•ä¸‹çš„æ‰€æœ‰ dat æ–‡ä»¶ã€‚

9ã€`data_files`  
æŒ‡å®šå…¶ä»–çš„ä¸€äº›æ–‡ä»¶ï¼ˆå¦‚é…ç½®æ–‡ä»¶ï¼‰
```toml
setup(...,
        data_files=[('bitmaps', ['bm/b1.gif', 'bm/b2.gif']),
                    ('config', ['cfg/data.cfg']),
                    ('/etc/init.d', ['init-script'])]
        )
```

è§„å®šäº†å“ªäº›æ–‡ä»¶è¢«å®‰è£…åˆ°å“ªäº›ç›®å½•ä¸­ã€‚å¦‚æœç›®å½•åæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™æ˜¯ç›¸å¯¹äº`sys.prefix`æˆ–`sys.exec_prefix`çš„è·¯å¾„ã€‚å¦‚æœæ²¡æœ‰æä¾›æ¨¡æ¿ï¼Œä¼šè¢«æ·»åŠ åˆ° MANIFEST æ–‡ä»¶ä¸­ã€‚

æ‰§è¡Œ sdist å‘½ä»¤æ—¶ï¼Œé»˜è®¤ä¼šæ‰“åŒ…å“ªäº›ä¸œè¥¿å‘¢ï¼Ÿ

*   æ‰€æœ‰ç”±`py_modules`æˆ–`packages`æŒ‡å®šçš„æºç æ–‡ä»¶
*   æ‰€æœ‰ç”±`ext_modules`æˆ–`libraries`æŒ‡å®šçš„ C æºç æ–‡ä»¶
*   ç”±`scripts`æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶
*   ç±»ä¼¼äº test/test*.py çš„æ–‡ä»¶
*   README.txt æˆ– READMEï¼Œsetup.pyï¼Œsetup.cfg
*   æ‰€æœ‰`package_data`æˆ–`data_files`æŒ‡å®šçš„æ–‡ä»¶

è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å†™ä¸€ä¸ª manifest templateï¼Œåä¸º`MANIFEST.in`ï¼Œå®šä¹‰å¦‚ä½•ç”Ÿæˆ MANIFEST æ–‡ä»¶ï¼Œå†…å®¹å°±æ˜¯éœ€è¦åŒ…å«åœ¨åˆ†å‘åŒ…ä¸­çš„æ–‡ä»¶ã€‚ä¸€ä¸ª MANIFEST.in æ–‡ä»¶å¦‚ä¸‹ï¼š
```ini
include *.txt
recursive-include examples *.txt *.py
prune examples/sample?/build
```

setup.cfg
---------

setup.cfg æä¾›ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥è®©åŒ…çš„å¼€å‘è€…æä¾›å‘½ä»¤çš„é»˜è®¤é€‰é¡¹ï¼ŒåŒæ—¶ä¸ºç”¨æˆ·æä¾›ä¿®æ”¹çš„æœºä¼šã€‚å¯¹ setup.cfg çš„è§£æï¼Œæ˜¯åœ¨ setup.py ä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œå‰ã€‚

setup.cfg æ–‡ä»¶çš„å½¢å¼ç±»ä¼¼äº
```toml
[command]plain
option=value
...
    
```
å…¶ä¸­ï¼Œ`command`æ˜¯ Distutils çš„å‘½ä»¤å‚æ•°ï¼Œ`option`æ˜¯å‚æ•°é€‰é¡¹ï¼Œå¯ä»¥é€šè¿‡`python setup.py --help build_ext`æ–¹å¼è·å–ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯”å¦‚ä¸€ä¸ªé€‰é¡¹æ˜¯â€“foo-barï¼Œåœ¨ setup.cfg ä¸­å¿…é¡»æ”¹æˆ foo_bar çš„æ ¼å¼

ç¬¦åˆ Distutils2 çš„ setup.cfg æœ‰äº›ä¸åŒã€‚åŒ…å«ä¸€äº› sectionsï¼š  
1ã€`global`  
å®šä¹‰ Distutils2 çš„å…¨å±€é€‰é¡¹ï¼Œå¯èƒ½åŒ…å« commandsï¼Œcompilersï¼Œsetup_hookï¼ˆå®šä¹‰è„šæœ¬ï¼Œåœ¨ setup.cfg è¢«è¯»å–åæ‰§è¡Œï¼Œå¯ä»¥ä¿®æ”¹ setup.cfg çš„é…ç½®ï¼Œpbr å°±ç”¨åˆ°äº†è¿™ä¸ªï¼‰  
2ã€`metadata`  
3ã€`files`

*   packages_rootï¼šæ ¹ç›®å½•
*   packages
*   modules
*   scripts
*   extra_files

Setuptools
----------

ä¸Šé¢çš„ setup.py å’Œ setup.cfg éƒ½æ˜¯éµå¾ª python æ ‡å‡†åº“ä¸­çš„ Distutilsï¼Œè€Œ setuptools å·¥å…·é’ˆå¯¹ Python å®˜æ–¹çš„ distutils åšäº†å¾ˆå¤šé’ˆå¯¹æ€§çš„åŠŸèƒ½å¢å¼ºï¼Œæ¯”å¦‚ä¾èµ–æ£€æŸ¥ï¼ŒåŠ¨æ€æ‰©å±•ç­‰ã€‚å¾ˆå¤šé«˜çº§åŠŸèƒ½æˆ‘å°±ä¸è¯¦è¿°äº†ï¼Œè‡ªå·±ä¹Ÿæ²¡æœ‰ç”¨è¿‡ï¼Œç­‰ç”¨çš„æ—¶å€™å†ä½œè¡¥å……ã€‚è¯¦æƒ…å¯å‚è§[è¿™é‡Œ](https://pythonhosted.org/setuptools/setuptools.html)ã€‚

ä¸€ä¸ªå…¸å‹çš„éµå¾ª setuptools çš„è„šæœ¬ï¼š
```python
    from setuptools import setup, find_packages
    setup(
        name = "HelloWorld",
        version = "0.1",
        packages = find_packages(),
        scripts = ['say_hello.py'],
    
        # Project uses reStructuredText, so ensure that the docutils get
        # installed or upgraded on the target machine
        install_requires = ['docutils>=0.3'],
    
        package_data = {
            # If any package contains *.txt or *.rst files, include them:
            '': ['*.txt', '*.rst'],
            # include any *.msg files found in the 'hello' package, too:
            'hello': ['*.msg'],
        },
    
        # metadata for upload to PyPI
        author = "Me",
        author_email = "me@example.com",
        description = "This is an Example Package",
        license = "PSF",
        keywords = "hello world example examples",
        url = "http://example.com/HelloWorld/",   # project home page, if any
    
        # could also include long_description, download_url, classifiers, etc.
    )
    
```
setuptools ç›¸å¯¹ distutilsï¼Œå¢å¼ºçš„å…³é”®å­—ï¼š  
`include_package_data`ï¼šä¸º True æ—¶è‡ªåŠ¨æ·»åŠ å—ç‰ˆæœ¬æ§åˆ¶çš„æ•°æ®æ–‡ä»¶ï¼Œå¯æ›¿ä»£`package_data`ï¼ŒåŒæ—¶ï¼Œ`exclude_package_data`å¯ä»¥æ’é™¤æŸäº›æ–‡ä»¶ã€‚å½“ä½ éœ€è¦åŠ å…¥æ²¡æœ‰è¢«ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶æ—¶ï¼Œè¿˜æ˜¯è€è€å®å®ä½¿ç”¨`package_data`å§ã€‚  
`install_requires`ï¼šä»£æ›¿`require`å‡½æ•°ã€‚è¡¨ç¤ºå½“å‰åŒ…çš„å®‰è£…ä¾èµ–äºå“ªäº›åˆ†å‘åŒ…ï¼Œè¿™äº›ä¿¡æ¯ä¼šå†™å…¥ egg çš„å…ƒä¿¡æ¯ä¸­ï¼Œè¿™äº›åŒ…åœ¨å®‰è£…æ—¶ä¼šè‡ªåŠ¨ï¼ˆä» PyPIï¼‰ä¸‹è½½å¹¶å®‰è£…ã€‚å¦‚æœåŒ…åœ¨ PyPI ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™ä¼šä»`dependency_links`æ ‡è¯†çš„ URL ä¸­è·å–ã€‚  
`extras_require`ï¼šå½“å‰åŒ…çš„é«˜çº§/é¢å¤–ç‰¹æ€§éœ€è¦ä¾èµ–çš„åˆ†å‘åŒ…ã€‚  
`entry_points`ï¼šè¿™ä¸ªå¾ˆç»å…¸ã€‚è§ä¸‹é¢çš„è®²è§£ã€‚  
`setup_requires`ï¼š å®‰è£…è„šæœ¬æ‰§è¡Œæ—¶éœ€è¦ä¾èµ–çš„åˆ†å‘åŒ…ï¼Œä¸»è¦ç”¨äºæ„å»ºè¿‡ç¨‹ã€‚æ³¨æ„ï¼Œè¿™é‡Œåˆ—å‡ºçš„åŒ…ä¸ä¼šè‡ªåŠ¨å®‰è£…ï¼Œå¦‚æœéœ€è¦ï¼ŒåŒæ—¶è¦åœ¨`install_requires`ä¸­æŒ‡å®šã€‚  
`dependency_links`ï¼šURL åœ°å€ã€‚è¿™äº›åœ°å€åœ¨å®‰è£…`setup_requires`æˆ–`tests_require`æŒ‡å®šçš„åŒ…æ—¶ä½¿ç”¨ã€‚ä¼šå†™å…¥ egg çš„ metadata ä¿¡æ¯ä¸­ã€‚

### å¦‚ä½•è®©ä¸€ä¸ª egg å¯è¢«æ‰§è¡Œ
```toml
    setup(
        # other arguments here...
        entry_points = {
            'setuptools.installation': [
                'eggsecutable = my_package.some_module:main_func',
            ]
        }
    )
    
```
### å¦‚ä½•å®šä¹‰ä¸€ä¸ªå¯é€‰ç‰¹æ€§

```toml
    setup(
        name="Project-A",
        ...
        extras_require = {
            'PDF':  ["ReportLab>=1.2", "RXP"],
            'reST': ["docutils>=0.3"],
        }
    )
```

è¡¨ç¤ºå¦‚æœç³»ç»Ÿå®‰è£… docutils äº†ï¼Œé‚£ä¹ˆå¯æä¾› reST ç‰¹æ€§ã€‚å½“ç„¶ï¼Œdocutils åŒ…ä¸ä¼šè‡ªåŠ¨å®‰è£…ï¼Œåªæœ‰ç¬¬ä¸‰æ–¹åŒ…ä¾èµ–æœ¬åŒ…çš„ reST ç‰¹æ€§æ—¶ï¼Œæ‰ä¼šä¸‹è½½å®‰è£…ã€‚

ç‰¹æ€§å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿéœ€è¦ä¸ entry points ç»“åˆä½¿ç”¨ï¼Œåœ¨ä¸Šä¸€ä¸ª setup.py è„šæœ¬ä¸­å¢åŠ ï¼š

```toml
    setup(
        name="Project-A",
        ...
        entry_points = {
            'console_scripts': [
                'rst2pdf = project_a.tools.pdfgen [reST]',
                'rst2html = project_a.tools.htmlgen',
                # more script entry points ...
            ],
        }
    )
```

è¡¨ç¤ºå¦‚æœè¦ä½¿ç”¨ rst2pdf è„šæœ¬ï¼Œå°±è¦å®‰è£… docutilsã€‚

æˆ–è€…è¢«å…¶ä»– project ä¾èµ–ï¼š`install_requires = ["Project-A[PDF]"]`

### æ’ä»¶å¼å¼€å‘

æˆ‘æƒ³å¤§å®¶æœ€ç†Ÿæ‚‰çš„å°±æ˜¯è¿™ä¸ªç‰¹æ€§äº†å§ã€‚æ¯”å¦‚ä¸€ä¸ªåšå®¢ç³»ç»Ÿæƒ³ç”¨ä¸åŒçš„æ’ä»¶æ”¯æŒä¸åŒçš„è¯­è¨€è¾“å‡ºæ ¼å¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªâ€œentry point groupâ€ï¼Œä¸åŒçš„æ’ä»¶å°±å¯ä»¥æ³¨å†Œâ€œentry pointâ€ï¼Œæ’ä»¶æ³¨å†Œçš„ç¤ºä¾‹ï¼š
```toml
setup(
    # ...
    entry_points = {'blogtool.parsers': ['.rst = some_module:a_func']}
)
# æˆ–è€…
setup(
    # ...
    entry_points = """
        [blogtool.parsers]
        .rst = some.nested.module:SomeClass.some_classmethod [reST]
    """,
    extras_require = dict(reST = "Docutils>=0.3.5")
)
    
```
### ç®¡ç†ä¾èµ–

æˆ‘ä»¬å†™ä¾èµ–å£°æ˜çš„æ—¶å€™éœ€è¦åœ¨ setup.py ä¸­å†™å¥½æŠ½è±¡ä¾èµ–ï¼ˆinstall_requiresï¼‰ï¼Œåœ¨ requirements.txt ä¸­å†™å¥½å…·ä½“çš„ä¾èµ–ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æƒ³ç»´æŠ¤ä¸¤ä»½ä¾èµ–æ–‡ä»¶ï¼Œè¿™æ ·ä¼šè®©æˆ‘ä»¬å¾ˆéš¾åšå¥½åŒæ­¥ã€‚ requirements.txt å¯ä»¥æ›´å¥½åœ°å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ‰ setup.py çš„ç›®å½•é‡Œå†™ä¸‹ä¸€ä¸ªè¿™æ ·çš„ requirements.txt
```plain
    --index https://pypi.python.org/simple/plain
    
    -e .
    
```
è¿™æ · pip install -r requirements.txt å¯ä»¥ç…§å¸¸å·¥ä½œï¼Œå®ƒä¼šå…ˆå®‰è£…è¯¥æ–‡ä»¶è·¯å¾„ä¸‹çš„åŒ…ï¼Œç„¶åç»§ç»­å¼€å§‹è§£ææŠ½è±¡ä¾èµ–ï¼Œç»“åˆ â€“index é€‰é¡¹åè½¬æ¢ä¸ºå…·ä½“ä¾èµ–ç„¶åå†å®‰è£…ä»–ä»¬ã€‚

è¿™ä¸ªåŠæ³•å¯ä»¥è®©æˆ‘ä»¬è§£å†³ä¸€ç§ç±»ä¼¼è¿™æ ·çš„æƒ…å½¢ï¼šæ¯”å¦‚ä½ æœ‰ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„åŒ…åœ¨ä¸€èµ·å¼€å‘ä½†æ˜¯æ˜¯åˆ†å¼€å‘è¡Œçš„ï¼Œæˆ–è€…è¯´ä½ æœ‰ä¸€ä¸ªå°šæœªå‘å¸ƒçš„åŒ…å¹¶æŠŠå®ƒåˆ†æˆäº†å‡ ä¸ªéƒ¨åˆ†ã€‚å¦‚æœä½ çš„é¡¶å±‚çš„åŒ… ä¾ç„¶ä»…ä»…æŒ‰ç…§â€œåå­—â€æ¥ä¾èµ–çš„è¯ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ requirements.txt æ¥å®‰è£…å¼€å‘ç‰ˆæœ¬çš„ä¾èµ–åŒ…:
```plain
    --index https://pypi.python.org/simple/
    
    -e https://github.com/foo/bar.git#egg=bar
    -e .
    
```

è¿™ä¼šé¦–å…ˆä» https://github.com/foo/bar.git æ¥å®‰è£…åŒ… bar ï¼Œ ç„¶åè¿›è¡Œåˆ°ç¬¬äºŒè¡Œ -e . ï¼Œå¼€å§‹å®‰è£… setup ä¸­çš„æŠ½è±¡ä¾èµ–ï¼Œä½†æ˜¯åŒ… bar å·²ç»å®‰è£…è¿‡äº†ï¼Œ æ‰€ä»¥ pip ä¼šè·³è¿‡å®‰è£…ã€‚

Differences between distribute, distutils, setuptools and distutils2
--------------------------------------------------------------------

**Distutils** is the standard tool used for packaging. It works rather well for simple needs, but is limited and not trivial to extend.

**Setuptools** is a project born from the desire to fill missing distutils functionality and explore new directions. In some subcommunities, itâ€™s a de facto standard. It uses monkey-patching and magic that is frowned upon by Python core developers.

**Distribute** is a fork of Setuptools that was started by developers feeling that its development pace was too slow and that it was not possible to evolve it. Its development was considerably slowed when distutils2 was started by the same group. 2013-August update: distribute is merged back into setuptools and discontinued.

**Distutils2** is a new distutils library, started as a fork of the distutils codebase, with good ideas taken from setup tools (of which some were thoroughly discussed in PEPs), and a basic installer inspired by pip. The actual name you use to import Distutils2 is packaging in the Python 3.3+ standard library, or distutils2 in 2.4+ and 3.1â€“3.2. (A backport will be available soon.) Distutils2 did not make the Python 3.3 release, and it was put on hold.

PBR
---

[pbr](https://pypi.python.org/pypi/pbr)æ˜¯ setuptools çš„è¾…åŠ©å·¥å…·ï¼Œæœ€åˆæ˜¯ä¸º OpenStack å¼€å‘(https://launchpad.net/pbr)ï¼ŒåŸºäº[d2to1](https://pypi.python.org/pypi/d2to1)ã€‚

> A library for managing setuptools packaging needs in a consistent manner.

pbr ä¼šè¯»å–å’Œè¿‡æ»¤ setup.cfg ä¸­çš„æ•°æ®ï¼Œç„¶åå°†è§£æåçš„æ•°æ®æä¾›ç»™ setup.py ä½œä¸ºå‚æ•°ã€‚åŒ…å«å¦‚ä¸‹åŠŸèƒ½ï¼š  
1ã€ä» git ä¸­è·å– Versionã€AUTHORS and ChangeLog ä¿¡æ¯  
2ã€Sphinx Autodocã€‚pbr ä¼šæ‰«æ projectï¼Œæ‰¾åˆ°æ‰€æœ‰æ¨¡å—ï¼Œç”Ÿæˆ stub files  
3ã€Requirementsã€‚pbr ä¼šè¯»å– requirements.txtï¼Œç”Ÿæˆ setup å‡½æ•°éœ€è¦çš„`install_requires/tests_require/dependency_links`

> è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œåœ¨ requirements.txt æ–‡ä»¶çš„å¤´éƒ¨å¯ä»¥ä½¿ç”¨ï¼š`--index https://pypi.python.org/simple/`ï¼Œè¿™ä¸€è¡ŒæŠŠä¸€ä¸ªæŠ½è±¡çš„ä¾èµ–å£°æ˜å¦‚ requests==1.2.0 è½¬å˜ä¸ºä¸€ä¸ªå…·ä½“çš„ä¾èµ–å£°æ˜ requests 1.2.0 from pypi.python.org/simple/

4ã€long_descriptionã€‚ä» README.rst, README.txt or README file ä¸­ç”Ÿæˆ`long_description`å‚æ•°

ä½¿ç”¨ pbr å¾ˆç®€å•ï¼š
```plain
    from setuptools import setup
    
    setup(
        setup_requires=['pbr'],
        pbr=True,
    )
    
```
ä½¿ç”¨ pbr æ—¶ï¼Œsetup.cfg ä¸­æœ‰ä¸€äº›é…ç½®ã€‚åœ¨[files]ä¸­ï¼Œæœ‰ä¸‰ä¸ª keyï¼š  
`packages`:æŒ‡å®šéœ€è¦åŒ…å«çš„åŒ…ï¼Œè¡Œä¸ºç±»ä¼¼äº setuptools.find_packages  
`namespace_packages`:æŒ‡å®š namespace packages  
`data_files`: æŒ‡å®šç›®çš„ç›®å½•å’Œæºæ–‡ä»¶è·¯å¾„ï¼Œä¸€ä¸ªç¤ºä¾‹ï¼š
```plain
    [files]plain
    data_files =
        etc/pbr = etc/pbr/*
        etc/neutron =
            etc/api-paste.ini
            etc/dhcp-agent.ini
        etc/init.d = neutron.init
    
```
`[entry_points]`æ®µè·Ÿ setuptools çš„æ–¹å¼ç›¸åŒã€‚

Babel
-----

> A collection of tools for internationalizing Python applications

[Babel](http://babel.edgewall.org/)æ˜¯ Python çš„ä¸€ä¸ªå›½é™…åŒ–å·¥å…·åŒ…ï¼Œæä¾›äº†å¯¹ distutils æˆ– setuptools çš„æ”¯æŒï¼ŒåŒ…å«ä¸€äº›å‘½ä»¤ã€‚

1ã€compile_catalog  
ç±»ä¼¼äº msgfmt å·¥å…·ï¼Œtakes a message catalog from a PO file and compiles it to a binary MO file.
```plain
    $ ./setup.py compile_catalog --directory foobar/locale --locale pt_BR
    running compile_catalog
    compiling catalog to foobar/locale/pt_BR/LC_MESSAGES/messages.mo
    
```
2ã€extract_messages  
ç±»ä¼¼äº xgettextï¼Œit can extract localizable messages from a variety of difference source files, and generate a PO (portable object) template file from the collected messages.
```plain
    $ ./setup.py extract_messages --output-file foobar/locale/messages.pot
    running extract_messages
    extracting messages from foobar/__init__.py
    extracting messages from foobar/core.py
    ...
    writing PO template file to foobar/locale/messages.pot
    
```
3ã€update_catalog  
ç±»ä¼¼äº msgmergeï¼Œit updates an existing translations catalog based on a PO template file (POT).

### setup.py å’Œ pip

è¡¨é¢ä¸Šï¼Œ`python setup.py install`å’Œ`pip install`éƒ½æ˜¯ç”¨æ¥å®‰è£… python åŒ…çš„ï¼Œå®é™…ä¸Šï¼Œ`pip`æä¾›äº†æ›´å¤šçš„ç‰¹æ€§ï¼Œæ›´æ˜“äºä½¿ç”¨ã€‚ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   pip ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–ï¼Œè€Œå¦‚æœä½¿ç”¨ setup.pyï¼Œåˆ™éœ€è¦æ‰‹åŠ¨æœç´¢å’Œä¸‹è½½ï¼›
*   pip ä¼šè‡ªåŠ¨ç®¡ç†åŒ…çš„ä¿¡æ¯ï¼Œä½¿å¸è½½/æ›´æ–°æ›´åŠ æ–¹ä¾¿å’Œå®¹æ˜“ï¼Œä½¿ç”¨`pip uninstall`å³å¯ã€‚è€Œä½¿ç”¨ setup.pyï¼Œå¿…é¡»æ‰‹åŠ¨åˆ é™¤ï¼Œæœ‰æ—¶å®¹æ˜“å‡ºé”™ã€‚
*   pip æä¾›äº†å¯¹`virtualenv`æ›´å¥½çš„æ•´åˆã€‚

## ç»“è¯­

OKï¼Œè®²äº†è¿™ä¹ˆå¤šçç¢çš„ä¸œè¥¿ï¼Œç°åœ¨å»çœ‹çœ‹ Nova æˆ– Ceilometer çš„ setup è„šæœ¬ï¼Œæ˜¯ä¸æ˜¯ä¸€ä¸‹æ¸…æ™°äº†å¾ˆå¤šï¼Ÿï¼ä½†è¯´å®è¯ï¼Œsetup.py çš„ä½¿ç”¨ï¼Œæˆ‘è¿˜ä¸èƒ½è®²çš„ç‰¹åˆ«æ¸…æ¥šï¼Œéœ€è¦åœ¨åç»­çš„å®æˆ˜ä¸­å­¦ä¹ ã€‚

## å‚è€ƒæ–‡æ¡£
[http://docs.python.org/2/distutils/introduction.html](http://docs.python.org/2/distutils/introduction.html)  
[http://pythonhosted.org/setuptools/](http://pythonhosted.org/setuptools/)

## åŸæ–‡é“¾æ¥
[å…³äº python ä¸­çš„ setup.py](https://lingxiankong.github.io/2013-12-23-python-setup.html)

## æ¨èé˜…è¯»

[èŠ±äº†ä¸¤å¤©ï¼Œç»ˆäºæŠŠ Python çš„ setup.py ç»™æ•´æ˜ç™½äº† - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/276461821)
[pep-0518](https://www.python.org/dev/peps/pep-0518/)
[Python æ‰“åŒ…æŒ‡å— 2021 | Frost's Blog](https://frostming.com/2020/12-25/python-packaging/)
