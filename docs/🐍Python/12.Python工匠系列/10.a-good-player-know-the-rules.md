---
title: Python å·¥åŒ ï¼šåšä¸€ä¸ªç²¾é€šè§„åˆ™çš„ç©å®¶

tags: 
  - ç¼–ç¨‹
  - Python
  - æ¨¡å—
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - Python å·¥åŒ ç³»åˆ—
date: 2020-08-13 18:30:46
permalink: /craftsman/aac69d/
author: piglei
---

## å‰è¨€

> è¿™æ˜¯ â€œPython å·¥åŒ â€ç³»åˆ—çš„ç¬¬ 10 ç¯‡æ–‡ç« ã€‚[[æŸ¥çœ‹ç³»åˆ—æ‰€æœ‰æ–‡ç« ]](https://github.com/piglei/one-python-craftsman)

![](https://www.zlovezl.cn/static/uploaded/2019/05/jeshoots-com-632498-unsplash_w1280.jpg)

ç¼–ç¨‹ï¼Œå…¶å®å’Œç©ç”µå­æ¸¸æˆæœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚ä½ åœ¨ç©ä¸åŒæ¸¸æˆå‰ï¼Œéœ€è¦å…ˆå­¦ä¹ æ¯ä¸ªæ¸¸æˆçš„ä¸åŒè§„åˆ™ï¼Œåªæœ‰ç†Ÿæ‚‰å’Œçµæ´»è¿ç”¨æ¸¸æˆè§„åˆ™ï¼Œæ‰æ›´æœ‰å¯èƒ½åœ¨æ¸¸æˆä¸­è·èƒœã€‚

è€Œç¼–ç¨‹ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä¸åŒç¼–ç¨‹è¯­è¨€åŒæ ·æœ‰ç€ä¸ä¸€æ ·çš„â€œè§„åˆ™â€ã€‚å¤§åˆ°æ˜¯å¦æ”¯æŒé¢å‘å¯¹è±¡ï¼Œå°åˆ°æ˜¯å¦å¯ä»¥å®šä¹‰å¸¸é‡ï¼Œç¼–ç¨‹è¯­è¨€çš„è§„åˆ™æ¯”ç»å¤§å¤šæ•°ç”µå­æ¸¸æˆè¦å¤æ‚çš„å¤šã€‚

å½“æˆ‘ä»¬ç¼–ç¨‹æ—¶ï¼Œå¦‚æœç›´æ¥æ‹¿ä¸€ç§è¯­è¨€çš„ç»éªŒå¥—ç”¨åˆ°å¦å¤–ä¸€ç§è¯­è¨€ä¸Šï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½å–å¾—æœ€ä½³ç»“æœã€‚è¿™å°±å¥½åƒä¸€ä¸ª CSï¼ˆåæç²¾è‹±ï¼‰ é«˜æ‰‹åœ¨ä¸äº†è§£è§„åˆ™çš„æƒ…å†µä¸‹å»ç© PUBGï¼ˆç»åœ°æ±‚ç”Ÿï¼‰ï¼Œè™½ç„¶ä»–çš„æªæ³•å¯èƒ½ä¸‡ä¸­æ— ä¸€ï¼Œä½†æ˜¯ææœ‰å¯èƒ½åœ¨å‘ç°ç¬¬ä¸€ä¸ªæ•Œäººå‰ï¼Œä»–å°±ä¼šå€’åœ¨æŸä¸ªçªåœ¨è‰ä¸›é‡Œçš„æ•Œäººçš„ä¼å‡»ä¸‹ã€‚

### Python é‡Œçš„è§„åˆ™

Python æ˜¯ä¸€é—¨åˆè§ç®€å•ã€æ·±å…¥åæ„ˆè§‰å¤æ‚çš„è¯­è¨€ã€‚æ‹¿ Python é‡Œæœ€é‡è¦çš„â€œå¯¹è±¡â€æ¦‚å¿µæ¥è¯´ï¼ŒPython ä¸ºå…¶å®šä¹‰äº†å¤šåˆ°è®©ä½ è®°ä¸å…¨çš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼š

- å®šä¹‰äº† `__str__` æ–¹æ³•çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨ `str()` å‡½æ•°æ¥è¿”å›å¯è¯»åç§°
- å®šä¹‰äº† `__next__` å’Œ `__iter__` æ–¹æ³•çš„å¯¹è±¡ï¼Œå°±å¯ä»¥è¢«å¾ªç¯è¿­ä»£
- å®šä¹‰äº† `__bool__` æ–¹æ³•çš„å¯¹è±¡ï¼Œåœ¨è¿›è¡Œå¸ƒå°”åˆ¤æ–­æ—¶å°±ä¼šä½¿ç”¨è‡ªå®šä¹‰çš„é€»è¾‘
- ... ...

**ç†Ÿæ‚‰è§„åˆ™ï¼Œå¹¶è®©è‡ªå·±çš„ä»£ç é€‚åº”è¿™äº›è§„åˆ™ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´åœ°é“çš„ä»£ç ï¼Œäº‹åŠåŠŸå€çš„å®Œæˆå·¥ä½œã€‚**ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæœ‰å…³é€‚åº”è§„åˆ™çš„æ•…äº‹ã€‚

## æ¡ˆä¾‹ï¼šä»ä¸¤ä»½æ—…æ¸¸æ•°æ®ä¸­è·å–äººå‘˜åå•

æŸæ—¥ï¼Œåœ¨ä¸€ä¸ªä¸»æ‰“æ–°è¥¿å…°å‡ºå¢ƒæ¸¸çš„æ—…æ¸¸å…¬å¸é‡Œï¼Œå•†åŠ¡åŒäº‹çªç„¶å…´å†²å†²çš„è·‘è¿‡æ¥æ‰¾åˆ°æˆ‘ï¼Œè¯´ä»–ä»æŸåˆä½œä¼™ä¼´é‚£é‡Œï¼Œè¦åˆ°äº†ä¸¤ä»½é‡è¦çš„æ•°æ®ï¼š

1. æ‰€æœ‰å»è¿‡â€œæ³°å›½æ™®å‰å²›â€çš„äººå‘˜åŠè”ç³»æ–¹å¼
2. æ‰€æœ‰å»è¿‡â€œæ–°è¥¿å…°â€çš„äººå‘˜åŠè”ç³»æ–¹å¼

æ•°æ®é‡‡ç”¨äº† JSON æ ¼å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
# å»è¿‡æ™®å‰å²›çš„äººå‘˜æ•°æ®
users_visited_phuket = [
    {"first_name": "Sirena", "last_name": "Gross", "phone_number": "650-568-0388", "date_visited": "2018-03-14"},
    {"first_name": "James", "last_name": "Ashcraft", "phone_number": "412-334-4380", "date_visited": "2014-09-16"},
    ... ...
]

# å»è¿‡æ–°è¥¿å…°çš„äººå‘˜æ•°æ®
users_visited_nz = [
    {"first_name": "Justin", "last_name": "Malcom", "phone_number": "267-282-1964", "date_visited": "2011-03-13"},
    {"first_name": "Albert", "last_name": "Potter", "phone_number": "702-249-3714", "date_visited": "2013-09-11"},
    ... ...
]
```

æ¯ä»½æ•°æ®é‡Œé¢éƒ½æœ‰ç€`å§“`ã€`å`ã€`æ‰‹æœºå·ç `ã€`æ—…æ¸¸æ—¶é—´` å››ä¸ªå­—æ®µã€‚åŸºäºè¿™ä»½æ•°æ®ï¼Œå•†åŠ¡åŒå­¦æå‡ºäº†ä¸€ä¸ª*ï¼ˆå¬ä¸Šå»æ¯«æ— é“ç†ï¼‰*çš„å‡è®¾ï¼šâ€œå»è¿‡æ™®å‰å²›çš„äººï¼Œåº”è¯¥å¯¹å»æ–°è¥¿å…°æ—…æ¸¸ä¹Ÿå¾ˆæœ‰å…´è¶£ã€‚æˆ‘ä»¬éœ€è¦ä»è¿™ä»½æ•°æ®é‡Œï¼Œæ‰¾å‡ºé‚£äº›**å»è¿‡æ™®å‰å²›ä½†æ²¡æœ‰å»è¿‡æ–°è¥¿å…°çš„äºº**ï¼Œé’ˆå¯¹æ€§çš„å–äº§å“ç»™ä»–ä»¬ã€‚

### ç¬¬ä¸€æ¬¡è›®åŠ›å°è¯•

æœ‰äº†åŸå§‹æ•°æ®å’Œæ˜ç¡®çš„éœ€æ±‚ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•å†™ä»£ç äº†ã€‚ä¾é è›®åŠ›ï¼Œæˆ‘å¾ˆå¿«å°±å†™å‡ºäº†ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼š

```python
def find_potential_customers_v1():
    """æ‰¾åˆ°å»è¿‡æ™®å‰å²›ä½†æ˜¯æ²¡å»è¿‡æ–°è¥¿å…°çš„äºº
    """
    for phuket_record in users_visited_phuket:
        is_potential = True
        for nz_record in users_visited_nz:
            if phuket_record['first_name'] == nz_record['first_name'] and \
                    phuket_record['last_name'] == nz_record['last_name'] and \
                    phuket_record['phone_number'] == nz_record['phone_number']:
                is_potential = False
                break

        if is_potential:
            yield phuket_record
```

å› ä¸ºåŸå§‹æ•°æ®é‡Œæ²¡æœ‰*â€œç”¨æˆ· IDâ€*ä¹‹ç±»çš„å”¯ä¸€æ ‡ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æŠŠâ€œå§“åå’Œç”µè¯å·ç å®Œå…¨ç›¸åŒâ€ä½œä¸ºåˆ¤æ–­æ˜¯ä¸æ˜¯åŒä¸€ä¸ªäººçš„æ ‡å‡†ã€‚

`find_potential_customers_v1` å‡½æ•°é€šè¿‡å¾ªç¯çš„æ–¹å¼ï¼Œå…ˆéå†æ‰€æœ‰å»è¿‡æ™®å‰å²›çš„äººï¼Œç„¶åå†éå†æ–°è¥¿å…°çš„äººï¼Œå¦‚æœåœ¨æ–°è¥¿å…°çš„è®°å½•ä¸­æ‰¾ä¸åˆ°å®Œå…¨åŒ¹é…çš„è®°å½•ï¼Œå°±æŠŠå®ƒå½“åšâ€œæ½œåœ¨å®¢æˆ·â€è¿”å›ã€‚

è¿™ä¸ªå‡½æ•°è™½ç„¶å¯ä»¥å®Œæˆä»»åŠ¡ï¼Œä½†æ˜¯ç›¸ä¿¡ä¸ç”¨æˆ‘è¯´ä½ ä¹Ÿèƒ½å‘ç°ã€‚**å®ƒæœ‰ç€éå¸¸ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚**å¯¹äºæ¯ä¸€æ¡å»è¿‡æ™®å‰å²›çš„è®°å½•ï¼Œæˆ‘ä»¬éƒ½éœ€è¦éå†æ‰€æœ‰æ–°è¥¿å…°è®¿é—®è®°å½•ï¼Œå°è¯•æ‰¾åˆ°åŒ¹é…ã€‚æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¯æ€•çš„ `O(n*m)`ï¼Œå¦‚æœæ–°è¥¿å…°çš„è®¿é—®æ¡ç›®æ•°å¾ˆå¤šçš„è¯ï¼Œé‚£ä¹ˆæ‰§è¡Œå®ƒå°†è€—è´¹éå¸¸é•¿çš„æ—¶é—´ã€‚

ä¸ºäº†ä¼˜åŒ–å†…å±‚å¾ªç¯æ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘çº¿æ€§æŸ¥æ‰¾åŒ¹é…éƒ¨åˆ†çš„å¼€é”€ã€‚

### å°è¯•ä½¿ç”¨é›†åˆä¼˜åŒ–å‡½æ•°

å¦‚æœä½ å¯¹ Python æœ‰æ‰€äº†è§£çš„è¯ï¼Œé‚£ä¹ˆä½ è‚¯å®šçŸ¥é“ï¼ŒPython é‡Œçš„å­—å…¸å’Œé›†åˆå¯¹è±¡éƒ½æ˜¯åŸºäº [å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰](https://en.wikipedia.org/wiki/Hash_table) å®ç°çš„ã€‚åˆ¤æ–­ä¸€ä¸ªä¸œè¥¿æ˜¯ä¸æ˜¯åœ¨é›†åˆé‡Œçš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)`ï¼Œéå¸¸å¿«ã€‚

æ‰€ä»¥ï¼Œå¯¹äºä¸Šé¢çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°è¯•é’ˆå¯¹æ–°è¥¿å…°è®¿é—®è®°å½•åˆå§‹åŒ–ä¸€ä¸ªé›†åˆï¼Œä¹‹åçš„æŸ¥æ‰¾åŒ¹é…éƒ¨åˆ†å°±å¯ä»¥å˜å¾—å¾ˆå¿«ï¼Œå‡½æ•°æ•´ä½“æ—¶é—´å¤æ‚åº¦å°±èƒ½å˜ä¸º `O(n+m)`ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹æ–°çš„å‡½æ•°ï¼š

```python
def find_potential_customers_v2():
    """æ‰¾åˆ°å»è¿‡æ™®å‰å²›ä½†æ˜¯æ²¡å»è¿‡æ–°è¥¿å…°çš„äººï¼Œæ€§èƒ½æ”¹è¿›ç‰ˆ
    """
    # é¦–å…ˆï¼Œéå†æ‰€æœ‰æ–°è¥¿å…°è®¿é—®è®°å½•ï¼Œåˆ›å»ºæŸ¥æ‰¾ç´¢å¼•
    nz_records_idx = {
        (rec['first_name'], rec['last_name'], rec['phone_number'])
        for rec in users_visited_nz
    }

    for rec in users_visited_phuket:
        key = (rec['first_name'], rec['last_name'], rec['phone_number'])
        if key not in nz_records_idx:
            yield rec
```

ä½¿ç”¨äº†é›†åˆå¯¹è±¡åï¼Œæ–°å‡½æ•°åœ¨é€Ÿåº¦ä¸Šç›¸æ¯”æ—§ç‰ˆæœ¬æœ‰äº†é£è·ƒæ€§çš„çªç ´ã€‚ä½†æ˜¯ï¼Œå¯¹è¿™ä¸ªé—®é¢˜çš„ä¼˜åŒ–å¹¶ä¸æ˜¯åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸ç„¶æ–‡ç« æ ‡é¢˜å°±åº”è¯¥æ”¹æˆï¼šâ€œå¦‚ä½•ä½¿ç”¨é›†åˆæé«˜ç¨‹åºæ€§èƒ½â€ äº†ã€‚

### å¯¹é—®é¢˜çš„é‡æ–°æ€è€ƒ

è®©æˆ‘ä»¬æ¥å°è¯•é‡æ–°æŠ½è±¡æ€è€ƒä¸€ä¸‹é—®é¢˜çš„æœ¬è´¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä»½è£…äº†å¾ˆå¤šä¸œè¥¿çš„å®¹å™¨ A*ï¼ˆæ™®å‰å²›è®¿é—®è®°å½•ï¼‰*ï¼Œç„¶åç»™æˆ‘ä»¬å¦ä¸€ä¸ªè£…äº†å¾ˆå¤šä¸œè¥¿çš„å®¹å™¨ B*ï¼ˆæ–°è¥¿å…°è®¿é—®è®°å½•ï¼‰*ï¼Œä¹‹åå®šä¹‰ç›¸ç­‰è§„åˆ™ï¼šâ€œå§“åä¸ç”µè¯ä¸€è‡´â€ã€‚æœ€ååŸºäºè¿™ä¸ªç›¸ç­‰è§„åˆ™ï¼Œæ±‚ A å’Œ B ä¹‹é—´çš„**â€œå·®é›†â€**ã€‚

å¦‚æœä½ å¯¹ Python é‡Œçš„é›†åˆä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œæˆ‘å°±ç¨å¾®å¤šä»‹ç»ä¸€ç‚¹ã€‚å‡å¦‚æˆ‘ä»¬æ‹¥æœ‰ä¸¤ä¸ªé›†åˆ A å’Œ Bï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ `A - B` è¿™æ ·çš„æ•°å­¦è¿ç®—è¡¨è¾¾å¼æ¥è®¡ç®—äºŒè€…ä¹‹é—´çš„ **å·®é›†**ã€‚

```python
>>> a = {1, 3, 5, 7}
>>> b = {3, 5, 8}
# äº§ç”Ÿæ–°é›†åˆï¼šæ‰€æœ‰åœ¨ a ä½†æ˜¯ä¸åœ¨ b é‡Œçš„å…ƒç´ 
>>> a - b
{1, 7}
```
 
æ‰€ä»¥ï¼Œè®¡ç®—â€œæ‰€æœ‰å»è¿‡æ™®å‰å²›ä½†æ²¡å»è¿‡æ–°è¥¿å…°çš„äººâ€ï¼Œå…¶å®å°±æ˜¯ä¸€æ¬¡é›†åˆçš„æ±‚å·®å€¼æ“ä½œã€‚é‚£ä¹ˆè¦æ€ä¹ˆåšï¼Œæ‰èƒ½æŠŠæˆ‘ä»¬çš„é—®é¢˜å¥—å…¥åˆ°é›†åˆçš„æ¸¸æˆè§„åˆ™é‡Œå»å‘¢?
 
### åˆ©ç”¨é›†åˆçš„æ¸¸æˆè§„åˆ™
 
åœ¨ Python ä¸­ï¼Œå¦‚æœè¦æŠŠæŸä¸ªä¸œè¥¿è£…åˆ°é›†åˆæˆ–å­—å…¸é‡Œï¼Œä¸€å®šè¦æ»¡è¶³ä¸€ä¸ªåŸºæœ¬æ¡ä»¶ï¼š**â€œè¿™ä¸ªä¸œè¥¿å¿…é¡»æ˜¯å¯ä»¥è¢«å“ˆå¸Œï¼ˆHashableï¼‰çš„â€** ã€‚ä»€ä¹ˆæ˜¯ â€œHashableâ€ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼ŒPython é‡Œé¢çš„æ‰€æœ‰å¯å˜å¯¹è±¡ï¼Œæ¯”å¦‚å­—å…¸ï¼Œå°± **ä¸æ˜¯** Hashable çš„ã€‚å½“ä½ å°è¯•æŠŠå­—å…¸æ”¾å…¥é›†åˆä¸­æ—¶ï¼Œä¼šå‘ç”Ÿè¿™æ ·çš„é”™è¯¯ï¼š

```python
>>> s = set()
>>> s.add({'foo': 'bar'})
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: unhashable type: 'dict'
```

æ‰€ä»¥ï¼Œå¦‚æœè¦åˆ©ç”¨é›†åˆè§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œå°±é¦–å…ˆå¾—å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ â€œHashableâ€ å¯¹è±¡ï¼š`VisitRecord`ã€‚è€Œè¦è®©ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡å˜å¾— Hashableï¼Œå”¯ä¸€è¦åšçš„äº‹æƒ…å°±æ˜¯å®šä¹‰å¯¹è±¡çš„ `__hash__` æ–¹æ³•ã€‚

```python
class VisitRecord:
    """æ—…æ¸¸è®°å½•
    """
    def __init__(self, first_name, last_name, phone_number, date_visited):
        self.first_name = first_name
        self.last_name = last_name
        self.phone_number = phone_number
        self.date_visited = date_visited
```

ä¸€ä¸ªå¥½çš„å“ˆå¸Œç®—æ³•ï¼Œåº”è¯¥è®©ä¸åŒå¯¹è±¡ä¹‹é—´çš„å€¼å°½å¯èƒ½çš„å”¯ä¸€ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦å‡å°‘[â€œå“ˆå¸Œç¢°æ’â€](https://en.wikipedia.org/wiki/Collision_(computer_science))å‘ç”Ÿçš„æ¦‚ç‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ Python å¯¹è±¡çš„å“ˆå¸Œå€¼æ¥è‡ªå®ƒçš„å†…å­˜åœ°å€ã€‚

åœ¨è¿™ä¸ªé—®é¢˜é‡Œï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å¯¹è±¡çš„ `__hash__` æ–¹æ³•ï¼Œè®©å®ƒåˆ©ç”¨ `ï¼ˆå§“ï¼Œåï¼Œç”µè¯ï¼‰`å…ƒç»„ä½œä¸º `VisitRecord` ç±»çš„å“ˆå¸Œå€¼æ¥æºã€‚

```python
def __hash__(self):
    return hash(
        (self.first_name, self.last_name, self.phone_number)
    )
```

è‡ªå®šä¹‰å®Œ `__hash__` æ–¹æ³•åï¼Œ`VisitRecord` å®ä¾‹å°±å¯ä»¥æ­£å¸¸çš„è¢«æ”¾å…¥é›†åˆä¸­äº†ã€‚ä½†è¿™è¿˜ä¸å¤Ÿï¼Œä¸ºäº†è®©å‰é¢æåˆ°çš„æ±‚å·®å€¼ç®—æ³•æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ç° `__eq__` ç‰¹æ®Šæ–¹æ³•ã€‚

`__eq__` æ˜¯ Python åœ¨åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰æ—¶è°ƒç”¨çš„ç‰¹æ®Šæ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåªæœ‰åœ¨è‡ªå·±å’Œå¦ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€å®Œå…¨ä¸€è‡´æ—¶ï¼Œæ‰ä¼šè¿”å› `True`ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¤ç”¨äº† `VisitRecord` å¯¹è±¡çš„å“ˆå¸Œå€¼ï¼Œå½“äºŒè€…ç›¸ç­‰æ—¶ï¼Œå°±è®¤ä¸ºå®ƒä»¬ä¸€æ ·ã€‚

```python
def __eq__(self, other):
    # å½“ä¸¤æ¡è®¿é—®è®°å½•çš„åå­—ä¸ç”µè¯å·ç›¸ç­‰æ—¶ï¼Œåˆ¤å®šäºŒè€…ç›¸ç­‰ã€‚
    if isinstance(other, VisitRecord) and hash(other) == hash(self):
        return True
    return False
```

å®Œæˆäº†æ°å½“çš„æ•°æ®å»ºæ¨¡åï¼Œä¹‹åçš„æ±‚å·®å€¼è¿ç®—ä¾¿ç®—æ˜¯æ°´åˆ°æ¸ æˆäº†ã€‚æ–°ç‰ˆæœ¬çš„å‡½æ•°åªéœ€è¦ä¸€è¡Œä»£ç å°±èƒ½å®Œæˆæ“ä½œï¼š

```python
def find_potential_customers_v3():
    return set(VisitRecord(**r) for r in users_visited_phuket) - \
        set(VisitRecord(**r) for r in users_visited_nz)
```

> Hintï¼šå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Python 2ï¼Œé‚£ä¹ˆé™¤äº† `__eq__` æ–¹æ³•å¤–ï¼Œä½ è¿˜éœ€è¦è‡ªå®šä¹‰ç±»çš„ `__ne__`ï¼ˆåˆ¤æ–­ä¸ç›¸ç­‰æ—¶ä½¿ç”¨ï¼‰ æ–¹æ³•ã€‚

### ä½¿ç”¨ dataclass ç®€åŒ–ä»£ç 

æ•…äº‹åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸã€‚åœ¨ä¸Šé¢çš„ä»£ç é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨å®šä¹‰äº†è‡ªå·±çš„ **æ•°æ®ç±»** `VisitRecord`ï¼Œå®ç°äº† `__init__`ã€`__eq__` ç­‰åˆå§‹åŒ–æ–¹æ³•ã€‚ä½†å…¶å®è¿˜æœ‰æ›´ç®€å•çš„åšæ³•ã€‚

å› ä¸ºå®šä¹‰æ•°æ®ç±»è¿™ç§éœ€æ±‚åœ¨ Python ä¸­å®åœ¨å¤ªå¸¸è§äº†ï¼Œæ‰€ä»¥åœ¨ 3.7 ç‰ˆæœ¬ä¸­ï¼Œæ ‡å‡†åº“ä¸­æ–°å¢äº† [dataclasses](https://docs.python.org/3/library/dataclasses.html) æ¨¡å—ï¼Œä¸“é—¨å¸®ä½ ç®€åŒ–è¿™ç±»å·¥ä½œã€‚

å¦‚æœä½¿ç”¨ dataclasses æä¾›çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬çš„ä»£ç å¯ä»¥æœ€ç»ˆç®€åŒ–æˆä¸‹é¢è¿™æ ·ï¼š

```python
@dataclass(unsafe_hash=True)
class VisitRecordDC:
    first_name: str
    last_name: str
    phone_number: str
    # è·³è¿‡â€œè®¿é—®æ—¶é—´â€å­—æ®µï¼Œä¸ä½œä¸ºä»»ä½•å¯¹æ¯”æ¡ä»¶
    date_visited: str = field(hash=False, compare=False)


def find_potential_customers_v4():
    return set(VisitRecordDC(**r) for r in users_visited_phuket) - \
        set(VisitRecordDC(**r) for r in users_visited_nz)
```

ä¸ç”¨å¹²ä»»ä½•è„æ´»ç´¯æ´»ï¼Œåªè¦ä¸åˆ°åè¡Œä»£ç å°±å®Œæˆäº†å·¥ä½œã€‚

### æ¡ˆä¾‹æ€»ç»“

é—®é¢˜è§£å†³ä»¥åï¼Œè®©æˆ‘ä»¬å†åšä¸€ç‚¹å°å°çš„æ€»ç»“ã€‚åœ¨å¤„ç†è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¸€å…±ä½¿ç”¨äº†ä¸‰ç§æ–¹æ¡ˆï¼š

1. ä½¿ç”¨æ™®é€šçš„ä¸¤å±‚å¾ªç¯ç­›é€‰ç¬¦åˆè§„åˆ™çš„ç»“æœé›†
2. åˆ©ç”¨å“ˆå¸Œè¡¨ç»“æ„ï¼ˆset å¯¹è±¡ï¼‰åˆ›å»ºç´¢å¼•ï¼Œæå‡å¤„ç†æ•ˆç‡
3. å°†æ•°æ®è½¬æ¢ä¸ºè‡ªå®šä¹‰å¯¹è±¡ï¼Œåˆ©ç”¨è§„åˆ™ï¼Œç›´æ¥ä½¿ç”¨é›†åˆè¿ç®—

ä¸ºä»€ä¹ˆç¬¬ä¸‰ç§æ–¹å¼ä¼šæ¯”å‰é¢ä¸¤ç§å¥½å‘¢ï¼Ÿ

é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªæ–¹æ¡ˆçš„æ€§èƒ½é—®é¢˜è¿‡äºæ˜æ˜¾ï¼Œæ‰€ä»¥å¾ˆå¿«å°±ä¼šè¢«æ”¾å¼ƒã€‚é‚£ä¹ˆç¬¬äºŒä¸ªæ–¹æ¡ˆå‘¢ï¼Ÿä»”ç»†æƒ³æƒ³çœ‹ï¼Œæ–¹æ¡ˆäºŒå…¶å®å¹¶æ²¡æœ‰ä»€ä¹ˆæ˜æ˜¾çš„ç¼ºç‚¹ã€‚ç”šè‡³å’Œç¬¬ä¸‰ä¸ªæ–¹æ¡ˆç›¸æ¯”ï¼Œå› ä¸ºå°‘äº†è‡ªå®šä¹‰å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ€§èƒ½ä¸å†…å­˜å ç”¨ä¸Šï¼Œç”šè‡³æœ‰å¯èƒ½ä¼šå¾®å¾®å¼ºäºåè€…ã€‚

ä½†è¯·å†æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœä½ æŠŠæ–¹æ¡ˆäºŒçš„ä»£ç æ¢æˆå¦å¤–ä¸€ç§è¯­è¨€ï¼Œæ¯”å¦‚ Javaï¼Œå®ƒæ˜¯ä¸æ˜¯åŸºæœ¬å¯ä»¥åšåˆ° 1:1 çš„å®Œå…¨ç¿»è¯‘ï¼Ÿæ¢å¥è¯è¯´ï¼Œ**å®ƒè™½ç„¶æ•ˆç‡é«˜ã€ä»£ç ç›´æ¥ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰å®Œå…¨åˆ©ç”¨å¥½ Python ä¸–ç•Œæä¾›çš„è§„åˆ™ï¼Œæœ€å¤§åŒ–çš„ä»ä¸­å—ç›Šã€‚**

å¦‚æœè¦å…·ä½“åŒ–è¿™ä¸ªé—®é¢˜é‡Œçš„â€œè§„åˆ™â€ï¼Œé‚£å°±æ˜¯ **â€œPython æ‹¥æœ‰å†…ç½®ç»“æ„é›†åˆï¼Œé›†åˆä¹‹é—´å¯ä»¥è¿›è¡Œå·®å€¼ç­‰å››åˆ™è¿ç®—â€** è¿™ä¸ªäº‹å®æœ¬èº«ã€‚åŒ¹é…è§„åˆ™åç¼–å†™çš„æ–¹æ¡ˆä¸‰ä»£ç æ‹¥æœ‰ä¸‹é¢è¿™äº›ä¼˜åŠ¿ï¼š

- ä¸ºæ•°æ®å»ºæ¨¡åï¼Œå¯ä»¥æ›´æ–¹ä¾¿çš„å®šä¹‰å…¶ä»–æ–¹æ³•
- å¦‚æœéœ€æ±‚å˜æ›´ï¼Œåšåå‘å·®å€¼è¿ç®—ã€æ±‚äº¤é›†è¿ç®—éƒ½å¾ˆç®€å•
- ç†è§£é›†åˆä¸ dataclasses é€»è¾‘åï¼Œä»£ç è¿œæ¯”å…¶ä»–ç‰ˆæœ¬æ›´ç®€æ´æ¸…æ™°
- å¦‚æœè¦ä¿®æ”¹ç›¸ç­‰è§„åˆ™ï¼Œæ¯”å¦‚â€œåªæ‹¥æœ‰ç›¸åŒå§“çš„è®°å½•å°±ç®—ä½œä¸€æ ·â€ï¼Œåªéœ€è¦ç»§æ‰¿`VisitRecord` è¦†ç›– `__eq__` æ–¹æ³•å³å¯

## å…¶ä»–è§„åˆ™å¦‚ä½•å½±å“æˆ‘ä»¬

åœ¨å‰é¢ï¼Œæˆ‘ä»¬èŠ±äº†å¾ˆå¤§çš„ç¯‡å¹…è®²äº†å¦‚ä½•åˆ©ç”¨â€œé›†åˆçš„è§„åˆ™â€æ¥ç¼–å†™äº‹åŠåŠŸå€çš„ä»£ç ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒPython ä¸–ç•Œä¸­è¿˜æœ‰ç€å¾ˆå¤šå…¶ä»–è§„åˆ™ã€‚å¦‚æœèƒ½ç†Ÿç»ƒæŒæ¡è¿™äº›è§„åˆ™ï¼Œå°±å¯ä»¥è®¾è®¡å‡ºç¬¦åˆ Python æƒ¯ä¾‹çš„ APIï¼Œè®©ä»£ç æ›´ç®€æ´ç²¾ç‚¼ã€‚

ä¸‹é¢æ˜¯ä¸¤ä¸ªå…·ä½“çš„ä¾‹å­ã€‚

### ä½¿ç”¨ `__format__` åšå¯¹è±¡å­—ç¬¦ä¸²æ ¼å¼åŒ–

å¦‚æœä½ çš„è‡ªå®šä¹‰å¯¹è±¡éœ€è¦å®šä¹‰å¤šç§å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```python
class Student:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def get_simple_display(self):
        return f'{self.name}({self.age})'

    def get_long_display(self):
        return f'{self.name} is {self.age} years old.'


piglei = Student('piglei', '18')
# OUTPUT: piglei(18)
print(piglei.get_simple_display())
# OUTPUT: piglei is 18 years old.
print(piglei.get_long_display())
```

é‚£ä¹ˆé™¤äº†å¢åŠ è¿™ç§ `get_xxx_display()` é¢å¤–æ–¹æ³•å¤–ï¼Œä½ è¿˜å¯ä»¥å°è¯•è‡ªå®šä¹‰ `Student` ç±»çš„ `__format__` æ–¹æ³•ï¼Œå› ä¸ºé‚£æ‰æ˜¯å°†å¯¹è±¡å˜ä¸ºå­—ç¬¦ä¸²çš„æ ‡å‡†è§„åˆ™ã€‚

```python
class Student:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def __format__(self, format_spec):
        if format_spec == 'long':
            return f'{self.name} is {self.age} years old.'
        elif format_spec == 'simple':
            return f'{self.name}({self.age})'
        raise ValueError('invalid format spec')


piglei = Student('piglei', '18')
print('{0:simple}'.format(piglei))
print('{0:long}'.format(piglei))
```

### ä½¿ç”¨ `__getitem__` å®šä¹‰å¯¹è±¡åˆ‡ç‰‡æ“ä½œ

å¦‚æœä½ è¦è®¾è®¡æŸä¸ªå¯ä»¥è£…ä¸œè¥¿çš„å®¹å™¨ç±»å‹ï¼Œé‚£ä¹ˆä½ å¾ˆå¯èƒ½ä¼šä¸ºå®ƒå®šä¹‰â€œæ˜¯å¦ä¸ºç©ºâ€ã€â€œè·å–ç¬¬ N ä¸ªå¯¹è±¡â€ç­‰æ–¹æ³•ï¼š

```python
class Events:
    def __init__(self, events):
        self.events = events

    def is_empty(self):
        return not bool(self.events)

    def list_events_by_range(self, start, end):
        return self.events[start:end]

events = Events([
    'computer started',
    'os launched',
    'docker started',
    'os sstickyped',
])

# åˆ¤æ–­æ˜¯å¦æœ‰å†…å®¹ï¼Œæ‰“å°ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå¯¹è±¡
if not events.is_empty():
    print(events.list_events_by_range(1, 3))
```

ä½†æ˜¯ï¼Œè¿™æ ·å¹¶éæœ€å¥½çš„åšæ³•ã€‚å› ä¸º Python å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€å¥—å¯¹è±¡è§„åˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åƒå†™å…¶ä»–è¯­è¨€çš„ OO*ï¼ˆé¢å‘å¯¹è±¡ï¼‰* ä»£ç é‚£æ ·å»è‡ªå·±å®šä¹‰é¢å¤–æ–¹æ³•ã€‚æˆ‘ä»¬æœ‰æ›´å¥½çš„é€‰æ‹©ï¼š

```python

class Events:
    def __init__(self, events):
        self.events = events

    def __len__(self):
        """è‡ªå®šä¹‰é•¿åº¦ï¼Œå°†ä¼šè¢«ç”¨æ¥åšå¸ƒå°”åˆ¤æ–­"""
        return len(self.events)

    def __getitem__(self, index):
        """è‡ªå®šä¹‰åˆ‡ç‰‡æ–¹æ³•"""
        # ç›´æ¥å°† slice åˆ‡ç‰‡å¯¹è±¡é€ä¼ ç»™ events å¤„ç†
        return self.events[index]

# åˆ¤æ–­æ˜¯å¦æœ‰å†…å®¹ï¼Œæ‰“å°ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå¯¹è±¡
if events:
    print(events[1:3])
```

æ–°çš„å†™æ³•ç›¸æ¯”æ—§ä»£ç ï¼Œæ›´èƒ½é€‚é…è¿› Python ä¸–ç•Œçš„è§„åˆ™ï¼ŒAPI ä¹Ÿæ›´ä¸ºç®€æ´ã€‚

å…³äºå¦‚ä½•é€‚é…è§„åˆ™ã€å†™å‡ºæ›´å¥½çš„ Python ä»£ç ã€‚Raymond Hettinger åœ¨ PyCon  2015 ä¸Šæœ‰è¿‡ä¸€æ¬¡éå¸¸ç²¾å½©çš„æ¼”è®² [â€œBeyond PEP8 - Best practices for beautiful intelligible codeâ€](https://www.youtube.com/watch?v=wf-BqAjZb8M)ã€‚è¿™æ¬¡æ¼”è®²é•¿æœŸæ’åœ¨æˆ‘ä¸ªäººçš„ *â€œPyCon è§†é¢‘ TOP5â€*  åå•ä¸Šï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ ç°åœ¨å°±å»çœ‹ä¸€é :)

> Hintï¼šæ›´å…¨é¢çš„ Python å¯¹è±¡æ¨¡å‹è§„åˆ™å¯ä»¥åœ¨ [å®˜æ–¹æ–‡æ¡£](https://docs.python.org/3/reference/datamodel.html) æ‰¾åˆ°ï¼Œæœ‰ç‚¹éš¾è¯»ï¼Œä½†å€¼å¾—ä¸€è¯»ã€‚

## æ€»ç»“

Python ä¸–ç•Œæœ‰ç€ä¸€å¥—éå¸¸å¤æ‚çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™çš„æ¶µç›–èŒƒå›´åŒ…æ‹¬â€œå¯¹è±¡ä¸å¯¹è±¡æ˜¯å¦ç›¸ç­‰â€œã€â€å¯¹è±¡ä¸å¯¹è±¡è°å¤§è°å°â€ç­‰ç­‰ã€‚å®ƒä»¬å¤§éƒ¨åˆ†éƒ½éœ€è¦é€šè¿‡é‡æ–°å®šä¹‰â€œåŒä¸‹åˆ’çº¿æ–¹æ³• `__xxx__`â€ å»å®ç°ã€‚

å¦‚æœç†Ÿæ‚‰è¿™äº›è§„åˆ™ï¼Œå¹¶åœ¨æ—¥å¸¸ç¼–ç ä¸­æ´»ç”¨å®ƒä»¬ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æ›´é«˜æ•ˆçš„è§£å†³é—®é¢˜ã€è®¾è®¡å‡ºæ›´ç¬¦åˆ Python å“²å­¦çš„ APIã€‚ä¸‹é¢æ˜¯æœ¬æ–‡çš„ä¸€äº›è¦ç‚¹æ€»ç»“ï¼š

- **æ°¸è¿œè®°å¾—å¯¹åŸå§‹éœ€æ±‚åšæŠ½è±¡åˆ†æï¼Œæ¯”å¦‚é—®é¢˜æ˜¯å¦èƒ½ç”¨é›†åˆæ±‚å·®é›†è§£å†³**
- å¦‚æœè¦æŠŠå¯¹è±¡æ”¾å…¥é›†åˆï¼Œéœ€è¦è‡ªå®šä¹‰å¯¹è±¡çš„ `__hash__` ä¸ `__eq__` æ–¹æ³•
- `__hash__` æ–¹æ³•å†³å®šæ€§èƒ½ï¼ˆç¢°æ’å‡ºç°æ¦‚ç‡ï¼‰ï¼Œ`__eq__` å†³å®šå¯¹è±¡é—´ç›¸ç­‰é€»è¾‘
- ä½¿ç”¨ dataclasses æ¨¡å—å¯ä»¥è®©ä½ å°‘å†™å¾ˆå¤šä»£ç 
- ä½¿ç”¨ `__format__` æ–¹æ³•æ›¿ä»£è‡ªå·±å®šä¹‰çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•
- åœ¨å®¹å™¨ç±»å¯¹è±¡ä¸Šä½¿ç”¨ `__len__`ã€`__getitem__` æ–¹æ³•ï¼Œè€Œä¸æ˜¯è‡ªå·±å®ç°

çœ‹å®Œæ–‡ç« çš„ä½ ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæƒ³åæ§½çš„ï¼Ÿè¯·ç•™è¨€æˆ–è€…åœ¨ [é¡¹ç›® Github Issues](https://github.com/piglei/one-python-craftsman) å‘Šè¯‰æˆ‘å§ã€‚

[>>>ä¸‹ä¸€ç¯‡ã€11.é«˜æ•ˆæ“ä½œæ–‡ä»¶çš„ä¸‰ä¸ªå»ºè®®ã€‘](./11-three-tips-on-writing-file-related-codes)

[<<<ä¸Šä¸€ç¯‡ã€9.ä¸€ä¸ªå…³äºæ¨¡å—çš„å°æ•…äº‹ã€‘](./9-a-story-on-cyclic-imports)

## é™„å½•

- é¢˜å›¾æ¥æº: Photo by JESHOOTS.COM on Unsplash
- æ›´å¤šç³»åˆ—æ–‡ç« åœ°å€ï¼šhttps://github.com/piglei/one-python-craftsman

ç³»åˆ—å…¶ä»–æ–‡ç« ï¼š

- [æ‰€æœ‰æ–‡ç« ç´¢å¼• [Github]](https://github.com/piglei/one-python-craftsman)
- [Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§](https://www.zlovezl.cn/articles/python-else-block-secrets/)
- [Python å·¥åŒ ï¼šå¼‚å¸¸å¤„ç†çš„ä¸‰ä¸ªå¥½ä¹ æƒ¯](https://www.zlovezl.cn/articles/three-rituals-of-exceptions-handling/)
- [Python å·¥åŒ ï¼šç¼–å†™åœ°é“å¾ªç¯çš„ä¸¤ä¸ªå»ºè®®](https://www.zlovezl.cn/articles/two-tips-on-loop-writing/)
