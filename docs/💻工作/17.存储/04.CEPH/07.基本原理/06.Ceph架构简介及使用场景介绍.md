---
title: Ceph æ¶æ„ç®€ä»‹åŠä½¿ç”¨åœºæ™¯ä»‹ç»

categories: 
  - ğŸ’»å·¥ä½œ
  - å­˜å‚¨
  - CEPH
  - åŸºæœ¬åŸç†
tags: 
  - CEPH
date: 2020-05-23 11:02:28
permalink: /pages/03107f/
---
1\. Ceph æ¶æ„ç®€ä»‹åŠä½¿ç”¨åœºæ™¯ä»‹ç»
===================

1.1 Ceph ç®€ä»‹
----------

Ceph æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œè®¾è®¡åˆè¡·æ˜¯æä¾›è¾ƒå¥½çš„æ€§èƒ½ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ã€‚

Ceph é¡¹ç›®æœ€æ—©èµ·æºäº Sage å°±è¯»åšå£«æœŸé—´çš„å·¥ä½œï¼ˆæœ€æ—©çš„æˆæœäº 2004 å¹´å‘è¡¨ï¼‰ï¼Œå¹¶éšåè´¡çŒ®ç»™å¼€æºç¤¾åŒºã€‚åœ¨ç»è¿‡äº†æ•°å¹´çš„å‘å±•ä¹‹åï¼Œç›®å‰å·²å¾—åˆ°ä¼—å¤šäº‘è®¡ç®—å‚å•†çš„æ”¯æŒå¹¶è¢«å¹¿æ³›åº”ç”¨ã€‚RedHat åŠ OpenStack éƒ½å¯ä¸ Ceph æ•´åˆä»¥æ”¯æŒè™šæ‹Ÿæœºé•œåƒçš„åç«¯å­˜å‚¨ã€‚

1.2 Ceph ç‰¹ç‚¹
----------

*   **é«˜æ€§èƒ½**
    *   a. æ‘’å¼ƒäº†ä¼ ç»Ÿçš„é›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®å¯»å€çš„æ–¹æ¡ˆï¼Œé‡‡ç”¨ CRUSH ç®—æ³•ï¼Œæ•°æ®åˆ†å¸ƒå‡è¡¡ï¼Œå¹¶è¡Œåº¦é«˜ã€‚
    *   b.è€ƒè™‘äº†å®¹ç¾åŸŸçš„éš”ç¦»ï¼Œèƒ½å¤Ÿå®ç°å„ç±»è´Ÿè½½çš„å‰¯æœ¬æ”¾ç½®è§„åˆ™ï¼Œä¾‹å¦‚è·¨æœºæˆ¿ã€æœºæ¶æ„ŸçŸ¥ç­‰ã€‚
    *   c. èƒ½å¤Ÿæ”¯æŒä¸Šåƒä¸ªå­˜å‚¨èŠ‚ç‚¹çš„è§„æ¨¡ï¼Œæ”¯æŒ TB åˆ° PB çº§çš„æ•°æ®ã€‚
*   **é«˜å¯ç”¨æ€§**
    *   a. å‰¯æœ¬æ•°å¯ä»¥çµæ´»æ§åˆ¶ã€‚
    *   b. æ”¯æŒæ•…éšœåŸŸåˆ†éš”ï¼Œæ•°æ®å¼ºä¸€è‡´æ€§ã€‚
    *   c. å¤šç§æ•…éšœåœºæ™¯è‡ªåŠ¨è¿›è¡Œä¿®å¤è‡ªæ„ˆã€‚
    *   d. æ²¡æœ‰å•ç‚¹æ•…éšœï¼Œè‡ªåŠ¨ç®¡ç†ã€‚
*   **é«˜å¯æ‰©å±•æ€§**
    *   a. å»ä¸­å¿ƒåŒ–ã€‚
    *   b. æ‰©å±•çµæ´»ã€‚
    *   c. éšç€èŠ‚ç‚¹å¢åŠ è€Œçº¿æ€§å¢é•¿ã€‚
*   **ç‰¹æ€§ä¸°å¯Œ**
    *   a. æ”¯æŒä¸‰ç§å­˜å‚¨æ¥å£ï¼šå—å­˜å‚¨ã€æ–‡ä»¶å­˜å‚¨ã€å¯¹è±¡å­˜å‚¨ã€‚
    *   b. æ”¯æŒè‡ªå®šä¹‰æ¥å£ï¼Œæ”¯æŒå¤šç§è¯­è¨€é©±åŠ¨ã€‚

1.3 Ceph æ¶æ„
----------

**æ”¯æŒä¸‰ç§æ¥å£ï¼š**

*   **Object**ï¼šæœ‰åŸç”Ÿçš„ APIï¼Œè€Œä¸”ä¹Ÿå…¼å®¹ Swift å’Œ S3 çš„ APIã€‚
*   **Block**ï¼šæ”¯æŒç²¾ç®€é…ç½®ã€å¿«ç…§ã€å…‹éš†ã€‚
*   **File**ï¼šPosix æ¥å£ï¼Œæ”¯æŒå¿«ç…§ã€‚

    ![](https://upload-images.jianshu.io/upload_images/2099201-078462bcc3910426.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

    rados.png


1.4 Ceph æ ¸å¿ƒç»„ä»¶åŠæ¦‚å¿µä»‹ç»
-----------------

*   **Monitor**

    ä¸€ä¸ª Ceph é›†ç¾¤éœ€è¦å¤šä¸ª Monitor ç»„æˆçš„å°é›†ç¾¤ï¼Œå®ƒä»¬é€šè¿‡ Paxos åŒæ­¥æ•°æ®ï¼Œç”¨æ¥ä¿å­˜ OSD çš„å…ƒæ•°æ®ã€‚

*   **OSD**

    OSD å…¨ç§° Object Storage Deviceï¼Œä¹Ÿå°±æ˜¯è´Ÿè´£å“åº”å®¢æˆ·ç«¯è¯·æ±‚è¿”å›å…·ä½“æ•°æ®çš„è¿›ç¨‹ã€‚ä¸€ä¸ª Ceph é›†ç¾¤ä¸€èˆ¬éƒ½æœ‰å¾ˆå¤šä¸ª OSDã€‚

*   **MDS**

    MDS å…¨ç§° Ceph Metadata Serverï¼Œæ˜¯ CephFS æœåŠ¡ä¾èµ–çš„å…ƒæ•°æ®æœåŠ¡ã€‚

*   **Object**

    Ceph æœ€åº•å±‚çš„å­˜å‚¨å•å…ƒæ˜¯ Object å¯¹è±¡ï¼Œæ¯ä¸ª Object åŒ…å«å…ƒæ•°æ®å’ŒåŸå§‹æ•°æ®ã€‚

*   **PG**

    PG å…¨ç§° Placement Grouopsï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘çš„æ¦‚å¿µï¼Œä¸€ä¸ª PG åŒ…å«å¤šä¸ª OSDã€‚å¼•å…¥ PG è¿™ä¸€å±‚å…¶å®æ˜¯ä¸ºäº†æ›´å¥½çš„åˆ†é…æ•°æ®å’Œå®šä½æ•°æ®ã€‚

*   **RADOS**

    RADOS å…¨ç§° Reliable Autonomic Distributed Object Storeï¼Œæ˜¯ Ceph é›†ç¾¤çš„ç²¾åï¼Œç”¨æˆ·å®ç°æ•°æ®åˆ†é…ã€Failover ç­‰é›†ç¾¤æ“ä½œã€‚

*   **Libradio**

    Librados æ˜¯ Rados æä¾›åº“ï¼Œå› ä¸º RADOS æ˜¯åè®®å¾ˆéš¾ç›´æ¥è®¿é—®ï¼Œå› æ­¤ä¸Šå±‚çš„ RBDã€RGW å’Œ CephFS éƒ½æ˜¯é€šè¿‡ librados è®¿é—®çš„ï¼Œç›®å‰æä¾› PHPã€Rubyã€Javaã€Pythonã€C å’Œ C++æ”¯æŒã€‚

*   **CRUSH**

    CRUSH æ˜¯ Ceph ä½¿ç”¨çš„æ•°æ®åˆ†å¸ƒç®—æ³•ï¼Œç±»ä¼¼ä¸€è‡´æ€§å“ˆå¸Œï¼Œè®©æ•°æ®åˆ†é…åˆ°é¢„æœŸçš„åœ°æ–¹ã€‚

*   **RBD**

    RBD å…¨ç§° RADOS block deviceï¼Œæ˜¯ Ceph å¯¹å¤–æä¾›çš„å—è®¾å¤‡æœåŠ¡ã€‚

*   **RGW**

    RGW å…¨ç§° RADOS gatewayï¼Œæ˜¯ Ceph å¯¹å¤–æä¾›çš„å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæ¥å£ä¸ S3 å’Œ Swift å…¼å®¹ã€‚

*   **CephFS**

    CephFS å…¨ç§° Ceph File Systemï¼Œæ˜¯ Ceph å¯¹å¤–æä¾›çš„æ–‡ä»¶ç³»ç»ŸæœåŠ¡ã€‚


1.5 ä¸‰ç§å­˜å‚¨ç±»å‹-å—å­˜å‚¨
--------------

![](https://upload-images.jianshu.io/upload_images/2099201-60904b51383fdfc8.png?imageMogr2/auto-orient/strip|imageView2/2/w/819/format/webp)

rbd.png

**å…¸å‹è®¾å¤‡ï¼š** ç£ç›˜é˜µåˆ—ï¼Œç¡¬ç›˜

ä¸»è¦æ˜¯å°†è£¸ç£ç›˜ç©ºé—´æ˜ å°„ç»™ä¸»æœºä½¿ç”¨çš„ã€‚

**ä¼˜ç‚¹ï¼š**

*   é€šè¿‡ Raid ä¸ LVM ç­‰æ‰‹æ®µï¼Œå¯¹æ•°æ®æä¾›äº†ä¿æŠ¤ã€‚
*   å¤šå—å»‰ä»·çš„ç¡¬ç›˜ç»„åˆèµ·æ¥ï¼Œæé«˜å®¹é‡ã€‚
*   å¤šå—ç£ç›˜ç»„åˆå‡ºæ¥çš„é€»è¾‘ç›˜ï¼Œæå‡è¯»å†™æ•ˆç‡ã€‚

**ç¼ºç‚¹ï¼š**

*   é‡‡ç”¨ SAN æ¶æ„ç»„ç½‘æ—¶ï¼Œå…‰çº¤äº¤æ¢æœºï¼Œé€ ä»·æˆæœ¬é«˜ã€‚
*   ä¸»æœºä¹‹é—´æ— æ³•å…±äº«æ•°æ®ã€‚

**ä½¿ç”¨åœºæ™¯ï¼š**

*   docker å®¹å™¨ã€è™šæ‹Ÿæœºç£ç›˜å­˜å‚¨åˆ†é…ã€‚
*   æ—¥å¿—å­˜å‚¨ã€‚
*   æ–‡ä»¶å­˜å‚¨ã€‚
*   â€¦â€¦

1.6 ä¸‰ç§å­˜å‚¨ç±»å‹-æ–‡ä»¶å­˜å‚¨
---------------

![](https://upload-images.jianshu.io/upload_images/2099201-01d647b5f1d469e3.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

fs.png

**å…¸å‹è®¾å¤‡ï¼š** FTPã€NFS æœåŠ¡å™¨
ä¸ºäº†å…‹æœå—å­˜å‚¨æ–‡ä»¶æ— æ³•å…±äº«çš„é—®é¢˜ï¼Œæ‰€ä»¥æœ‰äº†æ–‡ä»¶å­˜å‚¨ã€‚
åœ¨æœåŠ¡å™¨ä¸Šæ¶è®¾ FTP ä¸ NFS æœåŠ¡ï¼Œå°±æ˜¯æ–‡ä»¶å­˜å‚¨ã€‚

**ä¼˜ç‚¹ï¼š**

*   é€ ä»·ä½ï¼Œéšä¾¿ä¸€å°æœºå™¨å°±å¯ä»¥äº†ã€‚
*   æ–¹ä¾¿æ–‡ä»¶å…±äº«ã€‚

**ç¼ºç‚¹ï¼š**

*   è¯»å†™é€Ÿç‡ä½ã€‚
*   ä¼ è¾“é€Ÿç‡æ…¢ã€‚

**ä½¿ç”¨åœºæ™¯ï¼š**

*   æ—¥å¿—å­˜å‚¨ã€‚
*   æœ‰ç›®å½•ç»“æ„çš„æ–‡ä»¶å­˜å‚¨ã€‚
*   â€¦â€¦

1.7 ä¸‰ç§å­˜å‚¨ç±»å‹-å¯¹è±¡å­˜å‚¨
---------------

![](https://upload-images.jianshu.io/upload_images/2099201-372ff5a93ceca813.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

rgw.png

**å…¸å‹è®¾å¤‡ï¼š** å†…ç½®å¤§å®¹é‡ç¡¬ç›˜çš„åˆ†å¸ƒå¼æœåŠ¡å™¨(swift, s3)
å¤šå°æœåŠ¡å™¨å†…ç½®å¤§å®¹é‡ç¡¬ç›˜ï¼Œå®‰è£…ä¸Šå¯¹è±¡å­˜å‚¨ç®¡ç†è½¯ä»¶ï¼Œå¯¹å¤–æä¾›è¯»å†™è®¿é—®åŠŸèƒ½ã€‚

**ä¼˜ç‚¹ï¼š**

*   å…·å¤‡å—å­˜å‚¨çš„è¯»å†™é«˜é€Ÿã€‚
*   å…·å¤‡æ–‡ä»¶å­˜å‚¨çš„å…±äº«ç­‰ç‰¹æ€§ã€‚

**ä½¿ç”¨åœºæ™¯ï¼š** (é€‚åˆæ›´æ–°å˜åŠ¨è¾ƒå°‘çš„æ•°æ®)

*   å›¾ç‰‡å­˜å‚¨ã€‚
*   è§†é¢‘å­˜å‚¨ã€‚
*   â€¦â€¦

2\. Ceph IO æµç¨‹åŠæ•°æ®åˆ†å¸ƒ
==================

![](https://upload-images.jianshu.io/upload_images/2099201-db0fd6e3e3f49f68.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

rados\_io\_1.png

2.1 æ­£å¸¸ IO æµç¨‹å›¾
-----------

![](https://upload-images.jianshu.io/upload_images/2099201-2c47144a5118bcf0.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_io\_2.png

**æ­¥éª¤ï¼š**

1.  client åˆ›å»º cluster handlerã€‚
2.  client è¯»å–é…ç½®æ–‡ä»¶ã€‚
3.  client è¿æ¥ä¸Š monitorï¼Œè·å–é›†ç¾¤ map ä¿¡æ¯ã€‚
4.  client è¯»å†™ io æ ¹æ® crshmap ç®—æ³•è¯·æ±‚å¯¹åº”çš„ä¸» osd æ•°æ®èŠ‚ç‚¹ã€‚
5.  ä¸» osd æ•°æ®èŠ‚ç‚¹åŒæ—¶å†™å…¥å¦å¤–ä¸¤ä¸ªå‰¯æœ¬èŠ‚ç‚¹æ•°æ®ã€‚
6.  ç­‰å¾…ä¸»èŠ‚ç‚¹ä»¥åŠå¦å¤–ä¸¤ä¸ªå‰¯æœ¬èŠ‚ç‚¹å†™å®Œæ•°æ®çŠ¶æ€ã€‚
7.  ä¸»èŠ‚ç‚¹åŠå‰¯æœ¬èŠ‚ç‚¹å†™å…¥çŠ¶æ€éƒ½æˆåŠŸåï¼Œè¿”å›ç»™ clientï¼Œio å†™å…¥å®Œæˆã€‚

2.2 æ–°ä¸» IO æµç¨‹å›¾
-----------

**è¯´æ˜ï¼š**

å¦‚æœæ–°åŠ å…¥çš„ OSD1 å–ä»£äº†åŸæœ‰çš„ OSD4 æˆä¸º Primary OSD, ç”±äº OSD1 ä¸Šæœªåˆ›å»º PG , ä¸å­˜åœ¨æ•°æ®ï¼Œé‚£ä¹ˆ PG ä¸Šçš„ I/O æ— æ³•è¿›è¡Œï¼Œæ€æ ·å·¥ä½œçš„å‘¢ï¼Ÿ



![](https://upload-images.jianshu.io/upload_images/2099201-9cc1013f7e3dc8f9.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_io\_3.png

**æ­¥éª¤ï¼š**

1.  client è¿æ¥ monitor è·å–é›†ç¾¤ map ä¿¡æ¯ã€‚
2.  åŒæ—¶æ–°ä¸» osd1 ç”±äºæ²¡æœ‰ pg æ•°æ®ä¼šä¸»åŠ¨ä¸ŠæŠ¥ monitor å‘ŠçŸ¥è®© osd2 ä¸´æ—¶æ¥æ›¿ä¸ºä¸»ã€‚
3.  ä¸´æ—¶ä¸» osd2 ä¼šæŠŠæ•°æ®å…¨é‡åŒæ­¥ç»™æ–°ä¸» osd1ã€‚
4.  client IO è¯»å†™ç›´æ¥è¿æ¥ä¸´æ—¶ä¸» osd2 è¿›è¡Œè¯»å†™ã€‚
5.  osd2 æ”¶åˆ°è¯»å†™ ioï¼ŒåŒæ—¶å†™å…¥å¦å¤–ä¸¤å‰¯æœ¬èŠ‚ç‚¹ã€‚
6.  ç­‰å¾… osd2 ä»¥åŠå¦å¤–ä¸¤å‰¯æœ¬å†™å…¥æˆåŠŸã€‚
7.  osd2 ä¸‰ä»½æ•°æ®éƒ½å†™å…¥æˆåŠŸè¿”å›ç»™ client, æ­¤æ—¶ client io è¯»å†™å®Œæ¯•ã€‚
8.  å¦‚æœ osd1 æ•°æ®åŒæ­¥å®Œæ¯•ï¼Œä¸´æ—¶ä¸» osd2 ä¼šäº¤å‡ºä¸»è§’è‰²ã€‚
9.  osd1 æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œosd2 å˜æˆå‰¯æœ¬ã€‚

2.3 Ceph IO ç®—æ³•æµç¨‹
---------------

![](https://upload-images.jianshu.io/upload_images/2099201-b24c72ac8bbf1a19.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_io\_4.png

1.  File ç”¨æˆ·éœ€è¦è¯»å†™çš„æ–‡ä»¶ã€‚File->Object æ˜ å°„ï¼š

    *   a. ino (File çš„å…ƒæ•°æ®ï¼ŒFile çš„å”¯ä¸€ id)ã€‚
    *   b. ono(File åˆ‡åˆ†äº§ç”Ÿçš„æŸä¸ª object çš„åºå·ï¼Œé»˜è®¤ä»¥ 4M åˆ‡åˆ†ä¸€ä¸ªå—å¤§å°)ã€‚
    *   c. oid(object id: ino + ono)ã€‚
2.  Object æ˜¯ RADOS éœ€è¦çš„å¯¹è±¡ã€‚Ceph æŒ‡å®šä¸€ä¸ªé™æ€ hash å‡½æ•°è®¡ç®— oid çš„å€¼ï¼Œå°† oid æ˜ å°„æˆä¸€ä¸ªè¿‘ä¼¼å‡åŒ€åˆ†å¸ƒçš„ä¼ªéšæœºå€¼ï¼Œç„¶åå’Œ mask æŒ‰ä½ç›¸ä¸ï¼Œå¾—åˆ° pgidã€‚Object->PG æ˜ å°„ï¼š

    *   a. hash(oid) & mask-> pgid ã€‚
    *   b. mask = PG æ€»æ•° m(m ä¸º 2 çš„æ•´æ•°å¹‚)-1 ã€‚
3.  PG(Placement Group),ç”¨é€”æ˜¯å¯¹ object çš„å­˜å‚¨è¿›è¡Œç»„ç»‡å’Œä½ç½®æ˜ å°„, (ç±»ä¼¼äº redis cluster é‡Œé¢çš„ slot çš„æ¦‚å¿µ) ä¸€ä¸ª PG é‡Œé¢ä¼šæœ‰å¾ˆå¤š objectã€‚é‡‡ç”¨ CRUSH ç®—æ³•ï¼Œå°† pgid ä»£å…¥å…¶ä¸­ï¼Œç„¶åå¾—åˆ°ä¸€ç»„ OSDã€‚PG->OSD æ˜ å°„ï¼š

    *   a. CRUSH(pgid)->(osd1,osd2,osd3) ã€‚

2.4 Ceph IO ä¼ªä»£ç æµç¨‹
----------------
```plain
    locator = object_name
    obj_hash =  hash(locator)
    pg = obj_hash % num_pg
    osds_for_pg = crush(pg)  # returns a list of osds
    primary = osds_for_pg[0]
    replicas = osds_for_pg[1:]
```

2.5 Ceph RBD IO æµç¨‹
-----------------

![](https://upload-images.jianshu.io/upload_images/2099201-ed51d7d8050dbf64.png?imageMogr2/auto-orient/strip|imageView2/2/w/846/format/webp)

ceph\_rbd\_io.png

**æ­¥éª¤ï¼š**

1.  å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª poolï¼Œéœ€è¦ä¸ºè¿™ä¸ª pool æŒ‡å®š pg çš„æ•°é‡ã€‚
2.  åˆ›å»º pool/image rbd è®¾å¤‡è¿›è¡ŒæŒ‚è½½ã€‚
3.  ç”¨æˆ·å†™å…¥çš„æ•°æ®è¿›è¡Œåˆ‡å—ï¼Œæ¯ä¸ªå—çš„å¤§å°é»˜è®¤ä¸º 4Mï¼Œå¹¶ä¸”æ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œåå­—å°±æ˜¯ object+åºå·ã€‚
4.  å°†æ¯ä¸ª object é€šè¿‡ pg è¿›è¡Œå‰¯æœ¬ä½ç½®çš„åˆ†é…ã€‚
5.  pg æ ¹æ® cursh ç®—æ³•ä¼šå¯»æ‰¾ 3 ä¸ª osdï¼ŒæŠŠè¿™ä¸ª object åˆ†åˆ«ä¿å­˜åœ¨è¿™ä¸‰ä¸ª osd ä¸Šã€‚
6.  osd ä¸Šå®é™…æ˜¯æŠŠåº•å±‚çš„ disk è¿›è¡Œäº†æ ¼å¼åŒ–æ“ä½œï¼Œä¸€èˆ¬éƒ¨ç½²å·¥å…·ä¼šå°†å®ƒæ ¼å¼åŒ–ä¸º xfs æ–‡ä»¶ç³»ç»Ÿã€‚
7.  object çš„å­˜å‚¨å°±å˜æˆäº†å­˜å‚¨ä¸€ä¸ªæ–‡ rbd0.object1.fileã€‚

2.6 Ceph RBD IO æ¡†æ¶å›¾
------------------

![](https://upload-images.jianshu.io/upload_images/2099201-850a745bc0f44494.png?imageMogr2/auto-orient/strip|imageView2/2/w/467/format/webp)

ceph\_rbd\_io1.png

**å®¢æˆ·ç«¯å†™æ•°æ® osd è¿‡ç¨‹ï¼š**

1.  é‡‡ç”¨çš„æ˜¯ librbd çš„å½¢å¼ï¼Œä½¿ç”¨ librbd åˆ›å»ºä¸€ä¸ªå—è®¾å¤‡ï¼Œå‘è¿™ä¸ªå—è®¾å¤‡ä¸­å†™å…¥æ•°æ®ã€‚
2.  åœ¨å®¢æˆ·ç«¯æœ¬åœ°åŒè¿‡è°ƒç”¨ librados æ¥å£ï¼Œç„¶åç»è¿‡ poolï¼Œrbdï¼Œobjectã€pg è¿›è¡Œå±‚å±‚æ˜ å°„,åœ¨ PG è¿™ä¸€å±‚ä¸­ï¼Œå¯ä»¥çŸ¥é“æ•°æ®ä¿å­˜åœ¨å“ª 3 ä¸ª OSD ä¸Šï¼Œè¿™ 3 ä¸ª OSD åˆ†ä¸ºä¸»ä»çš„å…³ç³»ã€‚
3.  å®¢æˆ·ç«¯ä¸ primay OSD å»ºç«‹ SOCKET é€šä¿¡ï¼Œå°†è¦å†™å…¥çš„æ•°æ®ä¼ ç»™ primary OSDï¼Œç”± primary OSD å†å°†æ•°æ®å‘é€ç»™å…¶ä»– replica OSD æ•°æ®èŠ‚ç‚¹ã€‚

2.7 Ceph Pool å’Œ PG åˆ†å¸ƒæƒ…å†µ
--------------------

![](https://upload-images.jianshu.io/upload_images/2099201-d49d90ae6a918ef2.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_pool\_pg.png

**è¯´æ˜ï¼š**

*   pool æ˜¯ ceph å­˜å‚¨æ•°æ®æ—¶çš„é€»è¾‘åˆ†åŒºï¼Œå®ƒèµ·åˆ° namespace çš„ä½œç”¨ã€‚
*   æ¯ä¸ª pool åŒ…å«ä¸€å®šæ•°é‡(å¯é…ç½®)çš„ PGã€‚
*   PG é‡Œçš„å¯¹è±¡è¢«æ˜ å°„åˆ°ä¸åŒçš„ Object ä¸Šã€‚
*   pool æ˜¯åˆ†å¸ƒåˆ°æ•´ä¸ªé›†ç¾¤çš„ã€‚
*   pool å¯ä»¥åšæ•…éšœéš”ç¦»åŸŸï¼Œæ ¹æ®ä¸åŒçš„ç”¨æˆ·åœºæ™¯ä¸ä¸€è¿›è¡Œéš”ç¦»ã€‚

2.8 Ceph æ•°æ®æ‰©å®¹ PG åˆ†å¸ƒ
-----------------

**åœºæ™¯æ•°æ®è¿ç§»æµç¨‹ï¼š**

*   ç°çŠ¶ 3 ä¸ª OSD, 4 ä¸ª PG
*   æ‰©å®¹åˆ° 4 ä¸ª OSD, 4 ä¸ª PG

**ç°çŠ¶ï¼š**

![](https://upload-images.jianshu.io/upload_images/2099201-4dda9e2648dabe90.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_recory\_1.png

**æ‰©å®¹åï¼š**

![](https://upload-images.jianshu.io/upload_images/2099201-9e324e87c6d086f3.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_io\_recry2.png

**è¯´æ˜**
æ¯ä¸ª OSD ä¸Šåˆ†å¸ƒå¾ˆå¤š PG, å¹¶ä¸”æ¯ä¸ª PG ä¼šè‡ªåŠ¨æ•£è½åœ¨ä¸åŒçš„ OSD ä¸Šã€‚å¦‚æœæ‰©å®¹é‚£ä¹ˆç›¸åº”çš„ PG ä¼šè¿›è¡Œè¿ç§»åˆ°æ–°çš„ OSD ä¸Šï¼Œä¿è¯ PG æ•°é‡çš„å‡è¡¡ã€‚

3\. Ceph å¿ƒè·³æœºåˆ¶
============

3.1 å¿ƒè·³ä»‹ç»
--------

å¿ƒè·³æ˜¯ç”¨äºèŠ‚ç‚¹é—´æ£€æµ‹å¯¹æ–¹æ˜¯å¦æ•…éšœçš„ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°æ•…éšœèŠ‚ç‚¹è¿›å…¥ç›¸åº”çš„æ•…éšœå¤„ç†æµç¨‹ã€‚

**é—®é¢˜ï¼š**

*   æ•…éšœæ£€æµ‹æ—¶é—´å’Œå¿ƒè·³æŠ¥æ–‡å¸¦æ¥çš„è´Ÿè½½ä¹‹é—´åšæƒè¡¡ã€‚
*   å¿ƒè·³é¢‘ç‡å¤ªé«˜åˆ™è¿‡å¤šçš„å¿ƒè·³æŠ¥æ–‡ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚
*   å¿ƒè·³é¢‘ç‡è¿‡ä½åˆ™ä¼šå»¶é•¿å‘ç°æ•…éšœèŠ‚ç‚¹çš„æ—¶é—´ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚

**æ•…éšœæ£€æµ‹ç­–ç•¥åº”è¯¥èƒ½å¤Ÿåšåˆ°ï¼š**

*   **åŠæ—¶**ï¼šèŠ‚ç‚¹å‘ç”Ÿå¼‚å¸¸å¦‚å®•æœºæˆ–ç½‘ç»œä¸­æ–­æ—¶ï¼Œé›†ç¾¤å¯ä»¥åœ¨å¯æ¥å—çš„æ—¶é—´èŒƒå›´å†…æ„ŸçŸ¥ã€‚
*   **é€‚å½“çš„å‹åŠ›**ï¼šåŒ…æ‹¬å¯¹èŠ‚ç‚¹çš„å‹åŠ›ï¼Œå’Œå¯¹ç½‘ç»œçš„å‹åŠ›ã€‚
*   **å®¹å¿ç½‘ç»œæŠ–åŠ¨**ï¼šç½‘ç»œå¶å°”å»¶è¿Ÿã€‚
*   **æ‰©æ•£æœºåˆ¶**ï¼šèŠ‚ç‚¹å­˜æ´»çŠ¶æ€æ”¹å˜å¯¼è‡´çš„å…ƒä¿¡æ¯å˜åŒ–éœ€è¦é€šè¿‡æŸç§æœºåˆ¶æ‰©æ•£åˆ°æ•´ä¸ªé›†ç¾¤ã€‚

3.2 Ceph å¿ƒè·³æ£€æµ‹
-------------

![](https://upload-images.jianshu.io/upload_images/2099201-797b8f8c9e2de4d7.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_heartbeat\_1.png

**OSD èŠ‚ç‚¹ä¼šç›‘å¬ publicã€clusterã€front å’Œ back å››ä¸ªç«¯å£**

*   **public ç«¯å£**ï¼šç›‘å¬æ¥è‡ª Monitor å’Œ Client çš„è¿æ¥ã€‚
*   **cluster ç«¯å£**ï¼šç›‘å¬æ¥è‡ª OSD Peer çš„è¿æ¥ã€‚
*   **front ç«¯å£**ï¼šä¾›å®¢æˆ·ç«¯è¿æ¥é›†ç¾¤ä½¿ç”¨çš„ç½‘å¡, è¿™é‡Œä¸´æ—¶ç»™é›†ç¾¤å†…éƒ¨ä¹‹é—´è¿›è¡Œå¿ƒè·³ã€‚
*   **back ç«¯å£**ï¼šä¾›å®¢é›†ç¾¤å†…éƒ¨ä½¿ç”¨çš„ç½‘å¡ã€‚é›†ç¾¤å†…éƒ¨ä¹‹é—´è¿›è¡Œå¿ƒè·³ã€‚
*   **hbclient**ï¼šå‘é€ ping å¿ƒè·³çš„ messengerã€‚

3.3 Ceph OSD ä¹‹é—´ç›¸äº’å¿ƒè·³æ£€æµ‹
--------------------

![](https://upload-images.jianshu.io/upload_images/2099201-a04c96ba04ec47df.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_heartbeat\_osd.png

**æ­¥éª¤ï¼š**

*   åŒä¸€ä¸ª PG å†… OSD äº’ç›¸å¿ƒè·³ï¼Œä»–ä»¬äº’ç›¸å‘é€ PING/PONG ä¿¡æ¯ã€‚
*   æ¯éš” 6s æ£€æµ‹ä¸€æ¬¡(å®é™…ä¼šåœ¨è¿™ä¸ªåŸºç¡€ä¸ŠåŠ ä¸€ä¸ªéšæœºæ—¶é—´æ¥é¿å…å³°å€¼)ã€‚
*   20s æ²¡æœ‰æ£€æµ‹åˆ°å¿ƒè·³å›å¤ï¼ŒåŠ å…¥ failure é˜Ÿåˆ—ã€‚

3.4 Ceph OSD ä¸ Mon å¿ƒè·³æ£€æµ‹
--------------------

![](https://upload-images.jianshu.io/upload_images/2099201-06fcd181ba5c2671.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_heartbeat\_mon.png

**OSD æŠ¥å‘Šç»™ Monitorï¼š**

*   OSD æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚æ•…éšœã€PG å˜æ›´ï¼‰ã€‚
*   è‡ªèº«å¯åŠ¨ 5 ç§’å†…ã€‚
*   OSD å‘¨æœŸæ€§çš„ä¸ŠæŠ¥ç»™ Monito
    *   OSD æ£€æŸ¥ failure\_queue ä¸­çš„ä¼™ä¼´ OSD å¤±è´¥ä¿¡æ¯ã€‚
    *   å‘ Monitor å‘é€å¤±æ•ˆæŠ¥å‘Šï¼Œå¹¶å°†å¤±è´¥ä¿¡æ¯åŠ å…¥ failure\_pending é˜Ÿåˆ—ï¼Œç„¶åå°†å…¶ä» failure\_queue ç§»é™¤ã€‚
    *   æ”¶åˆ°æ¥è‡ª failure\_queue æˆ–è€… failure\_pending ä¸­çš„ OSD çš„å¿ƒè·³æ—¶ï¼Œå°†å…¶ä»ä¸¤ä¸ªé˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œå¹¶å‘ŠçŸ¥ Monitor å–æ¶ˆä¹‹å‰çš„å¤±æ•ˆæŠ¥å‘Šã€‚
    *   å½“å‘ç”Ÿä¸ Monitor ç½‘ç»œé‡è¿æ—¶ï¼Œä¼šå°† failure\_pending ä¸­çš„é”™è¯¯æŠ¥å‘ŠåŠ å›åˆ° failure\_queue ä¸­ï¼Œå¹¶å†æ¬¡å‘é€ç»™ Monitorã€‚
*   Monitor ç»Ÿè®¡ä¸‹çº¿ OSD
    *   Monitor æ”¶é›†æ¥è‡ª OSD çš„ä¼™ä¼´å¤±æ•ˆæŠ¥å‘Šã€‚
    *   å½“é”™è¯¯æŠ¥å‘ŠæŒ‡å‘çš„ OSD å¤±æ•ˆè¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œä¸”æœ‰è¶³å¤Ÿå¤šçš„ OSD æŠ¥å‘Šå…¶å¤±æ•ˆæ—¶ï¼Œå°†è¯¥ OSD ä¸‹çº¿ã€‚

3.5 Ceph å¿ƒè·³æ£€æµ‹æ€»ç»“
--------------

Ceph é€šè¿‡ä¼™ä¼´ OSD æ±‡æŠ¥å¤±æ•ˆèŠ‚ç‚¹å’Œ Monitor ç»Ÿè®¡æ¥è‡ª OSD çš„å¿ƒè·³ä¸¤ç§æ–¹å¼åˆ¤å®š OSD èŠ‚ç‚¹å¤±æ•ˆã€‚

*   **åŠæ—¶**ï¼šä¼™ä¼´ OSD å¯ä»¥åœ¨ç§’çº§å‘ç°èŠ‚ç‚¹å¤±æ•ˆå¹¶æ±‡æŠ¥ Monitorï¼Œå¹¶åœ¨å‡ åˆ†é’Ÿå†…ç”± Monitor å°†å¤±æ•ˆ OSD ä¸‹çº¿ã€‚
*   **é€‚å½“çš„å‹åŠ›**ï¼šç”±äºæœ‰ä¼™ä¼´ OSD æ±‡æŠ¥æœºåˆ¶ï¼ŒMonitor ä¸ OSD ä¹‹é—´çš„å¿ƒè·³ç»Ÿè®¡æ›´åƒæ˜¯ä¸€ç§ä¿é™©æªæ–½ï¼Œå› æ­¤ OSD å‘ Monitor å‘é€å¿ƒè·³çš„é—´éš”å¯ä»¥é•¿è¾¾ 600 ç§’ï¼ŒMonitor çš„æ£€æµ‹é˜ˆå€¼ä¹Ÿå¯ä»¥é•¿è¾¾ 900 ç§’ã€‚Ceph å®é™…ä¸Šæ˜¯å°†æ•…éšœæ£€æµ‹è¿‡ç¨‹ä¸­ä¸­å¿ƒèŠ‚ç‚¹çš„å‹åŠ›åˆ†æ•£åˆ°æ‰€æœ‰çš„ OSD ä¸Šï¼Œä»¥æ­¤æé«˜ä¸­å¿ƒèŠ‚ç‚¹ Monitor çš„å¯é æ€§ï¼Œè¿›è€Œæé«˜æ•´ä¸ªé›†ç¾¤çš„å¯æ‰©å±•æ€§ã€‚
*   **å®¹å¿ç½‘ç»œæŠ–åŠ¨**ï¼šMonitor æ”¶åˆ° OSD å¯¹å…¶ä¼™ä¼´ OSD çš„æ±‡æŠ¥åï¼Œå¹¶æ²¡æœ‰é©¬ä¸Šå°†ç›®æ ‡ OSD ä¸‹çº¿ï¼Œè€Œæ˜¯å‘¨æœŸæ€§çš„ç­‰å¾…å‡ ä¸ªæ¡ä»¶ï¼š
    *   ç›®æ ‡ OSD çš„å¤±æ•ˆæ—¶é—´å¤§äºé€šè¿‡å›ºå®šé‡ osd\_heartbeat\_grace å’Œå†å²ç½‘ç»œæ¡ä»¶åŠ¨æ€ç¡®å®šçš„é˜ˆå€¼ã€‚
    *   æ¥è‡ªä¸åŒä¸»æœºçš„æ±‡æŠ¥è¾¾åˆ° mon\_osd\_min\_down\_reportersã€‚
    *   æ»¡è¶³å‰ä¸¤ä¸ªæ¡ä»¶å‰å¤±æ•ˆæ±‡æŠ¥æ²¡æœ‰è¢«æº OSD å–æ¶ˆã€‚
*   **æ‰©æ•£**ï¼šä½œä¸ºä¸­å¿ƒèŠ‚ç‚¹çš„ Monitor å¹¶æ²¡æœ‰åœ¨æ›´æ–° OSDMap åå°è¯•å¹¿æ’­é€šçŸ¥æ‰€æœ‰çš„ OSD å’Œ Clientï¼Œè€Œæ˜¯æƒ°æ€§çš„ç­‰å¾… OSD å’Œ Client æ¥è·å–ã€‚ä»¥æ­¤æ¥å‡å°‘ Monitor å‹åŠ›å¹¶ç®€åŒ–äº¤äº’é€»è¾‘ã€‚

4\. Ceph é€šä¿¡æ¡†æ¶
============

4.1 Ceph é€šä¿¡æ¡†æ¶ç§ç±»ä»‹ç»
----------------

**ç½‘ç»œé€šä¿¡æ¡†æ¶ä¸‰ç§ä¸åŒçš„å®ç°æ–¹å¼ï¼š**

*   **Simple çº¿ç¨‹æ¨¡å¼**
    *   **ç‰¹ç‚¹**ï¼šæ¯ä¸€ä¸ªç½‘ç»œé“¾æ¥ï¼Œéƒ½ä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªç”¨äºæ¥æ”¶ï¼Œä¸€ä¸ªç”¨äºå‘é€ã€‚
    *   **ç¼ºç‚¹**ï¼šå¤§é‡çš„é“¾æ¥ä¼šäº§ç”Ÿå¤§é‡çš„çº¿ç¨‹ï¼Œä¼šæ¶ˆè€— CPU èµ„æºï¼Œå½±å“æ€§èƒ½ã€‚
*   **Async äº‹ä»¶çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å¼**
    *   **ç‰¹ç‚¹**ï¼šè¿™ç§æ˜¯ç›®å‰ç½‘ç»œé€šä¿¡ä¸­å¹¿æ³›é‡‡ç”¨çš„æ–¹å¼ã€‚k ç‰ˆé»˜è®¤å·²ç»ä½¿ç”¨ Asnyc äº†ã€‚
*   **XIO æ–¹å¼ä½¿ç”¨äº†å¼€æºçš„ç½‘ç»œé€šä¿¡åº“ accelio æ¥å®ç°**
    *   **ç‰¹ç‚¹**ï¼šè¿™ç§æ–¹å¼éœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹çš„åº“ accelio ç¨³å®šæ€§ï¼Œç›®å‰å¤„äºè¯•éªŒé˜¶æ®µã€‚

4.2 Ceph é€šä¿¡æ¡†æ¶è®¾è®¡æ¨¡å¼
----------------

**è®¾è®¡æ¨¡å¼(Subscribe/Publish)**

è®¢é˜…å‘å¸ƒæ¨¡å¼åˆåè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒæ„å›¾æ˜¯â€œå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œ
å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°â€ã€‚

4.3 Ceph é€šä¿¡æ¡†æ¶æµç¨‹å›¾
---------------

![](https://upload-images.jianshu.io/upload_images/2099201-8662667e6a06e931.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_message.png

**æ­¥éª¤ï¼š**

*   Accepter ç›‘å¬ peer çš„è¯·æ±‚, è°ƒç”¨ SimpleMessenger::add\_accept\_pipe() åˆ›å»ºæ–°çš„ Pipe åˆ° SimpleMessenger::pipes æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚
*   Pipe ç”¨äºæ¶ˆæ¯çš„è¯»å–å’Œå‘é€ã€‚è¯¥ç±»ä¸»è¦æœ‰ä¸¤ä¸ªç»„ä»¶ï¼ŒPipe::Readerï¼ŒPipe::Writer ç”¨æ¥å¤„ç†æ¶ˆæ¯è¯»å–å’Œå‘é€ã€‚
*   Messenger ä½œä¸ºæ¶ˆæ¯çš„å‘å¸ƒè€…, å„ä¸ª Dispatcher å­ç±»ä½œä¸ºæ¶ˆæ¯çš„è®¢é˜…è€…, Messenger æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œ é€šè¿‡ Pipe è¯»å–æ¶ˆæ¯ï¼Œç„¶åè½¬ç»™ Dispatcher å¤„ç†ã€‚
*   Dispatcher æ˜¯è®¢é˜…è€…çš„åŸºç±»ï¼Œå…·ä½“çš„è®¢é˜…åç«¯ç»§æ‰¿è¯¥ç±»,åˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡ Messenger::add\_dispatcher\_tail/head æ³¨å†Œåˆ° Messenger::dispatchers. æ”¶åˆ°æ¶ˆæ¯åï¼Œé€šçŸ¥è¯¥ç±»å¤„ç†ã€‚
*   DispatchQueue è¯¥ç±»ç”¨æ¥ç¼“å­˜æ”¶åˆ°çš„æ¶ˆæ¯, ç„¶åå”¤é†’ DispatchQueue::dispatch\_thread çº¿ç¨‹æ‰¾åˆ°åç«¯çš„ Dispatch å¤„ç†æ¶ˆæ¯ã€‚

![](https://upload-images.jianshu.io/upload_images/2099201-f7e6ef5c9d3fe38f.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_message\_2.png

4.4 Ceph é€šä¿¡æ¡†æ¶ç±»å›¾
--------------

![](https://upload-images.jianshu.io/upload_images/2099201-a7d2248cb9963f1d.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_message\_3.png

4.5 Ceph é€šä¿¡æ•°æ®æ ¼å¼
--------------

é€šä¿¡åè®®æ ¼å¼éœ€è¦åŒæ–¹çº¦å®šæ•°æ®æ ¼å¼ã€‚

**æ¶ˆæ¯çš„å†…å®¹ä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š**

*   header //æ¶ˆæ¯å¤´ç±»å‹æ¶ˆæ¯çš„ä¿¡å°
*   user data //éœ€è¦å‘é€çš„å®é™…æ•°æ®
    *   payload //æ“ä½œä¿å­˜å…ƒæ•°æ®
    *   middle //é¢„ç•™å­—æ®µ
    *   data //è¯»å†™æ•°æ®
*   footer //æ¶ˆæ¯çš„ç»“æŸæ ‡è®°
```c++
    class Message : public RefCountedObject {
    protected:
      ceph_msg_header  header;      // æ¶ˆæ¯å¤´
      ceph_msg_footer  footer;      // æ¶ˆæ¯å°¾
      bufferlist       payload;  // "front" unaligned blob
      bufferlist       middle;   // "middle" unaligned blob
      bufferlist       data;     // data payload (page-alignment will be preserved where possible)

      /* recv_stamp is set when the Messenger starts reading the
       * Message off the wire */
      utime_t recv_stamp;       //å¼€å§‹æ¥æ”¶æ•°æ®çš„æ—¶é—´æˆ³
      /* dispatch_stamp is set when the Messenger starts calling dispatch() on
       * its endpoints */
      utime_t dispatch_stamp;   //dispatch çš„æ—¶é—´æˆ³
      /* throttle_stamp is the point at which we got throttle */
      utime_t throttle_stamp;   //è·å– throttle çš„ slot çš„æ—¶é—´æˆ³
      /* time at which message was fully read */
      utime_t recv_complete_stamp;  //æ¥æ”¶å®Œæˆçš„æ—¶é—´æˆ³

      ConnectionRef connection;     //ç½‘ç»œè¿æ¥

      uint32_t magic = 0;           //æ¶ˆæ¯çš„é­”æœ¯å­—

      bi::list_member_hook<> dispatch_q;    //boost::intrusive æˆå‘˜å­—æ®µ
    };

    struct ceph_msg_header {
        ****************************************************************__le64 seq;       // å½“å‰ session å†… æ¶ˆæ¯çš„å”¯ä¸€ åºå·
        __****************************************************************le64 tid;       // æ¶ˆæ¯çš„å…¨å±€å”¯ä¸€çš„ id
        ********************************************************__le16 type;      // æ¶ˆæ¯ç±»å‹
        __********************************************************le16 priority;  // ä¼˜å…ˆçº§
        __le16 version;   // ç‰ˆæœ¬å·

        __le32 front_len; // payload çš„é•¿åº¦
        __le32 middle_len;// middle çš„é•¿åº¦
        __le32 data_len;  // data çš„ é•¿åº¦
        __le16 data_off;  // å¯¹è±¡çš„æ•°æ®åç§»é‡


        struct ceph_entity_name src; //æ¶ˆæ¯æº

        /* oldest code we think can decode this.  unknown if zero. */
        __le16 compat_version;
        __le16 reserved;
        __le32 crc;       /* header crc32c */
    } __attribute__ ((packed));

    struct ceph_msg_footer {
        __le32 front_crc, middle_crc, data_crc; //crcæ ¡éªŒç 
        __le64  sig; //æ¶ˆæ¯çš„64ä½signature
        __u8 flags; //ç»“æŸæ ‡å¿—
    } __attribute__ ((packed));
```

5\. Ceph CRUSH ç®—æ³•
================

5.1 æ•°æ®åˆ†å¸ƒç®—æ³•æŒ‘æˆ˜
------------

*   **æ•°æ®åˆ†å¸ƒå’Œè´Ÿè½½å‡è¡¡**ï¼š
    *   a. æ•°æ®åˆ†å¸ƒå‡è¡¡ï¼Œä½¿æ•°æ®èƒ½å‡åŒ€çš„åˆ†å¸ƒåˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚
    *   b. è´Ÿè½½å‡è¡¡ï¼Œä½¿æ•°æ®è®¿é—®è¯»å†™æ“ä½œçš„è´Ÿè½½åœ¨å„ä¸ªèŠ‚ç‚¹å’Œç£ç›˜çš„è´Ÿè½½å‡è¡¡ã€‚
*   **çµæ´»åº”å¯¹é›†ç¾¤ä¼¸ç¼©**ï¼š
    *   a. ç³»ç»Ÿå¯ä»¥æ–¹ä¾¿çš„å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹è®¾å¤‡ï¼Œå¹¶ä¸”å¯¹èŠ‚ç‚¹å¤±æ•ˆè¿›è¡Œå¤„ç†ã€‚
    *   b. å¢åŠ æˆ–è€…åˆ é™¤èŠ‚ç‚¹è®¾å¤‡åï¼Œèƒ½è‡ªåŠ¨å®ç°æ•°æ®çš„å‡è¡¡ï¼Œå¹¶ä¸”å°½å¯èƒ½å°‘çš„è¿ç§»æ•°æ®ã€‚
*   **æ”¯æŒå¤§è§„æ¨¡é›†ç¾¤**ï¼š
    *   a. è¦æ±‚æ•°æ®åˆ†å¸ƒç®—æ³•ç»´æŠ¤çš„å…ƒæ•°æ®ç›¸å¯¹è¾ƒå°ï¼Œå¹¶ä¸”è®¡ç®—é‡ä¸èƒ½å¤ªå¤§ã€‚éšç€é›†ç¾¤è§„æ¨¡çš„å¢ åŠ ï¼Œæ•°æ®åˆ†å¸ƒç®—æ³•å¼€é”€ç›¸å¯¹æ¯”è¾ƒå°ã€‚

5.2 Ceph CRUSH ç®—æ³•è¯´æ˜
------------------

*   CRUSH ç®—æ³•çš„å…¨ç§°ä¸ºï¼šControlled Scalable Decentralized Placement of Replicated Dataï¼Œå¯æ§çš„ã€å¯æ‰©å±•çš„ã€åˆ†å¸ƒå¼çš„å‰¯æœ¬æ•°æ®æ”¾ç½®ç®—æ³•ã€‚

*   PG åˆ° OSD çš„æ˜ å°„çš„è¿‡ç¨‹ç®—æ³•å«åš CRUSH ç®—æ³•ã€‚(ä¸€ä¸ª Object éœ€è¦ä¿å­˜ä¸‰ä¸ªå‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä¿å­˜åœ¨ä¸‰ä¸ª osd ä¸Š)ã€‚

*   CRUSH ç®—æ³•æ˜¯ä¸€ä¸ªä¼ªéšæœºçš„è¿‡ç¨‹ï¼Œä»–å¯ä»¥ä»æ‰€æœ‰çš„ OSD ä¸­ï¼Œéšæœºæ€§é€‰æ‹©ä¸€ä¸ª OSD é›†åˆï¼Œä½†æ˜¯åŒä¸€ä¸ª PG æ¯æ¬¡éšæœºé€‰æ‹©çš„ç»“æœæ˜¯ä¸å˜çš„ï¼Œä¹Ÿå°±æ˜¯æ˜ å°„çš„ OSD é›†åˆæ˜¯å›ºå®šçš„ã€‚


5.3 Ceph CRUSH ç®—æ³•åŸç†
------------------

**CRUSH ç®—æ³•å› å­ï¼š**

*   å±‚æ¬¡åŒ–çš„ Cluster Map
    åæ˜ äº†å­˜å‚¨ç³»ç»Ÿå±‚çº§çš„ç‰©ç†æ‹“æ‰‘ç»“æ„ã€‚å®šä¹‰äº† OSD é›†ç¾¤å…·æœ‰å±‚çº§å…³ç³»çš„ é™æ€æ‹“æ‰‘ç»“æ„ã€‚OSD å±‚çº§ä½¿å¾— CRUSH ç®—æ³•åœ¨é€‰æ‹© OSD æ—¶å®ç°äº†æœºæ¶æ„ŸçŸ¥èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è§„åˆ™å®šä¹‰ï¼Œ ä½¿å¾—å‰¯æœ¬å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„æœº æ¶ã€ä¸åŒçš„æœºæˆ¿ä¸­ã€æä¾›æ•°æ®çš„å®‰å…¨æ€§ ã€‚

*   Placement Rules
    å†³å®šäº†ä¸€ä¸ª PG çš„å¯¹è±¡å‰¯æœ¬å¦‚ä½•é€‰æ‹©çš„è§„åˆ™ï¼Œé€šè¿‡è¿™äº›å¯ä»¥è‡ªå·±è®¾å®šè§„åˆ™ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰è®¾ç½®å‰¯æœ¬åœ¨é›†ç¾¤ä¸­çš„åˆ†å¸ƒã€‚


### 5.3.1 å±‚çº§åŒ–çš„ Cluster Map

![](https://upload-images.jianshu.io/upload_images/2099201-f0f7321a9e37361f.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_crush.png

CRUSH Map æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼ŒOSDMap æ›´å¤šè®°å½•çš„æ˜¯ OSDMap çš„å±æ€§(epoch/fsid/pool ä¿¡æ¯ä»¥åŠ osd çš„ ip ç­‰ç­‰)ã€‚

å¶å­èŠ‚ç‚¹æ˜¯ deviceï¼ˆä¹Ÿå°±æ˜¯ osdï¼‰ï¼Œå…¶ä»–çš„èŠ‚ç‚¹ç§°ä¸º bucket èŠ‚ç‚¹ï¼Œè¿™äº› bucket éƒ½æ˜¯è™šæ„çš„èŠ‚ç‚¹ï¼Œå¯ä»¥æ ¹æ®ç‰©ç†ç»“æ„è¿›è¡ŒæŠ½è±¡ï¼Œå½“ç„¶æ ‘å½¢ç»“æ„åªæœ‰ä¸€ä¸ªæœ€ç»ˆçš„æ ¹èŠ‚ç‚¹ç§°ä¹‹ä¸º root èŠ‚ç‚¹ï¼Œä¸­é—´è™šæ‹Ÿçš„ bucket èŠ‚ç‚¹å¯ä»¥æ˜¯æ•°æ®ä¸­å¿ƒæŠ½è±¡ã€æœºæˆ¿æŠ½è±¡ã€æœºæ¶æŠ½è±¡ã€ä¸»æœºæŠ½è±¡ç­‰ã€‚

### 5.3.2 æ•°æ®åˆ†å¸ƒç­–ç•¥ Placement Rules

**æ•°æ®åˆ†å¸ƒç­–ç•¥ Placement Rules ä¸»è¦æœ‰ç‰¹ç‚¹ï¼š**

*   a. ä» CRUSH Map ä¸­çš„å“ªä¸ªèŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾
*   b. ä½¿ç”¨é‚£ä¸ªèŠ‚ç‚¹ä½œä¸ºæ•…éšœéš”ç¦»åŸŸ
*   c. å®šä½å‰¯æœ¬çš„æœç´¢æ¨¡å¼ï¼ˆå¹¿åº¦ä¼˜å…ˆ or æ·±åº¦ä¼˜å…ˆï¼‰

    rule replicated_ruleset  #è§„åˆ™é›†çš„å‘½åï¼Œåˆ›å»º pool æ—¶å¯ä»¥æŒ‡å®š rule é›†
    {
        ruleset 0                #rules é›†çš„ç¼–å·ï¼Œé¡ºåºç¼–å³å¯
        type replicated          #å®šä¹‰ pool ç±»å‹ä¸º replicated(è¿˜æœ‰ erasure æ¨¡å¼)
        min_size 1                #pool ä¸­æœ€å°æŒ‡å®šçš„å‰¯æœ¬æ•°é‡ä¸èƒ½å° 1
        max_size 10               #pool ä¸­æœ€å¤§æŒ‡å®šçš„å‰¯æœ¬æ•°é‡ä¸èƒ½å¤§äº 10
        step take default         #æŸ¥æ‰¾ bucket å…¥å£ç‚¹ï¼Œä¸€èˆ¬æ˜¯ root ç±»å‹çš„ bucket
        step chooseleaf  firstn  0  type  host #é€‰æ‹©ä¸€ä¸ª host,å¹¶é€’å½’é€‰æ‹©å¶å­èŠ‚ç‚¹ osd
        step emit        #ç»“æŸ
    }


5.3.3 Bucket éšæœºç®—æ³•ç±»å‹
------------------

![](https://upload-images.jianshu.io/upload_images/2099201-ac18dabc9fb44d20.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_bucket.png

*   **ä¸€èˆ¬çš„ buckets**ï¼šé€‚åˆæ‰€æœ‰å­èŠ‚ç‚¹æƒé‡ç›¸åŒï¼Œè€Œä¸”å¾ˆå°‘æ·»åŠ åˆ é™¤ itemã€‚

*   **list buckets**ï¼šé€‚ç”¨äºé›†ç¾¤æ‰©å±•ç±»å‹ã€‚å¢åŠ  itemï¼Œäº§ç”Ÿæœ€ä¼˜çš„æ•°æ®ç§»åŠ¨ï¼ŒæŸ¥æ‰¾ itemï¼Œæ—¶é—´å¤æ‚åº¦ O(n)ã€‚

*   **tree buckets**ï¼šæŸ¥æ‰¾è´Ÿè´£åº¦æ˜¯ O (log n), æ·»åŠ åˆ é™¤å¶å­èŠ‚ç‚¹æ—¶ï¼Œå…¶ä»–èŠ‚ç‚¹ node\_id ä¸å˜ã€‚

*   **straw buckets**ï¼šå…è®¸æ‰€æœ‰é¡¹é€šè¿‡ç±»ä¼¼æŠ½ç­¾çš„æ–¹å¼æ¥ä¸å…¶ä»–é¡¹å…¬å¹³â€œç«äº‰â€ã€‚å®šä½å‰¯æœ¬æ—¶ï¼Œbucket ä¸­çš„æ¯ä¸€é¡¹éƒ½å¯¹åº”ä¸€ä¸ªéšæœºé•¿åº¦çš„ strawï¼Œä¸”æ‹¥æœ‰æœ€é•¿é•¿åº¦çš„ straw ä¼šè·å¾—èƒœåˆ©ï¼ˆè¢«é€‰ä¸­ï¼‰ï¼Œæ·»åŠ æˆ–è€…é‡æ–°è®¡ç®—ï¼Œå­æ ‘ä¹‹é—´çš„æ•°æ®ç§»åŠ¨æä¾›æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚


5.4 CRUSH ç®—æ³•æ¡ˆä¾‹
-------------

**è¯´æ˜ï¼š**

é›†ç¾¤ä¸­æœ‰éƒ¨åˆ† sas å’Œ ssd ç£ç›˜ï¼Œç°åœ¨æœ‰ä¸ªä¸šåŠ¡çº¿æ€§èƒ½åŠå¯ç”¨æ€§ä¼˜å…ˆçº§é«˜äºå…¶ä»–ä¸šåŠ¡çº¿ï¼Œèƒ½å¦è®©è¿™ä¸ªé«˜ä¼˜ä¸šåŠ¡çº¿çš„æ•°æ®éƒ½å­˜æ”¾åœ¨ ssd ç£ç›˜ä¸Šã€‚

**æ™®é€šç”¨æˆ·ï¼š**

![](https://upload-images.jianshu.io/upload_images/2099201-1bd6980a2141bc51.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_sas.png

**é«˜ä¼˜ç”¨æˆ·ï¼š**

![](https://upload-images.jianshu.io/upload_images/2099201-127c6f8a40938233.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ssd.png

**é…ç½®è§„åˆ™ï¼š**

![](https://upload-images.jianshu.io/upload_images/2099201-0084962b3a7847b4.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_crush1.png

6\. å®šåˆ¶åŒ– Ceph RBD QOS
===================

6.1 QOS ä»‹ç»
---------

QoS ï¼ˆQuality of Serviceï¼ŒæœåŠ¡è´¨é‡ï¼‰èµ·æºäºç½‘ç»œæŠ€æœ¯ï¼Œå®ƒç”¨æ¥è§£å†³ç½‘ç»œå»¶è¿Ÿå’Œé˜»å¡ç­‰é—®é¢˜ï¼Œèƒ½å¤Ÿä¸ºæŒ‡å®šçš„ç½‘ç»œé€šä¿¡æä¾›æ›´å¥½çš„æœåŠ¡èƒ½åŠ›ã€‚

**é—®é¢˜ï¼š**

æˆ‘ä»¬æ€»çš„ Ceph é›†ç¾¤çš„ iIO èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œæ¯”å¦‚å¸¦å®½ï¼ŒIOPSã€‚å¦‚ä½•é¿å…ç”¨æˆ·äº‰å–èµ„æºï¼Œå¦‚æœä¿è¯é›†ç¾¤æ‰€æœ‰ç”¨æˆ·èµ„æºçš„é«˜å¯ç”¨æ€§ï¼Œä»¥åŠå¦‚ä½•ä¿è¯é«˜ä¼˜ç”¨æˆ·èµ„æºçš„å¯ç”¨æ€§ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠæœ‰é™çš„ IO èƒ½åŠ›åˆç†åˆ†é…ã€‚

6.2 Ceph IO æ“ä½œç±»å‹
---------------

*   **ClientOp**ï¼šæ¥è‡ªå®¢æˆ·ç«¯çš„è¯»å†™ I/O è¯·æ±‚ã€‚

*   **SubOp**ï¼šosd ä¹‹é—´çš„ I/O è¯·æ±‚ã€‚ä¸»è¦åŒ…æ‹¬ç”±å®¢æˆ·ç«¯ I/O äº§ç”Ÿçš„å‰¯æœ¬é—´æ•°æ®è¯»å†™è¯·æ±‚ï¼Œä»¥åŠç”±æ•°æ®åŒæ­¥ã€æ•°æ®æ‰«æã€è´Ÿè½½å‡è¡¡ç­‰å¼•èµ·çš„ I/O è¯·æ±‚ã€‚

*   **SnapTrim**ï¼šå¿«ç…§æ•°æ®åˆ é™¤ã€‚ä»å®¢æˆ·ç«¯å‘é€å¿«ç…§åˆ é™¤å‘½ä»¤åï¼Œåˆ é™¤ç›¸å…³å…ƒæ•°æ®ä¾¿ç›´æ¥è¿”å›ï¼Œä¹‹åç”±åå°çº¿ç¨‹åˆ é™¤çœŸå®çš„å¿«ç…§æ•°æ®ã€‚é€šè¿‡æ§åˆ¶ snaptrim çš„é€Ÿç‡é—´æ¥æ§åˆ¶åˆ é™¤é€Ÿç‡ã€‚

*   **Scrub**ï¼šç”¨äºå‘ç°å¯¹è±¡çš„é™é»˜æ•°æ®é”™è¯¯ï¼Œæ‰«æå…ƒæ•°æ®çš„ Scrub å’Œå¯¹è±¡æ•´ä½“æ‰«æçš„ deep Scrubã€‚

*   **Recovery**ï¼šæ•°æ®æ¢å¤å’Œè¿ç§»ã€‚é›†ç¾¤æ‰©/ç¼©å®¹ã€osd å¤±æ•ˆ/ä»æ–°åŠ å…¥ç­‰è¿‡ç¨‹ã€‚


6.3 Ceph å®˜æ–¹ QOS åŸç†
----------------

![ceph\_mclok\_qos.png](https://upload-images.jianshu.io/upload_images/2099201-1e1649e967f3ae12.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

mClock æ˜¯ä¸€ç§åŸºäºæ—¶é—´æ ‡ç­¾çš„ I/O è°ƒåº¦ç®—æ³•ï¼Œæœ€å…ˆè¢« Vmware æå‡ºæ¥çš„ç”¨äºé›†ä¸­å¼ç®¡ç†çš„å­˜å‚¨ç³»ç»Ÿã€‚(ç›®å‰å®˜æ–¹ QOS æ¨¡å—å±äºåŠæˆå“)ã€‚

**åŸºæœ¬æ€æƒ³ï¼š**

*   reservation é¢„ç•™ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯è·å¾—çš„æœ€ä½ I/O èµ„æºã€‚
*   weight æƒé‡ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ‰€å å…±äº« I/O èµ„æºçš„æ¯”é‡ã€‚
*   limit ä¸Šé™ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å¯è·å¾—çš„æœ€é«˜ I/O èµ„æºã€‚

6.4 å®šåˆ¶åŒ– QOS åŸç†
------------

### 6.4.1 ä»¤ç‰Œæ¡¶ç®—æ³•ä»‹ç»

![ceph\_token\_qos.png](https://upload-images.jianshu.io/upload_images/2099201-44d8c1a4d4bfd7bb.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)



åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•(TokenBucket)å®ç°äº†ä¸€å¥—ç®€å•æœ‰æ•ˆçš„ qos åŠŸèƒ½ï¼Œæ»¡è¶³äº†äº‘å¹³å°ç”¨æˆ·çš„æ ¸å¿ƒéœ€æ±‚ã€‚

**åŸºæœ¬æ€æƒ³ï¼š**

*   æŒ‰ç‰¹å®šçš„é€Ÿç‡å‘ä»¤ç‰Œæ¡¶æŠ•æ”¾ä»¤ç‰Œã€‚
*   æ ¹æ®é¢„è®¾çš„åŒ¹é…è§„åˆ™å…ˆå¯¹æŠ¥æ–‡è¿›è¡Œåˆ†ç±»ï¼Œä¸ç¬¦åˆåŒ¹é…è§„åˆ™çš„æŠ¥æ–‡ä¸éœ€è¦ç»è¿‡ä»¤ç‰Œæ¡¶çš„å¤„ç†ï¼Œç›´æ¥å‘é€ã€‚
*   ç¬¦åˆåŒ¹é…è§„åˆ™çš„æŠ¥æ–‡ï¼Œåˆ™éœ€è¦ä»¤ç‰Œæ¡¶è¿›è¡Œå¤„ç†ã€‚å½“æ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œåˆ™æŠ¥æ–‡å¯ä»¥è¢«ç»§ç»­å‘é€ä¸‹å»ï¼ŒåŒæ—¶ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œé‡æŒ‰æŠ¥æ–‡çš„é•¿åº¦åšç›¸åº”çš„å‡å°‘ã€‚
*   å½“ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œä¸è¶³æ—¶ï¼ŒæŠ¥æ–‡å°†ä¸èƒ½è¢«å‘é€ï¼Œåªæœ‰ç­‰åˆ°æ¡¶ä¸­ç”Ÿæˆäº†æ–°çš„ä»¤ç‰Œï¼ŒæŠ¥æ–‡æ‰å¯ä»¥å‘é€ã€‚è¿™å°±å¯ä»¥é™åˆ¶æŠ¥æ–‡çš„æµé‡åªèƒ½æ˜¯å°äºç­‰äºä»¤ç‰Œç”Ÿæˆçš„é€Ÿåº¦ï¼Œè¾¾åˆ°é™åˆ¶æµé‡çš„ç›®çš„ã€‚

### 6.4.2 RBD ä»¤ç‰Œæ¡¶ç®—æ³•æµç¨‹

![](https://upload-images.jianshu.io/upload_images/2099201-ee0e5f4494379b96.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_token1.png

**æ­¥éª¤ï¼š**

*   ç”¨æˆ·å‘èµ·è¯·æ±‚å¼‚æ­¥ IO åˆ°è¾¾ Image ä¸­ã€‚
*   è¯·æ±‚åˆ°è¾¾ ImageRequestWQ é˜Ÿåˆ—ä¸­ã€‚
*   åœ¨ ImageRequestWQ å‡ºé˜Ÿåˆ—çš„æ—¶å€™åŠ å…¥ä»¤ç‰Œæ¡¶ç®—æ³• TokenBucketã€‚
*   é€šè¿‡ä»¤ç‰Œæ¡¶ç®—æ³•è¿›è¡Œé™é€Ÿï¼Œç„¶åå‘é€ç»™ ImageRequest è¿›è¡Œå¤„ç†ã€‚

### 6.4.3 RBD ä»¤ç‰Œæ¡¶ç®—æ³•æ¡†æ¶å›¾

**ç°æœ‰æ¡†æ¶å›¾ï¼š**

![](https://upload-images.jianshu.io/upload_images/2099201-a5c9368ebffc0c96.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)

ceph\_qos2.png

**ä»¤ç‰Œå›¾ç®—æ³•æ¡†æ¶å›¾ï¼š**

![ceph_qos_token2](https://upload-images.jianshu.io/upload_images/2099201-da583f0fc10fbd87.png?imageMogr2/auto-orient/strip|imageView2/2/w/865/format/webp)


## ä½œè€…ä¿¡æ¯

[Ceph ä»‹ç»åŠåŸç†æ¶æ„åˆ†äº« - ç®€ä¹¦](https://www.jianshu.com/p/cc3ece850433)
**ä½œè€…ï¼š**æèˆª
**ä¸ªäººç®€ä»‹ï¼š** å¤šå¹´çš„åº•å±‚å¼€å‘ç»éªŒï¼Œåœ¨é«˜æ€§èƒ½ nginx å¼€å‘å’Œåˆ†å¸ƒå¼ç¼“å­˜ redis cluster æœ‰ç€ä¸°å¯Œçš„ç»éªŒï¼Œç›®å‰ä»äº‹ Ceph å·¥ä½œä¸¤å¹´å·¦å³ã€‚
å…ˆååœ¨ 58 åŒåŸã€æ±½è½¦ä¹‹å®¶ã€ä¼˜é…·åœŸè±†é›†å›¢å·¥ä½œã€‚ ç›®å‰ä¾›èŒäºæ»´æ»´åŸºç¡€å¹³å°è¿ç»´éƒ¨ è´Ÿè´£åˆ†å¸ƒå¼ Ceph é›†ç¾¤å¼€å‘åŠè¿ç»´ç­‰å·¥ä½œã€‚
ä¸ªäººä¸»è¦å…³æ³¨çš„æŠ€æœ¯é¢†åŸŸï¼šé«˜æ€§èƒ½ Nginx å¼€å‘ã€åˆ†å¸ƒå¼ç¼“å­˜ã€åˆ†å¸ƒå¼å­˜å‚¨ã€‚
