---
title: å…ƒæ•°æ®æœåŠ¡å™¨ï¼ˆMDSï¼‰ç›¸å…³

categories: 
  - ğŸ’»å·¥ä½œ
  - å­˜å‚¨
  - CEPH
  - Ceph è¿ç»´
date: 2020-12-11 12:49:17
permalink: /pages/f352dc/
tags: 
---
# 1.è¯´æ˜
## 1.1 ä»‹ç»
MDS å…¨ç§° Ceph Metadata Serverï¼Œæ˜¯ CephFS æœåŠ¡ä¾èµ–çš„å…ƒæ•°æ®æœåŠ¡ã€‚

# 2. å¸¸ç”¨æ“ä½œ
## 2.1 æŸ¥çœ‹ mds çš„çŠ¶æ€
```plain
$ ceph mds stat
test_fs-1/1/1 up test1_fs-1/1/1 up  {[test1_fs:0]=ceph-xx-osd03.gz01=up:active,[test_fs:0]=ceph-xx-osd00=up:active}
```

## 2.2 æŸ¥çœ‹ mds çš„æ˜ å°„ä¿¡æ¯
```plain
$ ceph mds dump
dumped fsmap epoch 50
fs_name	test_fs
epoch	50
flags	4
created	2017-09-05 10:06:56.343105
modified	2017-09-05 10:06:56.343105
tableserver	0
root	0
session_timeout	60
session_autoclose	300
max_file_size	1099511627776
last_failure	0
last_failure_osd_epoch	4787
compat	compat={},rocompat={},incompat={1=base v0.20,2=client writeable ranges,3=default file layouts on dirs,4=dir inode in separate object,5=mds uses versioned encoding,6=dirfrag is stored in omap,8=file layout v2}
max_mds	1
in	0
up	{0=104262}
failed
damaged
stopped
data_pools	[2]
metadata_pool	3
inline_data	disabled
balancer
standby_count_wanted	1
104262:	100.0.0.34:6800/1897776151 'ceph-xx-osd00' mds.0.37 up:active seq 151200
```

## 2.3 åˆ é™¤ mds èŠ‚ç‚¹
```plain
$ ceph mds rm 0 mds.ceph-xx-osd00
```

## 2.4 å¢åŠ æ•°æ®å­˜å‚¨æ± 
```plain
$ ceph mds add_data_pool <pool>
```

## 2.5 å…³é—­ mds é›†ç¾¤
```plain
$ ceph mds cluster_down
marked fsmap DOWN
```

## 2.6 å¯åŠ¨ mds é›†ç¾¤
```plain
$ ceph mds cluster_up
unmarked fsmap DOWN
```

## 2.7  å¯åˆ é™¤å…¼å®¹åŠŸèƒ½
```plain
$ ceph mds compat rm_compat <int[0-]>
```

## 2.8 å¯åˆ é™¤ä¸å…¼å®¹çš„åŠŸèƒ½
```plain
$ ceph mds compat rm_incompat <int[0-]>
```

## 2.9 æŸ¥çœ‹å…¼å®¹æ€§é€‰é¡¹
```plain
$ ceph mds compat show
```

## 2.10 åˆ é™¤æ•°æ®å­˜å‚¨æ± 
```plain
$ ceph mds remove_data_pool <pool>
```

## 2.11 åœæ­¢æŒ‡å®š mds
```plain
$ ceph mds stop <node1>
```

## 2.12 å‘æŸä¸ª mds å‘é€å‘½ä»¤
```plain
$ ceph mds tell <node> <args> [<args>...]
```

 

## 2.13 æ·»åŠ  mds æœºå™¨
```plain
#æ·»åŠ ä¸€ä¸ªæœºå™¨ new_host åˆ°ç°æœ‰mdsé›†ç¾¤ä¸­ 
su - ceph  -c "ceph-deploy --ceph-conf /etc/ceph/ceph.conf  mds create $new_host"
```

## 2.14 æŸ¥çœ‹å®¢æˆ·ç«¯ session
```plain
ceph daemon mds.ceph-xx-mds01.gz01 session ls
```
