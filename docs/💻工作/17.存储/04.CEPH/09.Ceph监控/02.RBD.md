---
title: RBD ç›‘æ§åŸ‹ç‚¹

tags: RBD
categories: 
  - ğŸ’»å·¥ä½œ
  - å­˜å‚¨
  - CEPH
  - Ceph ç›‘æ§
date: 2020-05-23 11:02:28
permalink: /pages/787e20/
---
# 1. perf dump
- ceph daemon /var/run/ceph/ceph-client.admin.asok  perf dump 

## 1. RBD Client Metrics Table
ç›‘æ§ç±»å‹ | ç›‘æ§é¡¹ |  è¯´æ˜ | çº§åˆ« |
---|---|---|---|
AsyncMessenger*| msgr_recv_messages |ç½‘ç»œæ¥æ”¶æ¶ˆæ¯| |
*| msgr_send_messages  |ç½‘ç»œå‘é€æ¶ˆæ¯| |
*| msgr_recv_bytes  |ç½‘ç»œæ¥æ”¶å­—èŠ‚| |
*| msgr_send_bytes  |ç½‘ç»œå‘é€å­—èŠ‚| |
*| msgr_created_connections  |åˆ›å»ºè¿æ¥æ•°| |
*| msgr_active_connections  |æœ‰æ•ˆè¿æ¥æ•°| |
*| msgr_running_total_time  |çº¿ç¨‹è¿è¡Œçš„æ€»æ—¶é—´| |
*| msgr_running_send_time  |æ¶ˆæ¯å‘é€çš„æ€»æ—¶é—´| |
*| msgr_running_recv_time  |æ¶ˆæ¯æ¥æ”¶çš„æ€»æ—¶é—´| |
*| msgr_running_fast_dispatch_time  |å¿«é€Ÿè°ƒåº¦æ€»æ—¶é—´| |

## 2. RBD Finisher-RadosClient Metrics Table
ç›‘æ§ç±»å‹ | ç›‘æ§é¡¹ |  è¯´æ˜ | çº§åˆ« |
---|---|---|---|
finisher-radosclient| queue_len |é˜Ÿåˆ—é•¿åº¦| |
*| complete_latency.avgcount  |å®Œæˆå»¶è¿Ÿ å¹³å‡æ•°| |
*| complete_latency.sum  |å®Œæˆå»¶è¿Ÿ æ€»æ•°| |
*| complete_latency.avgtime  |å®Œæˆå»¶è¿Ÿ å¹³å‡æ—¶é—´| |

## 3. RBD ObjectCacher-librbd-{id}-{pool}-{image} Metrics Table
ç›‘æ§ç±»å‹ | ç›‘æ§é¡¹ |  è¯´æ˜ | çº§åˆ« |
---|---|---|---|
objectcacher-librbd-{id}-{pool}-{image}| cache_ops_hit |å‘½ä¸­ç¼“å­˜| |
*| cache_ops_miss |ç©¿é€ç¼“å­˜| |
*| cache_bytes_hit |å‘½ä¸­ç¼“å­˜å¤§å°| |
*| cache_bytes_miss |ç©¿é€ç¼“å­˜å¤§å°| |
*| data_read |è¯»æ•°æ®å¤§å°| |
*| data_written |å†™ç¼“å­˜æ•°æ®å¤§å°| |
*| data_flushed |æ•°æ®åˆ·æ–°| |
*| data_overwritten_while_flushing |åˆ·æ–°æ—¶æ•°æ®é‡å†™| |
*| write_ops_blocked |è‚®è„é™åˆ¶å»¶è¿Ÿçš„å†™æ“ä½œ| |
*| write_bytes_blocked |å†™å…¥è„æ•°æ®çš„é™åˆ¶| |
*| write_time_blocked |ç”±äºè„æ•°æ®é™åˆ¶è€Œé˜»å¡å†™å…¥çš„æ—¶é—´| |

## 4. RBD librbd-{id}-{pool}-{image} Metrics Table
ç›‘æ§ç±»å‹ | ç›‘æ§é¡¹ |  è¯´æ˜ | çº§åˆ« |
---|---|---|---|
librbd-{id}-{pool}-{image}| rd |è¯»æ“ä½œæ•°| |
*| rd_bytes |è¯»æ“ä½œçš„å­—èŠ‚æ•°| |
*| rd_latency.avgcount |è¯»æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—çš„å¹³å‡æ•°| |
*| rd_latency.sum |è¯»æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—çš„æ€»æ•°| |
*| rd_latency.avgtime |è¯»æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—çš„å¹³å‡æ—¶é—´| |
*| wr |å†™æ“ä½œæ•°| |
*| wr_bytes |å†™æ“ä½œå­—èŠ‚æ•°| |
*| wr_latency.avgcount |å†™æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—çš„å¹³å‡æ•°| |
*| wr_latency.sum |å†™æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—çš„æ€»æ•°| |
*| wr_latency.avgtime |å†™æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—çš„å¹³å‡æ—¶é—´| |
*| discard |ä¸¢å¼ƒæ“ä½œæ•°| |
*| discard_bytes |ä¸¢å¼ƒæ“ä½œå­—èŠ‚æ•°| |
*| discard_latency.avgcount |ä¸¢å¼ƒæ“ä½œå»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ•°| |
*| discard_latency.sum |ä¸¢å¼ƒæ“ä½œå»¶è¿Ÿé˜Ÿåˆ—æ€»æ•°| |
*| discard_latency.avgtime |ä¸¢å¼ƒæ“ä½œå»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ—¶é—´| |
*| flush |åˆ·æ–°æ“ä½œæ•°| |
*| aio_flush |å¼‚æ­¥ IO åˆ·æ–°æ“ä½œæ•°| |
*| aio_flush_latency.avgcount |å¼‚æ­¥ IO åˆ·æ–°æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ•°| |
*| aio_flush_latency.sum |å¼‚æ­¥ IO åˆ·æ–°æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—æ€»æ•°| |
*| aio_flush_latency.avgtime	 |å¼‚æ­¥ IO åˆ·æ–°æ“ä½œå»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ—¶é—´| |
*| ws	 |WriteSame: æ¸…é›¶æ“ä½œ offload åˆ°å­˜å‚¨ï¼ŒåŠ é€Ÿå—åˆ†é…ã€å…‹éš†ã€æ•°æ®åˆå§‹åŒ–æ“ä½œ| |
*| ws_bytes	 |ws å­—èŠ‚æ•°å¤§å°| |
*| ws_latency.avgcount	 |ws å»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ•°| |
*| ws_latency.sum	 |ws å»¶è¿Ÿé˜Ÿåˆ—æ€»æ•°| |
*| ws_latency.avgtime	 |ws å»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ—¶é—´| |
*| cmp	 || |
*| cmp_bytes	 |cmp å­—èŠ‚æ•°å¤§å°| |
*| cmp_latency.avgcount	|cmp å»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ•°||	 	 	 
*| cmp_latency.sum	|cmp å»¶è¿Ÿé˜Ÿåˆ—æ€»æ•°	|| 	 	 
*| cmp_latency.avgtime|	cmp å»¶è¿Ÿé˜Ÿåˆ—å¹³å‡æ—¶é—´||	 	 	 
*| snap_create |	å¿«ç…§åˆ›å»ºæ•° ||	 	 	 
*| snap_remove |	å¿«ç…§ç§»é™¤æ•° ||	 	 	 
*| snap_rollback |	å¿«ç…§å›æ»šæ•° ||	 	 	 
*| snap_rename |	å¿«ç…§é‡å‘½åæ•° ||	  	 	 
*| notify |	æ›´æ–°é€šçŸ¥æ•° ||	 	 	 
*| resize |	è°ƒæ•´å¤§å°	|| 	 	 
*| readahead |	è¯»å–å¤´æ•°	|| 	 	 
*| readahead_bytes | è¯»å–å¤´å¤§å° ||	 	 	 
*| invalidate_cache |	ç¼“å­˜å¤±æ•ˆ ||

## 5. objecter
| ç›‘æ§ç±»å‹   |      ç›‘æ§é¡¹      |  è¯´æ˜  |
|----------|:-------------:|:-------------:|
| perf dump objecter  |  op_active         				 	  | ä¸»åŠ¨æ“ä½œæ•°	    					|
|   				  |  op_laggy         					  | æ¶ˆææ“ä½œæ•°	    					|
|   				  |  op_send         					  | å‘é€æ“ä½œæ•°	    					|
|   				  |  op_send_bytes         				  | å‘é€æ“ä½œ bytes	    					|
|   				  |  op_resend         				  	  | é‡æ“ä½œæ•°    							|
|   				  |  op_reply         				  	  | å›å¤æ“ä½œæ•°	    					|
|   				  |  op         				  		  | æ“ä½œæ•°	    						|
|   				  |  op_r         				  		  | è¯»æ“ä½œæ•°    							|
|   				  |  op_w         				  		  | å†™æ“ä½œæ•°    							|
|   				  |  op_rmw         				  	  | è¯»å†™ä¿®æ”¹æ“ä½œæ•°    					|
|   				  |  op_pg         				  		  | PG æ“ä½œæ•°    							|
|   				  |  osdop_stat         				  | æ“ä½œçŠ¶æ€    							|
|   				  |  osdop_create         				  | åˆ›å»ºå¯¹è±¡æ“ä½œ    						|
|   				  |  osdop_read         				  | è¯»æ“ä½œ    							|
|   				  |  osdop_write         				  | å†™æ“ä½œ    							|
|   				  |  osdop_writefull         			  | å†™æ»¡å¯¹è±¡æ“ä½œ    						|
|   				  |  osdop_writesame         			  | å†™ç›¸åŒçš„å¯¹è±¡æ“ä½œ    					|
|   				  |  osdop_append         				  | è¿½åŠ æ“ä½œ    							|
|   				  |  osdop_zero         				  | è®¾ç½®å¯¹è±¡ 0 æ“ä½œ    						|
|   				  |  osdop_truncate         			  | æˆªæ–­å¯¹è±¡æ“ä½œ    						|
|   				  |  osdop_delete         				  | åˆ é™¤å¯¹è±¡æ“ä½œ    						|
|   				  |  osdop_mapext         				  | æ˜ å°„èŒƒå›´æ“ä½œ    						|
|   				  |  osdop_sparse_read         			  | ç¨€å°‘è¯»æ“ä½œ    						|
|   				  |  osdop_clonerange         			  | å…‹éš†èŒƒå›´æ“ä½œ    						|
|   				  |  osdop_getxattr         			  | è·å– xattr æ“ä½œ    						|
|   				  |  osdop_setxattr         			  | è®¾ç½® xattr æ“ä½œ    						|
|   				  |  osdop_cmpxattr         			  | æ¯”è¾ƒ xattr æ“ä½œ    						|
|   				  |  osdop_rmxattr         			  	  | ç§»é™¤ xattr æ“ä½œ    						|
|   				  |  osdop_resetxattrs         			  | é‡ç½® xattr æ“ä½œ    						|
|   				  |  osdop_tmap_up         			  	  | tmap æ›´æ–°æ“ä½œ    						|
|   				  |  osdop_tmap_put         			  | tmap æ¨é€æ“ä½œ    						|
|   				  |  osdop_tmap_get         			  | tmap è·å–æ“ä½œ    						|
|   				  |  osdop_call         			  	  | è°ƒç”¨æ‰§è¡Œæ“ä½œ    						|
|   				  |  osdop_watch         			  	  | ç›‘æ§å¯¹è±¡æ“ä½œ    						|
|   				  |  osdop_notify         			  	  | å¯¹è±¡æ“ä½œé€šçŸ¥    						|
|   				  |  osdop_src_cmpxattr         		  | å¤šä¸ªæ“ä½œæ‰©å±•å±æ€§    					|
|   				  |  osdop_pgls         		  		  | pg å¯¹è±¡æ“ä½œ   							|
|   				  |  osdop_pgls_filter         		  	  | pg è¿‡æ»¤å¯¹è±¡æ“ä½œ    					|
|   				  |  osdop_other         		  		  | å…¶ä»–æ“ä½œ    							|
|   				  |  linger_active         		  		  | ä¸»åŠ¨å»¶è¿Ÿæ“ä½œ    						|
|   				  |  linger_send         		  		  | å»¶è¿Ÿå‘é€æ“ä½œ    						|
|   				  |  linger_resend         		  		  | å»¶è¿Ÿé‡æ–°å‘é€    						|
|   				  |  linger_ping         		  		  | å»¶è¿Ÿ ping æ“ä½œ    						|
|   				  |  poolop_active         		  		  | ä¸»åŠ¨æ± æ“ä½œ    						|
|   				  |  poolop_send         		  		  | å‘é€æ± æ“ä½œ   							|
|   				  |  poolop_resend         		  		  | é‡æ–°å‘é€æ± æ“ä½œ	   							|
|   				  |  poolstat_active         		  	  | ä¸»åŠ¨è·å–æ± å­ç»Ÿè®¡æ“ä½œ   							|
|   				  |  poolstat_send         		  		  | å‘é€æ± å­ç»Ÿè®¡æ“ä½œ   							|
|   				  |  poolstat_resend         		  	  | é‡æ–°å‘é€æ± å­ç»Ÿè®¡æ“ä½œ   							|
|   				  |  statfs_active         		  		  | fs çŠ¶æ€æ“ä½œ   							|
|   				  |  statfs_send         		  		  | å‘é€ fs çŠ¶æ€   							|
|   				  |  statfs_resend         		  		  | é‡æ–°å‘é€ fs çŠ¶æ€   							|
|   				  |  command_active         		  	  | æ´»åŠ¨çš„å‘½ä»¤   							|
|   				  |  command_send         		  		  | å‘é€æŒ‡ä»¤  							|
|   				  |  command_resend         		  	  | é‡æ–°å‘é€æŒ‡ä»¤  							|
|   				  |  map_epoch         		  	  		  | OSD map epoch  							|
|   				  |  map_full         		  	  		  | æ¥æ”¶æ»¡çš„ OSD map  							|
|   				  |  map_inc         		  	  		  | æ¥æ”¶åˆ°å¢é‡ OSD map  							|
|   				  |  osd_sessions         		  	  	  | osd ä¼šè¯  							|
|   				  |  osd_session_open         		  	  	  | æ‰“å¼€ osd ä¼šè¯  							|
|   				  |  osd_session_close         		  	  	  | å…³é—­ osd ä¼šè¯  							|
|   				  |  osd_laggy         		  	  	  	 | ç¼“æ…¢çš„ osd ä¼šè¯  							|
|   				  |  omap_wr         		  	  	  	 | osd map è¯»å†™æ“ä½œ  							|
|   				  |  omap_rd         		  	  	  	 | osd map è¯»æ“ä½œ  							|
|   				  |  omap_del         		  	  	  	 | osd map åˆ é™¤æ“ä½œ  							|


## 6. throttle
ç›‘æ§ç±»å‹ | ç›‘æ§é¡¹ |  è¯´æ˜ | çº§åˆ« |
---|---|---|---|
perf dump throttle-*|val|å½“å‰å¯ç”¨çš„å€¼||	 	 	 
*|max|æœ€å¤§é™åˆ¶æ•°||	 	 	 
*|get|è·å–åˆ°çš„å€¼||	 	 	 
*|get_sum|è·å–åˆ°çš„æ€»æ•°	|| 	 	 
*|get_or_fail_fail|è·å–æˆ–è€…é”™è¯¯å€¼||	 	 	 
*|get_or_fail_success|è·å–æˆ–è€…é”™è¯¯æˆåŠŸå€¼||	 	 	 
*|take|æ¥å—å€¼||	 	 	 
*|take_sum|æ¥å—æ€»æ•°||	 	 	 
*|put	|æ¨é€å€¼||	 	 	 
*|put_sum|æ¨é€æ€»æ•°	 ||	 	 
*|wait.avgcount|ç­‰å¾…å¹³å‡æ•°é‡||	 	 	 
*|wait.sum|ç­‰å¾…æ€»æ•°||	 	 	 
