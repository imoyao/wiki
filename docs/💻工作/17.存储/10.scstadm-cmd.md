---
title: scstadmin å‘½ä»¤æ±‡æ€»

tags: 
  - SCST
  - å­˜å‚¨
categories: 
  - ğŸ’»å·¥ä½œ
  - å­˜å‚¨
date: 2019-05-26 12:27:56
permalink: /scstadmin/
---

## iscsi-scst åŸºæœ¬é…ç½®

### åˆ›å»º
```bash
scstadmin -add_target iqn.2015:storage.vdisk1 -driver iscsi //åˆ›å»º target
scstadmin -add_group ESX -driver iscsi -target iqn.2015:storage.vdisk1 //æ·»åŠ ä¸»æœºç»„
scstadmin -open_dev disk01 -handler vdisk_blockio -attributes filename=/dev/VolGroup00/lv_01 // å»ºç«‹è™šæ‹Ÿç£ç›˜ä¸åç«¯ç£ç›˜æ˜ å°„
scstadmin -add_lun 0 -driver iscsi -target iqn.2015:storage.vdisk1 -device disk01            //è™šæ‹Ÿç£ç›˜æ·»åŠ è‡³ä¸»æœºç»„
scstadmin -add_init iqn.2015:vcenterserver  -driver iscsi -target  iqn.2015:storage.vdisk1 -group ESX // æ·»åŠ å®¢æˆ·ç«¯åˆ°ä¸»æœºç»„
scstadmin -enable_target iqn.2015:storage.vdisk1 -driver iscsi  //ä½¿èƒ½ target
scstadmin -set_drv_attr iscsi -attributes enabled=1 //ä½¿èƒ½è™šæ‹Ÿç£ç›˜å±æ€§è®¾ç½®
scstadmin -set_tgt_attr iqn.2015:storage.vdisk1 -driver iscsi -attributes allowed_portal=10.10.10.184 //å»ºç«‹ target ä¸ç½‘å¡æ˜ å°„å…³ç³»ï¼Œé€šè¿‡å¤šæ¬¡æ‰§è¡Œæ­¤å‘½ä»¤å®ç°å¤šè·¯å¾„å­˜å‚¨ç«¯æ”¯æŒï¼›
scstadmin -write_config /etc/scst.conf  //ä¿å­˜é…ç½®æ–‡ä»¶
```

### ä¿®æ”¹/åˆ é™¤
```bash
scstadmin -close_dev disk01 -handler vdisk_blockio  //åˆ é™¤è™šæ‹Ÿç£ç›˜ä¸åç«¯ç£ç›˜çš„æ˜ å°„
scstadmin -rem_target iqn.2015:storage.vdisk1 -driver iscsi  //åˆ é™¤ target
scstadmin -rem_group ESX -driver iscsi -target iqn.2015:storage.vdisk1  //åˆ é™¤ä¸»æœºç»„
scstadmin -rem_init iqn.2015:vcenterserver -driver iscsi -target iqn.2015:storage.vdisk1 -group ESX  //åˆ é™¤ä¸»æœºç»„ä¸­æŒ‡å®šå®¢æˆ·ç«¯
scstadmin -clear_init -driver iscsi -target iqn.2015:storage.vdisk1 -group ESX  //åˆ é™¤ç»„ä¸­çš„æ‰€æœ‰å®¢æˆ·ç«¯
scstadmin -rem_lun 0 -driver iscsi -target iqn.2015:storage.vdisk1           //è™šæ‹Ÿç£ç›˜åˆ é™¤ä»æŒ‡å®šä¸»æœºç»„
scstadmin -disable_target iqn.2015:storage.vdisk1 -driver iscsi  //åœæ­¢ target
scstadmin -clear_config -force //æ¸…ç†é…ç½®æ–‡ä»¶
```

### æŸ¥çœ‹ä¿¡æ¯
```bash
scstadmin -list_device  //æŸ¥çœ‹æ‰€æœ‰è™šæ‹Ÿå—è®¾å¤‡
scstadmin -list_target  //æŸ¥çœ‹æ‰€æœ‰ taget
scstadmin -list_tgt_attr iqn.2015:storage.vdisk1 -driver iscsi  //æŸ¥çœ‹æŒ‡å®š target å±æ€§
scstadmin -list_sessions  //æŸ¥çœ‹ target ä¸ init ä¹‹é—´çš„ä¼šè¯ä¿¡æ¯
```

## fc-target åŸºæœ¬é…ç½®
```bash
scstadmin -add_group ESX -driver qla2x00t -target 21:00:00:24:ff:5c:aa:15  //target æ·»åŠ ç»„
scstadmin -open_dev disk01 -handler vdisk_blockio -attributes filename=/dev/vg_raid5/thin_scst  //å»ºç«‹è™šæ‹Ÿç£ç›˜ä¸ç‰©ç†ç›˜çš„æ˜ å°„å…³ç³»
scstadmin -add_lun 0 -driver qla2x00t -target 21:00:00:24:ff:5c:aa:14 -device disk01  //æ·»åŠ è™šæ‹Ÿç£ç›˜åˆ° target
scstadmin -enable_target 21:00:00:24:ff:5c:aa:15 -driver qla2x00t  //ä½¿èƒ½ target
```
å…¶ä»–é…ç½®ä¸ iscsi éƒ½æ˜¯ç±»ä¼¼çš„ï¼›åªæ˜¯ FC é‡‡ç”¨ WWN å·æ ‡è¯† target å’Œ initï¼›

### å•æ§ fc é…ç½®
```bash
scstadmin -open_dev disk01 -handler vdisk_fileio -attributes filename=/dev/sdb
scstadmin -add_lun 0 -driver qla2x00t -target 21:00:00:24:ff:91:8e:8a -device disk01
scstadmin -add_group group1 -driver qla2x00t -target 21:00:00:24:ff:91:8e:8a
scstadmin -enable_target 21:00:00:24:ff:91:8e:8a -driver qla2x00t
scstadmin -write_conf /etc/scst.conf
```

### åŒæ§ fc é…ç½®
```bash
scstadmin -open_dev t11_l10_6142 -handler vdisk_fileio -attributes filename=/dev/StorPool11/SANLun10 -no_lip
scstadmin -add_lun 0 -driver qla2x00t -target 21:00:00:24:ff:91:8e:8a -device t11_l10_6142 -no_lip 
scstadmin -add_group group1 -driver qla2x00t -target 21:00:00:24:ff:91:8e:8a -no_lip 
scstadmin -enable_target 21:00:00:24:ff:91:8e:8a -driver qla2x00t
scstadmin -write_conf /etc/scst.conf
```
é‡æ–°è¿æ¥æœåŠ¡å™¨ç«¯ï¼š
```bash
echo 1 >> /sys/class/fc_hsot/host1/issue_lip

scstadmin -add_lun 6 -driver qla2x00t -target 21:00:00:24:ff:3d:be:21 -device sdg_1111
scstadmin -add_lun 6 -driver qla2x00t -target 21:00:00:24:ff:3d:be:20 -device sdg_1111
scstadmin -add_lun 6 -driver qla2x00t -target 21:00:00:24:ff:34:9b:bd -device sdg_1111
scstadmin -add_lun 6 -driver qla2x00t -target 21:00:00:24:ff:34:9b:bc -device sdg_1111
```
```bash
multipath -F å…³é—­å¤šè·¯å¾„ï¼ˆä¹Ÿå°±æ˜¯å…³é—­èšåˆï¼‰
multipath -v3 ç”Ÿæˆå¤šè·¯å¾„ï¼ˆèšåˆï¼‰
multipath -ll æŸ¥çœ‹å¤šè·¯å¾„
å¦‚æœæœ‰å¤šè·¯å¾„çš„è¯ï¼Œæœ€å¥½èšåˆï¼Œä½¿ç”¨èšåˆåçš„ç›˜ï¼›
```
### iscsiadmin çš„å‘½ä»¤æ±‡æ€»

1. æŸ¥çœ‹ iscsi çš„å­˜å‚¨ï¼š
```plain
iscsiadm -m discovery -t st -p ISCSI_IP
```
2. æŸ¥çœ‹ iscsi å‘ç°è®°å½•ï¼š
```bash
iscsiadm -m node
```
3. åˆ é™¤ iscsi å‘ç°è®°å½•ï¼š
```bash
iscsiadm -m node -o delete -T LUN_NAME -p ISCSI_IP
```
4. ç™»é™† iscsi å­˜å‚¨ï¼š
```bash
iscsiadm -m node -T LUN_NAME -p ISCSI_IP -l
```
5. ç™»å‡º iscsi å­˜å‚¨ï¼š
```bash
iscsiadm -m node -T LUN_NAME -p ISCSI_IP -u
```
6. æ˜¾ç¤ºä¼šè¯æƒ…å†µï¼š
```bash
iscsiadm -m session
```

## å‚è€ƒé“¾æ¥

[man scstadmin howto](http://rpm.pbone.net/manpage_idpl_35995495_numer_1_nazwa_scstadmin.html)
