---
title: Python å·¥åŒ ï¼šå–„ç”¨å˜é‡æ¥æ”¹å–„ä»£ç è´¨é‡
sticky: 100
tags: 
  - ç¼–ç¨‹
  - Python
  - å˜é‡
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - Python å·¥åŒ ç³»åˆ—
date: 2020-08-13 18:21:46
permalink: /craftsman/d8e694/
---

## å˜é‡å’Œä»£ç è´¨é‡

ä½œä¸ºã€Python å·¥åŒ ã€ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ï¼Œæˆ‘æƒ³å…ˆè°ˆè°ˆ ã€å˜é‡ï¼ˆVariablesï¼‰ã€ã€‚å› ä¸ºå¦‚ä½•å®šä¹‰å’Œä½¿ç”¨å˜é‡ï¼Œä¸€ç›´éƒ½æ˜¯å­¦ä¹ ä»»ä½•ä¸€é—¨ç¼–ç¨‹è¯­è¨€æœ€å…ˆè¦æŒæ¡çš„æŠ€èƒ½ä¹‹ä¸€ã€‚

å˜é‡ç”¨çš„å¥½æˆ–ä¸å¥½ï¼Œå’Œä»£ç è´¨é‡æœ‰ç€éå¸¸é‡è¦çš„è”ç³»ã€‚åœ¨å…³äºå˜é‡çš„è¯¸å¤šé—®é¢˜ä¸­ï¼Œä¸ºå˜é‡èµ·ä¸€ä¸ªå¥½åå­—å°¤å…¶é‡è¦ã€‚

## å¦‚ä½•ä¸ºå˜é‡èµ·å

åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸï¼Œæœ‰ä¸€å¥è‘—åçš„æ ¼è¨€ï¼ˆä¿çš®è¯ï¼‰ï¼š

> There are only two hard things in Computer Science: cache invalidation and naming things.
> åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸåªæœ‰ä¸¤ä»¶éš¾äº‹ï¼šç¼“å­˜å¤±æ•ˆ å’Œ ç»™ä¸œè¥¿èµ·åå­—
> 
> -- Phil Karlton

ç¬¬ä¸€ä¸ªã€ç¼“å­˜è¿‡æœŸé—®é¢˜ã€çš„éš¾åº¦ä¸ç”¨å¤šè¯´ï¼Œä»»ä½•ç”¨è¿‡ç¼“å­˜çš„äººéƒ½ä¼šæ‡‚ã€‚è‡³äºç¬¬äºŒä¸ªã€ç»™ä¸œè¥¿èµ·åå­—ã€è¿™äº‹çš„éš¾åº¦ï¼Œæˆ‘ä¹Ÿæ˜¯æ·±æœ‰ä½“ä¼šã€‚åœ¨æˆ‘çš„èŒä¸šç”Ÿæ¶¯é‡Œï¼Œåº¦è¿‡çš„æœ€ä¸ºé»‘æš—çš„ä¸‹åˆä¹‹ä¸€ï¼Œå°±æ˜¯ååœ¨æ˜¾ç¤ºå™¨å‰æŠ“è€³æŒ è…®ä¸ºä¸€ä¸ªæ–°é¡¹ç›®èµ·ä¸€ä¸ªåˆé€‚çš„åå­—ã€‚

ç¼–ç¨‹æ—¶èµ·çš„æœ€å¤šçš„åå­—ï¼Œè¿˜æ•°å„ç§å˜é‡ã€‚ç»™å˜é‡èµ·ä¸€ä¸ªå¥½åå­—å¾ˆé‡è¦ï¼Œ**å› ä¸ºå¥½çš„å˜é‡å‘½åå¯ä»¥æå¤§æé«˜ä»£ç çš„æ•´ä½“å¯è¯»æ€§ã€‚**

ä¸‹é¢å‡ ç‚¹ï¼Œæ˜¯æˆ‘æ€»ç»“çš„ä¸ºå˜é‡èµ·åæ—¶ï¼Œæœ€å¥½éµå®ˆçš„åŸºæœ¬åŸåˆ™ã€‚

### 1. å˜é‡åè¦æœ‰æè¿°æ€§ï¼Œä¸èƒ½å¤ªå®½æ³›

åœ¨**å¯æ¥å—çš„é•¿åº¦èŒƒå›´å†…**ï¼Œå˜é‡åèƒ½æŠŠå®ƒæ‰€æŒ‡å‘çš„å†…å®¹æè¿°çš„è¶Šç²¾ç¡®è¶Šå¥½ã€‚æ‰€ä»¥ï¼Œå°½é‡ä¸è¦ç”¨é‚£äº›è¿‡äºå®½æ³›çš„è¯æ¥ä½œä¸ºä½ çš„å˜é‡åï¼š

- **BAD**: `day`, `host`, `cards`, `temp`
- **GOOD**:  `day_of_week`, `hosts_to_reboot`, `expired_cards`

### 2. å˜é‡åæœ€å¥½è®©äººèƒ½çŒœå‡ºç±»å‹

æ‰€æœ‰å­¦ä¹  Python çš„äººéƒ½çŸ¥é“ï¼ŒPython æ˜¯ä¸€é—¨åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œå®ƒï¼ˆè‡³å°‘åœ¨ [PEP 484](https://www.python.org/dev/peps/pep-0484/) å‡ºç°å‰ï¼‰æ²¡æœ‰å˜é‡ç±»å‹å£°æ˜ã€‚æ‰€ä»¥å½“ä½ çœ‹åˆ°ä¸€ä¸ªå˜é‡æ—¶ï¼Œé™¤äº†é€šè¿‡ä¸Šä¸‹æ–‡çŒœæµ‹ï¼Œæ²¡æ³•è½»æ˜“çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆç±»å‹ã€‚

ä¸è¿‡ï¼Œäººä»¬å¯¹äºå˜é‡åå’Œå˜é‡ç±»å‹çš„å…³ç³»ï¼Œé€šå¸¸ä¼šæœ‰ä¸€äº›ç›´è§‰ä¸Šçš„çº¦å®šï¼Œæˆ‘æŠŠå®ƒä»¬æ€»ç»“åœ¨äº†ä¸‹é¢ã€‚

#### ã€ä»€ä¹ˆæ ·çš„åå­—ä¼šè¢«å½“æˆ bool ç±»å‹ï¼Ÿã€

å¸ƒå°”ç±»å‹å˜é‡çš„æœ€å¤§ç‰¹ç‚¹æ˜¯ï¼šå®ƒåªå­˜åœ¨ä¸¤ä¸ªå¯èƒ½çš„å€¼**ã€æ˜¯ã€** æˆ– **ã€ä¸æ˜¯ã€**ã€‚æ‰€ä»¥ï¼Œç”¨ `is`ã€`has` ç­‰éé»‘å³ç™½çš„è¯ä¿®é¥°çš„å˜é‡åï¼Œä¼šæ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚åŸåˆ™å°±æ˜¯ï¼š**è®©è¯»åˆ°å˜é‡åçš„äººè§‰å¾—è¿™ä¸ªå˜é‡åªä¼šæœ‰ã€æ˜¯ã€æˆ–ã€ä¸æ˜¯ã€ä¸¤ç§å€¼**ã€‚

ä¸‹é¢æ˜¯å‡ ä¸ªä¸é”™çš„ç¤ºä¾‹ï¼š

- `is_superuser`ï¼šã€æ˜¯å¦è¶…çº§ç”¨æˆ·ã€ï¼Œåªä¼šæœ‰ä¸¤ç§å€¼ï¼šæ˜¯/ä¸æ˜¯
- `has_error`ï¼šã€æœ‰æ²¡æœ‰é”™è¯¯ã€ï¼Œåªä¼šæœ‰ä¸¤ç§å€¼ï¼šæœ‰/æ²¡æœ‰
- `allow_vip`ï¼šã€æ˜¯å¦å…è®¸ VIPã€ï¼Œåªä¼šæœ‰ä¸¤ç§å€¼ï¼šå…è®¸/ä¸å…è®¸
- `use_msgpack`ï¼šã€æ˜¯å¦ä½¿ç”¨ msgpackã€ï¼Œåªä¼šæœ‰ä¸¤ç§å€¼ï¼šä½¿ç”¨/ä¸ä½¿ç”¨
- `debug`ï¼šã€æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ã€ï¼Œè¢«å½“åš bool ä¸»è¦æ˜¯å› ä¸ºçº¦å®šä¿—æˆ

#### ã€ä»€ä¹ˆæ ·çš„åå­—ä¼šè¢«å½“æˆ int/float ç±»å‹ï¼Ÿã€

äººä»¬çœ‹åˆ°å’Œæ•°å­—ç›¸å…³çš„åå­—ï¼Œéƒ½ä¼šé»˜è®¤ä»–ä»¬æ˜¯ int/float ç±»å‹ï¼Œä¸‹é¢è¿™äº›æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼š

- é‡Šä¹‰ä¸ºæ•°å­—çš„æ‰€æœ‰å•è¯ï¼Œæ¯”å¦‚ï¼š`portï¼ˆç«¯å£å·ï¼‰`ã€`ageï¼ˆå¹´é¾„ï¼‰`ã€`radiusï¼ˆåŠå¾„ï¼‰` ç­‰ç­‰
- ä½¿ç”¨ _id ç»“å°¾çš„å•è¯ï¼Œæ¯”å¦‚ï¼š`user_id`ã€`host_id`
- ä½¿ç”¨ length/count å¼€å¤´æˆ–è€…ç»“å°¾çš„å•è¯ï¼Œæ¯”å¦‚ï¼š `length_of_username`ã€`max_length`ã€`users_count`

**æ³¨æ„ï¼š**ä¸è¦ä½¿ç”¨æ™®é€šçš„å¤æ•°æ¥è¡¨ç¤ºä¸€ä¸ª int ç±»å‹å˜é‡ï¼Œæ¯”å¦‚ `apples`ã€`trips`ï¼Œæœ€å¥½ç”¨ `number_of_apples`ã€`trips_count` æ¥æ›¿ä»£ã€‚

#### å…¶ä»–ç±»å‹

å¯¹äº strã€listã€tupleã€dict è¿™äº›å¤æ‚ç±»å‹ï¼Œå¾ˆéš¾æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§„åˆ™è®©æˆ‘ä»¬å¯ä»¥é€šè¿‡åå­—å»çŒœæµ‹å˜é‡ç±»å‹ã€‚æ¯”å¦‚ `headers`ï¼Œæ—¢å¯èƒ½æ˜¯ä¸€ä¸ªå¤´ä¿¡æ¯åˆ—è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯åŒ…å«å¤´ä¿¡æ¯çš„ dictã€‚

å¯¹äºè¿™äº›ç±»å‹çš„å˜é‡åï¼Œæœ€æ¨èçš„æ–¹å¼ï¼Œå°±æ˜¯ç¼–å†™è§„èŒƒçš„æ–‡æ¡£ï¼Œåœ¨å‡½æ•°å’Œæ–¹æ³•çš„ document string ä¸­ï¼Œä½¿ç”¨ sphinx æ ¼å¼ï¼ˆ[Python å®˜æ–¹æ–‡æ¡£ä½¿ç”¨çš„æ–‡æ¡£å·¥å…·](http://www.sphinx-doc.org/en/stable/)ï¼‰æ¥æ ‡æ³¨æ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚ 

### 3. é€‚å½“ä½¿ç”¨ã€åŒˆç‰™åˆ©å‘½åæ³•ã€

ç¬¬ä¸€æ¬¡çŸ¥é“ã€[åŒˆç‰™åˆ©å‘½åæ³•](https://en.wikipedia.org/wiki/Hungarian_notation)ã€ï¼Œæ˜¯åœ¨ [Joel on Software çš„ä¸€ç¯‡åšæ–‡](http://www.joelonsoftware.com/articles/Wrong.html)ä¸­ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒåŒˆç‰™åˆ©å‘½åæ³•å°±æ˜¯æŠŠå˜é‡çš„ã€ç±»å‹ã€ç¼©å†™ï¼Œæ”¾åˆ°å˜é‡åçš„æœ€å‰é¢ã€‚

å…³é”®åœ¨äºï¼Œè¿™é‡Œè¯´çš„å˜é‡ã€ç±»å‹ã€ï¼Œå¹¶éæŒ‡ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„ int/str/list è¿™ç§ç±»å‹ï¼Œè€Œæ˜¯æŒ‡é‚£äº›å’Œä½ çš„ä»£ç ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„ç±»å‹ã€‚

æ¯”å¦‚ï¼Œåœ¨ä½ çš„ä»£ç ä¸­æœ‰ä¸¤ä¸ªå˜é‡ï¼š`students` å’Œ `teachers`ï¼Œä»–ä»¬æŒ‡å‘çš„å†…å®¹éƒ½æ˜¯ä¸€ä¸ªåŒ…å« Person å¯¹è±¡çš„ list ã€‚ä½¿ç”¨ã€åŒˆç‰™åˆ©å‘½åæ³•ã€åï¼Œå¯ä»¥æŠŠè¿™ä¸¤ä¸ªåå­—æ”¹å†™æˆè¿™æ ·ï¼š

students -> `pl_students`
teachers -> `pl_teachers`

å…¶ä¸­ pl æ˜¯ **person list** çš„é¦–å­—æ¯ç¼©å†™ã€‚å½“å˜é‡åè¢«åŠ ä¸Šå‰ç¼€åï¼Œå¦‚æœä½ çœ‹åˆ°ä»¥ `pl_` æ‰“å¤´çš„å˜é‡ï¼Œå°±èƒ½çŸ¥é“å®ƒæ‰€æŒ‡å‘çš„å€¼ç±»å‹äº†ã€‚

å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨ã€åŒˆç‰™åˆ©å‘½åæ³•ã€æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ï¼Œå› ä¸ºå®ƒå¯ä»¥æ”¹å–„ä½ çš„ä»£ç å¯è¯»æ€§ï¼Œå°¤å…¶åœ¨é‚£äº›å˜é‡ä¼—å¤šã€åŒä¸€ç±»å‹å¤šæ¬¡å‡ºç°æ—¶ã€‚æ³¨æ„ä¸è¦æ»¥ç”¨å°±å¥½ã€‚

### 4. å˜é‡åå°½é‡çŸ­ï¼Œä½†æ˜¯ç»å¯¹ä¸è¦å¤ªçŸ­

åœ¨å‰é¢ï¼Œæˆ‘ä»¬æåˆ°è¦è®©å˜é‡åæœ‰æè¿°æ€§ã€‚å¦‚æœä¸ç»™è¿™æ¡åŸåˆ™åŠ ä¸Šä»»ä½•é™åˆ¶ï¼Œé‚£ä¹ˆä½ å¾ˆæœ‰å¯èƒ½å†™å‡ºè¿™ç§æè¿°æ€§æå¼ºçš„å˜é‡åï¼š`how_much_points_need_for_level2`ã€‚å¦‚æœä»£ç ä¸­å……æ–¥ç€è¿™ç§è¿‡é•¿çš„å˜é‡åï¼Œå¯¹äºä»£ç å¯è¯»æ€§æ¥è¯´æ˜¯ä¸ªç¾éš¾ã€‚

ä¸€ä¸ªå¥½çš„å˜é‡åï¼Œé•¿åº¦åº”è¯¥æ§åˆ¶åœ¨ **ä¸¤åˆ°ä¸‰ä¸ªå•è¯å·¦å³**ã€‚æ¯”å¦‚ä¸Šé¢çš„åå­—ï¼Œå¯ä»¥ç¼©å†™ä¸º `points_level2`ã€‚

**ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥é¿å…ä½¿ç”¨é‚£äº›åªæœ‰ä¸€ä¸¤ä¸ªå­—æ¯çš„çŸ­åå­—**ï¼Œæ¯”å¦‚æ•°ç»„ç´¢å¼•ä¸‰å‰‘å®¢ `i`ã€`j`ã€`k`ï¼Œç”¨æœ‰æ˜ç¡®å«ä¹‰çš„åå­—ï¼Œæ¯”å¦‚ person_index æ¥ä»£æ›¿å®ƒä»¬æ€»æ˜¯ä¼šæ›´å¥½ä¸€äº›ã€‚

#### ä½¿ç”¨çŸ­åå­—çš„ä¾‹å¤–æƒ…å†µ

æœ‰æ—¶ï¼Œä¸Šé¢çš„åŸåˆ™ä¹Ÿå­˜åœ¨ä¸€äº›ä¾‹å¤–ã€‚å½“ä¸€äº›æ„ä¹‰æ˜ç¡®ä½†æ˜¯è¾ƒé•¿çš„å˜é‡åé‡å¤å‡ºç°æ—¶ï¼Œä¸ºäº†è®©ä»£ç æ›´ç®€æ´ï¼Œä½¿ç”¨çŸ­åå­—ç¼©å†™æ˜¯å®Œå…¨å¯ä»¥çš„ã€‚ä½†æ˜¯ä¸ºäº†é™ä½ç†è§£æˆæœ¬ï¼ŒåŒä¸€æ®µä»£ç å†…æœ€å¥½ä¸è¦ä½¿ç”¨å¤ªå¤šè¿™ç§çŸ­åå­—ã€‚

æ¯”å¦‚åœ¨ Python ä¸­å¯¼å…¥æ¨¡å—æ—¶ï¼Œå°±ä¼šç»å¸¸ç”¨åˆ°çŸ­åå­—ä½œä¸ºåˆ«åï¼Œåƒ Django i18n ç¿»è¯‘æ—¶å¸¸ç”¨çš„ `gettext` æ–¹æ³•é€šå¸¸ä¼šè¢«ç¼©å†™æˆ `_` æ¥ä½¿ç”¨*ï¼ˆfrom django.utils.translation import ugettext as _ï¼‰*

### 5. å…¶ä»–æ³¨æ„äº‹é¡¹

å…¶ä»–ä¸€äº›ç»™å˜é‡å‘½åçš„æ³¨æ„äº‹é¡¹ï¼š

- åŒä¸€æ®µä»£ç å†…ä¸è¦ä½¿ç”¨è¿‡äºç›¸ä¼¼çš„å˜é‡åï¼Œæ¯”å¦‚åŒæ—¶å‡ºç° `users`ã€`users1`ã€ `user3` è¿™ç§åºåˆ—
- ä¸è¦ä½¿ç”¨å¸¦å¦å®šå«ä¹‰çš„å˜é‡åï¼Œç”¨ `is_special` ä»£æ›¿ `is_not_normal`

## æ›´å¥½çš„ä½¿ç”¨å˜é‡

å‰é¢è®²äº†å¦‚ä½•ä¸ºå˜é‡å–ä¸€ä¸ªå¥½åå­—ï¼Œä¸‹é¢æˆ‘ä»¬è°ˆè°ˆåœ¨æ—¥å¸¸ä½¿ç”¨å˜é‡æ—¶ï¼Œåº”è¯¥æ³¨æ„çš„ä¸€äº›å°ç»†èŠ‚ã€‚

### 1. ä¿æŒä¸€è‡´æ€§

å¦‚æœä½ åœ¨ä¸€ä¸ªæ–¹æ³•å†…é‡Œé¢æŠŠå›¾ç‰‡å˜é‡å«åš `photo`ï¼Œåœ¨å…¶ä»–çš„åœ°æ–¹å°±ä¸è¦æŠŠå®ƒæ”¹æˆ `image`ï¼Œè¿™æ ·åªä¼šè®©ä»£ç çš„é˜…è¯»è€…å›°æƒ‘ï¼šã€`image` å’Œ `photo` åˆ°åº•æ˜¯ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Ÿã€

å¦å¤–ï¼Œè™½ç„¶ Python æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œä½†é‚£ä¹Ÿä¸æ„å‘³ç€ä½ å¯ä»¥ç”¨åŒä¸€ä¸ªå˜é‡åä¸€ä¼šè¡¨ç¤º str ç±»å‹ï¼Œè¿‡ä¼šåˆæ¢æˆ listã€‚**åŒä¸€ä¸ªå˜é‡åæŒ‡ä»£çš„å˜é‡ç±»å‹ï¼Œä¹Ÿéœ€è¦ä¿æŒä¸€è‡´æ€§ã€‚**

### 2. å°½é‡ä¸è¦ç”¨ globals()/locals()

ä¹Ÿè®¸ä½ ç¬¬ä¸€æ¬¡å‘ç° globals()/locals() è¿™å¯¹å†…å»ºå‡½æ•°æ—¶å¾ˆå…´å¥‹ï¼Œè¿«ä¸åŠå¾…çš„å†™ä¸‹ä¸‹é¢è¿™ç§æç«¯ã€ç®€æ´ã€çš„ä»£ç ï¼š

```python
def render_trip_page(request, user_id, trip_id):
    user = User.objects.get(id=user_id)
    trip = get_object_or_404(Trip, pk=trip_id)
    is_suggested = is_suggested(user, trip)
    # åˆ©ç”¨ locals() èŠ‚çº¦äº†ä¸‰è¡Œä»£ç ï¼Œæˆ‘æ˜¯ä¸ªå¤©æ‰ï¼
    return render(request, 'trip.html', locals())
```

åƒä¸‡ä¸è¦è¿™ä¹ˆåšï¼Œè¿™æ ·åªä¼šè®©è¯»åˆ°è¿™æ®µä»£ç çš„äººï¼ˆåŒ…æ‹¬ä¸‰ä¸ªæœˆåçš„ä½ è‡ªå·±ï¼‰ç—›æ¨ä½ ï¼Œå› ä¸ºä»–éœ€è¦è®°ä½è¿™ä¸ªå‡½æ•°å†…å®šä¹‰çš„æ‰€æœ‰å˜é‡ï¼ˆæƒ³æƒ³è¿™ä¸ªå‡½æ•°å¢é•¿åˆ°ä¸¤ç™¾è¡Œä¼šæ€ä¹ˆæ ·ï¼Ÿï¼‰ï¼Œæ›´åˆ«æ locals() è¿˜ä¼šæŠŠä¸€äº›ä¸å¿…è¦çš„å˜é‡ä¼ é€’å‡ºå»ã€‚

æ›´ä½•å†µï¼Œ [The Zen of Pythonï¼ˆPython ä¹‹ç¦…ï¼‰](https://www.python.org/dev/peps/pep-0020/) è¯´çš„æ¸…æ¸…æ¥šæ¥šï¼š**Explicit is better than implicit.ï¼ˆæ˜¾å¼ä¼˜äºéšå¼ï¼‰**ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯è€è€å®å®æŠŠä»£ç å†™æˆè¿™æ ·å§ï¼š

```python
    return render(request, 'trip.html', {
        'user': user,
        'trip': trip,
        'is_suggested': is_suggested
    })
```

### 3. å˜é‡å®šä¹‰å°½é‡é è¿‘ä½¿ç”¨

è¿™ä¸ªåŸåˆ™å±äºè€ç”Ÿå¸¸è°ˆäº†ã€‚å¾ˆå¤šäººï¼ˆåŒ…æ‹¬æˆ‘ï¼‰åœ¨åˆšå¼€å§‹å­¦ä¹ ç¼–ç¨‹æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªä¹ æƒ¯ã€‚å°±æ˜¯æŠŠæ‰€æœ‰çš„å˜é‡å®šä¹‰å†™åœ¨ä¸€èµ·ï¼Œæ”¾åœ¨å‡½æ•°æˆ–æ–¹æ³•çš„æœ€å‰é¢ã€‚

```python
def generate_trip_png(trip):
    path = []
    markers = []
    photo_markers = []
    text_markers = []
    marker_count = 0
    point_count = 0
    ... ...
```

è¿™æ ·åšåªä¼šè®©ä½ çš„ä»£ç ã€çœ‹ä¸Šå»å¾ˆæ•´æ´ã€ï¼Œä½†æ˜¯å¯¹æé«˜ä»£ç å¯è¯»æ€§æ²¡æœ‰ä»»ä½•å¸®åŠ©ã€‚

æ›´å¥½çš„åšæ³•æ˜¯ï¼Œ**è®©å˜é‡å®šä¹‰å°½é‡é è¿‘ä½¿ç”¨**ã€‚é‚£æ ·å½“ä½ é˜…è¯»ä»£ç æ—¶ï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£ä»£ç çš„é€»è¾‘ï¼Œè€Œä¸æ˜¯è´¹åŠ²çš„å»æƒ³è¿™ä¸ªå˜é‡åˆ°åº•æ˜¯ä»€ä¹ˆã€å“ªé‡Œå®šä¹‰çš„ï¼Ÿ

### 4. åˆç†ä½¿ç”¨ namedtuple/dict æ¥è®©å‡½æ•°è¿”å›å¤šä¸ªå€¼

Python çš„å‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼ï¼š

```python
def latlon_to_address(lat, lon):
    return country, province, city

# åˆ©ç”¨å¤šè¿”å›å€¼ä¸€æ¬¡è§£åŒ…å®šä¹‰å¤šä¸ªå˜é‡
country, province, city = latlon_to_address(lat, lon)
```

ä½†æ˜¯ï¼Œè¿™æ ·çš„ç”¨æ³•ä¼šäº§ç”Ÿä¸€ä¸ªå°é—®é¢˜ï¼šå¦‚æœæŸä¸€å¤©ï¼Œ `latlon_to_address` å‡½æ•°éœ€è¦è¿”å›ã€åŸåŒºï¼ˆDistrictï¼‰ã€æ—¶æ€ä¹ˆåŠï¼Ÿ

å¦‚æœæ˜¯ä¸Šé¢è¿™ç§å†™æ³•ï¼Œä½ éœ€è¦æ‰¾åˆ°æ‰€æœ‰è°ƒç”¨ `latlon_to_address` çš„åœ°æ–¹ï¼Œè¡¥ä¸Šå¤šå‡ºæ¥çš„è¿™ä¸ªå˜é‡ï¼Œå¦åˆ™ *ValueError: too many values to unpack* å°±ä¼šæ‰¾ä¸Šä½ ï¼š

```python
country, province, city, district = latlon_to_address(lat, lon)
# æˆ–è€…ä½¿ç”¨ _ å¿½ç•¥å¤šå‡ºæ¥çš„è¿”å›å€¼
country, province, city, _ = latlon_to_address(lat, lon)
```

å¯¹äºè¿™ç§å¯èƒ½å˜åŠ¨çš„å¤šè¿”å›å€¼å‡½æ•°ï¼Œä½¿ç”¨ namedtuple/dict ä¼šæ›´æ–¹ä¾¿ä¸€äº›ã€‚å½“ä½ æ–°å¢è¿”å›å€¼æ—¶ï¼Œä¸ä¼šå¯¹ä¹‹å‰çš„å‡½æ•°è°ƒç”¨äº§ç”Ÿä»»ä½•ç ´åæ€§çš„å½±å“ï¼š

```python
# 1. ä½¿ç”¨ dict
def latlon_to_address(lat, lon):
    return {
        'country': country,
        'province': province,
        'city': city
    }

addr_dict = latlon_to_address(lat, lon)

# 2. ä½¿ç”¨ namedtuple
from collections import namedtuple

Address = namedtuple("Address", ['country', 'province', 'city'])

def latlon_to_address(lat, lon):
    return Address(
        country=country,
        province=province,
        city=city
    )

addr = latlon_to_address(lat, lon)
```

ä¸è¿‡è¿™æ ·åšä¹Ÿæœ‰åå¤„ï¼Œå› ä¸ºä»£ç å¯¹å˜æ›´çš„å…¼å®¹æ€§è™½ç„¶å˜å¥½äº†ï¼Œä½†æ˜¯ä½ ä¸èƒ½ç»§ç»­ç”¨ä¹‹å‰ `x, y = f()` çš„æ–¹å¼ä¸€æ¬¡è§£åŒ…å®šä¹‰å¤šä¸ªå˜é‡äº†ã€‚å–èˆåœ¨äºä½ è‡ªå·±ã€‚

### 5. æ§åˆ¶å•ä¸ªå‡½æ•°å†…çš„å˜é‡æ•°é‡

äººè„‘çš„èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œç ”ç©¶è¡¨æ˜ï¼Œäººç±»çš„çŸ­æœŸè®°å¿†åªèƒ½åŒæ—¶è®°ä½ä¸è¶…è¿‡åä¸ªåå­—ã€‚æ‰€ä»¥ï¼Œå½“ä½ çš„æŸä¸ªå‡½æ•°è¿‡é•¿ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œè¶…è¿‡ä¸€å±çš„çš„å‡½æ•°å°±ä¼šè¢«è®¤ä¸ºæœ‰ç‚¹è¿‡é•¿äº†ï¼‰ï¼ŒåŒ…å«äº†å¤ªå¤šå˜é‡æ—¶ã€‚è¯·åŠæ—¶æŠŠå®ƒæ‹†åˆ†ä¸ºå¤šä¸ªå°å‡½æ•°å§ã€‚

### 6. åŠæ—¶åˆ æ‰é‚£äº›æ²¡ç”¨çš„å˜é‡

è¿™æ¡åŸåˆ™éå¸¸ç®€å•ï¼Œä¹Ÿå¾ˆå®¹æ˜“åšåˆ°ã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰éµå®ˆï¼Œé‚£å®ƒå¯¹ä½ çš„ä»£ç è´¨é‡çš„æ‰“å‡»æ˜¯æ¯ç­çº§çš„ã€‚ä¼šè®©é˜…è¯»ä½ ä»£ç çš„äººæœ‰ä¸€ç§è¢«æ„šå¼„çš„æ„Ÿè§‰ã€‚

```python
def fancy_func():
    # è¯»è€…å¿ƒç†ï¼šå—¯ï¼Œè¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª fancy_vars
    fancy_vars = get_fancy()
    ... ...ï¼ˆä¸€å¤§å †ä»£ç è¿‡åï¼‰

    # è¯»è€…å¿ƒç†ï¼šè¿™é‡Œå°±ç»“æŸäº†ï¼Ÿä¹‹å‰çš„ fancy_vars å»å“ªäº†ï¼Ÿè¢«çŒ«åƒäº†å—ï¼Ÿ
    return result
```

æ‰€ä»¥ï¼Œè¯·æ‰“å¼€ IDE çš„æ™ºèƒ½æç¤ºï¼ŒåŠæ—¶æ¸…ç†æ‰é‚£äº›å®šä¹‰äº†ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨çš„å˜é‡å§ã€‚

### 7. å®šä¹‰ä¸´æ—¶å˜é‡æå‡å¯è¯»æ€§

æœ‰æ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç é‡Œä¼šå‡ºç°ä¸€äº›å¤æ‚çš„è¡¨è¾¾å¼ï¼Œåƒä¸‹é¢è¿™æ ·ï¼š

```python
# ä¸ºæ‰€æœ‰æ€§åˆ«ä¸ºå¥³æ€§ï¼Œæˆ–è€…çº§åˆ«å¤§äº 3 çš„æ´»è·ƒç”¨æˆ·å‘æ”¾ 10000 ä¸ªé‡‘å¸
if user.is_active and (user.sex == 'female' or user.level > 3):
    user.add_coins(10000)
    return
```

çœ‹è§ `if` åé¢é‚£ä¸€é•¿ä¸²äº†å—ï¼Ÿæœ‰ç‚¹éš¾è¯»å¯¹ä¸å¯¹ï¼Ÿä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠå®ƒèµ‹å€¼æˆä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œ
å°±èƒ½ç»™è¯»è€…ä¸€ä¸ªå¿ƒç†ç¼“å†²ï¼Œæé«˜å¯è¯»æ€§ï¼š

```plain
# ä¸ºæ‰€æœ‰æ€§åˆ«ä¸ºå¥³æ€§ï¼Œæˆ–è€…çº§åˆ«å¤§äº 3 çš„æ´»è·ƒç”¨æˆ·å‘æ”¾ 10000 ä¸ªé‡‘å¸
user_is_eligible = user.is_active and (user.sex == 'female' or user.level > 3):

if user_is_eligible:
    user.add_coins(10000)
    return
```

å®šä¹‰ä¸´æ—¶å˜é‡å¯ä»¥æé«˜å¯è¯»æ€§ã€‚ä½†æœ‰æ—¶ï¼ŒæŠŠä¸å¿…è¦çš„ä¸œè¥¿èµ‹å€¼æˆä¸´æ—¶å˜é‡åè€Œä¼šè®©ä»£ç æ˜¾å¾—å•°å—¦ï¼š

```python
def get_best_trip_by_user_id(user_id):

    # å¿ƒç†æ´»åŠ¨ï¼šã€å—¯ï¼Œè¿™ä¸ªå€¼æœªæ¥è¯´ä¸å®šä¼šä¿®æ”¹/äºŒæ¬¡ä½¿ç”¨ã€ï¼Œè®©æˆ‘ä»¬å…ˆæŠŠå®ƒå®šä¹‰æˆå˜é‡å§ï¼
    user = get_user(user_id)
    trip = get_best_trip(user_id)
    result = {
        'user': user,
        'trip': trip
    }
    return result
```

å…¶å®ï¼Œä½ æ‰€æƒ³çš„ã€æœªæ¥ã€æ°¸è¿œä¸ä¼šæ¥ï¼Œè¿™æ®µä»£ç é‡Œçš„ä¸‰ä¸ªä¸´æ—¶å˜é‡å®Œå…¨å¯ä»¥å»æ‰ï¼Œå˜æˆè¿™æ ·ï¼š

```python
def get_best_trip_by_user_id(user_id):
    return {
        'user': get_user(user_id),
        'trip': get_best_trip(user_id)
    }
```

æ²¡å¿…è¦ä¸ºäº†é‚£äº›å¯èƒ½å‡ºç°çš„å˜åŠ¨ï¼Œç‰ºç‰²ä»£ç å½“å‰çš„å¯è¯»æ€§ã€‚å¦‚æœä»¥åæœ‰å®šä¹‰å˜é‡çš„éœ€æ±‚ï¼Œé‚£å°±ä»¥åå†åŠ å§ã€‚

## ç»“è¯­

ç¢ç¢å¿µäº†ä¸€å¤§å †ï¼Œä¸çŸ¥é“æœ‰å¤šå°‘äººèƒ½å¤ŸåšæŒåˆ°æœ€åã€‚å˜é‡ä½œä¸ºç¨‹åºè¯­è¨€çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå€¼å¾—æˆ‘ä»¬åœ¨å®šä¹‰å’Œä½¿ç”¨å®ƒæ—¶ï¼Œå¤šèŠ±ä¸€ä¸ç‚¹æ—¶é—´æ€è€ƒä¸€ä¸‹ï¼Œé‚£æ ·ä¼šè®©ä½ çš„ä»£ç å˜å¾—æ›´ä¼˜ç§€ã€‚

è¿™æ˜¯ã€Python å·¥åŒ ã€ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ï¼Œä¸çŸ¥é“çœ‹å®Œæ–‡ç« çš„ä½ ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæƒ³åæ§½çš„ï¼Ÿè¯·ç•™è¨€å‘Šè¯‰æˆ‘å§ã€‚

[>>>ä¸‹ä¸€ç¯‡ã€2.ç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§ã€‘](./2-if-else-block-secrets)

> æ–‡ç« æ›´æ–°è®°å½•ï¼š
> 
> - 2018.04.09ï¼šæ ¹æ® @onlyice çš„å»ºè®®ï¼Œæ·»åŠ äº† namedtuple éƒ¨åˆ†

## ç›¸å…³é“¾æ¥
[unbug.github.io](https://unbug.github.io/codelf/)