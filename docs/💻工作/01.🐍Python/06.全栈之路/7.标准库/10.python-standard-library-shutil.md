---
title: Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ shutil æ¨¡å—

tags: 
  - ç¼–ç 
  - é¢å‘å¯¹è±¡
top: 10
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - æ ‡å‡†åº“
date: 2020-05-23 18:21:46
permalink: /pages/9e8e4c/
---

> The shutil module offers a number of high-level operations on files and collections of files. In particular, functions are provided which support file copying and removal. For operations on individual files, see also the os module.

å¯¹æ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€å‹ç¼©åŒ…è¿›è¡Œå¤„ç†çš„æ¨¡å—ã€‚

å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.python.org/3.5/library/shutil.html

## æ–‡ä»¶å’Œç›®å½•æ“ä½œ

**shutil.copyfileobj(fsrc, fdst[, length])**

å°†æ–‡ä»¶å†…å®¹æ‹·è´åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­

```python
>>> import shutil
# å¾ªç¯è¯»å–old.txtæ–‡ä»¶å†…å®¹å¹¶å†™å…¥åˆ°new.txtæ–‡ä»¶å½“ä¸­
>>> shutil.copyfileobj(open('old.txt','r'), open('new.txt', 'w'))
>>> import os
# æŸ¥çœ‹å¤åˆ¶è¿‡å»çš„æ–‡ä»¶å†…å®¹
>>> os.system("cat old.txt new.txt")
old
old
0
```

**shutil.copyfile(src, dst, *, follow_symlinks=True)**

æ‹·è´æ•´ä¸ªæ–‡ä»¶ï¼Œæ²¡æœ‰ç¬¬äºŒä¸ªæ–‡ä»¶å°±åˆ›å»ºï¼Œæœ‰å°±è¦†ç›–

```python
>>> os.system("cat old.txt new.txt")
old
new
0
>>> shutil.copyfile('old.txt', 'new.txt')
# æŠŠç¬¬äºŒä¸ªæ–‡ä»¶å†…å®¹ç»™è¦†ç›–äº†
>>> os.system("cat old.txt new.txt")
old
old
0
```

**shutil.copymode(src, dst, *, follow_symlinks=True)**

ä»…æ‹·è´æ–‡ä»¶æƒé™ï¼Œæ–‡ä»¶çš„å†…å®¹ã€ç»„ã€ç”¨æˆ·å‡ä¸å˜

```python
>>> os.system("ls -l old.txt new.txt")
-rw-rw-rw- 1 ansheng ansheng 4 5æœˆ  26 15:54 new.txt
-rw-rw-r-- 1 ansheng ansheng 4 5æœˆ  26 15:52 old.txt
0
>>> shutil.copymode('old.txt', 'new.txt')
# æ–‡ä»¶æƒé™éƒ½å˜æˆ644äº†
>>> os.system("ls -l old.txt new.txt")
-rw-rw-r-- 1 ansheng ansheng 4 5æœˆ  26 15:54 new.txt
-rw-rw-r-- 1 ansheng ansheng 4 5æœˆ  26 15:52 old.txt
0
```

**shutil.copystat(src, dst, *, follow_symlinks=True)**

æ‹·è´æ–‡ä»¶çŠ¶æ€çš„ä¿¡æ¯ï¼Œæ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œä¸ copy æ”¹åŠ¨æ—¶é—´

```python
>>> os.system("stat old.txt new.txt")
  æ–‡ä»¶ï¼š'old.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835014     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:53:09.813612241 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:52:54.830640166 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:52:54.830640166 +0800
åˆ›å»ºæ—¶é—´ï¼š-
  æ–‡ä»¶ï¼š'new.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835024     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:56:22.540041783 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:54:24.244922722 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:55:38.353967649 +0800
åˆ›å»ºæ—¶é—´ï¼š-
0
>>> shutil.copystat('old.txt', 'new.txt')
>>> os.system("stat old.txt new.txt")
  æ–‡ä»¶ï¼š'old.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835014     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:53:09.813612241 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:52:54.830640166 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:52:54.830640166 +0800
åˆ›å»ºæ—¶é—´ï¼š-
  æ–‡ä»¶ï¼š'new.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835024     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:53:09.813612000 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:52:54.830640000 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:56:48.765143115 +0800
åˆ›å»ºæ—¶é—´ï¼š-
0
```

**shutil.copy(src, dst, *, follow_symlinks=True)**

æ‹·è´æ–‡ä»¶å’ŒçŠ¶æ€ä¿¡æ¯ï¼ŒåŒæ ·ä¸ copy æ”¹åŠ¨æ—¶é—´

```python
>>> os.system("stat old.txt new.txt")
  æ–‡ä»¶ï¼š'old.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835014     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:53:09.813612241 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:52:54.830640166 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:52:54.830640166 +0800
åˆ›å»ºæ—¶é—´ï¼š-
  æ–‡ä»¶ï¼š'new.txt'
  å¤§å°ï¼š0               å—ï¼š0          IO å—ï¼š4096   æ™®é€šç©ºæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835023     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:57:53.448632439 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:57:53.448632439 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:57:53.448632439 +0800
åˆ›å»ºæ—¶é—´ï¼š-
0
>>> shutil.copy2('old.txt', 'new.txt')
>>> os.system("stat old.txt new.txt")
  æ–‡ä»¶ï¼š'old.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835014     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:53:09.813612241 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:52:54.830640166 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:52:54.830640166 +0800
åˆ›å»ºæ—¶é—´ï¼š-
  æ–‡ä»¶ï¼š'new.txt'
  å¤§å°ï¼š4               å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
è®¾å¤‡ï¼š801h/2049d        Inodeï¼š1835023     ç¡¬é“¾æ¥ï¼š1
æƒé™ï¼š(0664/-rw-rw-r--)  Uidï¼š( 1000/ ansheng)   Gidï¼š( 1000/ ansheng)
æœ€è¿‘è®¿é—®ï¼š2016-05-26 15:53:09.813612000 +0800
æœ€è¿‘æ›´æ”¹ï¼š2016-05-26 15:52:54.830640000 +0800
æœ€è¿‘æ”¹åŠ¨ï¼š2016-05-26 15:58:07.938760974 +0800
åˆ›å»ºæ—¶é—´ï¼š-
0
```

**shutil.ignore_patterns(*patterns)**

This factory function creates a function that can be used as a callable for copytree()â€˜s ignore argument, ignoring files and directories that match one of the glob-style patterns provided. See the example below.

**shutil.copytree(src, dst, symlinks=False, ignore=None, copy_function=copy2, ignore_dangling_symlinks=False)**

é€’å½’çš„å»æ‹·è´æ–‡ä»¶å¤¹



```python
>>> os.system("tree folder1")
folder1
â”œâ”€â”€ dir
â”œâ”€â”€ file.txt
â”œâ”€â”€ sc.pyc
â”œâ”€â”€ tmp
â””â”€â”€ vgauthsvclog.txt.0 -> /tmp/vgauthsvclog.txt.0

2 directories, 3 files
0
# folder2ç›®å½•å¿…é¡»ä¸å­˜åœ¨ï¼Œsymlinks=Trueåªcopyé“¾æ¥æ–‡ä»¶ï¼Œå¦‚æœç­‰äºFalseå°±copyæºæ–‡ä»¶ï¼Œignoreç­‰äºä¸copyçš„æ–‡ä»¶æˆ–è€…ç›®å½•
>>> shutil.copytree('folder1', 'folder2', symlinks=False, ignore=shutil.ignore_patterns('*.pyc', 'tmp*'))
>>> os.system("tree folder2")
folder2
â”œâ”€â”€ dir
â”œâ”€â”€ file.txt
â””â”€â”€ vgauthsvclog.txt.0

1 directory, 2 files
0
```

**shutil.rmtree(path, ignore_errors=False, onerror=None)**

é€’å½’çš„å»åˆ é™¤æ–‡ä»¶

```python
>>> os.system("ls -d folder2")
folder2
0
>>> shutil.rmtree('folder2')
>>> os.system("ls -d folder2")
ls: æ— æ³•è®¿é—®'folder2': æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
512
```

**shutil.move(src, dst, copy_function=copy2)**

é€’å½’çš„å»ç§»åŠ¨æ–‡ä»¶ï¼Œå®ƒç±»ä¼¼ mv å‘½ä»¤ï¼Œå…¶å®å°±æ˜¯é‡å‘½åã€‚

```python
>>> os.system("ls -ld folder1")
drwxrwxr-x 4 ansheng ansheng 4096 5æœˆ  26 16:09 folder1
0
>>> shutil.move('folder1', 'folder3')
>>> os.system("ls -ld folder1")
ls: æ— æ³•è®¿é—®'folder1': æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
512
>>> os.system("ls -ld folder3")
drwxrwxr-x 4 ansheng ansheng 4096 5æœˆ  26 16:09 folder3
0
```

**shutil.make_archive(base_name, format[, root_dir[, base_dir[, verbose[, dry_run[, owner[, group[, logger]]]]]]])**

Create an archive file (such as zip or tar) and return its name.


```python
>>> os.system("ls -dl folder3")
drwxrwxr-x 4 ansheng ansheng 4096 5æœˆ  26 16:21 folder3
0
# /home/ansheng/folder3æ˜¯ä¿å­˜çš„æ–‡ä»¶ï¼Œgztaræ˜¯åç¼€åï¼Œ/home/ansheng/folder3æ˜¯è¦æ‰“åŒ…çš„è·¯å¾„
>>> shutil.make_archive("/home/ansheng/folder3", 'gztar', root_dir='/home/ansheng/folder3')
# è¿”å›æ–‡ä»¶æ‰“åŒ…æ”¾åœ¨é‚£å„¿äº†
'/home/ansheng/folder3.tar.gz'
>>> os.system("ls -dl /home/ansheng/folder3.tar.gz")
-rw-rw-r-- 1 ansheng ansheng 263 5æœˆ  26 16:22 /home/ansheng/folder3.tar.gz
0
```

å¯é€‰å‚æ•°å¦‚ä¸‹ï¼š

|å‚æ•°|è¯´æ˜|
|:--:|:--|
|base_name|å‹ç¼©åŒ…çš„æ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯å‹ç¼©åŒ…çš„è·¯å¾„ã€‚|
|format|å‹ç¼©åŒ…ç§ç±»ï¼Œâ€œzipâ€, â€œtarâ€, â€œbztarâ€ï¼Œâ€œgztarâ€|
|root_dir|è¦å‹ç¼©çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆé»˜è®¤å½“å‰ç›®å½•ï¼‰|
|owner|ç”¨æˆ·ï¼Œé»˜è®¤å½“å‰ç”¨æˆ·|
|group|ç»„ï¼Œé»˜è®¤å½“å‰ç»„|

shutil å¯¹å‹ç¼©åŒ…çš„å¤„ç†æ˜¯è°ƒç”¨ ZipFile å’Œ TarFile ä¸¤ä¸ªæ¨¡å—æ¥è¿›è¡Œçš„ï¼Œåé¢ä¼šä»‹ç»è¿™ä¸¤ä¸ªæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•ã€‚