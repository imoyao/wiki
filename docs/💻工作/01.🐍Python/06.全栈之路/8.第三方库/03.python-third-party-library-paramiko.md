---
title: Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ Paramiko æ¨¡å—

tags: 
  - ç¼–ç 
  - é¢å‘å¯¹è±¡
top: 2
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - ç¬¬ä¸‰æ–¹åº“
date: 2020-05-23 18:21:46
permalink: /pages/c9d278/
---
# Python æ ‡å‡†åº“ç³»åˆ—ä¹‹ Paramiko æ¨¡å—

`Paramiko`æ˜¯ä¸€ä¸ª Python å®æ–½`SSHv2`çš„åè®®ï¼Œæä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„åŠŸèƒ½ã€‚è™½ç„¶å®ƒåˆ©ç”¨ä¸€ä¸ª Python C æ‰©å±•ä½çº§åˆ«åŠ å¯†çš„ paramiko æœ¬èº«å°±æ˜¯å›´ç»• SSH è”ç½‘æ¦‚å¿µçš„çº¯ Python æ¥å£ã€‚

Paramiko å®˜ç½‘ï¼šhttp://www.paramiko.org/

## å®‰è£… Paramiko

```bash
pip3 install paramiko
```

å®‰è£…ä¹‹åè¿›å…¥ python è§£é‡Šå™¨å¯¼å…¥æ¨¡å—ï¼Œå¦‚æœå¯¼å…¥æˆåŠŸåˆ™å®‰è£…æˆåŠŸï¼Œå¦åˆ™å®‰è£…å¤±è´¥.

```python
C:\Users\Administrator>python
Python 3.5.2 (v3.5.2:4def2a2901a5, Jun 25 2016, 22:18:55) [MSC v.1900 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> import paramiko
```

##  ä½¿ç”¨ç”¨æˆ·åä¸å¯†ç çš„æ–¹å¼è¿æ¥

```python
# å¯¼å…¥paramikoæ¨¡å—
>>> import paramiko
# åˆ›å»ºSSHClientå¯¹è±¡
>>> ssh = paramiko.SSHClient()
# å¦‚æœæ˜¯ä¸€ä¸ªæ–°ä¸»æœºè¿æ¥ï¼Œä¼šå‡ºç°yes/noï¼ŒAutoAddPolicyè‡ªåŠ¨å¡«å†™yesçš„
>>> ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
# è¿æ¥æœåŠ¡å™¨
>>> ssh.connect(hostname='192.168.56.100', port=22, username='root', password='123456')
# æ‰§è¡Œå‘½ä»¤
>>> stdin, stdout, stderr = ssh.exec_command('df -h')
# è·å–æ­£ç¡®çš„è¾“å‡º
>>> result = stdout.read()
# å…³é—­è¿æ¥
>>> ssh.close()
# è·å–åˆ°çš„å€¼
>>> result
b'Filesystem      Size  Used Avail Use% Mounted on\n/dev/sda3        48G  3.3G   45G   7% /\ndevtmpfs        984M     0  984M   0% /dev\ntmpfs           993M     0  993M   0% /dev/shm\ntmpfs           993M  8.9M  984M   1% /run\ntmpfs           993M     0  993M   0% /sys/fs/cgroup\n/dev/sda1       197M  137M   60M  70% /boot\ntmpfs           199M     0  199M   0% /run/user/0\n'
```

## ä½¿ç”¨å¯†é’¥çš„æ–¹å¼è¿æ¥

åœ¨ä½¿ç”¨å¯†é’¥çš„æ–¹é¢è¿æ¥ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆåš`ssh-key`è®¤è¯ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š

```bash
[root@linux-node1 ~]# ssh-keygen -t rsa -f ~/.ssh/id_rsa -P ''
[root@linux-node1 ~]# cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys
[root@linux-node1 ~]# chmod 600 ~/.ssh/authorized_keys
```
ç„¶åä¸‹è½½`/root/.ssh/id_rsa`ä¸‹è½½ä¸‹æ¥ï¼Œå¤åˆ¶åˆ°`E:\python-intensive-training\`ç›®å½•ç³»ï¼Œä¸‹é¢æ˜¯åœ¨`windows`ä¸‹ä½¿ç”¨`paramiko`è¿æ¥è„šæœ¬å¦‚ä¸‹
```python
#!/use/bin/env python
# _*_ coding: utf-8 _*_

import paramiko

# æŒ‡å®šå¯†é’¥çš„æ–‡ä»¶
private_key = paramiko.RSAKey.from_private_key_file('E:\python-intensive-training\id_rsa')

# åˆ›å»ºSSHå¯¹è±¡
ssh = paramiko.SSHClient()

# å…è®¸è¿æ¥ä¸åœ¨know_hostsæ–‡ä»¶ä¸­çš„ä¸»æœºï¼Œè¦ä¸ç„¶ä¸€å°æ–°æœºå™¨å»è¿æ¥å®ƒçš„æ—¶å€™ä¼šè®©ä½ è¾“å…¥yes/no
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

# è¿æ¥æœåŠ¡å™¨
ssh.connect(hostname='192.168.56.100', port=22, username='root', pkey=private_key)

# æ‰§è¡Œå‘½ä»¤
stdin, stdout, stderr = ssh.exec_command('df -h')
"""
stdinï¼šæ ‡å‡†è¾“å…¥
stdoutï¼šæ ‡å‡†è¾“å‡º
stderrï¼šé”™è¯¯è¾“å‡º
"""

# è·å–å‘½ä»¤æ‰§è¡Œçš„æ­£ç¡®ç»“æœ
result = stdout.read()

# å…³é—­è¿æ¥
ssh.close()

# è¾“å‡ºæ‰§è¡Œç»“æœ
print(str(result, encoding='utf-8'))
```

## æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½

```python
#!/usr/bin/python

import paramiko

t = paramiko.Transport(('192.168.56.100', 22))

t.connect(username="root", password="123456")

sftp = paramiko.SFTPClient.from_transport(t)

# è¿œç¨‹ç›®å½•
remotepath = '/tmp/id_rsa'

# æœ¬åœ°æ–‡ä»¶
localpath = 'id_rsa'

# ä¸Šä¼ æ–‡ä»¶
sftp.put(localpath, remotepath)

# ä¸‹è½½æ–‡ä»¶
# sftp.get(remotepath, localpath)

# å…³é—­è¿æ¥
t.close()
```
