---
title: Python å…¨æ ˆä¹‹è·¯ç³»åˆ—ä¹‹è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨

tags: 
  - ç¼–ç 
  - è¿­ä»£å™¨
  - ç”Ÿæˆå™¨
top: 6
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - è¿›é˜¶ç¯‡
date: 2020-05-23 18:21:46
permalink: /pages/887542/
---

## ç”Ÿæˆå™¨

ä»…ä»…æ‹¥æœ‰ç”ŸæˆæŸç§ä¸œè¥¿çš„èƒ½åŠ›ï¼Œå¦‚æœä¸ç”¨`__next__`æ–¹æ³•æ˜¯è·å–ä¸åˆ°å€¼çš„ã€‚

åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°

```python
>>> def scq():
...    print("11")
       # å½“å‡½æ•°ä»£ç å—ä¸­é‡åˆ°yieldå…³é”®å­—çš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°
...    yield 1
...    print("22")
...    yield 2
...    print("33")
...    yield 3
...
```

æŠŠç”Ÿæˆå™¨èµ‹å€¼ç»™ä¸€ä¸ªå¯¹è±¡

```python
>>> r = scq()
```

æŸ¥çœ‹ r çš„è‹å‰§ç±»å‹å¹¶ä¸”è¾“å‡º r çš„å€¼

```python
>>> print(type(r),r)
<class 'generator'> <generator object scq at 0x000001F117D8DF10> 
```

å½“æ‰§è¡Œç”Ÿæˆå™¨çš„`__next__`çš„æ—¶å€™ï¼Œä»£ç ä¼šæŒ‰ç…§é¡ºåºå»æ‰§è¡Œï¼Œå½“æ‰§è¡Œåˆ°`yield`æ—¶ä¼šè¿”å›å¹¶æå‡ºï¼Œ`yield`åé¢çš„å€¼å°±æ˜¯è¿”å›å€¼ï¼Œç„¶åè®°å½•ä»£ç æ‰§è¡Œçš„ä½ç½®ï¼Œå¹¶é€€å‡º

```python
>>> ret = r.__next__()
11
```
ç¬¬äºŒæ¬¡æ‰§è¡Œçš„æ—¶å€™ä¼šæ ¹æ®ä¸Šæ¬¡ä»£ç æ‰§è¡Œçš„ä½ç½®ç»§ç»­å¾€ä¸‹æ‰§è¡Œ

```python
>>> ret = r.__next__()
22
>>> ret = r.__next__()
33
```

å¦‚æœ`__next__`è·å–ä¸åˆ°å€¼çš„æ—¶å€™å°±ä¼šæŠ¥`StopIteration`é”™è¯¯

```python
>>> ret = r.__next__()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
StopIteration
```

åˆ©ç”¨ç”Ÿæˆå™¨åˆ›å»ºä¸€ä¸ªç±»ä¼¼`xrange`çš„åŠŸèƒ½

ä»£ç 

```python
# åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œå‡½æ•°åæ˜¯rangeï¼Œnæ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿæ˜¯è¾“å‡ºçš„æ•°çš„æœ€å¤§å€¼
def range(n):
    # é»˜è®¤ä»0å¼€å§‹
    start = 0
    # è¿›å…¥whileå¾ªç¯ï¼Œå¦‚æœæœ€å°å€¼å°äºæœ€å¤§å€¼å°±è¿›å…¥å¾ªç¯
    while start < n:
        # ç¬¬ä¸€æ¬¡è¿”å›startï¼Œä¸‹é¢ä»£ç ä¸æ‰§è¡Œ
        yield start
        # ç¬¬äºŒæ¬¡è¿›æ¥çš„æ—¶å€™start = start + 1ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
        start += 1

# åœæ­¢çš„å‚æ•°ä¸º5
obj = range(5)
# ç¬¬ä¸€ä¸ªæ•°èµ‹å€¼ç»™n1
n1 = obj.__next__()
# ç¬¬äºŒä¸ªæ•°èµ‹å€¼ç»™n2
n2 = obj.__next__()
# ç¬¬ä¸‰ä¸ªæ•°èµ‹å€¼ç»™n3
n3 = obj.__next__()
# ç¬¬å››ä¸ªæ•°èµ‹å€¼ç»™n4
n4 = obj.__next__()
# ç¬¬äº”ä¸ªæ•°èµ‹å€¼ç»™n5
n5 = obj.__next__()

# è¾“å‡ºè¿™äº”ä¸ªæ•°çš„å€¼
print(n1,n2,n3,n4,n5)
```

æ‰§è¡Œç»“æœ

```python
C:\Python35\python.exe F:/Python_code/sublime/Week5/Day03/s1.py
0 1 2 3 4

Process finished with exit code 0
```

## è¿­ä»£å™¨

å…·æœ‰è®¿é—®ç”Ÿæˆå™¨çš„èƒ½åŠ›ï¼Œå¯ä»¥è®¿é—®åˆ°ç”Ÿæˆå™¨çš„å€¼ï¼Œç±»ä¼¼äºç”Ÿæˆå™¨çš„`__next__`æ–¹æ³•ï¼Œä¸€ä¸ªå€¼ä¸€ä¸ªå€¼åœ°å»è¿­ä»£ï¼Œåªèƒ½å¤ŸæŒ‰ç…§é¡ºåºçš„å»æŸ¥æ‰¾ã€‚

**ç‰¹ç‚¹ï¼š**

1. è®¿é—®è€…ä¸éœ€è¦å…³å¿ƒè¿­ä»£å™¨å†…éƒ¨çš„ç»“æ„ï¼Œä»…éœ€é€šè¿‡ next()æ–¹æ³•ä¸æ–­å»å–ä¸‹ä¸€ä¸ªå†…å®¹
2. ä¸èƒ½éšæœºè®¿é—®é›†åˆä¸­çš„æŸä¸ªå€¼ ï¼Œåªèƒ½ä»å¤´åˆ°å°¾ä¾æ¬¡è®¿é—®
3. è®¿é—®åˆ°ä¸€åŠæ—¶ä¸èƒ½å¾€å›é€€
4. ä¾¿äºå¾ªç¯æ¯”è¾ƒå¤§çš„æ•°æ®é›†åˆï¼ŒèŠ‚çœå†…å­˜

ä¼˜åŒ–ä¸Šé¢`range`æˆ–`xrange`çš„ç”Ÿæˆå™¨

```python
def irange(start, stop, step=1):
    while start != stop:
        yield start
        start += step
    else:
        raise StopIteration


for n in irange(1, 10):
    """forå¾ªç¯åªè¦é‡åˆ°StopIterationå°±ä¼šåœæ­¢"""
    print(n)

ret = irange(1, 20)
print(ret)  # è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œç›¸å½“äºåªåœ¨å†…å­˜ä¸­åˆ›å»ºäº†ä¸€ä¸ªå€¼
print(list(ret))  # å¦‚æœæƒ³è¦å¾—åˆ°å…¨éƒ¨çš„å€¼ï¼Œå˜æˆåˆ—è¡¨å°±å¯ä»¥
```

```python
/Library/Frameworks/Python.framework/Versions/3.5/bin/python3.5 /Users/ansheng/MyPythonCode/hello.py
1
2
3
4
5
6
7
8
9
<generator object irange at 0x1021df7d8>
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]

Process finished with exit code 0
```
