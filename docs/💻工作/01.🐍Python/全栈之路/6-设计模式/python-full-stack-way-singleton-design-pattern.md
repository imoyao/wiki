---
title: Python å…¨æ ˆä¹‹è·¯ç³»åˆ—ä¹‹å•ä¾‹è®¾è®¡æ¨¡å¼

tags: 
  - ç¼–ç 
  - å•ä¾‹æ¨¡å¼
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - 6-è®¾è®¡æ¨¡å¼
date: 2020-05-23 18:21:46
permalink: /pages/ea281b/
---

## è®¾è®¡æ¨¡å¼ä»‹ç»

è®¾è®¡æ¨¡å¼æ˜¯ç»è¿‡æ€»ç»“ã€ä¼˜åŒ–çš„ï¼Œå¯¹æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°çš„ä¸€äº›ç¼–ç¨‹é—®é¢˜çš„å¯é‡ç”¨è§£å†³æ–¹æ¡ˆã€‚ä¸€ä¸ªè®¾è®¡æ¨¡å¼å¹¶ä¸åƒä¸€ä¸ªç±»æˆ–ä¸€ä¸ªåº“é‚£æ ·èƒ½å¤Ÿç›´æ¥ä½œç”¨äºæˆ‘ä»¬çš„ä»£ç ã€‚åä¹‹ï¼Œè®¾è®¡æ¨¡å¼æ›´ä¸ºé«˜çº§ï¼Œå®ƒæ˜¯ä¸€ç§å¿…é¡»åœ¨ç‰¹å®šæƒ…å½¢ä¸‹å®ç°çš„ä¸€ç§æ–¹æ³•æ¨¡æ¿ã€‚è®¾è®¡æ¨¡å¼ä¸ä¼šç»‘å®šå…·ä½“çš„ç¼–ç¨‹è¯­è¨€ã€‚ä¸€ä¸ªå¥½çš„è®¾è®¡æ¨¡å¼åº”è¯¥èƒ½å¤Ÿç”¨å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€å®ç°(å¦‚æœåšä¸åˆ°å…¨éƒ¨çš„è¯ï¼Œå…·ä½“å–å†³äºè¯­è¨€ç‰¹æ€§)ã€‚æœ€ä¸ºé‡è¦çš„æ˜¯ï¼Œè®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œå¦‚æœè®¾è®¡æ¨¡å¼è¢«ç”¨åœ¨ä¸æ°å½“çš„æƒ…å½¢ä¸‹å°†ä¼šé€ æˆç¾éš¾ï¼Œè¿›è€Œå¸¦æ¥æ— ç©·çš„éº»çƒ¦ã€‚ç„¶è€Œå¦‚æœè®¾è®¡æ¨¡å¼åœ¨æ­£ç¡®çš„æ—¶é—´è¢«ç”¨åœ¨æ­£ç¡®åœ°åœ°æ–¹ï¼Œå®ƒå°†æ˜¯ä½ çš„æ•‘æ˜Ÿã€‚

èµ·åˆï¼Œä½ ä¼šè®¤ä¸ºâ€œæ¨¡å¼â€å°±æ˜¯ä¸ºäº†è§£å†³ä¸€ç±»ç‰¹å®šé—®é¢˜è€Œç‰¹åˆ«æƒ³å‡ºæ¥çš„æ˜æ™ºä¹‹ä¸¾ã€‚è¯´çš„æ²¡é”™ï¼Œçœ‹èµ·æ¥çš„ç¡®æ˜¯é€šè¿‡å¾ˆå¤šäººä¸€èµ·å·¥ä½œï¼Œä»ä¸åŒçš„è§’åº¦çœ‹å¾…é—®é¢˜è¿›è€Œå½¢æˆçš„ä¸€ä¸ªæœ€é€šç”¨ã€æœ€çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚ä¹Ÿè®¸è¿™äº›é—®é¢˜ä½ æ›¾ç»è§è¿‡æˆ–æ˜¯æ›¾ç»è§£å†³è¿‡ï¼Œä½†æ˜¯ä½ çš„è§£å†³æ–¹æ¡ˆå¾ˆå¯èƒ½æ²¡æœ‰æ¨¡å¼è¿™ä¹ˆå®Œå¤‡ã€‚

## å•ä¾‹æ¨¡å¼å­˜åœ¨æ„ä¹‰

**æ¨¡å¼ç‰¹ç‚¹ï¼š**

ä¿è¯ç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚

1. è®¾è®¡æ¨¡å¼åœ¨æ‰€æœ‰è¯­è¨€å†…éƒ½æ˜¯é€šç”¨çš„
2. è®¾è®¡æ¨¡å¼å­˜åœ¨çš„æ„ä¹‰å°±æ˜¯è®©ä»£ç è®¾è®¡ç»“æ„è®¾è®¡çš„æ›´å¥½

## å®ä¾‹ä»£ç 

```Python
#!/usr/bin/env python
# -*- coding:utf-8 -*-

from wsgiref.simple_server import make_server

class ConnectionPool:

    __instance = None

    def __init__(self):
        self.ip = "1.1.1.1"
        self.port = 3306
        self.pwd = "123123"
        self.username = 'xxxx'
        # å»è¿æ¥
        self.conn_list = [1,2,3,4,5,6,7,8,9, 10]

    @staticmethod
    def get_instance():
        if ConnectionPool.__instance:
            return ConnectionPool.__instance
        else:
            # åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡èµ‹å€¼ç»™é™æ€å­—æ®µ __instance
            ConnectionPool.__instance = ConnectionPool()
            return ConnectionPool.__instance

    def get_connection(self):
        # è·å–è¿æ¥
        import random
        r = random.randrange(1,11)
        return r

def index():
    # p = ConnectionPool()
    # print(p)
    p = ConnectionPool.get_instance()
    conn = p.get_connection()
    return "iiiiiii" + str(conn)

def news():
    return 'nnnnnnn'

def RunServer(environ, start_response):
    start_response(status='200 OK', headers=[('Content-Type', 'text/html')])

    url = environ['PATH_INFO']
    if url.endswith('index'):
        ret = index()
        return ret
    elif url.endswith('news'):
        ret = news()
        return ret
    else:
        return "404"

if __name__ == '__main__':
    httpd = make_server('', 80, RunServer)
    print("Serving HTTP on port 80...")
    httpd.serve_forever()
```