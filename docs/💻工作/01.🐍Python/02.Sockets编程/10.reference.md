---
title: å¼•ç”¨

tags: 
  - sockets
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - ç½‘ç»œç¼–ç¨‹
date: 2020-10-10 11:16:53
permalink: /socket/6597b4/
---

è¿™ä¸€èŠ‚ä¸»è¦ç”¨æ¥å¼•ç”¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯å’Œå¤–éƒ¨èµ„æºé“¾æ¥

## Python æ–‡æ¡£

* Pythonâ€™s [socket module](https://docs.python.org/3/library/socket.html)
* Pythonâ€™s [Socket Programming HOWTO](https://docs.python.org/3/howto/sockets.html#socket-howto)

## é”™è¯¯ä¿¡æ¯

ä¸‹é¢è¿™æ®µè¯æ¥è‡ª python çš„ socket æ¨¡å—æ–‡æ¡£ï¼š

> æ‰€æœ‰çš„é”™è¯¯éƒ½ä¼šè§¦å‘å¼‚å¸¸ï¼Œåƒæ— æ•ˆå‚æ•°ç±»å‹å’Œå†…å­˜ä¸è¶³çš„å¸¸è§å¼‚å¸¸å¯ä»¥è¢«æŠ›å‡ºï¼›ä» Python 3.3 å¼€å§‹ï¼Œä¸ socket æˆ–åœ°å€è¯­ä¹‰ç›¸å…³çš„é”™è¯¯ä¼šå¼•å‘ OSError æˆ–å…¶å­ç±»ä¹‹ä¸€çš„å¼‚å¸¸ [å¼•ç”¨](https://docs.python.org/3/library/socket.html)

å¼‚å¸¸                   | `errno` å¸¸é‡ | è¯´æ˜
---                     | ---          | ---
BlockingIOError        | EWOULDBLOCK  | èµ„æºæš‚ä¸å¯ç”¨ï¼Œæ¯”å¦‚åœ¨éé˜»å¡æ¨¡å¼ä¸‹è°ƒç”¨ `send()` æ–¹æ³•ï¼Œå¯¹æ–¹å¤ªç¹å¿™é¢æ²¡æœ‰è¯»å–ï¼Œå‘é€é˜Ÿåˆ—æ»¡äº†ï¼Œæˆ–è€…ç½‘ç»œæœ‰é—®é¢˜
OSError                | EADDRINUSE   | ç«¯å£è¢«æˆ˜ç”¨ï¼Œç¡®ä¿æ²¡æœ‰å…¶å®ƒçš„è¿›ç¨‹ä¸å½“å‰çš„ç¨‹åºè¿è¡Œåœ¨åŒä¸€åœ°å€ / ç«¯å£ä¸Šï¼Œä½ çš„æœåŠ¡å™¨è®¾ç½®äº† `SO_REUSEADDR` å‚æ•°
ConnectionResetError   | ECONNRESET   | è¿æ¥è¢«é‡ç½®ï¼Œè¿œç«¯çš„è¿›ç¨‹å´©æºƒï¼Œæˆ–è€… socket æ„å¤–å…³é—­ï¼Œæˆ–æ˜¯æœ‰é˜²ç«å¢™æˆ–é“¾è·¯ä¸Šçš„è®¾é…æœ‰é—®é¢˜
TimeoutError           | ETIMEDOUT    | æ“ä½œè¶…æ—¶ï¼Œå¯¹æ–¹æ²¡æœ‰å“åº”
ConnectionRefusedError | ECONNREFUSED | è¿æ¥è¢«æ‹’ç»ï¼Œæ²¡æœ‰ç¨‹åºç›‘å¬æŒ‡å®šçš„ç«¯å£

## socket åœ°å€æ—

`socket.AF_INET` å’Œ `socket.AF_INET6` æ˜¯ `socket.socket()` æ–¹æ³•è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºåœ°å€åè®®æ—ï¼ŒAPI ä½¿ç”¨äº†ä¸€ä¸ªæœŸæœ›ä¼ å…¥æŒ‡å®šæ ¼å¼å‚æ•°çš„åœ°å€ï¼Œè¿™å–å†³äºæ˜¯`AF_INET` è¿˜æ˜¯ `AF_INET6`

 åœ°å€æ—         | åè®® | åœ°å€å…ƒç»„                        | è¯´æ˜
---              | ---   | ---                             | ---
socket.AF_INET  | IPv4 | (host, port)                    | host å‚æ•°æ˜¯ä¸ªå¦‚ `www.example.com` çš„ä¸»æœºåç§°ï¼Œæˆ–è€…å¦‚ `10.1.2.3` çš„ IPv4 åœ°å€
socket.AF_INET6 | IPv6 | (host, port, flowinfo, scopeid) | ä¸»æœºååŒä¸Šï¼ŒIPv6 åœ°å€ å¦‚ï¼š`fe80::6203:7ab:fe88:9c23`ï¼Œflowinfo å’Œ scopeid åˆ†åˆ«è¡¨ç¤º C è¯­è¨€ç»“æ„ä½“ `sockaddr_in6` ä¸­çš„ `sin6_flowinfo` å’Œ `sin6_scope_id` æˆå‘˜

æ³¨æ„ä¸‹é¢è¿™æ®µ python socket æ¨¡å—ä¸­å…³äº host å€¼å’Œåœ°å€å…ƒç»„æ–‡æ¡£

> å¯¹äº IPv4 åœ°å€ï¼Œä½¿ç”¨ä¸»æœºåœ°å€çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š`''` ç©ºå­—ç¬¦ä¸²è¡¨ç¤º `INADDR_ANY`ï¼Œå­—ç¬¦ `'<broadcast>'` è¡¨ç¤º `INADDR_BROADCAST`ï¼Œè¿™ä¸ªè¡Œä¸ºå’Œ IPv6 ä¸å…¼å®¹ï¼Œå› æ­¤å¦‚æœä½ çš„ç¨‹åºä¸­ä½¿ç”¨çš„æ˜¯ IPv6 å°±åº”è¯¥é¿å…è¿™ç§åšæ³•ã€‚[æºæ–‡æ¡£](https://docs.python.org/3/library/socket.html#socket-families)

æˆ‘åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨äº† IPv4 åœ°å€ï¼Œä½†æ˜¯å¦‚æœä½ çš„æœºå™¨æ”¯æŒï¼Œä¹Ÿå¯ä»¥è¯•è¯• IPv6 åœ°å€ã€‚`socket.getaddrinfo()` æ–¹æ³•ä¼šè¿”å›äº”ä¸ªå…ƒç»„çš„åºåˆ—ï¼Œè¿™åŒ…æ‹¬æ‰€æœ‰åˆ›å»º socket è¿æ¥çš„å¿…è¦å‚æ•°ï¼Œ`socket.getaddrinfo()` æ–¹æ³•ç†è§£å¹¶å¤„ç†ä¼ å…¥çš„ IPv6 åœ°å€å’Œä¸»æœºå

ä¸‹é¢çš„ä¾‹å­ä¸­ç¨‹åºå°†è¿”å›ä¸€ä¸ªé€šè¿‡ TCP è¿æ¥åˆ° `example.org` 80 ç«¯å£ä¸Šçš„åœ°å€ä¿¡æ¯ï¼š

```python
>>> socket.getaddrinfo("example.org", 80, proto=socket.IPPROTO_TCP)
[(<AddressFamily.AF_INET6: 10>, <SocketType.SOCK_STREAM: 1>,
 6, '', ('2606:2800:220:1:248:1893:25c8:1946', 80, 0, 0)),
 (<AddressFamily.AF_INET: 2>, <SocketType.SOCK_STREAM: 1>,
 6, '', ('93.184.216.34', 80))]
```

å¦‚æœ IPv6 å¯ç”¨çš„è¯ç»“æœå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œä¸Šé¢è¿”å›çš„å€¼å¯ä»¥è¢«ç”¨äº `socket.socket()` å’Œ `socket.connect()` æ–¹æ³•è°ƒç”¨çš„å‚æ•°ï¼Œåœ¨ python socket æ¨¡å—æ–‡æ¡£ä¸­çš„ [ç¤ºä¾‹](https://docs.python.org/3/library/socket.html#example) ä¸€èŠ‚ä¸­æœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç¨‹åº

## ä½¿ç”¨ä¸»æœºå

è¿™ä¸€èŠ‚ä¸»è¦é€‚ç”¨äºä½¿ç”¨ `bind()` å’Œ `connect()` æˆ– `connect_ex()` æ–¹æ³•æ—¶å¦‚ä½•ä½¿ç”¨ä¸»æœºåï¼Œç„¶è€Œå½“ä½ ä½¿ç”¨å›ç¯åœ°å€ä½œä¸ºä¸»æœºåæ—¶ï¼Œå®ƒæ€»æ˜¯ä¼šè§£æåˆ°ä½ æœŸæœ›çš„åœ°å€ã€‚è¿™åˆšå¥½ä¸å®¢æˆ·ç«¯ä½¿ç”¨ä¸»æœºåçš„åœºæ™¯ç›¸åï¼Œå®ƒéœ€è¦ DNS è§£æçš„è¿‡ç¨‹ï¼Œæ¯”å¦‚ `www.example.com`

ä¸‹é¢ä¸€æ®µæ¥è‡ª python socket æ¨¡å—æ–‡æ¡£

> å¦‚æœä½ ä¸»æœºåç§°ä½œä¸º IPv4/v6 socket åœ°å€çš„ host éƒ¨åˆ†ï¼Œç¨‹åºå¯èƒ½ä¼šå‡ºç°éé¢„æœŸçš„ç»“æœï¼Œç”±äº python ä½¿ç”¨äº† DNS æŸ¥æ‰¾è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€ä¸ªç»“æœï¼Œsocket åœ°å€ä¼šè¢«è§£ææˆä¸çœŸæ­£çš„ IPv4/v6 åœ°å€ä¸åŒçš„å…¶å®ƒåœ°å€ï¼Œè¿™å–å†³äº DNS è§£æå’Œä½ çš„ host æ–‡ä»¶é…ç½®ã€‚å¦‚æœæƒ³å¾—åˆ°ç¡®å®šçš„ç»“æœï¼Œè¯·ä½¿ç”¨æ•°å­—æ ¼å¼çš„åœ°å€ä½œä¸º host å‚æ•°çš„å€¼ [æºæ–‡æ¡£](https://docs.python.org/3/library/socket.html)

é€šå¸¸å›ç¯åœ°å€ `localhost` ä¼šè¢«è§£æåˆ° `127.0.0.1` æˆ– `::1` ä¸Šï¼Œä½ çš„ç³»ç»Ÿå¯èƒ½å°±æ˜¯è¿™ä¹ˆè®¾ç½®çš„ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ã€‚è¿™å–å†³äºä½ ç³»ç»Ÿé…ç½®ï¼Œä¸æ‰€æœ‰ IT ç›¸å…³çš„äº‹æƒ…ä¸€æ ·ï¼Œæ€»ä¼šæœ‰ä¾‹å¤–çš„æƒ…å†µï¼Œæ²¡åŠæ³•å®Œå…¨ä¿è¯ localhost è¢«è§£æåˆ°äº†å›ç¯åœ°å€ä¸Š

æ¯”å¦‚åœ¨ Linux ä¸Šï¼ŒæŸ¥çœ‹ `man nsswitch.conf` çš„ç»“æœï¼ŒåŸŸååˆ‡æ¢é…ç½®æ–‡ä»¶ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ª macOS å’Œ Linux é€šç”¨çš„é…ç½®æ–‡ä»¶åœ°å€æ˜¯ï¼š`/etc/hosts`ï¼Œåœ¨ windows ä¸Šåˆ™æ˜¯`C:\Windows\System32\drivers\etc\hosts`ï¼Œhosts æ–‡ä»¶åŒ…å«äº†ä¸€ä¸ªæ–‡æœ¬æ ¼å¼çš„é™æ€åŸŸååœ°å€æ˜ å°„è¡¨ï¼Œæ€»ä¹‹ DNS ä¹Ÿæ˜¯ä¸€ä¸ªéš¾é¢˜

æœ‰è¶£çš„æ˜¯ï¼Œåœ¨æ’°å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼ˆ2018 å¹´ 6 æœˆï¼‰ï¼Œæœ‰ä¸€ä¸ªå…³äº [è®© localhost æˆä¸ºçœŸæ­£çš„ localhost](https://tools.ietf.org/html/draft-ietf-dnsop-let-localhost-be-localhost-02) çš„ RFC è‰æ¡ˆï¼Œè®¨è®ºå°±æ˜¯å›´ç»•ç€ localhost ä½¿ç”¨çš„æƒ…å†µå¼€å±•çš„

æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ä½ è¦ç†è§£å½“ä½ åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¸»æœºåæ—¶ï¼Œè¿”å›çš„åœ°å€å¯èƒ½æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå®‰å…¨æ€§æ•æ„Ÿçš„åº”ç”¨ç¨‹åºï¼Œä¸è¦ä½¿ç”¨ä¸»æœºåã€‚å–å†³äºä½ çš„åº”ç”¨ç¨‹åºå’Œç¯å¢ƒï¼Œè¿™å¯èƒ½ä¼šå›°æ‰°åˆ°ä½ 

**æ³¨æ„ï¼š** å®‰å…¨æ–¹é¢çš„è€ƒè™‘å’Œæœ€ä½³å®è·µæ€»æ˜¯å¥½çš„ï¼Œå³ä½¿ä½ çš„ç¨‹åºä¸æ˜¯å®‰å…¨æ•æ„Ÿå‹çš„åº”ç”¨ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºè®¿é—®äº†ç½‘ç»œï¼Œé‚£å®ƒå°±åº”è¯¥æ˜¯å®‰å…¨çš„ç¨³å®šçš„ã€‚è¿™è¡¨ç¤ºè‡³å°‘è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š

* ç»å¸¸ä¼šæœ‰ç³»ç»Ÿè½¯ä»¶å‡çº§å’Œå®‰å…¨è¡¥ä¸ï¼ŒåŒ…æ‹¬ pythonï¼Œä½ æ˜¯å¦ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹çš„åº“ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œç¡®ä¿ä»–ä»¬èƒ½æ­£å¸¸å·¥ä½œå¹¶ä¸”æ›´æ–°åˆ°äº†æ–°ç‰ˆæœ¬
* å°½é‡ä½¿ç”¨ä¸“ç”¨é˜²ç«å¢™æˆ–åŸºäºä¸»æœºçš„é˜²ç«å¢™æ¥é™åˆ¶ä¸å—ä¿¡ä»»ç³»ç»Ÿçš„è¿æ¥
* DNS æœåŠ¡æ˜¯å¦‚ä½•é…ç½®çš„ï¼Ÿä½ æ˜¯å¦ä¿¡ä»»é…ç½®å†…å®¹åŠå…¶é…ç½®è€…
* åœ¨è°ƒç”¨å¤„ç†å…¶ä»–ä»£ç ä¹‹å‰ï¼Œè¯·ç¡®ä¿å°½å¯èƒ½åœ°å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œäº†æ¸…ç†å’ŒéªŒè¯ï¼Œè¿˜è¦ä¸ºæ­¤æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ä¸”ç»å¸¸è¿è¡Œ

æ— è®ºæ˜¯å¦ä½¿ç”¨ä¸»æœºåç§°ï¼Œä½ çš„åº”ç”¨ç¨‹åºéƒ½éœ€è¦æ”¯æŒå®‰å…¨è¿æ¥ï¼ˆåŠ å¯†æˆæƒï¼‰ï¼Œä½ å¯èƒ½ä¼šç”¨åˆ° [TLS](https://en.wikipedia.org/wiki/Transport_Layer_Security)ï¼Œè¿™æ˜¯ä¸€ä¸ªè¶…è¶Šäº†æœ¬æ•™ç¨‹çš„èŒƒå›´çš„è¯é¢˜ã€‚å¯ä»¥ä» python çš„ [SSL](https://docs.python.org/3/library/ssl.html) æ¨¡å—æ–‡æ¡£äº†è§£å¦‚ä½•å¼€å§‹ä½¿ç”¨å®ƒï¼Œè¿™ä¸ªåè®®å’Œä½ çš„æµè§ˆå™¨ä½¿ç”¨çš„å®‰å…¨åè®®æ˜¯ä¸€æ ·çš„

è€ƒè™‘åˆ°æ¥å£ã€IP åœ°å€ã€åŸŸåè§£æè¿™äº›ã€Œå˜é‡ã€ï¼Œä½ åº”è¯¥æ€ä¹ˆåº”å¯¹ï¼Ÿå¦‚æœä½ è¿˜æ²¡æœ‰ç½‘ç»œåº”ç”¨ç¨‹åºå®¡æŸ¥æµç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å»ºè®®ï¼š

åº”ç”¨ç¨‹åº | ä½¿ç”¨       | å»ºè®®
--       | --         | --
æœåŠ¡ç«¯   | å›ç¯åœ°å€   | ä½¿ç”¨ IP åœ°å€ 127.0.0.1 æˆ– ::1
æœåŠ¡ç«¯   | ä»¥å¤ªç½‘åœ°å€ | ä½¿ç”¨ IP åœ°å€ï¼Œæ¯”å¦‚ï¼š10.1.2.3ï¼Œä½¿ç”¨ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºæœ¬æœºæ‰€æœ‰ IP åœ°å€
å®¢æˆ·ç«¯   | å›ç¯åœ°å€   | ä½¿ç”¨ IP åœ°å€ 127.0.0.1 æˆ– ::1
å®¢æˆ·ç«¯   | ä»¥å¤ªç½‘åœ°å€ | ä½¿ç”¨ç»Ÿä¸€çš„ä¸ä¾èµ–åŸŸåè§£æçš„ IP åœ°å€ï¼Œç‰¹æ®Šæƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨ä¸»æœºåœ°å€ï¼ŒæŸ¥çœ‹ä¸Šé¢çš„å®‰å…¨æç¤º

å¯¹äºå®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯æ¥è¯´ï¼Œå¦‚æœä½ éœ€è¦æˆæƒè¿æ¥åˆ°ä¸»æœºï¼Œè¯·æŸ¥çœ‹å¦‚ä½•ä½¿ç”¨ TLS

## é˜»å¡è°ƒç”¨

å¦‚æœä¸€ä¸ª socket å‡½æ•°æˆ–è€…æ–¹æ³•ä½¿ä½ çš„ç¨‹åºæŒ‚èµ·ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯ä¸ªé˜»å¡è°ƒç”¨ï¼Œæ¯”å¦‚ accept(), connect(), send(), å’Œ recv() éƒ½æ˜¯ **é˜»å¡** çš„ï¼Œå®ƒä»¬ä¸ä¼šç«‹å³è¿”å›ï¼Œé˜»å¡è°ƒç”¨åœ¨è¿”å›å‰å¿…é¡»ç­‰å¾…ç³»ç»Ÿè°ƒç”¨ (I/O) å®Œæˆã€‚æ‰€ä»¥è°ƒç”¨è€… â€”â€” ä½ ï¼Œä¼šè¢«é˜»æ­¢ç›´åˆ°ç³»ç»Ÿè°ƒç”¨ç»“æŸæˆ–è€…è¶…è¿‡å»¶è¿Ÿæ—¶é—´æˆ–è€…æœ‰é”™è¯¯å‘ç”Ÿ

é˜»å¡çš„ socket è°ƒç”¨å¯ä»¥è®¾ç½®æˆéé˜»å¡çš„æ¨¡å¼ï¼Œè¿™æ ·ä»–ä»¬å°±å¯ä»¥ç«‹å³è¿”å›ã€‚å¦‚æœä½ æƒ³åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±å¾—é‡æ„å¹¶é‡æ–°è®¾è®¡ä½ çš„åº”ç”¨ç¨‹åº

ç”±äºè°ƒç”¨ç›´æ¥è¿”å›äº†ï¼Œä½†æ˜¯æ•°æ®ç¡®æ²¡å°±ç»ªï¼Œè¢«è°ƒç”¨è€…å¤„äºç­‰å¾…ç½‘ç»œå“åº”çš„çŠ¶æ€ï¼Œæ²¡æ³•å®Œæˆå®ƒçš„å·¥ä½œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰ socket çš„çŠ¶æ€ç  errno åº”è¯¥æ˜¯ `socket.EWOULDBLOCK`ã€‚`setblocking()` æ–¹æ³•æ˜¯æ”¯æŒéé˜»å¡æ¨¡å¼çš„

é»˜è®¤æƒ…å†µä¸‹ï¼Œsocket ä¼šä»¥é˜»å¡æ¨¡å¼åˆ›å»ºï¼ŒæŸ¥çœ‹ [socket å»¶è¿Ÿçš„æ³¨æ„äº‹é¡¹](https://docs.python.org/3/library/socket.html#notes-on-socket-timeouts) ä¸­ä¸‰ç§æ¨¡å¼çš„è§£é‡Š

## å…³é—­è¿æ¥

æœ‰è¶£çš„æ˜¯ TCP è¿æ¥ä¸€ç«¯æ‰“å¼€ï¼Œå¦ä¸€ç«¯å…³é—­çš„çŠ¶æ€æ˜¯å®Œå…¨åˆæ³•çš„ï¼Œè¿™è¢«ç§°åš TCPã€ŒåŠè¿æ¥ã€ï¼Œæ˜¯å¦éœ€è¦è¿™ç§ä¿æŒçŠ¶æ€æ˜¯ç”±åº”ç”¨ç¨‹åºå†³å®šçš„ï¼Œé€šå¸¸æ¥è¯´ä¸éœ€è¦ã€‚è¿™ç§çŠ¶æ€ä¸‹ï¼Œå…³é—­æ–¹å°†ä¸èƒ½å‘é€ä»»ä½•æ•°æ®ï¼Œå®ƒåªèƒ½æ¥æ”¶æ•°æ®

æˆ‘ä¸æ˜¯åœ¨æå€¡ä½ é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼ŒHTTP ä½¿ç”¨äº†ä¸€ä¸ªåä¸ºã€ŒConnectionã€çš„å¤´æ¥æ ‡å‡†åŒ–è§„å®šåº”ç”¨ç¨‹åºæ˜¯å¦å…³é—­æˆ–è€…ä¿æŒè¿æ¥çŠ¶æ€ï¼Œæ›´å¤šå†…å®¹è¯·æŸ¥çœ‹ [RFC 7230 ä¸­ 6.3 èŠ‚ï¼ŒHTTP åè®® (HTTP/1.1): æ¶ˆæ¯è¯­æ³•ä¸è·¯ç”±](https://tools.ietf.org/html/rfc7230#section-6.3)

å½“ä½ åœ¨è®¾è®¡åº”ç”¨ç¨‹åºåŠå…¶åº”ç”¨å±‚åè®®çš„æ—¶å€™ï¼Œæœ€å¥½å…ˆäº†è§£ä¸€ä¸‹å¦‚ä½•å…³é—­è¿æ¥ï¼Œæœ‰æ—¶è¿™å¾ˆç®€å•è€Œä¸”å¾ˆæ˜æ˜¾ï¼Œæˆ–è€…é‡‡å–ä¸€äº›å¯ä»¥å®ç°çš„åŸå‹ï¼Œè¿™å–å†³äºä½ çš„åº”ç”¨ç¨‹åºä»¥åŠæ¶ˆæ¯å¾ªç¯å¦‚ä½•è¢«å¤„ç†æˆæœŸæœ›çš„æ•°æ®ï¼Œåªè¦ç¡®ä¿ socket åœ¨å®Œæˆå·¥ä½œåæ€»æ˜¯èƒ½æ­£ç¡®å…³é—­

## å­—èŠ‚åº

æŸ¥çœ‹ç»´åŸºç™¾ç§‘ [å­—èŠ‚åº](https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F) ä¸­å…³äºä¸åŒçš„ CPU æ˜¯å¦‚ä½•åœ¨å†…å­˜ä¸­å­˜å‚¨å­—èŠ‚åºåˆ—çš„ï¼Œå¤„ç†å•ä¸ªå­—èŠ‚æ—¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å½“æŠŠå¤šä¸ªå­—èŠ‚å¤„ç†æˆå•ä¸ªå€¼ï¼ˆå››å­—èŠ‚æ•´å‹ï¼‰æ—¶ï¼Œå¦‚æœå’Œä½ é€šä¿¡çš„å¦ä¸€ç«¯ä½¿ç”¨äº†ä¸åŒçš„å­—èŠ‚åºæ—¶å­—èŠ‚é¡ºåºéœ€è¦è¢«åè½¬

å­—èŠ‚é¡ºåºå¯¹äºå­—ç¬¦æ–‡æœ¬æ¥è¯´ä¹Ÿå¾ˆé‡è¦ï¼Œå­—ç¬¦æ–‡æœ¬é€šè¿‡è¡¨ç¤ºä¸ºå¤šå­—èŠ‚çš„åºåˆ—ï¼Œå°±åƒ Unicode ä¸€æ ·ã€‚é™¤éä½ åªä½¿ç”¨ `true` å’Œ ASCII å­—ç¬¦æ¥æ§åˆ¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„å®ç°ï¼Œå¦åˆ™ä½¿ç”¨ utf-8 æ ¼å¼æˆ–è€…æ”¯æŒå­—èŠ‚åºæ ‡è¯† (BOM) çš„ Unicode å­—ç¬¦é›†ä¼šæ¯”è¾ƒåˆé€‚

åœ¨åº”ç”¨å±‚åè®®ä¸­æ˜ç¡®çš„è§„å®šä½¿ç”¨ç¼–ç æ ¼å¼æ˜¯å¾ˆé‡è¦çš„ï¼Œä½ å¯ä»¥è§„å®šæ‰€æœ‰çš„æ–‡æœ¬éƒ½ä½¿ç”¨ utf-8 æˆ–è€…ç”¨ã€Œcontent-encodingã€å¤´æŒ‡å®šç¼–ç æ ¼å¼ï¼Œè¿™å°†ä½¿ä½ çš„ç¨‹åºä¸éœ€è¦æ£€æµ‹ç¼–ç æ–¹å¼ï¼Œå½“ç„¶ä¹Ÿåº”è¯¥å°½é‡é¿å…è¿™ä¹ˆåš

å½“æ•°æ®è¢«è°ƒç”¨å­˜å‚¨åˆ°äº†æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­è€Œä¸”åˆæ²¡æœ‰æ•°æ®çš„å…ƒä¿¡æ¯çš„æ—¶å€™ï¼Œé—®é¢˜å°±å¾ˆéº»çƒ¦äº†ï¼Œå½“æ•°æ®è¢«ä¼ åˆ°å…¶å®ƒç«¯ï¼Œå®ƒå°†è¯•ç€æ£€æµ‹æ•°æ®çš„ç¼–ç æ–¹å¼ã€‚æœ‰å…³è®¨è®ºï¼Œè¯·å‚é˜… Wikipedia çš„ [Unicode](https://en.wikipedia.org/wiki/Unicode) æ–‡ç« ï¼Œå®ƒå¼•ç”¨äº† [RFC 3629:UTF-8, a transformation format of ISO 10646](https://tools.ietf.org/html/rfc3629#page-6)

> ç„¶è€Œ UTF-8 çš„æ ‡å‡† RFC 3629 ä¸­æ¨èç¦æ­¢åœ¨ UTF-8 åè®®ä¸­ä½¿ç”¨æ ‡è®°å­—èŠ‚åº (BOM)ï¼Œä½†æ˜¯è®¨è®ºäº†æ— æ³•å®ç°çš„æƒ…å†µï¼Œæœ€å¤§çš„é—®é¢˜åœ¨äºå¦‚ä½•ä½¿ç”¨ä¸€ç§æ¨¡å¼åœ¨ä¸ä¾èµ– BOM çš„æƒ…å†µä¸‹åŒºåˆ† UTF-8 å’Œå…¶å®ƒç¼–ç æ–¹å¼

é¿å¼€è¿™äº›é—®é¢˜çš„æ–¹æ³•å°±æ˜¯æ€»æ˜¯å­˜å‚¨æ•°æ®ä½¿ç”¨çš„ç¼–ç æ–¹å¼ï¼Œæ¢å¥è¯è¯´ï¼Œå¦‚æœä¸åªç”¨ utf-8 æ ¼å¼çš„ç¼–ç æˆ–è€…å…¶å®ƒçš„å¸¦æœ‰ BOM çš„ç¼–ç å°±è¦å°è¯•ä»¥æŸç§æ–¹å¼å°†ç¼–ç æ–¹å¼å­˜å‚¨ä¸ºå…ƒæ•°æ®ï¼Œç„¶åä½ å°±å¯ä»¥åœ¨æ•°æ®ä¸Šé™„åŠ ç¼–ç çš„å¤´ä¿¡æ¯ï¼Œå‘Šè¯‰æ¥æ”¶è€…ç¼–ç æ–¹å¼

TCP/IP ä½¿ç”¨çš„å­—èŠ‚é¡ºåºæ˜¯ [big-endian](https://en.wikipedia.org/wiki/Endianness#Big)ï¼Œè¢«ç§°åšç½‘ç»œåºã€‚ç½‘ç»œåºè¢«ç”¨æ¥è¡¨ç¤ºåº•å±‚åè®®æ ˆä¸­çš„æ•´å‹æ•°å­—ï¼Œå¥½æ¯” IP åœ°å€å’Œç«¯å£å·ï¼Œpython çš„ socket æ¨¡å—æœ‰å‡ ä¸ªå‡½æ•°å¯ä»¥æŠŠè¿™ç§æ•´å‹æ•°å­—ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢æˆä¸»æœºå­—èŠ‚åº

å‡½æ•°            | è¯´æ˜
--              | --
socket.ntohl(x) | æŠŠ 32 ä½çš„æ­£æ•´å‹æ•°å­—ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢æˆä¸»æœºå­—èŠ‚åºï¼Œåœ¨ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºå­—èŠ‚åºç›¸åŒçš„æœºå™¨ä¸Šè¿™æ˜¯ä¸ªç©ºæ“ä½œï¼Œå¦åˆ™å°†æ˜¯ä¸€ä¸ª 4 å­—èŠ‚çš„äº¤æ¢æ“ä½œ
socket.ntohs(x) | æŠŠ 16 ä½çš„æ­£æ•´å‹æ•°å­—ä»ç½‘ç»œå­—èŠ‚åºè½¬æ¢æˆä¸»æœºå­—èŠ‚åºï¼Œåœ¨ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºå­—èŠ‚åºç›¸åŒçš„æœºå™¨ä¸Šè¿™æ˜¯ä¸ªç©ºæ“ä½œï¼Œå¦åˆ™å°†æ˜¯ä¸€ä¸ª 2 å­—èŠ‚çš„äº¤æ¢æ“ä½œ
socket.htonl(x) | æŠŠ 32 ä½çš„æ­£æ•´å‹æ•°å­—ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢æˆç½‘ç»œå­—èŠ‚åºï¼Œåœ¨ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºå­—èŠ‚åºç›¸åŒçš„æœºå™¨ä¸Šè¿™æ˜¯ä¸ªç©ºæ“ä½œï¼Œå¦åˆ™å°†æ˜¯ä¸€ä¸ª 4 å­—èŠ‚çš„äº¤æ¢æ“ä½œ
socket.htons(x) | æŠŠ 16 ä½çš„æ­£æ•´å‹æ•°å­—ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢æˆç½‘ç»œå­—èŠ‚åºï¼Œåœ¨ç½‘ç»œå­—èŠ‚åºå’Œä¸»æœºå­—èŠ‚åºç›¸åŒçš„æœºå™¨ä¸Šè¿™æ˜¯ä¸ªç©ºæ“ä½œï¼Œå¦åˆ™å°†æ˜¯ä¸€ä¸ª 2 å­—èŠ‚çš„äº¤æ¢æ“ä½œ

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [struct](https://docs.python.org/3/library/struct.html) æ¨¡å—æ‰“åŒ…æˆ–è€…è§£åŒ…äºŒè¿›åˆ¶æ•°æ®ï¼ˆä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼‰ï¼š

```python
import struct
network_byteorder_int = struct.pack('>H', 256)
python_int = struct.unpack('>H', network_byteorder_int)[0]
```
