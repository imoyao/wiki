---
title: pep-0530
date: 2020-12-11 21:40:35
permalink: /pages/a146f7/
categories:
  - ğŸ’»å·¥ä½œ
  - ğŸPython
  - PEP
tags:
  - 
---
---
title: [è¯‘] PEP 530--å¼‚æ­¥æ¨å¯¼å¼
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - PEP
date: 2019-11-27 23:34:31
permalink: /pages/de62d0/
tags: 
  - peps
---

**PEP åŸæ–‡**ï¼šhttps://github.com/python/peps/blob/master/pep-0530.txt


**è¯‘è€…** ï¼š[CXA](https://www.cnblogs.com/c-x-a)ï¼ˆ**python å­¦ä¹ å¼€å‘** å…¬ä¼—å·ä½œè€…ï¼‰


### æ‘˜è¦
>PEP 492 å’Œ PEP 525 ä½¿ç”¨ async/await è¯­æ³•å¼•å…¥äº†åç¨‹ã€‚PEP 530 å»ºè®®æ·»åŠ  listï¼Œsetï¼Œdict æ¨å¯¼å¼å’Œç”Ÿæˆå™¨æ¨å¯¼å¼çš„å¼‚æ­¥ç‰ˆæœ¬ã€‚

### ç†è®ºå’Œç›®æ ‡
å¯¹å¦‚ä¸‹ä»£ç åšäº†æ”¹è¿›ã€‚
```plain
result = []
async for i in aiter():
    if i % 2:
        result.append(i)
```
å¯ä»¥å†™æˆå¼‚æ­¥æ¨å¯¼å¼çš„æ–¹å¼ç®€åŒ–ä¸Šé¢ä»£ç ï¼š
```plain
result = [i async for i in aiter() if i % 2]
```
åŒæ ·çš„è¯¥ pep ä¹Ÿæ”¯æŒä¸Šè¿°å„ç§è¡¨è¾¾å¼é‡Œé¢ä½¿ç”¨ await è¯­å¥ï¼Œåƒä¸‹é¢è¿™æ ·
```plain
result = [await fun() for fun in funcs]
```
### è¯¦ç»†å†…å®¹
åŒæ ·çš„æˆ‘ä»¬å¯ä»¥åˆ›å»º set,list,dict çš„å¼‚æ­¥æ¨å¯¼å¼ã€‚

```plain
å¼‚æ­¥é›†åˆæ¨å¯¼å¼: {i async for i in agen()};
å¼‚æ­¥åˆ—è¡¨æ¨å¯¼å¼: [i async for i in agen()];
å¼‚æ­¥å­—å…¸æ¨å¯¼å¼: {i: i ** 2 async for i in agen()};
å¼‚æ­¥ç”Ÿæˆå™¨æ¨å¯¼å¼:(i ** 2 async for i in agen()).
```
å’Œä»¥å‰æˆ‘ä»¬ç†Ÿæ‚‰çš„æ¨å¯¼å¼ä¸€æ ·æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨ async for æ¥ç”Ÿæˆæ¨å¯¼å¼çš„æ—¶å€™ï¼Œä½¿ç”¨æ¡ä»¶è¯­å¥ ifï¼Œå°±åƒä¸‹é¢è¿™æ ·
```plain
dataset = {data for line in aiter()
                async for data in line
                if check(data)}
```
éœ€è¦æ³¨æ„çš„æ˜¯åˆ° python3.6 çš„æ—¶å€™ async å’Œ await å¿…é¡»é…åˆ async def å‡½æ•°ä½¿ç”¨ï¼Œä¸èƒ½å†™åœ¨å¼‚æ­¥å‡½æ•°ä¹‹å¤–ï¼Œä½†æ˜¯åœ¨ python3.7 çš„æ—¶å€™è¿™ä¸ªé™åˆ¶å°†è¢«è§£é™¤ã€‚
### æ¨å¯¼å¼é‡Œä½¿ç”¨ await
#### å¼‚æ­¥æ¨å¯¼å¼
await å¯ä»¥ç”¨åˆ°åŒæ­¥è¡¨è¾¾å¼å’Œå¼‚æ­¥è¡¨è¾¾å¼ä¸­ï¼Œåƒä¸‹é¢çš„ä»£ç è¿™æ ·
```plain
result = [await fun() for fun in funcs]
result = {await fun() for fun in funcs}
result = {fun: await fun() for fun in funcs}

result = [await fun() for fun in funcs if await smth]
result = {await fun() for fun in funcs if await smth}
result = {fun: await fun() for fun in funcs if await smth}

result = [await fun() async for fun in funcs]
result = {await fun() async for fun in funcs}
result = {fun: await fun() async for fun in funcs}

result = [await fun() async for fun in funcs if await smth]
result = {await fun() async for fun in funcs if await smth}
result = {fun: await fun() async for fun in funcs if await smth}
```
ä»¥ä¸Šè¯­å¥åªèƒ½åœ¨ async def å‡½æ•°ä½“ä¸­ä½¿ç”¨
### è¯­å¥æ›´æ–°
è¯¥æè®®éœ€è¦å¯¹è¯­æ³•çº§åˆ«è¿›è¡Œä¸€æ¬¡æ›´æ”¹ï¼šå‘ comp_for æ·»åŠ å¯é€‰çš„â€œasyncâ€å…³é”®å­—ï¼š
```plain
comp_for: [ASYNC] 'for' exprlist 'in' or_test [comp_iter]
```
python æ¨å¯¼å¼ AST éƒ¨åˆ†å°†åŠ å…¥ is_async å‚æ•°ã€‚è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯è¯´åŠ å…¥å­—å…¸å¼‚æ­¥æ¨å¯¼å¼çš„å®ç°ï¼ŒåƒåŒæ­¥é‚£æ ·ã€‚
### æ˜¯å¦æ”¯æŒå‘åå…¼å®¹
æ”¯æŒå‘åå…¼å®¹
### æä¾›äºº
PEP 530 ç”± Guido, 2016 å¹´ 9 æœˆ 6 æ—¥æå‡º.
### å‚è€ƒèµ„æ–™
[1]	https://mail.python.org/pipermail/python-ideas/2016-September/042141.html
[2]	https://github.com/1st1/cpython/tree/asyncomp
[3]	http://bugs.python.org/issue28008
### ç‰ˆæƒå£°æ˜
>æœ¬æ–‡ç« ç¿»è¯‘æ•´ç†è‡ªï¼Œpep530
Source: https://github.com/python/peps/blob/master/pep-0530.txt