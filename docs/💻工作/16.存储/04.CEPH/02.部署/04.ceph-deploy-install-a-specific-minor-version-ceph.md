---
title: å¦‚ä½•ä½¿ç”¨ ceph-deploy éƒ¨ç½²ä¸€ä¸ªæŒ‡å®šç‰ˆæœ¬å·çš„ ceph é›†ç¾¤
tags: 
  - CEPH
  - ceph-deploy
  - CentOS7
  - ç¯å¢ƒæ­å»º
reward: true
cover: /images/logos/ceph-logo.svg
categories: 
  - ğŸ’» å·¥ä½œ
  - å­˜å‚¨
  - CEPH

date: 2020-03-16 14:09:20
permalink: /pages/752db9/
---

## å‰è¨€
åœ¨ [ä¸Šæ–‡](/blog/2020-03-15/ceph-deploy-install-ceph-nautilus-on-CentOS7/) ä¸­æˆ‘ä»¬ä½¿ç”¨ ceph-deploy æ­å»º ceph é›†ç¾¤ã€‚è€Œå½“å‰ç‰ˆæœ¬ ceph-deploy ä¸æ”¯æŒç”¨æˆ·æŒ‡å®šå°ç‰ˆæœ¬å·ï¼Œä½¿ç”¨`--release`åªæ”¯æŒå®‰è£…æœ€æ–°ç¨³å®šç‰ˆã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ­å»ºï¼Œä½†æ˜¯æ“ä½œä¸‹æ¥è€—æ—¶ä¸”å®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”~~äººç”Ÿè‹¦çŸ­ï¼ˆæˆ‘å¤ªæ‡’äº†ï¼‰~~ã€‚
## ç‰ˆæœ¬ä¿¡æ¯
1. ç³»ç»Ÿç‰ˆæœ¬
```plain
[root@admin-node my-cluster]# cat /etc/system-release
CentOS Linux release 7.6.1810 (Core) 
[root@admin-node my-cluster]# uname -a
Linux admin-node 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```
2. ceph ç‰ˆæœ¬
```plain
[root@admin-node my-cluster]# ceph -v
ceph version 14.2.5 (ad5bd132e1492173c85fda2cc863152730b16a92) nautilus (stable)
```

## åœ¨æœ¬åœ°é…ç½®ç¦»çº¿å­˜å‚¨åº“

### å®‰è£…ç½‘ç»œæœåŠ¡

1. å®‰è£… ngix
```plain
yum install epel-release -y
yum install nginx -y
```
2. æ‰“å¼€ nginx
```plain
systemctl start nginx
systemctl enable nginx
systemctl status nginx
```
3. æ·»åŠ é˜²ç«å¢™è§„åˆ™
```plain
firewall-cmd --zone=public --permanent --add-service=http
firewall-cmd --zone=public --permanent --add-service=https
firewall-cmd --reload
```

### åˆ›å»ºæœ¬åœ°é•œåƒæº

1. å®‰è£…å¿…éœ€å·¥å…·
```plain
yum install createrepo yum-utils wget -y
```
2. åˆ›å»ºé•œåƒæºæ–‡ä»¶å¤¹
```plain
mkdir -p /var/www/html/repos/{SRPMS,x86_64,noarch}
```
3. ä¸‹è½½ç›¸åº”è½¯ä»¶åŒ…
å¯ä»¥æ‰‹åŠ¨åœ¨ä»¥ä¸‹ 3 ä¸ªé“¾æ¥ä¸­ä¸‹è½½å„è‡ªæ¶æ„ä¸‹çš„ç›¸åº”è½¯ä»¶åŒ…
```plain
https://download.ceph.com/rpm-nautilus/el7/SRPMS/
https://download.ceph.com/rpm-nautilus/el7/noarch/
https://download.ceph.com/rpm-nautilus/el7/x86_64/
```
å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»é˜¿é‡Œäº‘çš„é•œåƒæºé“¾æ¥`http://mirrors.aliyun.com/ceph/`ä¸‹è½½ï¼ˆå›½å†…ç”¨æˆ·ä½ æ‡‚çš„ï¼‰
```plain
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-base-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-common-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-debuginfo-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-fuse-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-mds-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-mgr-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-mon-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-osd-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-radosgw-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-resource-agents-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-selinux-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/ceph-test-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/cephfs-java-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/libcephfs-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/libcephfs2-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/libcephfs_jni-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/libcephfs_jni1-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/librados-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/librados2-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/libradosstriper-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/libradosstriper1-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/librbd-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/librbd1-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/librgw-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/librgw2-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python-ceph-compat-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python-cephfs-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python-rados-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python-rbd-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python-rgw-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python34-ceph-argparse-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python34-cephfs-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python34-rados-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python34-rbd-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python34-rgw-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/rados-objclass-devel-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/rbd-fuse-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/rbd-mirror-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/rbd-nbd-14.2.5-0.el7.x86_64.rpm
wget http://mirrors.aliyun.com/ceph/rpm-nautilus/el7/x86_64/python-ceph-argparse-14.2.5-0.el7.x86_64.rpm
wget https://mirrors.aliyun.com/ceph/rpm-nautilus/el7/noarch/ceph-deploy-2.0.0-0.noarch.rpm
```
4. æ‰§è¡Œé•œåƒæºåˆ›å»º
```plain
createrepo -v /var/www/html/repos/SRPMS/
createrepo -v /var/www/html/repos/x86_64/
createrepo -v /var/www/html/repos/noarch/
```
5. ä¿®æ”¹ Nginx é…ç½®
```plain
vi /etc/nginx/conf.d/repos.conf
```
```plain
server {
        listen   80;
        server_name  172.18.1.101;	# ä¿®æ”¹æ­¤å¤„ä¸ºæœ¬æœºåœ°å€
        root   /var/www/html/repos;
        location / {
                index  index.php index.html index.htm;
                autoindex on;	#enable listing of directory index
        }
}

```
6. é‡æ–°å¯åŠ¨ nginxï¼Œç„¶åå†æ¬¡è®¿é—®æœ¬åœ°æºæµ‹è¯•
```plain
systemctl restart nginx
```
![upload successful](/images/pasted-0.png)

## å®‰è£… Ceph
1. å£°æ˜æœ¬åœ°ä»“åº“
```plain
vi/etc/yum.repos.d/ceph.repo
```
```plain
[ceph]
name=Ceph packages for $basearch
baseurl=http://172.18.1.101/x86_64/		# æ³¨æ„æ­¤å¤„ipä¸ºé•œåƒæºçš„ip
enabled=1
priority=2
gpgcheck=0
gpgkey=https://download.ceph.com/keys/release.asc

[ceph-noarch]
name=Ceph noarch packages
baseurl=http://172.18.1.101/noarch
enabled=1
priority=2
gpgcheck=0
gpgkey=https://download.ceph.com/keys/release.asc

[ceph-source]
name=Ceph source packages
baseurl=http://172.18.1.101/SRPMS
enabled=0
priority=2
gpgcheck=0
gpgkey=https://download.ceph.com/keys/release.asc
EOF
```
2. ç„¶ååƒ[å¾€å¸¸ä¸€æ ·](/blog/2020-03-15/ceph-deploy-install-ceph-nautilus-on-CentOS7/)è¿›è¡Œ ceph éƒ¨ç½²
```plain
yum -y install ceph-deploy
```
3. è½¬åˆ°ä½¿ç”¨ ceph deploy å®‰è£…çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **--repo-url** æ›¿æ¢å‘½ä»¤
```plain
ceph-deploy install --repo-url http://172.18.1.101/ ceph1 ceph2 ceph3
```
4. å®‰è£…å®Œæˆåï¼Œå†æ¬¡æ£€æŸ¥`ceph version`ç‰ˆæœ¬
```plain
[node2][DEBUG ] 
[node2][DEBUG ] Complete!
[node2][INFO  ] Running command: sudo ceph --version
[node2][DEBUG ] ceph version 14.2.5 (ad5bd132e1492173c85fda2cc863152730b16a92) nautilus (stable)
[root@admin-node x86_64]# ceph -v
ceph version 14.2.5 (ad5bd132e1492173c85fda2cc863152730b16a92) nautilus (stable)
```

## æ€»ç»“	
 `ceph-deploy` å¯ä»¥é€šè¿‡ä¸‰ç§æŒ‡å®šæ–¹å¼éƒ¨ç½² ceph,åˆ†åˆ«ä¸º`ceph-deploy install --release`ï¼ˆç”¨äºæŒ‡å®šå¤§ç‰ˆæœ¬å·å¦‚`nautilus`ï¼‰ã€`ceph-deploy install --testing`(ç”¨äºæœ€æ–°å¼€å‘ç‰ˆæœ¬)å’Œ`ceph-deploy install --dev`ï¼ˆç”¨äºæŒ‡å®šåˆ†æ”¯æˆ–è€… tagï¼‰,èµ·åˆæˆ‘ä»¥ä¸º`--dev`å¯ä»¥æ»¡è¶³æˆ‘æŒ‡å®šç‰ˆæœ¬å·çš„éœ€æ±‚ï¼Œåæ¥ä¸€é¡¿æ“ä½œå‘ç°æŠ¥é”™:
```plain
[ceph_deploy.hosts.centos.install][DEBUG ] fetching repo information from: https://shaman.ceph.com/api/repos/ceph/14.5.2/latest/centos/7/repo/?arch=x86_64
[ceph_deploy.util.net][ERROR ] repository might not be available yet
[ceph_deploy][ERROR ] RuntimeError: HTTP Error 504: Gateway Timeout, failed to fetch https://shaman.ceph.com/api/repos/ceph/14.5.2/latest/centos/7/repo/?arch=x86_64
```
è®¿é—®`https://shaman.ceph.com/api/repos/ceph`å‘ç°å¯ç”¨åº“é‡Œæ ¹æœ¬æ²¡æœ‰å¯¹åº”ç‰ˆæœ¬ã€‚é€šè¿‡é˜…è¯»[install â€” ceph-deploy 2.0.2 documentation](https://docs.ceph.com/ceph-deploy/docs/install.html#behind-firewall)æˆ‘ä»¬çŸ¥é“å¯ä»¥æŒ‡å®š `--repo-url`æ­é…`--gpg-url`ä½¿ç”¨æŒ‡å®šæºé“¾æ¥çš„æ–¹å¼æŒ‡å®šæœ¬åœ°æºå®‰è£…ã€‚æ­¤å¤–ï¼Œä½¿ç”¨`--local-mirrors`æŒ‡å®šæœ¬åœ°æºçš„æ–¹å¼ä¹Ÿå¯ä»¥å‚è€ƒã€‚å‚è§[install â€” ceph-deploy 2.0.2 documentation](https://docs.ceph.com/ceph-deploy/docs/install.html#local-mirrors)ã€‚

æœ¬æ–‡é€šè¿‡æ­å»ºæœ¬åœ°é•œåƒæºç„¶åæŒ‡å®šçš„æ–¹å¼é—´æ¥å®Œæˆäº† ceph é›†ç¾¤çš„å®‰è£…ã€‚

## å‚è€ƒé“¾æ¥
- [install â€” ceph-deploy 2.0.2 documentation](https://docs.ceph.com/ceph-deploy/docs/install.html#install)
- [ceph-deploy-specific-version.md at thaonguyenvan/notes-storage](https://github.com/thaonguyenvan/notes-storage/blob/51e6eeb02c34767ad84d350c2462bdccc179c35c/ceph/setup/ceph-deploy-specific-version.md)

