---
title: TCP ç²˜åŒ…é—®é¢˜
date: 2022-09-28 14:05:51
permalink: /posts/tcp-mixed-packages/
categories:
  - ğŸPython
  - é«˜é˜¶çŸ¥è¯†ç‚¹
tags:
  - é«˜å¹¶å‘
  - é¢è¯•
---


TCP/IP åè®®ç°‡å»ºç«‹äº†äº’è”ç½‘ä¸­é€šä¿¡åè®®çš„æ¦‚å¿µæ¨¡å‹ï¼Œè¯¥åè®®ç°‡ä¸­çš„ä¸¤ä¸ªä¸»è¦åè®®å°±æ˜¯ TCP å’Œ IP åè®®ã€‚TCP/ IP åè®®ç°‡ä¸­çš„ TCP åè®®èƒ½å¤Ÿä¿è¯æ•°æ®æ®µï¼ˆSegmentï¼‰çš„å¯é æ€§å’Œé¡ºåºï¼Œæœ‰äº†å¯é çš„ä¼ è¾“å±‚åè®®ä¹‹åï¼Œåº”ç”¨å±‚åè®®å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ TCP åè®®ä¼ è¾“æ•°æ®ï¼Œä¸åœ¨éœ€è¦å…³å¿ƒæ•°æ®æ®µçš„ä¸¢å¤±å’Œé‡å¤é—®é¢˜[1](#)ã€‚

![](https://img.draveness.me/2020-03-05-15834216958567-tcp-and-application-protocols.png)

**å›¾ 1 - TCP åè®®ä¸åº”ç”¨å±‚åè®®**

IP åè®®è§£å†³äº†æ•°æ®åŒ…ï¼ˆPacketï¼‰çš„è·¯ç”±å’Œä¼ è¾“ï¼Œä¸Šå±‚çš„ TCP åè®®ä¸å†å…³æ³¨è·¯ç”±å’Œå¯»å€[2](#)ï¼Œé‚£ä¹ˆ TCP åè®®è§£å†³çš„æ˜¯ä¼ è¾“çš„å¯é æ€§å’Œé¡ºåºé—®é¢˜ï¼Œä¸Šå±‚ä¸éœ€è¦å…³å¿ƒæ•°æ®èƒ½å¦ä¼ è¾“åˆ°ç›®æ ‡è¿›ç¨‹ï¼Œåªè¦å†™å…¥ TCP åè®®çš„ç¼“å†²åŒºçš„æ•°æ®ï¼Œåè®®æ ˆå‡ ä¹éƒ½èƒ½ä¿è¯æ•°æ®çš„é€è¾¾ã€‚

å½“åº”ç”¨å±‚åè®®ä½¿ç”¨ TCP åè®®ä¼ è¾“æ•°æ®æ—¶ï¼ŒTCP åè®®å¯èƒ½ä¼šå°†åº”ç”¨å±‚å‘é€çš„æ•°æ®åˆ†æˆå¤šä¸ªåŒ…ä¾æ¬¡å‘é€ï¼Œè€Œæ•°æ®çš„æ¥æ”¶æ–¹æ”¶åˆ°çš„æ•°æ®æ®µå¯èƒ½æœ‰å¤šä¸ªã€åº”ç”¨å±‚æ•°æ®åŒ…ã€ç»„æˆï¼Œæ‰€ä»¥å½“åº”ç”¨å±‚ä» TCP ç¼“å†²åŒºä¸­è¯»å–æ•°æ®æ—¶å‘ç°ç²˜è¿çš„æ•°æ®åŒ…æ—¶ï¼Œéœ€è¦å¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œæ‹†åˆ†ã€‚

ç²˜åŒ…å¹¶ä¸æ˜¯ TCP åè®®é€ æˆçš„ï¼Œå®ƒçš„å‡ºç°æ˜¯å› ä¸ºåº”ç”¨å±‚åè®®è®¾è®¡è€…å¯¹ TCP åè®®çš„é”™è¯¯ç†è§£ï¼Œå¿½ç•¥äº† TCP åè®®çš„å®šä¹‰å¹¶ä¸”ç¼ºä¹è®¾è®¡åº”ç”¨å±‚åè®®çš„ç»éªŒã€‚æœ¬æ–‡å°†ä» TCP åè®®ä»¥åŠåº”ç”¨å±‚åè®®å‡ºå‘ï¼Œåˆ†ææˆ‘ä»¬ç»å¸¸æåˆ°çš„ TCP åè®®ä¸­çš„ç²˜åŒ…æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼š

* TCP åè®®æ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼Œå®ƒå¯èƒ½ä¼šç»„åˆæˆ–è€…æ‹†åˆ†åº”ç”¨å±‚åè®®çš„æ•°æ®ï¼›
* åº”ç”¨å±‚åè®®çš„æ²¡æœ‰å®šä¹‰æ¶ˆæ¯çš„è¾¹ç•Œå¯¼è‡´æ•°æ®çš„æ¥æ”¶æ–¹æ— æ³•æ‹¼æ¥æ•°æ®ï¼›

å¾ˆå¤šäººå¯èƒ½ä¼šè®¤ä¸ºç²˜åŒ…æ˜¯ä¸€ä¸ªæ¯”è¾ƒä½çº§çš„ç”šè‡³ä¸å€¼å¾—è®¨è®ºçš„é—®é¢˜ï¼Œä½†æ˜¯åœ¨ä½œè€…çœ‹æ¥è¿™ä¸ªé—®é¢˜è¿˜æ˜¯å¾ˆæœ‰è¶£çš„ï¼Œä¸æ˜¯æ‰€æœ‰äººéƒ½ç³»ç»Ÿæ€§åœ°å­¦è¿‡åŸºäº TCP çš„åº”ç”¨å±‚åè®®è®¾è®¡ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰äººå¯¹ TCP åè®®éƒ½æœ‰é‚£ä¹ˆæ·±å…¥çš„ç†è§£ï¼Œç›¸ä¿¡å¾ˆå¤šäººå­¦ä¹ ç¼–ç¨‹çš„è¿‡ç¨‹éƒ½æ˜¯è‡ªåº•å‘ä¸Šçš„ï¼Œæ‰€ä»¥ä½œè€…è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå€¼å¾—å›ç­”çš„é—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥ä¼ é€’æ­£ç¡®çš„çŸ¥è¯†ï¼Œè€Œä¸æ˜¯è´Ÿé¢çš„å’Œå±…é«˜ä¸´ä¸‹çš„æƒ…ç»ªã€‚

é¢å‘å­—èŠ‚æµ
-----

TCP åè®®æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®®[3](#)ï¼Œåº”ç”¨å±‚äº¤ç»™ TCP åè®®çš„æ•°æ®å¹¶ä¸ä¼šä»¥æ¶ˆæ¯ä¸ºå•ä½å‘ç›®çš„ä¸»æœºä¼ è¾“ï¼Œè¿™äº›æ•°æ®åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè¢«ç»„åˆæˆä¸€ä¸ªæ•°æ®æ®µå‘é€ç»™ç›®æ ‡çš„ä¸»æœºã€‚

Nagle ç®—æ³•æ˜¯ä¸€ç§é€šè¿‡å‡å°‘æ•°æ®åŒ…çš„æ–¹å¼æé«˜ TCP ä¼ è¾“æ€§èƒ½çš„ç®—æ³•[4](#)ã€‚å› ä¸ºç½‘ç»œ å¸¦å®½æœ‰é™ï¼Œå®ƒä¸ä¼šå°†å°çš„æ•°æ®å—ç›´æ¥å‘é€åˆ°ç›®çš„ä¸»æœºï¼Œè€Œæ˜¯ä¼šåœ¨æœ¬åœ°ç¼“å†²åŒºä¸­ç­‰å¾…æ›´å¤šå¾…å‘é€çš„æ•°æ®ï¼Œè¿™ç§æ‰¹é‡å‘é€æ•°æ®çš„ç­–ç•¥è™½ç„¶ä¼šå½±å“å®æ—¶æ€§å’Œç½‘ç»œå»¶è¿Ÿï¼Œä½†æ˜¯èƒ½å¤Ÿé™ä½ç½‘ç»œæ‹¥å µçš„å¯èƒ½æ€§å¹¶å‡å°‘é¢å¤–å¼€é”€ã€‚

åœ¨æ—©æœŸçš„äº’è”ç½‘ä¸­ï¼ŒTelnet æ˜¯è¢«å¹¿æ³›ä½¿ç”¨çš„åº”ç”¨ç¨‹åºï¼Œç„¶è€Œä½¿ç”¨ Telnet ä¼šäº§ç”Ÿå¤§é‡åªæœ‰ 1 å­—èŠ‚è´Ÿè½½çš„æœ‰æ•ˆæ•°æ®ï¼Œæ¯ä¸ªæ•°æ®åŒ…éƒ½ä¼šæœ‰ 40 å­—èŠ‚çš„é¢å¤–å¼€é”€ï¼Œå¸¦å®½çš„åˆ©ç”¨ç‡åªæœ‰ ~2.44%ï¼ŒNagle ç®—æ³•å°±æ˜¯åœ¨å½“æ—¶çš„è¿™ç§åœºæ™¯ä¸‹è®¾è®¡çš„ã€‚

å½“åº”ç”¨å±‚åè®®é€šè¿‡ TCP åè®®ä¼ è¾“æ•°æ®æ—¶ï¼Œå®é™…ä¸Šå¾…å‘é€çš„æ•°æ®å…ˆè¢«å†™å…¥äº† TCP åè®®çš„ç¼“å†²åŒºï¼Œå¦‚æœç”¨æˆ·å¼€å¯äº† Nagle ç®—æ³•ï¼Œé‚£ä¹ˆ TCP åè®®å¯èƒ½ä¸ä¼šç«‹åˆ»å‘é€å†™å…¥çš„æ•°æ®ï¼Œå®ƒä¼šç­‰å¾…ç¼“å†²åŒºä¸­æ•°æ®è¶…è¿‡æœ€å¤§æ•°æ®æ®µï¼ˆMSSï¼‰æˆ–è€…ä¸Šä¸€ä¸ªæ•°æ®æ®µè¢« ACK æ—¶æ‰ä¼šå‘é€ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚

![](https://img.draveness.me/2020-03-05-15834216958612-nagle-algorithm.png)

**å›¾ 2 - Nagle ç®—æ³•**

å‡ åå¹´å‰è¿˜ä¼šå‘ç”Ÿç½‘ç»œæ‹¥å¡çš„é—®é¢˜ï¼Œä½†æ˜¯ä»Šå¤©çš„ç½‘ç»œå¸¦å®½èµ„æºä¸å†åƒè¿‡å»é‚£ä¹ˆç´§å¼ ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux å†…æ ¸éƒ½ä¼šä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼é»˜è®¤å…³é—­ Nagle ç®—æ³•ï¼š
```c
TCP_NODELAY = 1
```
Linux å†…æ ¸ä¸­ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ [tcp_nagle_test](https://github.com/torvalds/linux/blob/bd2463ac7d7ec51d432f23bf0e893fb371a908cd/net/ipv4/tcp_output.c#L1897) å‡½æ•°æµ‹è¯•æˆ‘ä»¬æ˜¯å¦åº”è¯¥å‘é€å½“å‰çš„ TCP æ•°æ®æ®µï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ä»¥è¿™æ®µä»£ç ä¸ºå…¥å£è¯¦ç»†äº†è§£ Nagle ç®—æ³•åœ¨ä»Šå¤©çš„å®ç°ï¼š

```c
static inline bool tcp_nagle_test(const struct tcp_sock *tp, const struct sk_buff *skb,
				  unsigned int cur_mss, int nonagle)
{
	if (nonagle & TCP_NAGLE_PUSH)
		return true;

	if (tcp_urg_mode(tp) || (TCP_SKB_CB(skb)->tcp_flags & TCPHDR_FIN))
		return true;

	if (!tcp_nagle_check(skb->len < cur_mss, tp, nonagle))
		return true;

	return false;
}
```

Nagle ç®—æ³•ç¡®å®èƒ½å¤Ÿåœ¨æ•°æ®åŒ…è¾ƒå°æ—¶æé«˜ç½‘ç»œå¸¦å®½çš„åˆ©ç”¨ç‡å¹¶å‡å°‘ TCP å’Œ IP åè®®å¤´å¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œä½†æ˜¯ä½¿ç”¨è¯¥ç®—æ³•ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨å±‚åè®®å¤šæ¬¡å†™å…¥çš„æ•°æ®è¢«åˆå¹¶æˆ–è€…æ‹†åˆ†å‘é€ï¼Œå½“æ¥æ”¶æ–¹ä» TCP åè®®æ ˆä¸­è¯»å–æ•°æ®æ—¶ä¼šå‘ç°ä¸ç›¸å…³çš„æ•°æ®å‡ºç°åœ¨äº†åŒä¸€ä¸ªæ•°æ®æ®µä¸­ï¼Œåº”ç”¨å±‚åè®®å¯èƒ½æ²¡æœ‰åŠæ³•å¯¹å®ƒä»¬è¿›è¡Œæ‹†åˆ†å’Œé‡ç»„ã€‚

é™¤äº† Nagle ç®—æ³•ä¹‹å¤–ï¼ŒTCP åè®®æ ˆä¸­è¿˜æœ‰å¦ä¸€ä¸ªç”¨äºå»¶è¿Ÿå‘é€æ•°æ®çš„é€‰é¡¹ `TCP_CORK`ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯è¯¥é€‰é¡¹ï¼Œé‚£ä¹ˆå½“å‘é€çš„æ•°æ®å°äº MSS æ—¶ï¼ŒTCP åè®®å°±ä¼šå»¶è¿Ÿ 200ms å‘é€è¯¥æ•°æ®æˆ–è€…ç­‰å¾…ç¼“å†²åŒºä¸­çš„æ•°æ®è¶…è¿‡ MSSã€‚

æ— è®ºæ˜¯ `TCP_NODELAY` è¿˜æ˜¯ `TCP_CORK`ï¼Œå®ƒä»¬éƒ½ä¼šé€šè¿‡å»¶è¿Ÿå‘é€æ•°æ®æ¥æé«˜å¸¦å®½çš„åˆ©ç”¨ç‡ï¼Œå®ƒä»¬ä¼šå¯¹åº”ç”¨å±‚åè®®å†™å…¥çš„æ•°æ®è¿›è¡Œæ‹†åˆ†å’Œé‡ç»„ï¼Œè€Œè¿™äº›æœºåˆ¶å’Œé…ç½®èƒ½å¤Ÿå‡ºç°çš„æœ€é‡è¦åŸå› æ˜¯ â€” TCP åè®®æ˜¯åŸºäºå­—èŠ‚æµçš„åè®®ï¼Œå…¶æœ¬èº«æ²¡æœ‰æ•°æ®åŒ…çš„æ¦‚å¿µï¼Œä¸ä¼šæŒ‰ç…§æ•°æ®åŒ…å‘é€æ•°æ®ã€‚

æ¶ˆæ¯è¾¹ç•Œ
----

å¦‚æœæˆ‘ä»¬ç³»ç»Ÿæ€§åœ°å­¦ä¹ è¿‡ TCP åè®®ä»¥åŠåŸºäº TCP çš„åº”ç”¨å±‚åè®®è®¾è®¡ï¼Œé‚£ä¹ˆè®¾è®¡ä¸€ä¸ªèƒ½å¤Ÿè¢« TCP åè®®æ ˆä»»æ„æ‹†åˆ†å’Œç»„è£…æ•°æ®åŒ…çš„åº”ç”¨å±‚åè®®å°±ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚æ—¢ç„¶ TCP åè®®æ˜¯åŸºäºå­—èŠ‚æµçš„ï¼Œè¿™å…¶å®å°±æ„å‘³ç€åº”ç”¨å±‚åè®®è¦è‡ªå·±åˆ’åˆ†æ¶ˆæ¯çš„è¾¹ç•Œã€‚

å¦‚æœæˆ‘ä»¬èƒ½åœ¨åº”ç”¨å±‚åè®®ä¸­å®šä¹‰æ¶ˆæ¯çš„è¾¹ç•Œï¼Œé‚£ä¹ˆæ— è®º TCP åè®®å¦‚ä½•å¯¹åº”ç”¨å±‚åè®®çš„æ•°æ®åŒ…è¿›ç¨‹æ‹†åˆ†å’Œé‡ç»„ï¼Œæ¥æ”¶æ–¹éƒ½èƒ½æ ¹æ®åè®®çš„è§„åˆ™æ¢å¤å¯¹åº”çš„æ¶ˆæ¯ã€‚åœ¨åº”ç”¨å±‚åè®®ä¸­ï¼Œæœ€å¸¸è§çš„ä¸¤ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŸºäºé•¿åº¦æˆ–è€…åŸºäºç»ˆç»“ç¬¦ï¼ˆDelimiterï¼‰ã€‚

![](https://img.draveness.me/2020-03-05-15834216958643-message-framing.png)

**å›¾ 3 - å®ç°æ¶ˆæ¯è¾¹ç•Œçš„æ–¹æ³•**

åŸºäºé•¿åº¦çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å›ºå®šé•¿åº¦ï¼Œæ‰€æœ‰çš„åº”ç”¨å±‚æ¶ˆæ¯éƒ½ä½¿ç”¨ç»Ÿä¸€çš„å¤§å°ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ä¸å›ºå®šé•¿åº¦ï¼Œä½†æ˜¯éœ€è¦åœ¨åº”ç”¨å±‚åè®®çš„åè®®å¤´ä¸­å¢åŠ è¡¨ç¤ºè´Ÿè½½é•¿åº¦çš„å­—æ®µï¼Œè¿™æ ·æ¥æ”¶æ–¹æ‰å¯ä»¥ä»å­—èŠ‚æµä¸­åˆ†ç¦»å‡ºä¸åŒçš„æ¶ˆæ¯ï¼ŒHTTP åè®®çš„æ¶ˆæ¯è¾¹ç•Œå°±æ˜¯åŸºäºé•¿åº¦å®ç°çš„ï¼š

```html
HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Content-Length: 138
...
Connection: close

<html>
    <head>
    <title>An Example Page</title>
    </head>
    <body>
    <p>Hello World, this is a very simple HTML document.</p>
    </body>
</html>
```

åœ¨ä¸Šè¿° HTTP æ¶ˆæ¯ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Content-Length` å¤´è¡¨ç¤º HTTP æ¶ˆæ¯çš„è´Ÿè½½å¤§å°ï¼Œå½“åº”ç”¨å±‚åè®®è§£æåˆ°è¶³å¤Ÿçš„å­—èŠ‚æ•°åï¼Œå°±èƒ½ä»ä¸­åˆ†ç¦»å‡ºå®Œæ•´çš„ HTTP æ¶ˆæ¯ï¼Œæ— è®ºå‘é€æ–¹å¦‚ä½•å¤„ç†å¯¹åº”çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥éµå¾ªè¿™ä¸€è§„åˆ™å®Œæˆ HTTP æ¶ˆæ¯çš„é‡ç»„[6](#)ã€‚

ä¸è¿‡ HTTP åè®®é™¤äº†ä½¿ç”¨åŸºäºé•¿åº¦çš„æ–¹å¼å®ç°è¾¹ç•Œï¼Œä¹Ÿä¼šä½¿ç”¨åŸºäºç»ˆç»“ç¬¦çš„ç­–ç•¥ï¼Œå½“ HTTP ä½¿ç”¨å—ä¼ è¾“ï¼ˆChunked Transferï¼‰æœºåˆ¶æ—¶ï¼ŒHTTP å¤´ä¸­å°±ä¸å†åŒ…å« `Content-Length` äº†ï¼Œå®ƒä¼šä½¿ç”¨è´Ÿè½½å¤§å°ä¸º 0 çš„ HTTP æ¶ˆæ¯ä½œä¸ºç»ˆç»“ç¬¦è¡¨ç¤ºæ¶ˆæ¯çš„è¾¹ç•Œã€‚

å½“ç„¶é™¤äº†è¿™ä¸¤ç§æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºç‰¹å®šçš„è§„åˆ™å®ç°æ¶ˆæ¯çš„è¾¹ç•Œï¼Œä¾‹å¦‚ï¼šä½¿ç”¨ TCP åè®®å‘é€ JSON æ•°æ®ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ®æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿè¢«è§£ææˆåˆæ³•çš„ JSON åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦ç»ˆç»“ã€‚

æ€»ç»“
--

TCP åè®®ç²˜åŒ…é—®é¢˜æ˜¯å› ä¸ºåº”ç”¨å±‚åè®®å¼€å‘è€…çš„é”™è¯¯è®¾è®¡å¯¼è‡´çš„ï¼Œä»–ä»¬å¿½ç•¥äº† TCP åè®®æ•°æ®ä¼ è¾“çš„æ ¸å¿ƒæœºåˆ¶ â€” åŸºäºå­—èŠ‚æµï¼Œå…¶æœ¬èº«ä¸åŒ…å«æ¶ˆæ¯ã€æ•°æ®åŒ…ç­‰æ¦‚å¿µï¼Œæ‰€æœ‰æ•°æ®çš„ä¼ è¾“éƒ½æ˜¯æµå¼çš„ï¼Œéœ€è¦åº”ç”¨å±‚åè®®è‡ªå·±è®¾è®¡æ¶ˆæ¯çš„è¾¹ç•Œï¼Œå³æ¶ˆæ¯å¸§ï¼ˆMessage Framingï¼‰ï¼Œæˆ‘ä»¬é‡æ–°å›é¡¾ä¸€ä¸‹ç²˜åŒ…é—®é¢˜å‡ºç°çš„æ ¸å¿ƒåŸå› ï¼š

1. TCP åè®®æ˜¯åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚åè®®ï¼Œå…¶ä¸­ä¸å­˜åœ¨æ¶ˆæ¯å’Œæ•°æ®åŒ…çš„æ¦‚å¿µï¼›
2. åº”ç”¨å±‚åè®®æ²¡æœ‰ä½¿ç”¨åŸºäºé•¿åº¦æˆ–è€…åŸºäºç»ˆç»“ç¬¦çš„æ¶ˆæ¯è¾¹ç•Œï¼Œå¯¼è‡´å¤šä¸ªæ¶ˆæ¯çš„ç²˜è¿ï¼›

ç½‘ç»œåè®®çš„å­¦ä¹ è¿‡ç¨‹éå¸¸æœ‰è¶£ï¼Œä¸æ–­æ€è€ƒèƒŒåçš„é—®é¢˜èƒ½å¤Ÿè®©æˆ‘ä»¬å¯¹å®šä¹‰æœ‰æ›´æ·±çš„è®¤è¯†ã€‚åˆ°æœ€åï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸€äº›æ¯”è¾ƒå¼€æ”¾çš„ç›¸å…³é—®é¢˜ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ä»”ç»†æ€è€ƒä¸€ä¸‹ä¸‹é¢çš„é—®é¢˜ï¼š

* åŸºäº UDP åè®®çš„åº”ç”¨å±‚åè®®åº”è¯¥å¦‚ä½•è®¾è®¡ï¼Ÿä¼šå‡ºç°ç²˜åŒ…çš„é—®é¢˜ä¹ˆï¼Ÿ
* æœ‰å“ªäº›åº”ç”¨å±‚åè®®ä½¿ç”¨åŸºäºé•¿åº¦çš„åˆ†å¸§ï¼Ÿåˆæœ‰å“ªäº›ä½¿ç”¨åŸºäºç»ˆç»“ç¬¦çš„åˆ†å¸§ï¼Ÿ

> å¦‚æœå¯¹æ–‡ç« ä¸­çš„å†…å®¹æœ‰ç–‘é—®æˆ–è€…æƒ³è¦äº†è§£æ›´å¤šè½¯ä»¶å·¥ç¨‹ä¸Šä¸€äº›è®¾è®¡å†³ç­–èƒŒåçš„åŸå› ï¼Œå¯ä»¥åœ¨åšå®¢ä¸‹é¢ç•™è¨€ï¼Œä½œè€…ä¼šåŠæ—¶å›å¤æœ¬æ–‡ç›¸å…³çš„ç–‘é—®å¹¶é€‰æ‹©å…¶ä¸­åˆé€‚çš„ä¸»é¢˜ä½œä¸ºåç»­çš„å†…å®¹ã€‚

ç›¸å…³æ–‡ç« 
----

* [ä¸ºä»€ä¹ˆ TCP å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹](https://draveness.me/whys-the-design-tcp-three-way-handshake)
* [ä¸ºä»€ä¹ˆ TCP/IP åè®®ä¼šæ‹†åˆ†æ•°æ®](https://draveness.me/whys-the-design-tcp-segment-ip-packet)

æ¨èé˜…è¯»
----

* JC Mogul. â€œRethinking the TCP Nagle Algorithmâ€ [http://ccr.sigcomm.org/archive/2001/jan01/ccr-200101-mogul.pdf](http://ccr.sigcomm.org/archive/2001/jan01/ccr-200101-mogul.pdf)
* Stephen Cleary. Apr 30, 2009. â€œMessage Framingâ€ [https://blog.stephencleary.com/2009/04/message-framing.html](https://blog.stephencleary.com/2009/04/message-framing.html)

1. [Wikipedia: Internet protocol suite](https://en.wikipedia.org/wiki/Internet_protocol_suite) [â†©ï¸](#1)

2.  [What is the Internet Protocol?](https://www.cloudflare.com/learning/ddos/glossary/internet-protocol/) [â†©ï¸](#2)

3. [Wikipedia: Transmission Control Procol](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) [â†©ï¸](#3)

4. [Nagle, J., â€œCongestion Control in IP/TCP Internetworksâ€, RFC 896, DOI 10.17487/RFC0896, January 1984](https://www.rfc-editor.org/info/rfc896). [â†©ï¸](#4)

5.  [Is there any significant difference between TCP\_CORK and TCP\_NODELAY in this use-case?](https://stackoverflow.com/questions/22124098/is-there-any-significant-difference-between-tcp-cork-and-tcp-nodelay-in-this-use) [â†©ï¸](#5)

6. [Wikipedia: Hypertext Transfer Protocol](https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol) [â†©ï¸](#6)
