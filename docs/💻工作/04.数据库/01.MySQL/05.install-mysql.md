---
title: Linux å®‰è£… MySQLï¼ˆåŒ…å«æºç å®‰è£…å’Œ yum å®‰è£…ï¼‰
date: 2020-12-25 12:55:13
permalink: /mysql/install/
categories:
  - ğŸ’»å·¥ä½œ
  - æ•°æ®åº“
  - MySQL
tags:
  - MySQL
  - Linux
---

åœ¨`Linux`ä¸Šé¢å®‰è£…`MySQL`æœ¬åº”è¯¥æ˜¯å¾ˆå®¹æ˜“çš„ä¸€ä»¶äº‹ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ä¸æ³¨æ„ç»†èŠ‚è¿˜æ˜¯å¾ˆå®¹æ˜“â€œç¿»è½¦â€ï¼Œå‡ºç°ä¸€äº›é¢„æ–™ä¸åˆ°çš„é—®é¢˜ã€‚æœ¬æ–‡åœ¨å®è·µä¸­åšä¸€ä¸ªç®€å•çš„è®°å½•ã€‚

<!--more-->

## Yum å®‰è£…
1.  å¸è½½ä¹‹å‰çš„ MySQLï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
```bash    
pkill -9 mysqld  # åœæ­¢MySQL
rpm -qa | grep -i mysql # åˆ—å‡ºç°æœ‰çš„MySQLå®‰è£…åŒ…
yum -y remove åŒ…å # ä½¿ç”¨è¿™ä¸ªå‘½ä»¤åˆ é™¤åˆ—å‡ºæ¥çš„åŒ…å
rpm -ev  åŒ…å # å¦‚æœyumåˆ é™¤ä¸äº†,å°±ç”¨è¿™ä¸ªå‘½ä»¤åˆ 
```
2.  ä¸‹è½½ MySQL æº
```bash  
wget http://repo.mysql.com/mysql57-community-release-el7-8.noarch.rpm 
rpm -ivh mysql57-community-release-el7-8.noarch.rpm 
```
3.  æ›¿æ¢æ¸…åæº
æ ¹æ®è¿™ä¸ªåœ°å€ `https://mirror.tuna.tsinghua.edu.cn/help/centos/` è®¾ç½®æ¸…åå¤§å­¦çš„æºï¼Œæ³¨æ„æŠŠ `gpgcheck=1` æ”¹ä¸º `gpgcheck=0` ï¼Œ å¦åˆ™å®‰è£…ä¼šå¤±è´¥
```plain
# CentOS-Base.repo
#
# The mirror system uses the connecting IP address of the client and the
# update status of each mirror to pick mirrors that are updated to and
# geographically close to the client.  You should use this for CentOS updates
# unless you are manually picking other mirrors.
#
# If the mirrorlist= does not work for you, as a fall back you can try the
# remarked out baseurl= line instead.
#
#


[base]
name=CentOS-$releasever - Base
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/os/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7

#released updates
[updates]
name=CentOS-$releasever - Updates
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/updates/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7



#additional packages that may be useful
[extras]
name=CentOS-$releasever - Extras
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/extras/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras
enabled=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7


#additional packages that extend functionality of existing packages
[centosplus]
name=CentOS-$releasever - Plus
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos/$releasever/centosplus/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplus
gpgcheck=0
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7

```
4. æ‰§è¡Œå®‰è£…
```bash
yum -y install mysql-server 
```
5. å¯åŠ¨æœåŠ¡
```bash
systemctl enable mysqld
systemctl start mysqld
```
::: danger
å¦‚æœå¯åŠ¨æœåŠ¡æŠ¥é”™ï¼Œ
1. å¦‚æœæ˜¯ SELinux é—®é¢˜ï¼Œè¯·å‚é˜…[è§£å†³ Linux-Centos7 å¯åŠ¨ Mysql æœåŠ¡å¤±è´¥_ç¼–ç¨‹æ¸£-ç‹çˆ½-CSDN åšå®¢](https://blog.csdn.net/wsh_0703/article/details/80278370)
2. `datadir`ä¸å¯¹
```plain
2020-12-25T05:54:16.053547Z 0 [Warning] Failed to open optimizer cost constant tables

2020-12-25T05:54:16.053696Z 0 [ERROR] Fatal error: Can't open and lock privilege tables: Table 'mysql.user' doesn't exist
2020-12-25T05:54:16.053715Z 0 [ERROR] Fatal error: Failed to initialize ACL/grant/time zones structures or failed to remove temporary table files.
2020-12-25T05:54:16.053760Z 0 [ERROR] Aborting

```
ä¿®æ”¹`/etc/my.conf`ä¸­çš„`datadir=/var/lib/mysql/mysql`ï¼Œæ ¹æ®å®é™…ä¿®æ”¹
å‚é˜…ï¼š[Can't open and lock privilege tables: Table 'mysql.user' doesn't exist - Stack Overflow](https://stackoverflow.com/questions/34516664/cant-open-and-lock-privilege-tables-table-mysql-user-doesnt-exist)
:::

6. ä»¥åŸå§‹å¯†ç ç™»å½•
```bash
grep 'password' /var/log/mysqld.log # ä»è¿™é‡Œæ‹¿åˆ°åˆå§‹åŒ–çš„å¯†ç 
mysql -uroot -p # ç™»å½•
```
7. ä¿®æ”¹å¯†ç å®‰å…¨ç­–ç•¥
åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨ï¼Œå¯†ç å¯ä»¥å¼„ç®€å•ç‚¹ï¼Œç”Ÿäº§å»ºè®®éœ€è¦è®¾ç½®å¤æ‚
```bash
set global validate_password_length=0; # å¯†ç æœ€å°é•¿åº¦ç­–ç•¥
set global validate_password_policy=0; # å¯†ç å¼ºåº¦æ£€æŸ¥ç­‰çº§ç­–ç•¥ï¼Œ0/LOWã€1/MEDIUMã€2/STRONG
set password for 'root'@'localhost' = password('123456');   # å¯†ç ä¿®æ”¹ä¸ºçœŸå®å®é™…å¯†ç 
```
å‚è€ƒé…ç½®ï¼š
```plain
[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M
datadir=/var/lib/mysql/mysql
socket=/var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
# ç¼–ç 
character_set_server=utf8 
init_connect='SET NAMES utf8'
```
8. å¼€å¯ mysql è¿œç¨‹è¿æ¥ï¼ˆå¯é€‰ï¼‰
```bash
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
flush privileges;
```
9. æ”¾å¼€æœåŠ¡å™¨ç«¯å£æƒé™ï¼ˆå¦‚æœé€‰æ‹©ä¸Šæ­¥ï¼‰
```bash
firewall-cmd --zone=public --add-port=3306/tcp --permanent
firewall-cmd --reload
```

## æºç å®‰è£…

### Linux
```bash
[root@172 mysql]# uname -a
Linux 172.18.1.117 3.10.0-957.el7.x86_64 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
# å‘è¡Œç‰ˆæœ¬
[root@172 mysql]# cat /etc/redhat-release
CentOS Linux release 7.6.1810 (Core) 
```
###  MySQL ç‰ˆæœ¬
```bash
# å®‰è£…å®Œæˆä¹‹åæ‰å¯ä»¥æŸ¥è¯¢åˆ°
[root@172 mysql]# mysql --version
mysql  Ver 14.14 Distrib 5.7.26, for linux-glibc2.12 (x86_64) using  EditLine wrapper
```
## ä¸‹è½½
ç‚¹å‡»[æ­¤é“¾æ¥](https://dev.mysql.com/downloads/mysql/)é€‰æ‹©é€‚å®œç‰ˆæœ¬ä¸‹è½½ï¼›  
å¦‚å›¾æ‰€ç¤ºè¿›è¡Œé€‰æ‹©

![é€‰æ‹©åˆé€‚ç‰ˆæœ¬ä¸‹è½½](https://cdn.jsdelivr.net/gh/masantu/statics@master/images/download-mysql.png)

æˆ–è€…ä½¿ç”¨`wget`ä¸‹è½½ï¼š
```bash
wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.26-linux-glibc2.12-x86_64.tar.gz
```

## è§£å‹
æˆ‘ä¸€èˆ¬ä¹ æƒ¯åœ¨å·¥ä½œç›®å½•æ–°å»º`temp`æ–‡ä»¶å¤¹ï¼Œç„¶åå­˜æ”¾è¿™äº›ä¸´æ—¶æ–‡ä»¶ã€‚
```bash
pwd
/root/temp/
tar -xzvf mysql-5.7.26-linux-glibc2.12-x86_64.tar.gz
# çœç•¥è§£å‹ç»“æœ
â€¦â€¦
```
## åˆ›å»ºå®‰è£…ç›®å½•å¹¶åˆ‡æ¢
```bash
# åˆ›å»ºæ–‡ä»¶å¤¹
mkdir /usr/local/mysql
# å°†è§£å‹æ–‡ä»¶ç§»åŠ¨åˆ°æ–°å»ºç›®å½•
mv mysql-5.7.26-linux-glibc2.12-x86_64/* /usr/local/mysql/
# åˆ‡æ¢ç›®å½•
cd /usr/local/mysql
```
## æ£€æŸ¥å¹¶åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„
```bash
[root@localhost local]# cat /etc/group | grep mysql
[root@localhost local]# cat /etc/passwd |grep mysql
[root@localhost local]# groupadd mysql
[root@localhost local]# useradd -r -g mysql mysql
```
### åˆ›å»ºæ•°æ®å­˜å‚¨ç›®å½•å¹¶èµ‹æƒ

**æ³¨æ„**ï¼šå¿˜è®°æˆæƒä¼šå‡ºé—®é¢˜ï¼Œå„ç§å„æ ·çš„é—®é¢˜ã€‚æˆ‘ç¬¬ä¸€æ¬¡å®‰è£…çš„æ—¶å€™æ²¡æœ‰æ–°å»ºç”¨æˆ·å¹¶èµ‹äºˆç›¸åº”æƒé™ï¼Œå¯¼è‡´å®‰è£…å‡ºç°
`Starting MySQL... ERROR! The server quit without updating PID file (/var/lib/mysql/xxx.pid).`ç­‰å„ç§é—®é¢˜ã€‚
```bash
mkdir data
# ç”¨æˆ·èµ‹æƒ
chown -R mysql mysql/
chgrp -R mysql mysql/
```
## å®‰è£…å¹¶åˆå§‹åŒ–

```bash
/usr/local/mysql/bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data/   
--pid-file=/usr/local/mysql/data/mysql.pid --lc_messages_dir=/usr/local/mysql/share --lc_messages=en_US
```
**æ³¨æ„**:
1. ç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ²¡æœ‰è®¾ç½®`--lc_messages_dir`å’Œ `--lc_messages`å‡ºç°ä»¥ä¸‹æŠ¥é”™ï¼Œæ‰€ä»¥å»ºè®®ç›´æ¥ä½¿ç”¨å®Œæ•´çš„å‘½ä»¤ï¼Œå¦‚æœå·²ç»å‡ºç°ä¸‹é¢çš„æŠ¥é”™ã€‚å¯ä»¥ä½¿ç”¨`rm -rf /usr/local/mysql/data/*`å°†æ•°æ®åˆ é™¤ä¹‹åé‡æ–°åˆå§‹åŒ–ï¼›
```bash
2019-06-23T08:38:15.774307Z 0 [ERROR] Can't find error-message file '/usr/local/mysql/share/errmsg.sys'. Check error-message file location and 'lc-messages-dir' configuration directive.
```
2. æ­¤æ­¥éª¤å¦‚æœå‡ºç°`ERROR`é”™è¯¯ä¸€å®šè¦æ³¨æ„è§£å†³ï¼Œä¸èƒ½ç»§ç»­æ“ä½œï¼Œå¦‚ï¼š
    ```bash
    [ERROR] Can't find error-message file '/usr/local/mysql/share/errmsg.sys'. Check error-message file location and 'lc-messages-dir' configuration directive.
    ```
3. è®°ä½æœ€åä¸€è¡Œç”Ÿæˆçš„éšæœºå¯†ç ï¼Œå®‰è£…æˆåŠŸåç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦ä½¿ç”¨ï¼š
    ```bash
    # æ­¤å¤„å¯†ç éšæœºç”Ÿæˆï¼Œæ³¨æ„è®°å½•
    2019-06-23T08:52:37.416821Z 1 [Note] A temporary password is generated for root@localhost: PDRO-ab.a8jd
    ```
4. æœ€å®¹æ˜“å‡ºç°è¿™ä¸ªé”™è¯¯ï¼š`Starting MySQL. ERROR! The server quit without updating PID file`ï¼Œç½‘ä¸Šæœåˆ°çš„è§£å†³æ–¹æ¡ˆæ²¡æœ‰å•¥ç”¨ï¼Œæˆ‘æœ¬æ¬¡å®‰è£…èµ°åˆ°è¿™é‡Œæ²¡æœ‰å‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œä½†æ˜¯ä¸‹é¢*å¯åŠ¨æœåŠ¡*ç¯èŠ‚å‡ºç°è¯¥æŠ¥é”™ï¼Œä½¿ç”¨`rm  /etc/my.cnf -rf`å±…ç„¶æœ‰ç”¨ï¼Œæš‚æ—¶ä¸çŸ¥é“é€ æˆåŸå› ã€‚
### ä½¿ç”¨ mysqld_safe å¯åŠ¨æœåŠ¡
```bash
/usr/local/mysql/bin/mysqld_safe --user=mysql
2019-06-23T09:00:10.100530Z mysqld_safe error: log-error set to '/var/log/mariadb/mariadb.log', however file don't exists. Create writable for user 'mysql'.
```
æ ¹æ®æç¤ºä¿®æ”¹é…ç½®æˆ–è€…æ–°å»º`log`æ—¥å¿—å­˜æ”¾ç›®å½•
```bash
[root@172 mysql]# mkdir /var/log/mariadb
[root@172 mysql]# touch /var/log/mariadb/mariadb.log
```
å†æ¬¡å¯åŠ¨
```bash
[root@172 mysql]# bin/mysqld_safe --user=mysql
2019-06-23T09:00:58.541328Z mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.
2019-06-23T09:00:58.546897Z mysqld_safe Directory '/var/lib/mysql' for UNIX socket file don't exists.
```
###  æ ¹æ®æŠ¥é”™ä¿¡æ¯ä¿®æ”¹ my.cnf ä¸­çš„é…ç½®é¡¹
```bash
[root@172 mysql]# vi /etc/my.cnf
# æ­¤å¤„çœç•¥ï¼Œæ¯ä¸ªäººçš„é…ç½®ä¸ä¸€æ ·ï¼ˆæˆ‘å·²ç»å°†è¯¥æ–‡ä»¶åˆ é™¤äº†ï¼Œæ²¡åŠæ³•è®°ä½æ€ä¹ˆé…ç½®çš„äº†ï¼Œè¿™é‡Œçš„é”™è¯¯ä¿¡æ¯å¾ˆæ˜ç¡®ï¼Œæ ¹æ®é”™è¯¯ä¿®æ”¹åˆ°ä¸æŠ¥é”™å³å¯ï¼‰
[root@172 mysql]# bin/mysqld_safe --user=mysql
2019-06-23T09:03:54.795490Z mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.
2019-06-23T09:03:54.845647Z mysqld_safe Starting mysqld daemon with databases from /usr/local/mysql/data
2019-06-23T09:03:55.148856Z mysqld_safe mysqld from pid file /var/run/mariadb/mariadb.pid ended
```
### åŠ å…¥å¼€æœºè‡ªå¯åŠ¨é¡¹
å°†`/usr/local/mysql/support-files/mysql.server` æ‹·è´ä¸º`/etc/init.d/mysql`å¹¶è®¾ç½®è¿è¡Œæƒé™ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨`service mysql`å‘½ä»¤å¯åŠ¨/åœæ­¢æœåŠ¡ï¼Œ
å¦åˆ™å°±åªèƒ½ä½¿ç”¨`/usr/local/mysql/bin/mysqld_safe`å‘½ä»¤æ¥å¯åŠ¨æœåŠ¡
å¦‚æœè‡ªå®šä¹‰äº†å®‰è£…è·¯å¾„,è¿˜éœ€è¦æŠŠ`mysql.server`ä¸­`basedir`çš„ç›¸å…³è·¯å¾„ï¼Œæ”¹ä¸ºè‡ªå®šä¹‰çš„è·¯å¾„ï¼Œé»˜è®¤è·¯å¾„æ˜¯`/usr/local/mysql`ã€‚æœ¬æ–‡ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼Œæ‰€ä»¥ä¸ç”¨ä¿®æ”¹ã€‚
```bash
[root@dbserver support-files]# cp mysql.server /etc/init.d/mysql  
[root@dbserver support-files]# chmod +x /etc/init.d/mysql 
-- æŠŠmysqlæ³¨å†Œä¸ºå¼€æœºå¯åŠ¨çš„æœåŠ¡
[root@dbserver support-files]# chkconfig --add mysql  
-- æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸ
[root@dbserver support-files]#  chkconfig --list mysql  
Note: This output shows SysV services only and does not include native
      systemd services. SysV configuration data might be overridden by native
      systemd configuration.

      If you want to list systemd services use 'systemctl list-unit-files'.
      To see services enabled on particular target use
      'systemctl list-dependencies [target]'.

mysql          	0:off	1:off	2:on	3:on	4:on	5:on	6:off
```
### å¯åŠ¨æœåŠ¡
```bash
# service mysql start
Starting MySQL. ERROR! The server quit without updating PID file (/usr/local/mysql/data/172.18.1.117.pid).
```
æ­¤æ—¶åˆ é™¤é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è§£å†³è¯¥æŠ¥é”™ï¼ˆåŸå› æœªçŸ¥ï¼Œæ²¡æœ‰æ·±ç©¶ï¼‰
```bash
[root@172 mysql]# rm  /etc/my.cnf -rf
```
é‡æ–°å¯åŠ¨
```bash
[root@172 mysql]# /etc/init.d/mysql start
Starting MySQL.Logging to '/usr/local/mysql/data/172.18.1.117.err'.
 SUCCESS! 
 ```
###  ç™»å½•
```bash
[root@172 mysql]# /usr/local/mysql/bin/mysql -uroot -pPDRO-ab.a8jd
```
ä¿®æ”¹å¯†ç 
```bash
# æœ‰çš„æ–‡ç« è¯´æ­¤å¤„ä¸èƒ½ä½¿ç”¨å•å¼•å·ï¼Œä½†æ˜¯æˆ‘ä½¿ç”¨å•å¼•å·ä¹ŸæˆåŠŸäº†ï¼Œå¥½åƒæ²¡æœ‰é—®é¢˜ã€‚YOUR PASSWORD ä¸ºä½ è‡ªå·±è®¾ç½®çš„æ•°æ®åº“çš„å¯†ç ï¼Œè¿™ä¸ªè¦è®°ä½äº†ï¼Œä¸ç„¶å°±è¦è‡ªå·±å†å»æ‰‹åŠ¨é‡ç½®å¯†ç äº†ï¼
mysql>  set password=password("YOUR PASSWORD");
Query OK, 0 rows affected, 1 warning (0.00 sec)
mysql> flush privileges;
Query OK, 0 rows affected (0.06 sec)
mysql> quit
Bye
```
### æ·»åŠ ç¯å¢ƒå˜é‡
ä¸Šä¸€æ­¥ä¸­å¯åŠ¨ mysql çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å…¨è·¯å¾„ï¼Œæœ‰çš„æ—¶å€™ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ä¿®æ”¹ï¼›
æ‰§è¡Œ`vi ~/.bash_profile`ä¿®æ”¹æ–‡ä»¶ä¸­`PATH`ä¸€è¡Œï¼Œå°†`/usr/local/mysql/bin` åŠ å…¥åˆ°`PATH=$PATH:$HOME/bin`ä¸€è¡Œä¹‹å
**æ³¨æ„**ï¼šè¿™ç§æ–¹æ³•åªå¯¹å½“å‰ç™»å½•ç”¨æˆ·ç”Ÿæ•ˆã€‚

## å‚è€ƒé˜…è¯»
- [Linux å®‰è£… mysql5.7.24 - ç»¿è‰²è½æ—¥çš„åšå®¢ - CSDN åšå®¢](https://blog.csdn.net/qq_30000313/article/details/85333971)
- [Linux å®‰è£… mysql5.7.19](https://blog.csdn.net/zhou920786312/article/details/77750604)
- [CentOS å®‰è£… MySQL è¯¦è§£](https://juejin.cn/post/6844903870053761037)
- [CentOS7 ä¸‹å®‰è£… mysql5.7_ä¸ç”˜äºå¹³å‡¡çš„æºƒè´¥çš„åšå®¢-CSDN åšå®¢_centos7 å®‰è£… mysql5.7](https://blog.csdn.net/wohiusdashi/article/details/89358071)