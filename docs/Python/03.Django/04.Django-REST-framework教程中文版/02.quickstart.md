---
title: å¿«é€Ÿå…¥é—¨
date: 2021-04-13 10:25:19
permalink: /drf-tutorial/quickstart/
categories:
  - ğŸ“–æ–‡æ¡£ä¹¦ç±
  - Django-REST-framework æ•™ç¨‹ä¸­æ–‡ç‰ˆ
tags:
  - DRF
---

åœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ APIï¼Œå…è®¸ç®¡ç†å‘˜æŸ¥çœ‹ã€ç¼–è¾‘ç”¨æˆ·å’Œç»„ä¿¡æ¯ã€‚

é¡¹ç›®è®¾ç½®
----

æ–°å»ºåä¸º`tutorial`çš„ django é¡¹ç›®å¹¶åœ¨å…¶ä¸­å»ºç«‹ä¸€ä¸ªåä¸º`quickstart`çš„ APPï¼š
```shell
# æ–°å»ºç›®å½•
mkdir tutorial
cd tutorial

# æ–°å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv env
source env/bin/activate  # Windowså¹³å°ä½¿ç”¨ `env\Scripts\activate`

# åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ä¾èµ–
pip install django
pip install djangorestframework

# æ–°å»ºé¡¹ç›®
django-admin startproject tutorial .  # æ³¨æ„æœ€åé¢çš„ '.'
cd tutorial
django-admin startapp quickstart
cd ..
```
æ­¤æ—¶ç›®å½•ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š
```shell
$ pwd
<some path>/tutorial
$ find .
.
./manage.py
./tutorial
./tutorial/__init__.py
./tutorial/quickstart
./tutorial/quickstart/__init__.py
./tutorial/quickstart/admin.py
./tutorial/quickstart/apps.py
./tutorial/quickstart/migrations
./tutorial/quickstart/migrations/__init__.py
./tutorial/quickstart/models.py
./tutorial/quickstart/tests.py
./tutorial/quickstart/views.py
./tutorial/settings.py
./tutorial/urls.py
./tutorial/wsgi.py
```

åº”ç”¨ç¨‹åºæ˜¯åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºçš„ï¼Œè¿™çœ‹èµ·æ¥å¾ˆä¸å¯»å¸¸ã€‚ä½¿ç”¨é¡¹ç›®çš„å‘½åç©ºé—´é¿å…äº†ä¸å¤–éƒ¨æ¨¡å—çš„åç§°å†²çª(è¿™æ˜¯ä¸€ä¸ªè¶…å‡ºâ€œå¿«é€Ÿå…¥é—¨â€èŒƒå›´çš„ä¸»é¢˜)ã€‚

ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆå§‹åŒ–æ•°æ®åº“ï¼š
```shell
python manage.py migrate
```

ç„¶ååˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸º`admin`å¯†ç ä¸º`password123`çš„ç®¡ç†å‘˜ï¼š
```shell
python manage.py createsuperuser --email admin@example.com --username admin
``` 

ä»¥ä¸Šè®¾ç½®å®Œæˆåï¼Œè¿›å…¥ APP çš„ç›®å½•æ¥ç¼–å†™ä»£ç ...

åºåˆ—åŒ–
---

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶`tutorial/quickstart/serializers.py`æ¥ç¼–å†™åºåˆ—åŒ–ç›¸å…³çš„ä»£ç ï¼š
```python
from django.contrib.auth.models import User, Group
from rest_framework import serializers


class UserSerializer(serializers.HyperlinkedModelSerializer):
    class Meta:
        model = User
        fields = ('url', 'username', 'email', 'groups')


class GroupSerializer(serializers.HyperlinkedModelSerializer):
    class Meta:
        model = Group
        fields = ('url', 'name')
```

æ³¨æ„åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº†`HyperlinkedModelSerializer`æ¥å»ºç«‹è¶…é“¾æ¥å…³ç³»ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸»é”®æˆ–å…¶ä»–å…³ç³»ï¼Œä½† hyperlinking æ˜¯ä¸€ä¸ªå¥½çš„ RESTful è®¾è®¡ã€‚

Views
-----

ç°åœ¨è®©æˆ‘ä»¬æ¥ç¼–å†™è§†å›¾æ–‡ä»¶`tutorial/quickstart/views.py`ï¼š
```python
from django.contrib.auth.models import User, Group
from rest_framework import viewsets
from rest_framework import permissions
from tutorial.quickstart.serializers import UserSerializer, GroupSerializer


class UserViewSet(viewsets.ModelViewSet):
    """
    API endpoint that allows users to be viewed or edited.
    """
    queryset = User.objects.all().order_by('-date_joined')
    serializer_class = UserSerializer
    permission_classes = [permissions.IsAuthenticated]


class GroupViewSet(viewsets.ModelViewSet):
    """
    API endpoint that allows groups to be viewed or edited.
    """
    queryset = Group.objects.all()
    serializer_class = GroupSerializer
    permission_classes = [permissions.IsAuthenticated]
```

æˆ‘ä»¬æŠŠè®¸å¤šå¸¸è§çš„æ“ä½œéƒ½å°è£…åœ¨äº†ç±»`ViewSets`ä¸­ï¼Œè¿™æ ·å°±ä¸ç”¨ç¼–å†™é‡å¤ä»£ç äº†ã€‚å½“ç„¶ä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚ç¼–å†™ viewï¼Œä½†ä½¿ç”¨`ViewSets`å¯ä»¥ä¿æŒ view ä»£ç çš„ç®€æ´ä»¥åŠé€»è¾‘çš„æ¸…æ™°ã€‚

URLs
----

æ¥ä¸‹æ¥ç¼–å†™`tutorial/urls.py`ï¼š
```python
from django.urls import include, path
from rest_framework import routers
from tutorial.quickstart import views

router = routers.DefaultRouter()
router.register(r'users', views.UserViewSet)
router.register(r'groups', views.GroupViewSet)

# ä½¿ç”¨URLè·¯ç”±æ¥ç®¡ç†æˆ‘ä»¬çš„API
# å¦å¤–æ·»åŠ ç™»å½•ç›¸å…³çš„URL
urlpatterns = [
    path('', include(router.urls)),
    path('api-auth/', include('rest_framework.urls', namespace='rest_framework'))
]

```
å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†`ViewSets`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ Router ç±»æ¥è‡ªåŠ¨ç”Ÿæˆ URL é…ç½®ä¿¡æ¯ã€‚

é‡ç”³ä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦æ›´è‡ªä¸»çš„é…ç½® URLï¼Œå¯ä»¥ä½¿ç”¨å¸¸è§„çš„ç±»è§†å›¾ä»¥åŠæ˜¾å¼ç¼–å†™ URL é…ç½®ã€‚

æœ€åæˆ‘ä»¬æ·»åŠ äº†é»˜è®¤çš„ç™»å½•ã€ç™»å‡ºè§†å›¾åœ¨æµè§ˆ API æ—¶å€™ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œä½†å¦‚æœä½ æƒ³åœ¨æµè§ˆ API æ—¶ä½¿ç”¨è®¤è¯åŠŸèƒ½è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚

Pagination
--------

åˆ†é¡µä½¿æ‚¨å¯ä»¥æ§åˆ¶æ¯é¡µè¿”å›å¤šå°‘å¯¹è±¡ã€‚ä¸ºäº†å¯ç”¨å®ƒï¼Œå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ° `tutorial/settings.py`ï¼š
```python

REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': ('rest_framework.permissions.IsAdminUser',),
    'PAGE_SIZE': 10
}
```

Settings
--------

å°†`'rest_framework'`åˆ°`INSTALLED_APPS`ï¼Œè¯¥é…ç½®ä½äº`tutorial/settings.py`ï¼š
```python
INSTALLED_APPS = (
    ...
    'rest_framework',
)
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†å…¨éƒ¨å·¥ä½œã€‚

æµ‹è¯•
--

ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•æˆ‘ä»¬çš„ APIï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ï¼š
```shell
python manage.py runserver
    
```
ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·è®¿é—® API äº†ï¼Œæ¯”å¦‚`curl`:
```shell
    curl -H 'Accept: application/json; indent=4' -u admin:password123 http://127.0.0.1:8000/users/
    {
        "count": 2,
        "next": null,
        "previous": null,
        "results": [
            {
                "email": "admin@example.com",
                "groups": [],
                "url": "http://127.0.0.1:8000/users/1/",
                "username": "admin"
            },
            {
                "email": "tom@example.com",
                "groups": [                ],
                "url": "http://127.0.0.1:8000/users/2/",
                "username": "tom"
            }
        ]
    }
    
```
æˆ–è€…ä½¿ç”¨ [httpie](https://github.com/jakubroztocil/httpie#installation) å‘½ä»¤è¡Œå·¥å…·ï¼š
```python
http -a admin:password123 http://127.0.0.1:8000/users/

HTTP/1.1 200 OK
...
{
    "count": 2,
    "next": null,
    "previous": null,
    "results": [
        {
            "email": "admin@example.com",
            "groups": [],
            "url": "http://localhost:8000/users/1/",
            "username": "paul"
        },
        {
            "email": "tom@example.com",
            "groups": [                ],
            "url": "http://127.0.0.1:8000/users/2/",
            "username": "tom"
        }
    ]
}
    
```
æˆ–è€…ç›´æ¥æ‰“å¼€æµè§ˆå™¨ï¼š 

![](http://www.django-rest-framework.org/img/quickstart.png) 

å¦‚æœä½¿ç”¨æµè§ˆå™¨ï¼Œè¯·ç¡®ä¿å·²ç»ä½¿ç”¨å³ä¸Šè§’çš„ç™»å½•åŠŸèƒ½ç™»å½•ã€‚

å¥½æäº†ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼

å¦‚æœæ‚¨æƒ³æ›´æ·±å…¥åœ°äº†è§£ REST æ¡†æ¶å¦‚ä½•ç»„åˆåœ¨ä¸€èµ·ï¼Œè¯·ç»§ç»­é˜…è¯»[æœ¬æ•™ç¨‹](/drf-tutorial/serialization/) ï¼Œæˆ–è€…å¼€å§‹æµè§ˆ API æŒ‡å—ã€‚
