---
title: Python å…¨æ ˆä¹‹è·¯ç³»åˆ—ä¹‹ socketserver å®ç°å¤šå¹¶å‘

tags: 
  - ç¼–ç 
top: 4
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - ç½‘ç»œç¼–ç¨‹
date: 2020-05-23 18:21:46
permalink: /pages/8098c3/
---

åˆ©ç”¨`socketserver`å®ç°å¤šå¹¶å‘ï¼Œ`socketserver`å†…éƒ¨ä¼šè°ƒç”¨`socket`æ¨¡å—è¿›è¡ŒåŠŸèƒ½ä¸Šçš„å®ç°

`client.py`å®¢æˆ·ç«¯è„šæœ¬æ–‡ä»¶å†…å®¹

```Python
#!/usr/bin/env python
# _*_ coding:utf-8 _*_

import socket

# åˆ›å»ºä¸€ä¸ªsocketå¯¹è±¡
obj = socket.socket()

# åˆ¶å®šæœåŠ¡ç«¯çš„IPåœ°å€å’Œç«¯å£
obj.connect(('127.0.0.1', 999, ))

# é˜»å¡ï¼Œç­‰å¾…æœåŠ¡ç«¯å‘é€å†…å®¹ï¼Œæ¥å—æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„å†…å®¹ï¼Œæœ€å¤§æ¥å—1024å­—èŠ‚
ret_bytes = obj.recv(1024)

# å› ä¸ºæœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ˜¯å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠå­—èŠ‚è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œè¾“å‡º
ret_str = str(ret_bytes, encoding="utf-8")

# è¾“å‡ºå†…å®¹
print(ret_str)

while True:
    # å½“è¿›å…¥è¿æ¥çš„æ—¶å€™ï¼Œæç¤ºè®©ç”¨æˆ·è¾“å…¥å†…å®¹
    inp = input("Clientè¯·è¾“å…¥è¦å‘é€çš„å†…å®¹>>> ")
    # å¦‚æœè¾“å‡ºqåˆ™é€€å‡º
    if inp == "q":
        # æŠŠqå‘é€ç»™æœåŠ¡ç«¯
        obj.sendall(bytes(inp, encoding="utf-8"))
        # é€€å‡ºå½“å‰while
        break
    else:
        # å¦åˆ™å°±æŠŠç”¨æˆ·è¾“å…¥çš„å†…å®¹å‘é€ç»™ç”¨æˆ·
        obj.sendall(bytes(inp, encoding="utf-8"))
        # ç­‰å¾…æœåŠ¡ç«¯å›ç­”
        print("æ­£åœ¨ç­‰å¾…Serverè¾“å…¥å†…å®¹......")
        # è·å–æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„ç»“æœ
        ret = str(obj.recv(1024), encoding="utf-8")
        # è¾“å‡ºç»“æœ
        print(ret)

# è¿æ¥å®Œæˆä¹‹åå…³é—­é“¾æ¥
obj.close()
```

`server.py`æœåŠ¡ç«¯è„šæœ¬æ–‡ä»¶å†…å®¹

```Python
#!/usr/bin/env python
# _*_ coding:utf-8 _*_

import socketserver

class MyServer(socketserver.BaseRequestHandler):

    def handle(self):

        conn = self.request

        conn.sendall(bytes("ä½ å¥½ï¼Œæ¬¢è¿ç™»é™†ï¼", encoding="utf-8"))

        while True:
            # è¾“å‡ºç­‰å¾…å®¢æˆ·ç«¯å‘é€å†…å®¹
            print("æ­£åœ¨ç­‰å¾…Clientè¾“å…¥å†…å®¹......")
            # æ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„å†…å®¹
            ret_bytes = conn.recv(1024)
            # è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹
            ret_str = str(ret_bytes, encoding="utf-8")
            # è¾“å‡ºç”¨æˆ·å‘é€è¿‡æ¥çš„å†…å®¹
            print(ret_str)

            # å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯q
            if ret_str == "q":
                # åˆ™é€€å‡ºå¾ªç¯ï¼Œç­‰å¾…ä¸‹ä¸ªç”¨æˆ·è¾“å…¥
                break
            # ç»™å®¢æˆ·ç«¯å‘é€å†…å®¹
            inp = input("Serviceè¯·è¾“å…¥è¦å‘é€çš„å†…å®¹>>> ")
            conn.sendall(bytes(inp, encoding="utf-8"))

if __name__ == "__main__":
    server = socketserver.ThreadingTCPServer(('127.0.0.1', 999, ), MyServer)
    server.serve_forever()
```

æ•ˆæœå›¾

![socker-04](https://ansheng.me/wp-content/uploads/2016/12/1483021949.png)

åŒæ—¶æ‰“å¼€å¤šä¸ªå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿä¸ä¼šå‡ºç°é”™è¯¯