---
title: Python å…¨æ ˆä¹‹è·¯ç³»åˆ—ä¹‹é¢å‘å¯¹è±¡è¿ç®—ç¬¦é‡è½½

tags: 
  - ç¼–ç 
  - é¢å‘å¯¹è±¡
  - é­”æ³•å±æ€§
  - dunder
top: 6
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - å…¨æ ˆä¹‹è·¯
  - é¢å‘å¯¹è±¡
date: 2020-05-23 18:21:46
permalink: /pages/5bb5b8/
---

è¿ç®—ç¬¦é‡è½½çš„æ¦‚å¿µå¦‚ä¸‹ï¼š

1. è¿ç®—ç¬¦é‡è½½è®©ç±»æ‹¦æˆªå¸¸è§„çš„ Python è¿ç®—ï¼›
2. ç±»å¯é‡è½½æ‰€æœ‰ Python è¡¨è¾¾å¼è¿ç®—ç¬¦ï¼›
3. ç±»ä¹Ÿå¯é‡è½½æ‰“å°ã€å‡½æ•°è°ƒç”¨ã€å±æ€§ç‚¹å·è¿ç®—ç­‰å†…ç½®è¿ç®—ï¼›
4. é‡è½½æ˜¯ç±»å®ä¾‹çš„è¡Œä¸ºæƒ³å†…ç½®ç±»å‹ï¼›
5. é‡è½½æ˜¯é€šè¿‡æä¾›ç‰¹æ®Šåç§°çš„ç±»æ–¹æ³•æ¥å®ç°çš„ï¼›

## å¸¸è§çš„è¿ç®—ç¬¦é‡è½½æ–¹æ³•

|æ–¹æ³•|é‡è½½|è°ƒç”¨|
|:--|:--|:--|
|`__init__`|æ„é€ å‡½æ•°|å¯¹è±¡å»ºç«‹ï¼šX = Class(args)|
|`__del__`|è§£æå‡½æ•°|X å¯¹è±¡æ”¶å›|
|`__add__`|è¿ç®—ç¬¦+|å¦‚æœæ²¡æœ‰`__iadd__`,X+Y,X+=Y|
|`__or__`|è¿ç®—ç¬¦æˆ–|å¦‚æœæ²¡æœ‰`__ior__`|
|`__repr__`,`__str__`|æ‰“å°ã€è½¬æ¢|print(X)ã€repr(X)ã€str(X)|
|`__call__`|å‡½æ•°è°ƒç”¨|X(*args, **kwargs)|
|`__getattr__`|ç‚¹å·è¿ç®—|X.undefined|
|`__setattr__`|å±æ€§èµ‹å€¼è¯­å¥|X.any = value|
|`__delattr__`|å±æ€§åˆ é™¤|del X.any|
|`__getattribute__`|å±æ€§è·å–|X.any
|`__getitem__`|ç´¢å¼•è¿ç®—|X[key]ï¼ŒX[i:j]ï¼Œæ²¡`__iter__`æ—¶çš„ for å¾ªç¯å’Œå…¶ä»–è¿­ä»£å™¨|
|`__setitem__`|ç´¢å¼•èµ‹å€¼è¯­å¥|X[key]=value,X[i:k]=sequence|
|`__delitem__`|ç´¢å¼•å’Œåˆ†ç‰‡åˆ é™¤|del X[key], del X[i:j]|
|`__len__`|é•¿åº¦|len(X)ï¼Œå¦‚æœæ²¡æœ‰`__bool__`ï¼ŒçœŸå€¼æµ‹è¯•|
|`__bool__`|å¸ƒå°”æµ‹è¯•|bool(X)ï¼ŒçœŸæµ‹è¯•|
|`__lt__`ï¼Œ`__gt__`ï¼Œ`__le__`ï¼Œ`__ge__`ï¼Œ`__eq__`ï¼Œ`__ne__`|ç‰¹å®šçš„æ¯”è¾ƒ|X<Yï¼ŒX>Y...|
|`__radd__`|å³ä¾§åŠ æ³•|Other + X|
|`__iadd__`|å¢å¼ºçš„åŠ æ³•|X += Y|
|`__iter__`ï¼Œ`__next__`|è¿­ä»£ç¯å¢ƒ|I=iter(X),next(I)|
|`__contains__`|æˆå‘˜å…³ç³»æµ‹è¯•|item in X(ä»»ä½•å¯è¿­ä»£å¯¹è±¡)|
|`__index__`|æ•´æ•°å€¼|hex(X),bin(X),oct(X),o[X],O[X:]|
|`__enter__`,`__exit__`|ç¯å¢ƒç®¡ç†å™¨|with obj as var:|
|`__get__`,`__set__`,`__delete__`|æè¿°ç¬¦å±æ€§|X.attrï¼ŒX.attr=Value,del X.attr|
|`__new__`|åˆ›å»º|åœ¨`__init__`ä¹‹å‰åˆ›å»ºå¯¹è±¡|

æ‰€æœ‰é‡è½½æ–¹æ³•çš„åç§°å‰åéƒ½æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿å­—ç¬¦ï¼Œä»¥ä¾¿æŠŠåŒç±»ä¸­å®šä¹‰çš„å˜é‡ååŒºåˆ«å¼€æ¥ã€‚

### æ„é€ å‡½æ•°å’Œè¡¨è¾¾å¼:`__init__`å’Œ`__sub__`

```python
>>> class Number:
...   def __init__(self, start):
...     self.data = start
...   def __sub__(self, other):
...     return Number(self.data - other)
...
>>> X = Number(5)
>>> Y = X - 2
>>> Y
<__main__.Number object at 0x10224d550>
>>> Y.data
3
```

### ç´¢å¼•å’Œåˆ†ç‰‡: `__getitem__`å’Œ`__setitem__`

åŸºæœ¬ç´¢å¼•

```python
>>> class Index:
...     def __getitem__(self, item):
...         return item ** 2
...
>>>
>>> for i in range(5):
...     I = Index()
...     print(I[i], end=' ')
...
0 1 4 9 16
```

åˆ‡ç‰‡ç´¢å¼•

```python
>>> class Index:
...   data = [5, 6, 7, 8, 9]
...   def __getitem__(self, item):
...     print('getitem: ', item)
...     return self.data[item]
...   def __setitem__(self, key, value):
...     self.data[key] = value
...
>>> X = Index()
>>> print(X[1:4])
getitem:  slice(1, 4, None)
[6, 7, 8]
>>> X[1:4] = (1, 1, 1)
>>> print(X[1:4])
getitem:  slice(1, 4, None)
[1, 1, 1]
```

### ç´¢å¼•è¿­ä»£ï¼š`__getitem__`

å¦‚æœé‡è½½äº†è¿™ä¸ªæ–¹æ³•ï¼Œfor å¾ªç¯æ¯æ¬¡å¾ªç¯æ—¶éƒ½ä¼šè°ƒç”¨ç±»çš„__getitem__æ–¹æ³•ï¼›

```python
>>> class stepper:
...     def __getitem__(self, item):
...         return self.data[item].upper()
...
>>>
>>> X = stepper()
>>> X.data = 'ansheng'
>>> for item in X:
...     print(item)
...
A
N
S
H
E
N
G
```

### è¿­ä»£å™¨å¯¹è±¡ï¼š`__iter__`å’Œ`__next__`

```python
>>> class Squares:
...   def __init__(self, start, stop):
...         self.value = start - 1
...         self.stop = stop
...   def __iter__(self):
...         return self
...   def __next__(self):
...         if self.value == self.stop:
...             raise StopIteration
...         self.value += 1
...         return self.value ** 2
...
>>> for i in Squares(1, 5):
...   print(i)
...
1
4
9
16
25
```

### æˆå‘˜å…³ç³»ï¼š`__contains__`ã€`__iter__`å’Œ`__getitem__`

```python
class Iters:
    def __init__(self, value):
        self.data = value

    def __getitem__(self, item):
        print('get[%s]' % item, end='')
        return self.data[item]

    def __iter__(self):
        print('iter>==', end='')
        self.ix = 0
        return self

    def __next__(self):
        print('next:', end='')
        if self.ix == len(self.data): raise StopIteration
        item = self.data[self.ix]
        self.ix += 1
        return item

    def __contains__(self, item):
        print('contains: ', end=' ')
        return item in self.data


X = Iters([1, 2, 3, 4, 5])
print(3 in X)
for i in X:
    print(i, end='|')

print([i ** 2 for i in X])
print(list(map(bin, X)))

I = iter(X)
while True:
    try:
        print(next(I), end=' @')
    except StopIteration as e:
        break
```

### å±æ€§å¼•ç”¨ï¼š`__getattr__`å’Œ`__setattr__`

å½“é€šè¿‡æœªå®šä¹‰çš„å±æ€§åç§°å’Œå®ä¾‹é€šè¿‡ç‚¹å·è¿›è¡Œè®¿é—®æ—¶ï¼Œå°±ä¼šç”¨å±æ€§åç§°ä½œä¸ºå­—ç¬¦ä¸²è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä½†å¦‚æœç±»ä½¿ç”¨äº†ç»§æ‰¿ï¼Œå¹¶ä¸”åœ¨è¶…ç±»ä¸­å¯ä»¥æ‰¾åˆ°è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè§¦å‘ã€‚

```python
>>> class empty:
...     def __getattr__(self, item):
...         if item == 'age':
...             return 40
...         else:
...             raise AttributeError(item)
...
>>>
>>> x = empty()
>>> print(x.age)
40
>>> print(x.name)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 6, in __getattr__
AttributeError: name
```

```python
>>> class accesscontrol:
...     def __setattr__(self, key, value):
...         if key == 'age':
...             self.__dict__[key] = value
...         else:
...             raise AttributeError(key + ' not allowed')
...
>>>
>>> x = accesscontrol()
>>> x.age = 40
>>> print(x.age)
40
>>> x.name = 'Hello'
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 6, in __setattr__
AttributeError: name not allowed
```

### `__repr__`å’Œ`__str__`ä¼šè¿”å›å­—ç¬¦ä¸²è¡¨è¾¾å¼

`__repr__`å’Œ`__str__`éƒ½æ˜¯ä¸ºäº†æ›´å‹å¥½çš„æ˜¾ç¤ºï¼Œå…·ä½“æ¥è¯´ï¼Œå¦‚æœåœ¨ç»ˆç«¯ä¸‹ print(Class)åˆ™ä¼šè°ƒç”¨`__repr__`ï¼Œéç»ˆç«¯ä¸‹ä¼šè°ƒç”¨`__str__`æ–¹æ³•ï¼Œä¸”è¿™ä¸¤ä¸ªæ–¹æ³•åªèƒ½è¿”å›å­—ç¬¦ä¸²ï¼›


```python
class adder:
    def __init__(self, value=0):
        self.data = value

    def __add__(self, other):
        self.data += other

    def __repr__(self):
        return 'addrepr(%s)' % self.data

    def __str__(self):
        return 'N: %s' % self.data


x = adder(2)
x + 1
print(x)
print((str(x), repr(x)))
```

### å³ä¾§åŠ æ³•å’ŒåŸå¤„åŠ æ³•: `__radd__`å’Œ`__iadd__`

åªæœ‰å½“+å³ä¾§çš„å¯¹è±¡æ˜¯ç±»å®ä¾‹ï¼Œè€Œå·¦è¾¹å¯¹è±¡ä¸æ˜¯ç±»å®ä¾‹çš„æ—¶å€™ï¼ŒPython æ‰ä¼šè°ƒç”¨`__radd__`

```python
class Commuter:
    def __init__(self, val):
        self.val = val

    def __add__(self, other):
        print('add', self.val, other)
        return self.val + other

    def __radd__(self, other):
        print('radd', self.val, other)
        return other + self.val


x = Commuter(88)
y = Commuter(99)
print(x + 1)
print('')
print(1 + y)
print('')
print(x + y)
```

ä½¿ç”¨`__iadd__`è¿›è¡ŒåŸå¤„åŠ æ³•

```python
class Number:
    def __init__(self, val):
        self.val = val

    def __iadd__(self, other):
        self.val += other
        return self


x = Number(5)
x += 1
x += 1
print(x.val)


class Number:
    def __init__(self, val):
        self.val = val

    def __add__(self, other):
        return Number(self.val + other)


x = Number(5)
x += 1
x += 1
print(x.val)
```

### Call è¡¨è¾¾å¼ï¼š`__call__`

å½“è°ƒç”¨ç±»å®ä¾‹æ—¶æ‰§è¡Œ`__call__`æ–¹æ³•

```python
class Callee:
    def __call__(self, *args, **kwargs):
        print('Callee:', args, kwargs)


C = Callee()
C(1, 2, 3)
C(1, 2, 3, x=1, y=2, z=3)


class Prod:
    def __init__(self, value):
        self.value = value

    def __call__(self, other):
        return self.value * other


x = Prod(3)
print(x(3))
print(x(4))
```

### æ¯”è¾ƒ:`__lt__`,`__gt__`å’Œå…¶ä»–æ–¹æ³•

ç±»å¯ä»¥å®šä¹‰æ–¹æ³•æ¥æ•è·æ‰€æœ‰çš„ 6 ç§æ¯”è¾ƒè¿ç®—ç¬¦ï¼š<ã€>ã€<=ã€>=ã€==å’Œ!=

```python
class C:
    data = 'spam'

    def __gt__(self, other):
        return self.data > other

    def __lt__(self, other):
        return self.data < other

x = C()
print(x > 'han')
print(x < 'han')
```

### å¸ƒå°”å€¼æµ‹è¯•ï¼š__bool__å’Œ__len__

```python
class Truth:
    def __bool__(self):
        return True


X = Truth()
if X: print('yes')


class Truth:
    def __bool__(self):
        return False

X = Truth()
print(bool(X))
```

å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼ŒPython é€€è€Œæ±‚å…¶æ¬¡çš„æ±‚é•¿åº¦ï¼Œå› ä¸ºä¸€ä¸ªéç©ºå¯¹è±¡çœ‹ä½œæ˜¯çœŸ:

```python
>>> class Truth:
...   def __len__(self): return 0
...
>>> X = Truth()
>>> if not X: print('no')
...
no
```

å¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½æœ‰ï¼Œ`__bool__`ä¼šèƒœè¿‡`__len__`ï¼š

```python
>>> class Truth:
...   def __bool__(self): return True
...   def __len__(self): return 0
...
>>> X = Truth()
>>> bool(X)
True
```
å¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½æ²¡æœ‰å®šä¹‰ï¼Œå¯¹è±¡æ¯«æ— ç–‘ä¹‰çš„çœ‹ä½œä¸ºçœŸï¼š
```python
>>> class Truth: pass
...
>>> bool(Truth)
True
```

### å¯¹è±¡è§£æå‡½æ•°ï¼š`__del__`

æ¯å½“å®ä¾‹äº§ç”Ÿæ—¶ï¼Œå°±ä¼šè°ƒç”¨__init__æ„é€ å‡½æ•°ï¼Œæ¯å½“å®ä¾‹ç©ºé—´è¢«æ”¶å›æ—¶ï¼Œå®ƒçš„å¯¹ç«‹é¢`__del__`ï¼Œä¹Ÿå°±æ˜¯è§£æå‡½æ•°ï¼Œå°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼›


```python
class Life:
    def __init__(self, name='unknown'):
        print('Hello, ', name)
        self.name = name

    def __del__(self):
        print('Goodbye', self.name)


brian = Life('Brian')
brian = 'loretta'
```