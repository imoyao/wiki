---
title: '[è¯‘]PEP 3107 -- å‡½æ•°æ³¨è§£'
tags: 
  - è£…é¥°å™¨
categories: 
  - ğŸ’» å·¥ä½œ
  - ğŸPython
  - PEP
date: 2019-11-27 23:34:31
permalink: /peps/pep-3107/
---

**PEP åŸæ–‡ ï¼š** https://www.python.org/dev/peps/pep-3107/

**PEP æ ‡é¢˜ï¼š** Function Annotations

**PEP ä½œè€…ï¼š** Collin Winter , Tony Lownds

**åˆ›å»ºæ—¥æœŸï¼š** 2006-12-2

**åˆå…¥ç‰ˆæœ¬ï¼š** 3.0

**è¯‘è€…** ï¼šRobert Lu ( Blog : https://www.robberphex.com )



## èƒŒæ™¯

Python 2.x ç³»åˆ—ç¼ºä¹ä¸€ä¸ªæ ‡å‡†çš„æ–¹å¼æ¥è¯´æ˜ä¸€ä¸ªå‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ï¼Œå„ç§å·¥å…·å’Œåº“çš„å‡ºç°å¡«è¡¥äº†è¿™ä¸€ç©ºç™½ã€‚ä¸€äº›å·¥å…·ä½¿ç”¨äº†â€œPEP 318â€ä¸­çš„è£…é¥°å™¨ï¼Œè€Œå…¶ä»–çš„å·¥å…·åˆ™å»è§£æå‡½æ•°çš„æ–‡æ¡£æ³¨é‡Šï¼Œå¯»æ‰¾æ³¨è§£ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä¼—å¤šå·²å­˜åœ¨çš„æœºåˆ¶å’Œè¯­æ³•é€ æˆäº†å¾ˆå¤§çš„æ··ä¹±ã€‚æœ¬ PEP çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå•ä¸€çš„ï¼Œæ ‡å‡†çš„æ–¹å¼æŒ‡å®šè¿™äº›ä¿¡æ¯ï¼Œå‡å°‘è¿™äº›æ··ä¹±ã€‚

## å‡½æ•°æ³¨è§£çš„åŸºç¡€çŸ¥è¯†

åœ¨ä»”ç»†è®¨è®º Python 3.0 çš„å‡½æ•°æ³¨è§£çš„ç»†èŠ‚ä¹‹å‰ï¼Œé¦–å…ˆè®©æˆ‘ä»¬å¤§è‡´è®¨è®ºä¸‹æ³¨è§£æ˜¯ä»€ä¹ˆã€ä¸æ˜¯ä»€ä¹ˆï¼š

1. å‡½æ•°æ³¨è§£ï¼Œæ— è®ºæ˜¯å¯¹å‚æ•°çš„è¿˜æ˜¯å¯¹è¿”å›å€¼çš„å‡½æ•°æ³¨è§£ï¼Œå®Œå…¨æ˜¯å¯é€‰çš„ã€‚

2. å‡½æ•°æ³¨è§£æ— éæ˜¯ä¸€ç§æ–¹æ³•ï¼Œç”¨æ¥åœ¨ç¼–è¯‘æ—¶å°†ä»»æ„ Python è¡¨è¾¾å¼å’Œå‡½æ•°çš„ä¸åŒéƒ¨åˆ†å…³è”èµ·æ¥ã€‚å°±è¿™ç‚¹è€Œè¨€ï¼ŒPython å¹¶æ²¡æœ‰ç»™æ³¨è§£èµ‹äºˆç‰¹æ®Šçš„æ„ä¹‰å’Œé‡è¦æ€§ã€‚Python ä»…ä»…è®©è¿™äº›è¡¨è¾¾å¼å¯ä»¥è¢«è®¿é—®è€Œå·²ï¼Œä»¥ä¸€ç§åƒæœ¬æ–‡çš„â€œè®¿é—®å‡½æ•°æ³¨è§£â€ä¸­æè¿°çš„æ–¹æ³•ã€‚æ³¨è§£å¯¹å«ä¹‰äº§ç”Ÿä½œç”¨çš„å”¯ä¸€æ–¹å¼æ˜¯å½“å®ƒä»¬è¢«ç¬¬ä¸‰æ–¹åº“è§£é‡Šçš„æ—¶å€™ã€‚è¿™äº›æ³¨è§£çš„ä½¿ç”¨è€…å¯ä»¥ç”¨è¿™äº›å‡½æ•°æ³¨è§£åšä»–ä»¬æƒ³åšçš„ä»»ä½•äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåº“å¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²ç±»å‹çš„æ³¨è§£æ¥æä¾›æ”¹è¿›è¿‡çš„å¸®åŠ©ä¿¡æ¯ï¼š

   ```plain
   def compile(source: "something compilable",
               filename: "where the compilable thing comes from",
               mode: "is this a single statement or a suite?"):
       ...
   ```

   å¦ä¸€ä¸ªåº“å¯ä»¥ç”¨æ¥æä¾› Python å‡½æ•°å’Œæ–¹æ³•çš„ç±»å‹æ£€æŸ¥ã€‚è¿™ä¸ªåº“å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥è¯´æ˜å‡½æ•°çš„é¢„æœŸè¾“å…¥å’Œè¿”å›å€¼çš„ç±»å‹ï¼š

   ```plain
   def haul(item: Haulable, *vargs: PackAnimal) -> Distance:
       ...
   ```

   ç„¶è€Œï¼Œä¸è®ºæ˜¯ç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„å­—ç¬¦ä¸²è¿˜æ˜¯ç¬¬äºŒä¸ªä¾‹å­ä¸­çš„ç±»å‹ä¿¡æ¯ï¼Œå®ƒä»¬è‡ªå·±æ²¡æœ‰ä»»ä½•å«ä¹‰ï¼›å«ä¹‰æ¥è‡ªç¬¬ä¸‰æ–¹åº“ã€‚

3. æ ¹æ®ç¬¬äºŒç‚¹ï¼Œè¯¥ PEP ä¸ä¼šè¯•å›¾å¼•å…¥ä¸€ç§æ ‡å‡†çš„è¯­ä¹‰ï¼Œå³ä½¿æ˜¯ä¸ºé‚£äº›å†…ç½®ç±»å‹ã€‚è¿™ä¸ªå·¥ä½œç•™ç»™ç¬¬ä¸‰æ–¹åº“ã€‚

## è¯­æ³•

### å‚æ•°

å¯¹å‚æ•°çš„æ³¨è§£è·Ÿéšç€å‚æ•°åï¼Œé‡‡ç”¨äº†ä¸€ç§å¯é€‰è¡¨è¾¾å¼çš„å½¢å¼ï¼š

```plain
def foo(a: expression, b: expression = 5):
    ...
```

åœ¨ä¼ªè¯­æ³•ä¸­ï¼Œå‚æ•°ç°åœ¨çœ‹èµ·æ¥åƒ identifier [: expression] [= expression] ã€‚å³ï¼Œæ³¨è§£åœ¨å‚æ•°çš„é»˜è®¤å€¼ä¹‹å‰ï¼Œè€Œä¸”ä¸¤è€…éƒ½æ˜¯å¯é€‰çš„ã€‚å°±åƒç­‰å·æ˜¯ç”¨æ¥æ ‡è®°ä¸€ä¸ªé»˜è®¤å€¼çš„ï¼Œå†’å·ç”¨æ¥æ ‡è®°æ³¨è§£ã€‚åƒé»˜è®¤å€¼ä¸€æ ·ï¼Œæ‰€æœ‰çš„æ³¨è§£è¡¨è¾¾å¼éƒ½ä¼šåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™è¢«æ±‚å€¼ã€‚

â€œå¤šä½™â€çš„å‚æ•°ï¼ˆä¾‹å¦‚ï¼š*args å’Œ**kwargs ï¼‰çš„æ³¨è§£ä»¥åŒæ ·çš„æ–¹å¼æ ‡è®°ï¼š

```plain
def foo((x1, y1: expression),
        (x2: expression, y2: expression)=(None, None)):
    ...
```

### è¿”å›å€¼

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¾‹å­éƒ½å¿½ç•¥äº†å¦‚ä½•æ³¨è§£ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ç±»å‹ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š

```plain
def sum() -> expression:
    ...
```

å³ï¼Œå‚æ•°åˆ—è¡¨åå¯ä»¥è·Ÿç€å­—ç¬¦-> å’Œä¸€ä¸ª Python è¡¨è¾¾å¼ã€‚åƒå¯¹å‚æ•°çš„æ³¨è§£ä¸€æ ·ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä¼šåœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™è¢«æ±‚å€¼ã€‚

ç°åœ¨[å‡½æ•°å®šä¹‰çš„è¯­æ³•](http://docs.python.org/2/reference/compound_stmts.html#function-definitions)æ˜¯ï¼š

```plain
decorator: '@' dotted_name [ '(' [arglist] ')' ] NEWLINE
decorators: decorator+
funcdef: [decorators] 'def' NAME parameters ['->' test] ':' suite
parameters: '(' [typedargslist] ')'
typedargslist: ((tfpdef ['=' test] ',')*
                ('*' [tname] (',' tname ['=' test])* [',' '**' tname]
                 | '**' tname)
                | tfpdef ['=' test] (',' tfpdef ['=' test])* [','])
tname: NAME [':' test]
tfpdef: tname | '(' tfplist ')'
tfplist: tfpdef (',' tfpdef)* [',']
```

### Lambda è¡¨è¾¾å¼

lambda çš„è¯­æ³•ä¸æ”¯æŒæ³¨è§£ã€‚æœ¬å¯ä»¥é€šè¿‡ä¿®æ”¹ lambda çš„è¯­æ³•æ¥æ”¯æŒæ³¨è§£ï¼Œå³è¦æ±‚ç”¨åœ†æ‹¬å·å›´ä½å‚æ•°åˆ—è¡¨ã€‚ä½†æ˜¯ï¼Œå·²ç»[å†³å®š](https://mail.python.org/pipermail/python-3000/2006-May/001613.html)ä¸è¿›è¡Œæ­¤é¡¹æ›´æ”¹ï¼Œå› ä¸ºï¼š

1. è¿™å°†æ˜¯ä¸€ä¸ªä¸å…¼å®¹çš„æ›´æ”¹ã€‚
2. ä¸è®ºå¦‚ä½•ï¼ŒLambda ä¼šè¢«é˜‰å‰²ã€‚
3. ä¸€ä¸ª Lambda æ€»æ˜¯å¯ä»¥è¢«æ”¹ä¸ºä¸€ä¸ªå‡½æ•°ã€‚

## è®¿é—®å‡½æ•°æ³¨è§£

ä¸€æ—¦è¢«ç¼–è¯‘ï¼Œå‡½æ•°æ³¨è§£æ˜¯å¯ä»¥é€šè¿‡å‡½æ•°çš„ func_annotations å±æ€§æ¥è®¿é—®çš„ã€‚è¯¥å±æ€§æ˜¯ä¸€ä¸ªå¯å˜å­—å…¸ç±»å‹ï¼Œå‚æ•°åç§°æ˜ å°„åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä»£è¡¨æ±‚å€¼åçš„æ³¨è§£ã€‚

return åœ¨ func_annotations ä¸­æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„é”®ã€‚åªæœ‰åœ¨ä¸ºå‡½æ•°çš„è¿”å›å€¼æä¾›äº†æ³¨è§£çš„æƒ…å†µä¸‹ï¼Œreturn é”®æ‰ä¼šå‡ºç°ã€‚

ä¾‹å¦‚ï¼Œå¦‚ä¸‹æ³¨è§£ï¼š

```plain
def foo(a: 'x', b: 5 + 6, c: list) -> max(2, 9):
    ...
```

å°†ä¼šäº§ç”Ÿä¸€ä¸ªè¿™æ ·çš„ func_annotation æ˜ å°„ï¼š

```plain
{'a': 'x',
 'b': 11,
 'c': list,
 'return': 9}
```

é€‰æ‹© return é”®ï¼Œæ˜¯å› ä¸ºå®ƒä¸ä¼šå’Œå‚æ•°åç§°å†²çªã€‚ä»»ä½•ç”¨ return ä½œä¸ºå‡½æ•°å‚æ•°åçš„å°è¯•éƒ½ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ï¼ˆSyntaxError ï¼‰

å¦‚æœå‡½æ•°æ²¡æœ‰æ³¨è§£ï¼Œæˆ–è€…å‡½æ•°åˆ›å»ºè‡ªä¸€ä¸ª lamba è¡¨è¾¾å¼ï¼Œåˆ™ func_annotations æ˜¯ä¸€ä¸ªç©ºçš„ã€å¯å˜çš„å­—å…¸ã€‚

## ä½¿ç”¨æ¡ˆä¾‹

åœ¨è®¨è®ºæ³¨è§£çš„è¿‡ç¨‹ä¸­ï¼Œä¸€äº›ä½¿ç”¨æ¡ˆä¾‹å·²ç»å‡ºç°ã€‚æœ‰äº›åœ¨è¿™é‡Œåˆ—å‡ºï¼Œä»¥å®ƒä»¬è¦ä¼ è¾¾çš„ä¿¡æ¯æ¥åˆ†ç»„ã€‚è¿˜åŒ…æ‹¬åœ¨ç°æœ‰çš„äº§å“å’ŒåŒ…ä¸­ä½¿ç”¨æ³¨è§£çš„ä¾‹å­ã€‚

- æä¾›ç±»å‹ä¿¡æ¯
  - ç±»å‹æ£€æŸ¥ï¼ˆ[link 1](http://oakwinter.com/code/typecheck/), [link 2](http://maxrepo.info/taxonomy/term/3,6/all)ï¼‰
  - è®© IDE æ˜¾ç¤ºå‡½æ•°æœŸæœ›çš„ç±»å‹å’Œè¿”å›çš„ç±»å‹([link](http://www.python.org/idle/doc/idle2.html#Tips))
  - å‡½æ•°é‡è½½/æ³›å‹å‡½æ•°([link](http://www-128.ibm.com/developerworks/library/l-cppeak2/))
  - å…¶ä»–è¯­è¨€çš„æ¡¥[Foreign-language bridges]([link 1](http://www.jython.org/Project/index.html), [link 2](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython))
  - é…æ¥[Adaptation]([link 1](http://www.artima.com/weblogs/viewpost.jsp?thread=155123), [link 2](http://peak.telecommunity.com/PyProtocols.html))
  - é€»è¾‘è°“è¯åŠŸèƒ½[Predicate logic functions]
  - æ•°æ®åº“æŸ¥è¯¢æ˜ å°„
  - RPC å‚æ•°å°è£…([link](http://rpyc.wikispaces.com/))
- å…¶ä»–ä¿¡æ¯
  - ä¸ºå‚æ•°å’Œè¿”å›å€¼çš„æ–‡æ¡£è¯´æ˜([link](http://docs.python.org/library/pydoc.html))