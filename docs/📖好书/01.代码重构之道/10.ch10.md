---
title: ç¬¬ 10 ç«  ç®€åŒ–æ¡ä»¶é€»è¾‘
date: 2021-01-20 21:02:49
permalink: /pages/5ac634/
categories:
  - ğŸ“–å¥½ä¹¦
  - ä»£ç é‡æ„ä¹‹é“
tags:
  - æ¡ä»¶
  - é€»è¾‘
---
# ç¬¬ 10 ç«  ç®€åŒ–æ¡ä»¶é€»è¾‘

ç¨‹åºçš„å¤§éƒ¨åˆ†å¨åŠ›æ¥è‡ªæ¡ä»¶é€»è¾‘ï¼Œä½†å¾ˆä¸å¹¸ï¼Œç¨‹åºçš„å¤æ‚åº¦ä¹Ÿå¤§å¤šæ¥è‡ªæ¡ä»¶é€»è¾‘ã€‚æˆ‘ç»å¸¸å€ŸåŠ©é‡æ„æŠŠæ¡ä»¶é€»è¾‘å˜å¾—æ›´å®¹æ˜“ç†è§£ã€‚æˆ‘å¸¸ç”¨åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ260ï¼‰å¤„ç†å¤æ‚çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ263ï¼‰å˜æ¸…é€»è¾‘ç»„åˆã€‚æˆ‘ä¼šç”¨ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ266ï¼‰æ¸…æ™°è¡¨è¾¾â€œåœ¨ä¸»è¦å¤„ç†é€»è¾‘ä¹‹å‰å…ˆåšæ£€æŸ¥â€çš„æ„å›¾ã€‚å¦‚æœæˆ‘å‘ç°ä¸€å¤„ switch é€»è¾‘å¤„ç†äº†å‡ ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘æ‹¿å‡ºä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ272ï¼‰é‡æ„æ‰‹æ³•ã€‚

å¾ˆå¤šæ¡ä»¶é€»è¾‘æ˜¯ç”¨äºå¤„ç†ç‰¹æ®Šæƒ…å†µçš„ï¼Œä¾‹å¦‚å¤„ç† null å€¼ã€‚å¦‚æœå¯¹æŸç§ç‰¹æ®Šæƒ…å†µçš„å¤„ç†é€»è¾‘å¤§å¤šç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å¼•å…¥ç‰¹ä¾‹ï¼ˆ289ï¼‰ï¼ˆå¸¸è¢«ç§°ä½œå¼•å…¥ç©ºå¯¹è±¡ï¼‰æ¶ˆé™¤é‡å¤ä»£ç ã€‚å¦å¤–ï¼Œè™½ç„¶æˆ‘å¾ˆå–œæ¬¢å»é™¤æ¡ä»¶é€»è¾‘ï¼Œä½†å¦‚æœæˆ‘æƒ³æ˜ç¡®åœ°è¡¨è¿°ï¼ˆä»¥åŠæ£€æŸ¥ï¼‰ç¨‹åºçš„çŠ¶æ€ï¼Œå¼•å…¥æ–­è¨€ï¼ˆ302ï¼‰æ˜¯ä¸€ä¸ªä¸é”™çš„è¡¥å……ã€‚

## 10.1 åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆDecompose Conditionalï¼‰

```js
if (!aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd))
 charge = quantity * plan.summerRate;
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;


if (summer())
 charge = summerCharge();
else
 charge = regularCharge();
```

### åŠ¨æœº

ç¨‹åºä¹‹ä¸­ï¼Œå¤æ‚çš„æ¡ä»¶é€»è¾‘æ˜¯æœ€å¸¸å¯¼è‡´å¤æ‚åº¦ä¸Šå‡çš„åœ°ç‚¹ä¹‹ä¸€ã€‚æˆ‘å¿…é¡»ç¼–å†™ä»£ç æ¥æ£€æŸ¥ä¸åŒçš„æ¡ä»¶åˆ†æ”¯ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶åšä¸åŒçš„äº‹ï¼Œç„¶åï¼Œæˆ‘å¾ˆå¿«å°±ä¼šå¾—åˆ°ä¸€ä¸ªç›¸å½“é•¿çš„å‡½æ•°ã€‚å¤§å‹å‡½æ•°æœ¬èº«å°±ä¼šä½¿ä»£ç çš„å¯è¯»æ€§ä¸‹é™ï¼Œè€Œæ¡ä»¶é€»è¾‘åˆ™ä¼šä½¿ä»£ç æ›´éš¾é˜…è¯»ã€‚åœ¨å¸¦æœ‰å¤æ‚æ¡ä»¶é€»è¾‘çš„å‡½æ•°ä¸­ï¼Œä»£ç ï¼ˆåŒ…æ‹¬æ£€æŸ¥æ¡ä»¶åˆ†æ”¯çš„ä»£ç å’ŒçœŸæ­£å®ç°åŠŸèƒ½çš„ä»£ç ï¼‰ä¼šå‘Šè¯‰æˆ‘å‘ç”Ÿçš„äº‹ï¼Œä½†å¸¸å¸¸è®©æˆ‘å¼„ä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™æ ·çš„äº‹ï¼Œè¿™å°±è¯´æ˜ä»£ç çš„å¯è¯»æ€§çš„ç¡®å¤§å¤§é™ä½äº†ã€‚

å’Œä»»ä½•å¤§å—å¤´ä»£ç ä¸€æ ·ï¼Œæˆ‘å¯ä»¥å°†å®ƒåˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Œæ ¹æ®æ¯ä¸ªå°å—ä»£ç çš„ç”¨é€”ï¼Œä¸ºåˆ†è§£è€Œå¾—çš„æ–°å‡½æ•°å‘½åï¼Œå¹¶å°†åŸå‡½æ•°ä¸­å¯¹åº”çš„ä»£ç æ”¹ä¸ºè°ƒç”¨æ–°å‡½æ•°ï¼Œä»è€Œæ›´æ¸…æ¥šåœ°è¡¨è¾¾è‡ªå·±çš„æ„å›¾ã€‚å¯¹äºæ¡ä»¶é€»è¾‘ï¼Œå°†æ¯ä¸ªåˆ†æ”¯æ¡ä»¶åˆ†è§£æˆæ–°å‡½æ•°è¿˜å¯ä»¥å¸¦æ¥æ›´å¤šå¥½å¤„ï¼šå¯ä»¥çªå‡ºæ¡ä»¶é€»è¾‘ï¼Œæ›´æ¸…æ¥šåœ°è¡¨æ˜æ¯ä¸ªåˆ†æ”¯çš„ä½œç”¨ï¼Œå¹¶ä¸”çªå‡ºæ¯ä¸ªåˆ†æ”¯çš„åŸå› ã€‚

æœ¬é‡æ„æ‰‹æ³•å…¶å®åªæ˜¯æç‚¼å‡½æ•°ï¼ˆ106ï¼‰çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ã€‚ä½†æˆ‘è¦ç‰¹åˆ«å¼ºè°ƒè¿™ä¸ªåœºæ™¯ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒç»å¸¸ä¼šå¸¦æ¥å¾ˆå¤§çš„ä»·å€¼ã€‚

### åšæ³•

å¯¹æ¡ä»¶åˆ¤æ–­å’Œæ¯ä¸ªæ¡ä»¶åˆ†æ”¯åˆ†åˆ«è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ‰‹æ³•ã€‚

### èŒƒä¾‹

å‡è®¾æˆ‘è¦è®¡ç®—è´­ä¹°æŸæ ·å•†å“çš„æ€»ä»·ï¼ˆæ€»ä»·=æ•°é‡ Ã— å•ä»·ï¼‰ï¼Œè€Œè¿™ä¸ªå•†å“åœ¨å†¬å­£å’Œå¤å­£çš„å•ä»·æ˜¯ä¸åŒçš„ï¼š

```js
if (!aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd))
 charge = quantity * plan.summerRate;
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;
```

æˆ‘æŠŠæ¡ä»¶åˆ¤æ–­æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­ï¼š

```js
if (summer())
 charge = quantity * plan.summerRate;
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
```

ç„¶åæç‚¼æ¡ä»¶åˆ¤æ–­ä¸ºçœŸçš„åˆ†æ”¯ï¼š

```js
if (summer())
 charge = summerCharge();
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
function summerCharge() {
 return quantity * plan.summerRate;
}
```

æœ€åæç‚¼æ¡ä»¶åˆ¤æ–­ä¸ºå‡çš„åˆ†æ”¯ï¼š

```js
if (summer())
 charge = summerCharge();
else
 charge = regularCharge();

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
function summerCharge() {
 return quantity * plan.summerRate;
}
function regularCharge() {
 return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

æç‚¼å®Œæˆåï¼Œæˆ‘å–œæ¬¢ç”¨ä¸‰å…ƒè¿ç®—ç¬¦é‡æ–°å®‰æ’æ¡ä»¶è¯­å¥ã€‚

```js
  charge = summer() ? summerCharge() : regularCharge();

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
function summerCharge() {
 return quantity * plan.summerRate;
}
function regularCharge() {
 return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

## 10.2 åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆConsolidate Conditional Expressionï¼‰

```js
if (anEmployee.seniority &lt; 2) return 0;
if (anEmployee.monthsDisabled &gt; 12) return 0;
if (anEmployee.isPartTime) return 0;


if (isNotEligibleForDisability()) return 0;

function isNotEligibleForDisability() {
 return ((anEmployee.seniority &lt; 2)
     || (anEmployee.monthsDisabled &gt; 12)
     || (anEmployee.isPartTime));
}
```

### åŠ¨æœº

æœ‰æ—¶æˆ‘ä¼šå‘ç°è¿™æ ·ä¸€ä¸²æ¡ä»¶æ£€æŸ¥ï¼šæ£€æŸ¥æ¡ä»¶å„ä¸ç›¸åŒï¼Œæœ€ç»ˆè¡Œä¸ºå´ä¸€è‡´ã€‚å¦‚æœå‘ç°è¿™ç§æƒ…å†µï¼Œå°±åº”è¯¥ä½¿ç”¨â€œé€»è¾‘æˆ–â€å’Œâ€œé€»è¾‘ä¸â€å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚

ä¹‹æ‰€ä»¥è¦åˆå¹¶æ¡ä»¶ä»£ç ï¼Œæœ‰ä¸¤ä¸ªé‡è¦åŸå› ã€‚é¦–å…ˆï¼Œåˆå¹¶åçš„æ¡ä»¶ä»£ç ä¼šè¡¨è¿°â€œå®é™…ä¸Šåªæœ‰ä¸€æ¬¡æ¡ä»¶æ£€æŸ¥ï¼Œåªä¸è¿‡æœ‰å¤šä¸ªå¹¶åˆ—æ¡ä»¶éœ€è¦æ£€æŸ¥è€Œå·²â€ï¼Œä»è€Œä½¿è¿™ä¸€æ¬¡æ£€æŸ¥çš„ç”¨æ„æ›´æ¸…æ™°ã€‚å½“ç„¶ï¼Œåˆå¹¶å‰å’Œåˆå¹¶åçš„ä»£ç æœ‰ç€ç›¸åŒçš„æ•ˆæœï¼Œä½†åŸå…ˆä»£ç ä¼ è¾¾å‡ºçš„ä¿¡æ¯å´æ˜¯â€œè¿™é‡Œæœ‰ä¸€äº›å„è‡ªç‹¬ç«‹çš„æ¡ä»¶æµ‹è¯•ï¼Œå®ƒä»¬åªæ˜¯æ°å¥½åŒæ—¶å‘ç”Ÿâ€ã€‚å…¶æ¬¡ï¼Œè¿™é¡¹é‡æ„å¾€å¾€å¯ä»¥ä¸ºä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰åšå¥½å‡†å¤‡ã€‚å°†æ£€æŸ¥æ¡ä»¶æç‚¼æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°å¯¹äºå˜æ¸…ä»£ç æ„ä¹‰éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæŠŠæè¿°â€œåšä»€ä¹ˆâ€çš„è¯­å¥æ¢æˆäº†â€œä¸ºä»€ä¹ˆè¿™æ ·åšâ€ã€‚

æ¡ä»¶è¯­å¥çš„åˆå¹¶ç†ç”±ä¹ŸåŒæ—¶æŒ‡å‡ºäº†ä¸è¦åˆå¹¶çš„ç†ç”±ï¼šå¦‚æœæˆ‘è®¤ä¸ºè¿™äº›æ£€æŸ¥çš„ç¡®å½¼æ­¤ç‹¬ç«‹ï¼Œçš„ç¡®ä¸åº”è¯¥è¢«è§†ä¸ºåŒä¸€æ¬¡æ£€æŸ¥ï¼Œæˆ‘å°±ä¸ä¼šä½¿ç”¨æœ¬é¡¹é‡æ„ã€‚

### åšæ³•

ç¡®å®šè¿™äº›æ¡ä»¶è¡¨è¾¾å¼éƒ½æ²¡æœ‰å‰¯ä½œç”¨ã€‚

å¦‚æœæŸä¸ªæ¡ä»¶è¡¨è¾¾å¼æœ‰å‰¯ä½œç”¨ï¼Œå¯ä»¥å…ˆç”¨å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦»ï¼ˆ306ï¼‰å¤„ç†ã€‚

ä½¿ç”¨é€‚å½“çš„é€»è¾‘è¿ç®—ç¬¦ï¼Œå°†ä¸¤ä¸ªç›¸å…³æ¡ä»¶è¡¨è¾¾å¼åˆå¹¶ä¸ºä¸€ä¸ªã€‚

é¡ºåºæ‰§è¡Œçš„æ¡ä»¶è¡¨è¾¾å¼ç”¨é€»è¾‘æˆ–æ¥åˆå¹¶ï¼ŒåµŒå¥—çš„ if è¯­å¥ç”¨é€»è¾‘ä¸æ¥åˆå¹¶ã€‚

æµ‹è¯•ã€‚

é‡å¤å‰é¢çš„åˆå¹¶è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼éƒ½åˆå¹¶åˆ°ä¸€èµ·ã€‚

å¯ä»¥è€ƒè™‘å¯¹åˆå¹¶åçš„æ¡ä»¶è¡¨è¾¾å¼å®æ–½æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

### èŒƒä¾‹

åœ¨èµ°è¯»ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çœ‹åˆ°äº†ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼š

```js
function disabilityAmount(anEmployee) {
 if (anEmployee.seniority &lt; 2) return 0;
 if (anEmployee.monthsDisabled &gt; 12) return 0;
 if (anEmployee.isPartTime) return 0;
 // compute the disability amount
```

è¿™é‡Œæœ‰ä¸€è¿ä¸²çš„æ¡ä»¶æ£€æŸ¥ï¼Œéƒ½æŒ‡å‘åŒæ ·çš„ç»“æœã€‚æ—¢ç„¶ç»“æœæ˜¯ç›¸åŒçš„ï¼Œå°±åº”è¯¥æŠŠè¿™äº›æ¡ä»¶æ£€æŸ¥åˆå¹¶æˆä¸€æ¡è¡¨è¾¾å¼ã€‚å¯¹äºè¿™æ ·é¡ºåºæ‰§è¡Œçš„æ¡ä»¶æ£€æŸ¥ï¼Œå¯ä»¥ç”¨é€»è¾‘æˆ–è¿ç®—ç¬¦æ¥åˆå¹¶ã€‚

```js
function disabilityAmount(anEmployee) {
 if ((anEmployee.seniority &lt; 2)
   || (anEmployee.monthsDisabled &gt; 12)) return 0;
 if (anEmployee.isPartTime) return 0;
 // compute the disability amount
```

æµ‹è¯•ï¼Œç„¶åæŠŠä¸‹ä¸€ä¸ªæ¡ä»¶æ£€æŸ¥ä¹Ÿåˆå¹¶è¿›æ¥ï¼š

```js
function disabilityAmount(anEmployee) {
 if ((anEmployee.seniority &lt; 2)
   || (anEmployee.monthsDisabled &gt; 12)
   || (anEmployee.isPartTime)) return 0;
 // compute the disability amount
```

åˆå¹¶å®Œæˆåï¼Œå†å¯¹è¿™å¥æ¡ä»¶è¡¨è¾¾å¼ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```js
function disabilityAmount(anEmployee) {
 if (isNotEligableForDisability()) return 0;
 // compute the disability amount

function isNotEligableForDisability() {
 return ((anEmployee.seniority &lt; 2)
     || (anEmployee.monthsDisabled &gt; 12)
     || (anEmployee.isPartTime));
}
```

### èŒƒä¾‹ï¼šä½¿ç”¨é€»è¾‘ä¸

ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†ç”¨é€»è¾‘æˆ–åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼çš„åšæ³•ã€‚ä¸è¿‡ï¼Œæˆ‘æœ‰å¯èƒ½é‡åˆ°éœ€è¦é€»è¾‘ä¸çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼ŒåµŒå¥— if è¯­å¥çš„æƒ…å†µï¼š

```js
if (anEmployee.onVacation)
 if (anEmployee.seniority &gt; 10)
  return 1;
return 0.5;
```

å¯ä»¥ç”¨é€»è¾‘ä¸è¿ç®—ç¬¦å°†å…¶åˆå¹¶ã€‚

```js
if ((anEmployee.onVacation)
  &amp;&amp; (anEmployee.seniority &gt; 10)) return 1;
return 0.5;
```

å¦‚æœåŸæ¥çš„æ¡ä»¶é€»è¾‘æ··æ‚äº†è¿™ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä¹Ÿä¼šæ ¹æ®éœ€è¦ç»„åˆä½¿ç”¨é€»è¾‘ä¸å’Œé€»è¾‘æˆ–è¿ç®—ç¬¦ã€‚åœ¨è¿™ç§æ—¶å€™ï¼Œä»£ç å¾ˆå¯èƒ½å˜å¾—æ··ä¹±ï¼Œæ‰€ä»¥æˆ‘ä¼šé¢‘ç¹ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ï¼ŒæŠŠä»£ç å˜å¾—å¯è¯»ã€‚

## 10.3 ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ï¼ˆReplace Nested Conditional with Guard Clausesï¼‰

```js
function getPayAmount() {
  let result;
  if (isDead) result = deadAmount();
  else {
    if (isSeparated) result = separatedAmount();
    else {
      if (isRetired) result = retiredAmount();
      else result = normalPayAmount();
    }
  }
  return result;
}

function getPayAmount() {
  if (isDead) return deadAmount();
  if (isSeparated) return separatedAmount();
  if (isRetired) return retiredAmount();
  return normalPayAmount();
}
```

### åŠ¨æœº

æ ¹æ®æˆ‘çš„ç»éªŒï¼Œæ¡ä»¶è¡¨è¾¾å¼é€šå¸¸æœ‰ä¸¤ç§é£æ ¼ã€‚ç¬¬ä¸€ç§é£æ ¼æ˜¯ï¼šä¸¤ä¸ªæ¡ä»¶åˆ†æ”¯éƒ½å±äºæ­£å¸¸è¡Œä¸ºã€‚ç¬¬äºŒç§é£æ ¼åˆ™æ˜¯ï¼šåªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œå¦ä¸€ä¸ªåˆ†æ”¯åˆ™æ˜¯å¼‚å¸¸çš„æƒ…å†µã€‚

è¿™ä¸¤ç±»æ¡ä»¶è¡¨è¾¾å¼æœ‰ä¸åŒçš„ç”¨é€”ï¼Œè¿™ä¸€ç‚¹åº”è¯¥é€šè¿‡ä»£ç è¡¨ç°å‡ºæ¥ã€‚å¦‚æœä¸¤æ¡åˆ†æ”¯éƒ½æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œå°±åº”è¯¥ä½¿ç”¨å½¢å¦‚ if...else...çš„æ¡ä»¶è¡¨è¾¾å¼ï¼›å¦‚æœæŸä¸ªæ¡ä»¶æå…¶ç½•è§ï¼Œå°±åº”è¯¥å•ç‹¬æ£€æŸ¥è¯¥æ¡ä»¶ï¼Œå¹¶åœ¨è¯¥æ¡ä»¶ä¸ºçœŸæ—¶ç«‹åˆ»ä»å‡½æ•°ä¸­è¿”å›ã€‚è¿™æ ·çš„å•ç‹¬æ£€æŸ¥å¸¸å¸¸è¢«ç§°ä¸ºâ€œå«è¯­å¥â€ï¼ˆguard clausesï¼‰ã€‚

ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼çš„ç²¾é«“å°±æ˜¯ï¼šç»™æŸä¸€æ¡åˆ†æ”¯ä»¥ç‰¹åˆ«çš„é‡è§†ã€‚å¦‚æœä½¿ç”¨ if-then-else ç»“æ„ï¼Œä½ å¯¹ if åˆ†æ”¯å’Œ else åˆ†æ”¯çš„é‡è§†æ˜¯åŒç­‰çš„ã€‚è¿™æ ·çš„ä»£ç ç»“æ„ä¼ é€’ç»™é˜…è¯»è€…çš„æ¶ˆæ¯å°±æ˜¯ï¼šå„ä¸ªåˆ†æ”¯æœ‰åŒæ ·çš„é‡è¦æ€§ã€‚å«è¯­å¥å°±ä¸åŒäº†ï¼Œå®ƒå‘Šè¯‰é˜…è¯»è€…ï¼šâ€œè¿™ç§æƒ…å†µä¸æ˜¯æœ¬å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘æ‰€å…³å¿ƒçš„ï¼Œå¦‚æœå®ƒçœŸå‘ç”Ÿäº†ï¼Œè¯·åšä¸€äº›å¿…è¦çš„æ•´ç†å·¥ä½œï¼Œç„¶åé€€å‡ºã€‚â€

â€œæ¯ä¸ªå‡½æ•°åªèƒ½æœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£â€çš„è§‚å¿µï¼Œæ ¹æ·±è’‚å›ºäºæŸäº›ç¨‹åºå‘˜çš„è„‘æµ·é‡Œã€‚æˆ‘å‘ç°ï¼Œå½“æˆ‘å¤„ç†ä»–ä»¬ç¼–å†™çš„ä»£ç æ—¶ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ã€‚ç°ä»Šçš„ç¼–ç¨‹è¯­è¨€éƒ½ä¼šå¼ºåˆ¶ä¿è¯æ¯ä¸ªå‡½æ•°åªæœ‰ä¸€ä¸ªå…¥å£ï¼Œè‡³äºâ€œå•ä¸€å‡ºå£â€è§„åˆ™ï¼Œå…¶å®ä¸æ˜¯é‚£ä¹ˆæœ‰ç”¨ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä¿æŒä»£ç æ¸…æ™°æ‰æ˜¯æœ€å…³é”®çš„ï¼šå¦‚æœå•ä¸€å‡ºå£èƒ½ä½¿è¿™ä¸ªå‡½æ•°æ›´æ¸…æ¥šæ˜“è¯»ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å•ä¸€å‡ºå£ï¼›å¦åˆ™å°±ä¸å¿…è¿™ä¹ˆåšã€‚

### åšæ³•

é€‰ä¸­æœ€å¤–å±‚éœ€è¦è¢«æ›¿æ¢çš„æ¡ä»¶é€»è¾‘ï¼Œå°†å…¶æ›¿æ¢ä¸ºå«è¯­å¥ã€‚

æµ‹è¯•ã€‚

æœ‰éœ€è¦çš„è¯ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚

å¦‚æœæ‰€æœ‰å«è¯­å¥éƒ½å¼•å‘åŒæ ·çš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ263ï¼‰åˆå¹¶ä¹‹ã€‚

### èŒƒä¾‹

ä¸‹é¢çš„ä»£ç ç”¨äºè®¡ç®—è¦æ”¯ä»˜ç»™å‘˜å·¥ï¼ˆemployeeï¼‰çš„å·¥èµ„ã€‚åªæœ‰è¿˜åœ¨å…¬å¸ä¸Šç­çš„å‘˜å·¥æ‰éœ€è¦æ”¯ä»˜å·¥èµ„ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°éœ€è¦æ£€æŸ¥ä¸¤ç§â€œå‘˜å·¥å·²ç»ä¸åœ¨å…¬å¸ä¸Šç­â€çš„æƒ…å†µã€‚

```js
function payAmount(employee) {
 let result;
 if(employee.isSeparated) {
  result = {amount: 0, reasonCode:"SEP"};
 }
 else {
  if (employee.isRetired) {
   result = {amount: 0, reasonCode: "RET"};
  }
  else {
   // logic to compute amount
   lorem.ipsum(dolor.sitAmet);1
   consectetur(adipiscing).elit();
   sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
   ut.enim.ad(minim.veniam);
   result = someFinalComputation();
  }
 }
 return result;
}
```

åµŒå¥—çš„æ¡ä»¶é€»è¾‘è®©æˆ‘ä»¬çœ‹ä¸æ¸…ä»£ç çœŸå®çš„å«ä¹‰ã€‚åªæœ‰å½“å‰ä¸¤ä¸ªæ¡ä»¶è¡¨è¾¾å¼éƒ½ä¸ä¸ºçœŸçš„æ—¶å€™ï¼Œè¿™æ®µä»£ç æ‰çœŸæ­£å¼€å§‹å®ƒçš„ä¸»è¦å·¥ä½œã€‚æ‰€ä»¥ï¼Œå«è¯­å¥èƒ½è®©ä»£ç æ›´æ¸…æ™°åœ°é˜è¿°è‡ªå·±çš„æ„å›¾ã€‚

ä¸€å¦‚æ—¢å¾€åœ°ï¼Œæˆ‘å–œæ¬¢å°æ­¥å‰è¿›ï¼Œæ‰€ä»¥æˆ‘å…ˆå¤„ç†æœ€é¡¶ä¸Šçš„æ¡ä»¶é€»è¾‘ã€‚

```js
function payAmount(employee) {
 let result;
 if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};
 if (employee.isRetired) {
  result = {amount: 0, reasonCode: "RET"};
 }
 else {
  // logic to compute amount
  lorem.ipsum(dolor.sitAmet);
  consectetur(adipiscing).elit();
  sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
  ut.enim.ad(minim.veniam);
  result = someFinalComputation();
 }
 return result;
}
```

åšå®Œè¿™æ­¥ä¿®æ”¹ï¼Œæˆ‘æ‰§è¡Œæµ‹è¯•ï¼Œç„¶åç»§ç»­ä¸‹ä¸€æ­¥ã€‚

```js
function payAmount(employee) {
 let result;
 if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};
 if (employee.isRetired)   return {amount: 0, reasonCode: "RET"};
 // logic to compute amount
 lorem.ipsum(dolor.sitAmet);
 consectetur(adipiscing).elit();
 sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
 ut.enim.ad(minim.veniam);
 result = someFinalComputation();
 return result;
}
```

æ­¤æ—¶ï¼Œresult å˜é‡å·²ç»æ²¡æœ‰ç”¨å¤„äº†ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒåˆ æ‰ï¼š

```js
function payAmount(employee) {
 let result;
 if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};
 if (employee.isRetired)   return {amount: 0, reasonCode: "RET"};
 // logic to compute amount
 lorem.ipsum(dolor.sitAmet);
 consectetur(adipiscing).elit();
 sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
 ut.enim.ad(minim.veniam);
 return someFinalComputation();
}
```

èƒ½å‡å°‘ä¸€ä¸ªå¯å˜å˜é‡æ€»æ˜¯å¥½çš„ã€‚

### èŒƒä¾‹ï¼šå°†æ¡ä»¶åè½¬

å®¡é˜…æœ¬ä¹¦ç¬¬ 1 ç‰ˆçš„åˆç¨¿æ—¶ï¼ŒJoshua Kerievsky æŒ‡å‡ºï¼šæˆ‘ä»¬å¸¸å¸¸å¯ä»¥å°†æ¡ä»¶è¡¨è¾¾å¼åè½¬ï¼Œä»è€Œå®ç°ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ã€‚ä¸ºäº†æ‹¯æ•‘æˆ‘å¯æ€œçš„æƒ³è±¡åŠ›ï¼Œä»–è¿˜å¥½å¿ƒå¸®æˆ‘æƒ³äº†ä¸€ä¸ªä¾‹å­ï¼š

```js
function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital &gt; 0) {
  if (anInstrument.interestRate &gt; 0 &amp;&amp; anInstrument.duration &gt; 0) {
   result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
  }
 }
 return result;
}
```

åŒæ ·åœ°ï¼Œæˆ‘é€ä¸€è¿›è¡Œæ›¿æ¢ã€‚ä¸è¿‡è¿™æ¬¡åœ¨æ’å…¥å«è¯­å¥æ—¶ï¼Œæˆ‘éœ€è¦å°†ç›¸åº”çš„æ¡ä»¶åè½¬è¿‡æ¥ï¼š

```js
function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital &lt;= 0) return result;
 if (anInstrument.interestRate &gt; 0 &amp;&amp; anInstrument.duration &gt; 0) {
  result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 }
 return result;
}
```

ä¸‹ä¸€ä¸ªæ¡ä»¶ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘åˆ†ä¸¤æ­¥è¿›è¡Œåè½¬ã€‚é¦–å…ˆåŠ å…¥ä¸€ä¸ªé€»è¾‘éæ“ä½œï¼š

```js
function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital &lt;= 0) return result;
 if (!(anInstrument.interestRate &gt; 0 &amp;&amp; anInstrument.duration &gt; 0)) return result;
 result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 return result;
}
```

ä½†æ˜¯åœ¨è¿™æ ·çš„æ¡ä»¶è¡¨è¾¾å¼ä¸­ç•™ä¸‹ä¸€ä¸ªé€»è¾‘éï¼Œä¼šæŠŠæˆ‘çš„è„‘è¢‹æ‹§æˆä¸€å›¢ä¹±éº»ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒç®€åŒ–æˆä¸‹é¢è¿™æ ·ï¼š

```js
  function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital &lt;= 0) return result;
 if (anInstrument.interestRate &lt;= 0 || anInstrument.duration &lt;= 0) return result;
 result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 return result;
}
```

è¿™ä¸¤è¡Œé€»è¾‘è¯­å¥å¼•å‘çš„ç»“æœä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ç”¨åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ263ï¼‰å°†å…¶åˆå¹¶ã€‚

```js
function adjustedCapital(anInstrument) {
 let result = 0;
 if (   anInstrument.capital      &lt;= 0
   || anInstrument.interestRate &lt;= 0
   || anInstrument.duration     &lt;= 0) return result;
 result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 return result;
}
```

æ­¤æ—¶ result å˜é‡åšäº†ä¸¤ä»¶äº‹ï¼šä¸€å¼€å§‹æˆ‘æŠŠå®ƒè®¾ä¸º 0ï¼Œä»£è¡¨å«è¯­å¥è¢«è§¦å‘æ—¶çš„è¿”å›å€¼ï¼›ç„¶ååˆç”¨æœ€ç»ˆè®¡ç®—çš„ç»“æœç»™å®ƒèµ‹å€¼ã€‚æˆ‘å¯ä»¥å½»åº•ç§»é™¤è¿™ä¸ªå˜é‡ï¼Œé¿å…ç”¨ä¸€ä¸ªå˜é‡æ‰¿æ‹…ä¸¤é‡è´£ä»»ï¼Œè€Œä¸”åˆå‡å°‘äº†ä¸€ä¸ªå¯å˜å˜é‡ã€‚

```js
function adjustedCapital(anInstrument) {
 if (   anInstrument.capital     &lt;= 0
   || anInstrument.interestRate &lt;= 0
   || anInstrument.duration   &lt;= 0) return 0;
 return (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
}
```

1 â€œlorem.ipsumâ€¦â€¦â€æ˜¯ä¸€ç¯‡å¸¸è§äºæ’ç‰ˆè®¾è®¡é¢†åŸŸçš„æ–‡ç« ï¼Œå…¶å†…å®¹ä¸ºä¸å…·å¯è¯»æ€§çš„å­—ç¬¦ç»„åˆï¼Œç›®çš„æ˜¯ä½¿é˜…è¯»è€…åªä¸“æ³¨äºè§‚å¯Ÿæ®µè½çš„å­—å‹å’Œç‰ˆå‹ã€‚â€”â€”è¯‘è€…æ³¨

## 10.4 ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆReplace Conditional with Polymorphismï¼‰

```js
switch (bird.type) {
 case 'EuropeanSwallow':
  return "average";
 case 'AfricanSwallow':
  return (bird.numberOfCoconuts &gt; 2) ? "tired" : "average";
 case 'NorwegianBlueParrot':
  return (bird.voltage &gt; 100) ? "scorched" : "beautiful";
 default:
  return "unknown";


class EuropeanSwallow {
 get plumage() {
  return "average";
 }
class AfricanSwallow {
 get plumage() {
   return (this.numberOfCoconuts &gt; 2) ? "tired" : "average";
 }
class NorwegianBlueParrot {
 get plumage() {
   return (this.voltage &gt; 100) ? "scorched" : "beautiful";
}
```

### åŠ¨æœº

å¤æ‚çš„æ¡ä»¶é€»è¾‘æ˜¯ç¼–ç¨‹ä¸­æœ€éš¾ç†è§£çš„ä¸œè¥¿ä¹‹ä¸€ï¼Œå› æ­¤æˆ‘ä¸€ç›´åœ¨å¯»æ±‚ç»™æ¡ä»¶é€»è¾‘æ·»åŠ ç»“æ„ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘å‘ç°å¯ä»¥å°†æ¡ä»¶é€»è¾‘æ‹†åˆ†åˆ°ä¸åŒçš„åœºæ™¯ï¼ˆæˆ–è€…å«é«˜é˜¶ç”¨ä¾‹ï¼‰ï¼Œä»è€Œæ‹†è§£å¤æ‚çš„æ¡ä»¶é€»è¾‘ã€‚è¿™ç§æ‹†åˆ†æœ‰æ—¶ç”¨æ¡ä»¶é€»è¾‘æœ¬èº«çš„ç»“æ„å°±è¶³ä»¥è¡¨è¾¾ï¼Œä½†ä½¿ç”¨ç±»å’Œå¤šæ€èƒ½æŠŠé€»è¾‘çš„æ‹†åˆ†è¡¨è¿°å¾—æ›´æ¸…æ™°ã€‚

ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯ï¼šæˆ‘å¯ä»¥æ„é€ ä¸€ç»„ç±»å‹ï¼Œæ¯ä¸ªç±»å‹å¤„ç†å„è‡ªçš„ä¸€ç§æ¡ä»¶é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä¼šæ³¨æ„åˆ°ï¼Œå›¾ä¹¦ã€éŸ³ä¹ã€é£Ÿå“çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬åˆ†å±ä¸åŒç±»å‹çš„å•†å“ã€‚æœ€æ˜æ˜¾çš„å¾å…†å°±æ˜¯æœ‰å¥½å‡ ä¸ªå‡½æ•°éƒ½æœ‰åŸºäºç±»å‹ä»£ç çš„ switch è¯­å¥ã€‚è‹¥æœçœŸå¦‚æ­¤ï¼Œæˆ‘å°±å¯ä»¥é’ˆå¯¹ switch è¯­å¥ä¸­çš„æ¯ç§åˆ†æ”¯é€»è¾‘åˆ›å»ºä¸€ä¸ªç±»ï¼Œç”¨å¤šæ€æ¥æ‰¿è½½å„ä¸ªç±»å‹ç‰¹æœ‰çš„è¡Œä¸ºï¼Œä»è€Œå»é™¤é‡å¤çš„åˆ†æ”¯é€»è¾‘ã€‚

å¦ä¸€ç§æƒ…å†µæ˜¯ï¼šæœ‰ä¸€ä¸ªåŸºç¡€é€»è¾‘ï¼Œåœ¨å…¶ä¸Šåˆæœ‰ä¸€äº›å˜ä½“ã€‚åŸºç¡€é€»è¾‘å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€ç®€å•çš„ã€‚æˆ‘å¯ä»¥æŠŠåŸºç¡€é€»è¾‘æ”¾è¿›è¶…ç±»ï¼Œè¿™æ ·æˆ‘å¯ä»¥é¦–å…ˆç†è§£è¿™éƒ¨åˆ†é€»è¾‘ï¼Œæš‚æ—¶ä¸ç®¡å„ç§å˜ä½“ï¼Œç„¶åæˆ‘å¯ä»¥æŠŠæ¯ç§å˜ä½“é€»è¾‘å•ç‹¬æ”¾è¿›ä¸€ä¸ªå­ç±»ï¼Œå…¶ä¸­çš„ä»£ç ç€é‡å¼ºè°ƒä¸åŸºç¡€é€»è¾‘çš„å·®å¼‚ã€‚

å¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€ã€‚è·Ÿå…¶ä»–ä¸€åˆ‡æœ‰ç”¨çš„ç‰¹æ€§ä¸€æ ·ï¼Œå®ƒä¹Ÿå¾ˆå®¹æ˜“è¢«æ»¥ç”¨ã€‚æˆ‘æ›¾ç»é‡åˆ°æœ‰äººäº‰è®ºè¯´æ‰€æœ‰æ¡ä»¶é€»è¾‘éƒ½åº”è¯¥ç”¨å¤šæ€å–ä»£ã€‚æˆ‘ä¸èµåŒè¿™ç§è§‚ç‚¹ã€‚æˆ‘çš„å¤§éƒ¨åˆ†æ¡ä»¶é€»è¾‘åªç”¨åˆ°äº†åŸºæœ¬çš„æ¡ä»¶è¯­å¥â€”â€”if/else å’Œ switch/caseï¼Œå¹¶ä¸éœ€è¦åŠ³å¸ˆåŠ¨ä¼—åœ°å¼•å…¥å¤šæ€ã€‚ä½†å¦‚æœå‘ç°å¦‚å‰æ‰€è¿°çš„å¤æ‚æ¡ä»¶é€»è¾‘ï¼Œå¤šæ€æ˜¯æ”¹å–„è¿™ç§æƒ…å†µçš„æœ‰åŠ›å·¥å…·ã€‚

### åšæ³•

å¦‚æœç°æœ‰çš„ç±»å°šä¸å…·å¤‡å¤šæ€è¡Œä¸ºï¼Œå°±ç”¨å·¥å‚å‡½æ•°åˆ›å»ºä¹‹ï¼Œä»¤å·¥å‚å‡½æ•°è¿”å›æ°å½“çš„å¯¹è±¡å®ä¾‹ã€‚

åœ¨è°ƒç”¨æ–¹ä»£ç ä¸­ä½¿ç”¨å·¥å‚å‡½æ•°è·å¾—å¯¹è±¡å®ä¾‹ã€‚

å°†å¸¦æœ‰æ¡ä»¶é€»è¾‘çš„å‡½æ•°ç§»åˆ°è¶…ç±»ä¸­ã€‚

å¦‚æœæ¡ä»¶é€»è¾‘è¿˜æœªæç‚¼è‡³ç‹¬ç«‹çš„å‡½æ•°ï¼Œé¦–å…ˆå¯¹å…¶ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

ä»»é€‰ä¸€ä¸ªå­ç±»ï¼Œåœ¨å…¶ä¸­å»ºç«‹ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ä¹‹è¦†å†™è¶…ç±»ä¸­å®¹çº³æ¡ä»¶è¡¨è¾¾å¼çš„é‚£ä¸ªå‡½æ•°ã€‚å°†ä¸è¯¥å­ç±»ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼åˆ†æ”¯å¤åˆ¶åˆ°æ–°å‡½æ•°ä¸­ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œé€‚å½“è°ƒæ•´ã€‚

é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå¤„ç†å…¶ä»–æ¡ä»¶åˆ†æ”¯ã€‚

åœ¨è¶…ç±»å‡½æ•°ä¸­ä¿ç•™é»˜è®¤æƒ…å†µçš„é€»è¾‘ã€‚æˆ–è€…ï¼Œå¦‚æœè¶…ç±»åº”è¯¥æ˜¯æŠ½è±¡çš„ï¼Œå°±æŠŠè¯¥å‡½æ•°å£°æ˜ä¸º abstractï¼Œæˆ–åœ¨å…¶ä¸­ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¡¨æ˜è®¡ç®—è´£ä»»éƒ½åœ¨å­ç±»ä¸­ã€‚

### èŒƒä¾‹

æˆ‘çš„æœ‹å‹æœ‰ä¸€ç¾¤é¸Ÿå„¿ï¼Œä»–æƒ³çŸ¥é“è¿™äº›é¸Ÿé£å¾—æœ‰å¤šå¿«ï¼Œä»¥åŠå®ƒä»¬çš„ç¾½æ¯›æ˜¯ä»€ä¹ˆæ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å†™äº†ä¸€å°æ®µç¨‹åºæ¥åˆ¤æ–­è¿™äº›ä¿¡æ¯ã€‚

```js
function plumages(birds) {
 return new Map(birds.map(b =&gt; [b.name, plumage(b)]));
}
function speeds(birds) {
 return new Map(birds.map(b =&gt; [b.name, airSpeedVelocity(b)]));
}

function plumage(bird) {
 switch (bird.type) {
 case 'EuropeanSwallow':
  return "average";
 case 'AfricanSwallow':
  return (bird.numberOfCoconuts &gt; 2) ? "tired" : "average";
 case 'NorwegianBlueParrot':
  return (bird.voltage &gt; 100) ? "scorched" : "beautiful";
 default:
  return "unknown";
 }
}

function airSpeedVelocity(bird) {
 switch (bird.type) {
 case 'EuropeanSwallow':
  return 35;
 case 'AfricanSwallow':
  return 40 - 2 * bird.numberOfCoconuts;
 case 'NorwegianBlueParrot':
  return (bird.isNailed) ? 0 : 10 + bird.voltage / 10;
 default:
  return null;
 }
}
```

æœ‰ä¸¤ä¸ªä¸åŒçš„æ“ä½œï¼Œå…¶è¡Œä¸ºéƒ½éšç€â€œé¸Ÿçš„ç±»å‹â€å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤å¯ä»¥åˆ›å»ºå‡ºå¯¹åº”çš„ç±»ï¼Œç”¨å¤šæ€æ¥å¤„ç†å„ç±»å‹ç‰¹æœ‰çš„è¡Œä¸ºã€‚

æˆ‘å…ˆå¯¹ airSpeedVelocity å’Œ plumage ä¸¤ä¸ªå‡½æ•°ä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰ã€‚

```js
function plumage(bird) {
 return new Bird(bird).plumage;
}

function airSpeedVelocity(bird) {
 return new Bird(bird).airSpeedVelocity;
}
class Bird {
 constructor(birdObject) {
  Object.assign(this, birdObject);
 }
 get plumage() {
  switch (this.type) {
  case 'EuropeanSwallow':
   return "average";
  case 'AfricanSwallow':
   return (this.numberOfCoconuts &gt; 2) ? "tired" : "average";
  case 'NorwegianBlueParrot':
   return (this.voltage &gt; 100) ? "scorched" : "beautiful";
  default:
   return "unknown";
  }
 }
 get airSpeedVelocity() {
  switch (this.type) {
  case 'EuropeanSwallow':
   return 35;
  case 'AfricanSwallow':
   return 40 - 2 * this.numberOfCoconuts;
  case 'NorwegianBlueParrot':
   return (this.isNailed) ? 0 : 10 + this.voltage / 10;
  default:
   return null;
  }
 }
}
```

ç„¶åé’ˆå¯¹æ¯ç§é¸Ÿåˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œç”¨ä¸€ä¸ªå·¥å‚å‡½æ•°æ¥å®ä¾‹åŒ–åˆé€‚çš„å­ç±»å¯¹è±¡ã€‚

```js
function plumage(bird) {
  return createBird(bird).plumage;
}

function airSpeedVelocity(bird) {
  return createBird(bird).airSpeedVelocity;
}

function createBird(bird) {
  switch (bird.type) {
    case "EuropeanSwallow":
      return new EuropeanSwallow(bird);
    case "AfricanSwallow":
      return new AfricanSwallow(bird);
    case "NorweigianBlueParrot":
      return new NorwegianBlueParrot(bird);
    default:
      return new Bird(bird);
  }
}
class EuropeanSwallow extends Bird {}

class AfricanSwallow extends Bird {}

class NorwegianBlueParrot extends Bird {}
```

ç°åœ¨æˆ‘å·²ç»æœ‰äº†éœ€è¦çš„ç±»ç»“æ„ï¼Œå¯ä»¥å¤„ç†ä¸¤ä¸ªæ¡ä»¶é€»è¾‘äº†ã€‚å…ˆä» plumage å‡½æ•°å¼€å§‹ï¼Œæˆ‘ä» switch è¯­å¥ä¸­é€‰ä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨é€‚å½“çš„å­ç±»ä¸­è¦†å†™è¿™ä¸ªé€»è¾‘ã€‚

#### class EuropeanSwallow...

```js
get plumage() {
  return "average";
}
```

#### class Bird...

```js
get plumage() {
 switch (this.type) {
 case 'EuropeanSwallow':
  throw "oops";
 case 'AfricanSwallow':
  return (this.numberOfCoconuts &gt; 2) ? "tired" : "average";
 case 'NorwegianBlueParrot':
  return (this.voltage &gt; 100) ? "scorched" : "beautiful";
 default:
  return "unknown";
 }
}
```

åœ¨è¶…ç±»ä¸­ï¼Œæˆ‘æŠŠå¯¹åº”çš„é€»è¾‘åˆ†æ”¯æ”¹ä¸ºæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºæˆ‘æ€»æ˜¯åæ‰§åœ°æ‹…å¿ƒå‡ºé”™ã€‚

æ­¤æ—¶æˆ‘å°±å¯ä»¥ç¼–è¯‘å¹¶æµ‹è¯•ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œæˆ‘å¯ä»¥æ¥ç€å¤„ç†ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚

#### class AfricanSwallow...

```js
get plumage() {
   return (this.numberOfCoconuts &gt; 2) ? "tired" : "average";
}
```

ç„¶åæ˜¯æŒªå¨è“é¹¦é¹‰ï¼ˆNorwegian Blueï¼‰çš„åˆ†æ”¯ã€‚

#### class NorwegianBlueParrot...

```js
get plumage() {
   return (this.voltage &gt;100) ? "scorched" : "beautiful";
}
```

è¶…ç±»å‡½æ•°ä¿ç•™ä¸‹æ¥å¤„ç†é»˜è®¤æƒ…å†µã€‚

#### class Bird...

```js
get plumage() {
  return "unknown";
}
```

airSpeedVelocity ä¹Ÿå¦‚æ³•ç‚®åˆ¶ã€‚å®Œæˆä»¥åï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼ˆæˆ‘è¿˜å¯¹é¡¶å±‚çš„ airSpeedVelocity å’Œ plumage å‡½æ•°åšäº†å†…è”å¤„ç†ï¼‰ï¼š

```js
function plumages(birds) {
 return new Map(birds
         .map(b =&gt; createBird(b))
         .map(bird =&gt; [bird.name, bird.plumage]));
}
function speeds(birds) {
 return new Map(birds
         .map(b =&gt; createBird(b))
         .map(bird =&gt; [bird.name, bird.airSpeedVelocity]));
}

function createBird(bird) {
 switch (bird.type) {
 case 'EuropeanSwallow':
  return new EuropeanSwallow(bird);
 case 'AfricanSwallow':
  return new AfricanSwallow(bird);
 case 'NorwegianBlueParrot':
  return new NorwegianBlueParrot(bird);
 default:
  return new Bird(bird);
 }
}

class Bird {
 constructor(birdObject) {
  Object.assign(this, birdObject);
 }
 get plumage() {
  return "unknown";
 }
 get airSpeedVelocity() {
  return null;
 }
}
class EuropeanSwallow extends Bird {
 get plumage() {
  return "average";
 }
 get airSpeedVelocity() {
  return 35;
 }
}
class AfricanSwallow extends Bird {
 get plumage() {
  return (this.numberOfCoconuts &gt; 2) ? "tired" : "average";
 }
 get airSpeedVelocity() {
  return 40 - 2 * this.numberOfCoconuts;
 }
}
class NorwegianBlueParrot extends Bird {
 get plumage() {
  return (this.voltage &gt; 100) ? "scorched" : "beautiful";
 }
 get airSpeedVelocity() {
  return (this.isNailed) ? 0 : 10 + this.voltage / 10;
 }
}
```

çœ‹ç€æœ€ç»ˆçš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡º Bird è¶…ç±»å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚åœ¨ JavaScript ä¸­ï¼Œå¤šæ€ä¸ä¸€å®šéœ€è¦ç±»å‹å±‚çº§ï¼Œåªè¦å¯¹è±¡å®ç°äº†é€‚å½“çš„å‡½æ•°å°±è¡Œã€‚ä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘æ„¿æ„ä¿ç•™è¿™ä¸ªä¸å¿…è¦çš„è¶…ç±»ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©é˜é‡Šå„ä¸ªå­ç±»ä¸é—®é¢˜åŸŸä¹‹é—´çš„å…³ç³»ã€‚

### èŒƒä¾‹ï¼šç”¨å¤šæ€å¤„ç†å˜ä½“é€»è¾‘

åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œâ€œé¸Ÿâ€çš„ç±»å‹ä½“ç³»æ˜¯ä¸€ä¸ªæ¸…æ™°çš„æ³›åŒ–ä½“ç³»ï¼šè¶…ç±»æ˜¯æŠ½è±¡çš„â€œé¸Ÿâ€ï¼Œå­ç±»æ˜¯å„ç§å…·ä½“çš„é¸Ÿã€‚è¿™æ˜¯æ•™ç§‘ä¹¦ï¼ˆåŒ…æ‹¬æˆ‘å†™çš„ä¹¦ï¼‰ä¸­ç»å¸¸è®¨è®ºçš„ç»§æ‰¿å’Œå¤šæ€ï¼Œä½†å¹¶ä¸æ˜¯å®è·µä¸­ä½¿ç”¨ç»§æ‰¿çš„å”¯ä¸€æ–¹å¼ã€‚å®é™…ä¸Šï¼Œè¿™ç§æ–¹å¼å¾ˆå¯èƒ½ä¸æ˜¯æœ€å¸¸ç”¨æˆ–æœ€å¥½çš„æ–¹å¼ã€‚å¦ä¸€ç§ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µæ˜¯ï¼šæˆ‘æƒ³è¡¨è¾¾æŸä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡å¤§ä½“ç±»ä¼¼ï¼Œä½†åˆæœ‰ä¸€äº›ä¸åŒä¹‹å¤„ã€‚

ä¸‹é¢æœ‰ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šæœ‰ä¸€å®¶è¯„çº§æœºæ„ï¼Œè¦å¯¹è¿œæ´‹èˆªèˆ¹çš„èˆªè¡Œè¿›è¡ŒæŠ•èµ„è¯„çº§ã€‚è¿™å®¶è¯„çº§æœºæ„ä¼šç»™å‡ºâ€œAâ€æˆ–è€…â€œBâ€ä¸¤ç§è¯„çº§ï¼Œå–å†³äºå¤šç§é£é™©å’Œç›ˆåˆ©æ½œåŠ›çš„å› ç´ ã€‚åœ¨è¯„ä¼°é£é™©æ—¶ï¼Œæ—¢è¦è€ƒè™‘èˆªç¨‹æœ¬èº«çš„ç‰¹å¾ï¼Œä¹Ÿè¦è€ƒè™‘èˆ¹é•¿è¿‡å¾€èˆªè¡Œçš„å†å²ã€‚

```js
function rating(voyage, history) {
 const vpf = voyageProfitFactor(voyage, history);
 const vr = voyageRisk(voyage);
 const chr = captainHistoryRisk(voyage, history);
 if (vpf * 3 &gt; (vr + chr * 2)) return "A";
 else return "B";
}
function voyageRisk(voyage) {
 let result = 1;
 if (voyage.length &gt; 4) result += 2;
 if (voyage.length &gt; 8) result += voyage.length - 8;
 if (["china", "east-indies"].includes(voyage.zone)) result += 4;
 return Math.max(result, 0);
}
function captainHistoryRisk(voyage, history) {
 let result = 1;
 if (history.length &lt; 5) result += 4;
 result += history.filter(v =&gt; v.profit &lt; 0).length;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) result -= 2;
 return Math.max(result, 0);
}
function hasChina(history) {
 return history.some(v =&gt; "china" === v.zone);
}
function voyageProfitFactor(voyage, history) {
 let result = 2;
 if (voyage.zone === "china") result += 1;
 if (voyage.zone === "east-indies") result += 1;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) {
  result += 3;
  if (history.length &gt; 10) result += 1;
  if (voyage.length &gt; 12) result += 1;
  if (voyage.length &gt; 18) result -= 1;
 }
 else {
  if (history.length &gt; 8) result += 1;
  if (voyage.length &gt; 14) result -= 1;
 }
 return result;
}
```

voyageRisk å’Œ captainHistoryRisk ä¸¤ä¸ªå‡½æ•°è´Ÿè´£æ‰“å‡ºé£é™©åˆ†æ•°ï¼ŒvoyageProfitFactor è´Ÿè´£æ‰“å‡ºç›ˆåˆ©æ½œåŠ›åˆ†æ•°ï¼Œrating å‡½æ•°å°† 3 ä¸ªåˆ†æ•°ç»„åˆåˆ°ä¸€èµ·ï¼Œç»™å‡ºä¸€æ¬¡èˆªè¡Œçš„ç»¼åˆè¯„çº§ã€‚

è°ƒç”¨æ–¹çš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š

```js
const voyage = { zone: "west-indies", length: 10 };
const history = [
  { zone: "east-indies", profit: 5 },
  { zone: "west-indies", profit: 15 },
  { zone: "china", profit: -2 },
  { zone: "west-africa", profit: 7 },
];

const myRating = rating(voyage, history);
```

ä»£ç ä¸­æœ‰ä¸¤å¤„åŒæ ·çš„æ¡ä»¶é€»è¾‘ï¼Œéƒ½åœ¨è¯¢é—®â€œæ˜¯å¦æœ‰åˆ°ä¸­å›½çš„èˆªç¨‹â€ä»¥åŠâ€œèˆ¹é•¿æ˜¯å¦æ›¾å»è¿‡ä¸­å›½â€ã€‚

```js
function rating(voyage, history) {
 const vpf = voyageProfitFactor(voyage, history);
 const vr = voyageRisk(voyage);
 const chr = captainHistoryRisk(voyage, history);
 if (vpf * 3 &gt; (vr + chr * 2)) return "A";
 else return "B";
}
function voyageRisk(voyage) {
 let result = 1;
 if (voyage.length &gt; 4) result += 2;
 if (voyage.length &gt; 8) result += voyage.length - 8;
 if (["china", "east-indies"].includes(voyage.zone)) result += 4;
 return Math.max(result, 0);
}
function captainHistoryRisk(voyage, history) {
 let result = 1;
 if (history.length &lt; 5) result += 4;
 result += history.filter(v =&gt; v.profit &lt; 0).length;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) result -= 2;
 return Math.max(result, 0);
}
function hasChina(history) {
 return history.some(v =&gt; "china" === v.zone);
}
function voyageProfitFactor(voyage, history) {
 let result = 2;
 if (voyage.zone === "china") result += 1;
 if (voyage.zone === "east-indies") result += 1;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) {
  result += 3;
  if (history.length &gt; 10) result += 1;
  if (voyage.length &gt; 12) result += 1;
  if (voyage.length &gt; 18) result -= 1;
 }
 else {
  if (history.length &gt; 8) result += 1;
  if (voyage.length &gt; 14) result -= 1;
 }
 return result;
}
```

æˆ‘ä¼šç”¨ç»§æ‰¿å’Œå¤šæ€å°†å¤„ç†â€œä¸­å›½å› ç´ â€çš„é€»è¾‘ä»åŸºç¡€é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å¦‚æœè¿˜è¦å¼•å…¥æ›´å¤šçš„ç‰¹æ®Šé€»è¾‘ï¼Œè¿™ä¸ªé‡æ„å°±å¾ˆæœ‰ç”¨â€”â€”è¿™äº›é‡å¤çš„â€œä¸­å›½å› ç´ â€ä¼šæ··æ·†è§†å¬ï¼Œè®©åŸºç¡€é€»è¾‘éš¾ä»¥ç†è§£ã€‚

èµ·åˆä»£ç é‡Œåªæœ‰ä¸€å †å‡½æ•°ï¼Œå¦‚æœè¦å¼•å…¥å¤šæ€çš„è¯ï¼Œæˆ‘éœ€è¦å…ˆå»ºç«‹ä¸€ä¸ªç±»ç»“æ„ï¼Œå› æ­¤æˆ‘é¦–å…ˆä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰ã€‚è¿™ä¸€æ­¥é‡æ„çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```js
function rating(voyage, history) {
 return new Rating(voyage, history).value;
}

class Rating {
 constructor(voyage, history) {
  this.voyage = voyage;
  this.history = history;
 }
 get value() {
  const vpf = this.voyageProfitFactor;
  const vr = this.voyageRisk;
  const chr = this.captainHistoryRisk;
  if (vpf * 3 &gt; (vr + chr * 2)) return "A";
  else return "B";
 }
 get voyageRisk() {
  let result = 1;
  if (this.voyage.length &gt; 4) result += 2;
  if (this.voyage.length &gt; 8) result += this.voyage.length - 8;
  if (["china", "east-indies"].includes(this.voyage.zone)) result += 4;
  return Math.max(result, 0);
 }
 get captainHistoryRisk() {
  let result = 1;
  if (this.history.length &lt; 5) result += 4;
  result += this.history.filter(v =&gt; v.profit &lt; 0).length;
  if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) result -= 2;
  return Math.max(result, 0);
 }
 get voyageProfitFactor() {
  let result = 2;

  if (this.voyage.zone === "china") result += 1;
  if (this.voyage.zone === "east-indies") result += 1;
  if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) {
   result += 3;
   if (this.history.length &gt; 10) result += 1;
   if (this.voyage.length &gt; 12) result += 1;
   if (this.voyage.length &gt; 18) result -= 1;
  }
  else {
   if (this.history.length &gt; 8) result += 1;
   if (this.voyage.length &gt; 14) result -= 1;
  }
  return result;
 }
 get hasChinaHistory() {
  return this.history.some(v =&gt; "china" === v.zone);
 }
}
```

äºæ˜¯æˆ‘å°±æœ‰äº†ä¸€ä¸ªç±»ï¼Œç”¨æ¥å®‰æ”¾åŸºç¡€é€»è¾‘ã€‚ç°åœ¨æˆ‘éœ€è¦å¦å»ºä¸€ä¸ªç©ºçš„å­ç±»ï¼Œç”¨æ¥å®‰æ”¾ä¸è¶…ç±»ä¸åŒçš„è¡Œä¸ºã€‚

```js
class ExperiencedChinaRating extends Rating {}
```

ç„¶åï¼Œå»ºç«‹ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨äºåœ¨éœ€è¦æ—¶è¿”å›å˜ä½“ç±»ã€‚

```js
function createRating(voyage, history) {
 if (voyage.zone === "china" &amp;&amp; history.some(v =&gt; "china" === v.zone))
  return new ExperiencedChinaRating(voyage, history);
 else return new Rating(voyage, history);
}
```

æˆ‘éœ€è¦ä¿®æ”¹æ‰€æœ‰è°ƒç”¨æ–¹ä»£ç ï¼Œè®©å®ƒä»¬ä½¿ç”¨è¯¥å·¥å‚å‡½æ•°ï¼Œè€Œä¸è¦ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°ã€‚è¿˜å¥½ç°åœ¨è°ƒç”¨æ„é€ å‡½æ•°çš„åªæœ‰ rating å‡½æ•°ä¸€å¤„ã€‚

```js
function rating(voyage, history) {
  return createRating(voyage, history).value;
}
```

æœ‰ä¸¤å¤„è¡Œä¸ºéœ€è¦ç§»å…¥å­ç±»ä¸­ã€‚æˆ‘å…ˆå¤„ç† captainHistoryRisk ä¸­çš„é€»è¾‘ã€‚

#### class Rating...

```js
get captainHistoryRisk() {
 let result = 1;
 if (this.history.length &lt; 5) result += 4;
 result += this.history.filter(v =&gt; v.profit &lt; 0).length;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) result -= 2;
 return Math.max(result, 0);
}
```

åœ¨å­ç±»ä¸­è¦†å†™è¿™ä¸ªå‡½æ•°ã€‚

class ExperiencedChinaRating

```js
get captainHistoryRisk() {
  const result = super.captainHistoryRisk - 2;
  return Math.max(result, 0);
}
```

#### class Rating...

```js
get captainHistoryRisk() {
 let result = 1;
 if (this.history.length &lt; 5) result += 4;
 result += this.history.filter(v =&gt; v.profit &lt; 0).length;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) result -= 2;
 return Math.max(result, 0);
}
```

åˆ†ç¦» voyageProfitFactor å‡½æ•°ä¸­çš„å˜ä½“è¡Œä¸ºè¦æ›´éº»çƒ¦ä¸€äº›ã€‚æˆ‘ä¸èƒ½ç›´æ¥ä»è¶…ç±»ä¸­åˆ æ‰å˜ä½“è¡Œä¸ºï¼Œå› ä¸ºåœ¨è¶…ç±»ä¸­è¿˜æœ‰å¦ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚æˆ‘åˆä¸æƒ³æŠŠæ•´ä¸ªè¶…ç±»ä¸­çš„å‡½æ•°å¤åˆ¶åˆ°å­ç±»ä¸­ã€‚

#### class Rating...

```js
get voyageProfitFactor() {
 let result = 2;

 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) {
  result += 3;
  if (this.history.length &gt; 10) result += 1;
  if (this.voyage.length &gt; 12) result += 1;
  if (this.voyage.length &gt; 18) result -= 1;
 }
 else {
  if (this.history.length &gt; 8) result += 1;
  if (this.voyage.length &gt; 14) result -= 1;
 }
 return result;
}
```

æ‰€ä»¥æˆ‘å…ˆç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰å°†æ•´ä¸ªæ¡ä»¶é€»è¾‘å—æç‚¼å‡ºæ¥ã€‚

#### class Rating...

```js
get voyageProfitFactor() {
 let result = 2;

 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 result += this.voyageAndHistoryLengthFactor;
 return result;
}
get voyageAndHistoryLengthFactor() {
 let result = 0;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) {
  result += 3;
  if (this.history.length &gt; 10) result += 1;
  if (this.voyage.length &gt; 12) result += 1;
  if (this.voyage.length &gt; 18) result -= 1;
 }
 else {
  if (this.history.length &gt; 8) result += 1;
  if (this.voyage.length &gt; 14) result -= 1;
 }
 return result;
}
```

å‡½æ•°åä¸­å‡ºç°â€œAndâ€å­—æ ·æ˜¯ä¸€ä¸ªå¾ˆä¸å¥½çš„å‘³é“ï¼Œä¸è¿‡æˆ‘ä¼šæš‚æ—¶å®¹å¿å®ƒï¼Œå…ˆèšç„¦å­ç±»åŒ–æ“ä½œã€‚

#### class Rating...

```js
get voyageAndHistoryLengthFactor() {
 let result = 0;
 if (this.history.length &gt; 8) result += 1;
 if (this.voyage.length &gt; 14) result -= 1;
 return result;
}
```

#### class ExperiencedChinaRating...

```js
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += 3;
 if (this.history.length &gt; 10) result += 1;
 if (this.voyage.length &gt; 12) result += 1;
 if (this.voyage.length &gt; 18) result -= 1;
 return result;
}
```

ä¸¥æ ¼è¯´æ¥ï¼Œé‡æ„åˆ°è¿™å„¿å°±ç»“æŸäº†â€”â€”æˆ‘å·²ç»æŠŠå˜ä½“è¡Œä¸ºåˆ†ç¦»åˆ°äº†å­ç±»ä¸­ï¼Œè¶…ç±»çš„é€»è¾‘ç†è§£å’Œç»´æŠ¤èµ·æ¥æ›´ç®€å•äº†ï¼Œåªæœ‰åœ¨è¿›å…¥å­ç±»ä»£ç æ—¶æˆ‘æ‰éœ€è¦æ“å¿ƒå˜ä½“é€»è¾‘ã€‚å­ç±»çš„ä»£ç è¡¨è¿°äº†å®ƒä¸è¶…ç±»çš„å·®å¼‚ã€‚

ä½†æˆ‘è§‰å¾—è‡³å°‘åº”è¯¥è°ˆè°ˆå¦‚ä½•å¤„ç†è¿™ä¸ªä¸‘é™‹çš„æ–°å‡½æ•°ã€‚å¼•å…¥ä¸€ä¸ªå‡½æ•°ä»¥ä¾¿å­ç±»è¦†å†™ï¼Œè¿™åœ¨å¤„ç†è¿™ç§â€œåŸºç¡€å’Œå˜ä½“â€çš„ç»§æ‰¿å…³ç³»æ—¶æ˜¯å¸¸è§æ“ä½œã€‚ä½†è¿™æ ·ä¸€ä¸ªéš¾çœ‹çš„å‡½æ•°åªä¼šå¦¨ç¢â€”â€”è€Œä¸æ˜¯å¸®åŠ©â€”â€”åˆ«äººç†è§£å…¶ä¸­çš„é€»è¾‘ã€‚

å‡½æ•°åä¸­çš„â€œAndâ€å­—æ ·è¯´æ˜å…¶ä¸­åŒ…å«äº†ä¸¤ä»¶äº‹ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—åº”è¯¥å°†å®ƒä»¬åˆ†å¼€ã€‚æˆ‘ä¼šç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æŠŠâ€œå†å²èˆªè¡Œæ•°â€ï¼ˆhistory lengthï¼‰çš„ç›¸å…³é€»è¾‘æç‚¼å‡ºæ¥ã€‚è¿™ä¸€æ­¥æç‚¼åœ¨è¶…ç±»å’Œå­ç±»ä¸­éƒ½è¦å‘ç”Ÿï¼Œæˆ‘é¦–å…ˆä»è¶…ç±»å¼€å§‹ã€‚

#### class Rating...

```js
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += this.historyLengthFactor;
 if (this.voyage.length &gt; 14) result -= 1;
 return result;
}
get historyLengthFactor() {
 return (this.history.length &gt; 8) ? 1 : 0;
}
```

ç„¶ååœ¨å­ç±»ä¸­ä¹Ÿå¦‚æ³•ç‚®åˆ¶ã€‚

#### class ExperiencedChinaRating...

```js
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += 3;
 result += this.historyLengthFactor;
 if (this.voyage.length &gt; 12) result += 1;
 if (this.voyage.length &gt; 18) result -= 1;
 return result;
}
get historyLengthFactor() {
 return (this.history.length &gt; 10) ? 1 : 0;
}
```

ç„¶ååœ¨è¶…ç±»ä¸­ä½¿ç”¨æ¬ç§»è¯­å¥åˆ°è°ƒç”¨è€…ï¼ˆ217ï¼‰ã€‚

#### class Rating...

```js
get voyageProfitFactor() {
 let result = 2;
 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 result += this.historyLengthFactor;
 result += this.voyageAndHistoryLengthFactor;
 return result;
}

get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += this.historyLengthFactor;
 if (this.voyage.length &gt; 14) result -= 1;
 return result;
}
```

#### class ExperiencedChinaRating...

```js
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += 3;
 result += this.historyLengthFactor;
 if (this.voyage.length &gt; 12) result += 1;
 if (this.voyage.length &gt; 18) result -= 1;
 return result;
}
```

å†ç”¨å‡½æ•°æ”¹åï¼ˆ124ï¼‰æ”¹æ‰è¿™ä¸ªéš¾å¬çš„åå­—ã€‚

#### class Rating...

```js
get voyageProfitFactor() {
 let result = 2;
 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 result += this.historyLengthFactor;
 result += this.voyageLengthFactor;
 return result;
}

get voyageLengthFactor() {
 return (this.voyage.length &gt; 14) ? - 1: 0;
}
```

æ”¹ä¸ºä¸‰å…ƒè¡¨è¾¾å¼ï¼Œä»¥ç®€åŒ– voyageLengthFactor å‡½æ•°ã€‚

#### class ExperiencedChinaRating...

```js
get voyageLengthFactor() {
 let result = 0;
 result += 3;
 if (this.voyage.length &gt; 12) result += 1;
 if (this.voyage.length &gt; 18) result -= 1;
 return result;
}
```

æœ€åä¸€ä»¶äº‹ï¼šåœ¨â€œèˆªç¨‹æ•°â€ï¼ˆvoyage lengthï¼‰å› ç´ ä¸ŠåŠ ä¸Š 3 åˆ†ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªé€»è¾‘ä¸åˆç†ï¼Œåº”è¯¥æŠŠè¿™ 3 åˆ†åŠ åœ¨æœ€ç»ˆçš„ç»“æœä¸Šã€‚

#### class ExperiencedChinaRating...

```js
get voyageProfitFactor() {
  return super.voyageProfitFactor + 3;
}

get voyageLengthFactor() {
  let result = 0;
  result += 3;
  if (this.voyage.length &gt; 12) result += 1;
  if (this.voyage.length &gt; 18) result -= 1;
  return result;
}
```

é‡æ„ç»“æŸï¼Œæˆ‘å¾—åˆ°äº†å¦‚ä¸‹ä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªåŸºæœ¬çš„ Rating ç±»ï¼Œå…¶ä¸­ä¸è€ƒè™‘ä¸â€œä¸­å›½ç»éªŒâ€ç›¸å…³çš„å¤æ‚æ€§ï¼š

```js
class Rating {
 constructor(voyage, history) {
  this.voyage = voyage;
  this.history = history;
 }
 get value() {
  const vpf = this.voyageProfitFactor;
  const vr = this.voyageRisk;
  const chr = this.captainHistoryRisk;
  if (vpf * 3 &gt; (vr + chr * 2)) return "A";
  else return "B";
 }
 get voyageRisk() {
  let result = 1;
  if (this.voyage.length &gt; 4) result += 2;
  if (this.voyage.length &gt; 8) result += this.voyage.length - 8;
  if (["china", "east-indies"].includes(this.voyage.zone)) result += 4;
  return Math.max(result, 0);
 }
 get captainHistoryRisk() {
  let result = 1;
  if (this.history.length &lt; 5) result += 4;
  result += this.history.filter(v =&gt; v.profit &lt; 0).length;
  return Math.max(result, 0);
 }
 get voyageProfitFactor() {
  let result = 2;
  if (this.voyage.zone === "china") result += 1;
  if (this.voyage.zone === "east-indies") result += 1;
  result += this.historyLengthFactor;
  result += this.voyageLengthFactor;
  return result;
 }
 get voyageLengthFactor() {
  return (this.voyage.length &gt; 14) ? - 1: 0;
 }
 get historyLengthFactor() {
  return (this.history.length &gt; 8) ? 1 : 0;
 }
}
```

ä¸â€œä¸­å›½ç»éªŒâ€ç›¸å…³çš„ä»£ç åˆ™æ¸…æ™°è¡¨è¿°å‡ºåœ¨åŸºæœ¬é€»è¾‘ä¹‹ä¸Šçš„ä¸€ç³»åˆ—å˜ä½“é€»è¾‘ï¼š

```js
class ExperiencedChinaRating extends Rating {
 get captainHistoryRisk() {
  const result = super.captainHistoryRisk - 2;
  return Math.max(result, 0);
 }
 get voyageLengthFactor() {
  let result = 0;
  if (this.voyage.length &gt; 12) result += 1;
  if (this.voyage.length &gt; 18) result -= 1;
  return result;
 }
 get historyLengthFactor() {
  return (this.history.length &gt; 10) ? 1 : 0;
 }
 get voyageProfitFactor() {
  return super.voyageProfitFactor + 3;
 }
}
```

## 10.5 å¼•å…¥ç‰¹ä¾‹ï¼ˆIntroduce Special Caseï¼‰

æ›¾ç”¨åï¼šå¼•å…¥ Null å¯¹è±¡ï¼ˆIntroduce Null Objectï¼‰

```js
if (aCustomer === "unknown") customerName = "occupant";


class UnknownCustomer {
  get name() {return "occupant";}
```

### åŠ¨æœº

ä¸€ç§å¸¸è§çš„é‡å¤ä»£ç æ˜¯è¿™ç§æƒ…å†µï¼šä¸€ä¸ªæ•°æ®ç»“æ„çš„ä½¿ç”¨è€…éƒ½åœ¨æ£€æŸ¥æŸä¸ªç‰¹æ®Šçš„å€¼ï¼Œå¹¶ä¸”å½“è¿™ä¸ªç‰¹æ®Šå€¼å‡ºç°æ—¶æ‰€åšçš„å¤„ç†ä¹Ÿéƒ½ç›¸åŒã€‚å¦‚æœæˆ‘å‘ç°ä»£ç åº“ä¸­æœ‰å¤šå¤„ä»¥åŒæ ·æ–¹å¼åº”å¯¹åŒä¸€ä¸ªç‰¹æ®Šå€¼ï¼Œæˆ‘å°±ä¼šæƒ³è¦æŠŠè¿™ä¸ªå¤„ç†é€»è¾‘æ”¶æ‹¢åˆ°ä¸€å¤„ã€‚

å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ä¸ªå¥½åŠæ³•æ˜¯ä½¿ç”¨â€œç‰¹ä¾‹â€ï¼ˆSpecial Caseï¼‰æ¨¡å¼ï¼šåˆ›å»ºä¸€ä¸ªç‰¹ä¾‹å…ƒç´ ï¼Œç”¨ä»¥è¡¨è¾¾å¯¹è¿™ç§ç‰¹ä¾‹çš„å…±ç”¨è¡Œä¸ºçš„å¤„ç†ã€‚è¿™æ ·æˆ‘å°±å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°è°ƒç”¨å–ä»£å¤§éƒ¨åˆ†ç‰¹ä¾‹æ£€æŸ¥é€»è¾‘ã€‚

ç‰¹ä¾‹æœ‰å‡ ç§è¡¨ç°å½¢å¼ã€‚å¦‚æœæˆ‘åªéœ€è¦ä»è¿™ä¸ªå¯¹è±¡è¯»å–æ•°æ®ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªå­—é¢é‡å¯¹è±¡ï¼ˆliteral objectï¼‰ï¼Œå…¶ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯é¢„å…ˆå¡«å……å¥½çš„ã€‚å¦‚æœé™¤ç®€å•çš„æ•°å€¼ä¹‹å¤–è¿˜éœ€è¦æ›´å¤šçš„è¡Œä¸ºï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å…±ç”¨è¡Œä¸ºæ‰€å¯¹åº”çš„å‡½æ•°ã€‚ç‰¹ä¾‹å¯¹è±¡å¯ä»¥ç”±ä¸€ä¸ªå°è£…ç±»æ¥è¿”å›ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å˜æ¢æ’å…¥ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚

ä¸€ä¸ªé€šå¸¸éœ€è¦ç‰¹ä¾‹å¤„ç†çš„å€¼å°±æ˜¯ nullï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªæ¨¡å¼å¸¸è¢«å«ä½œâ€œNull å¯¹è±¡â€ï¼ˆNull Objectï¼‰æ¨¡å¼çš„åŸå› â€”â€”æˆ‘å–œæ¬¢è¯´ï¼šNull å¯¹è±¡æ˜¯ç‰¹ä¾‹çš„ä¸€ç§ç‰¹ä¾‹ã€‚

### åšæ³•

æˆ‘ä»¬ä»ä¸€ä¸ªä½œä¸ºå®¹å™¨çš„æ•°æ®ç»“æ„ï¼ˆæˆ–è€…ç±»ï¼‰å¼€å§‹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§å°±æ˜¯æˆ‘ä»¬è¦é‡æ„çš„ç›®æ ‡ã€‚å®¹å™¨çš„å®¢æˆ·ç«¯æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå±æ€§æ—¶ï¼Œéƒ½éœ€è¦å°†å…¶ä¸æŸä¸ªç‰¹ä¾‹å€¼åšæ¯”å¯¹ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠè¿™ä¸ªç‰¹ä¾‹å€¼æ›¿æ¢ä¸ºä»£è¡¨è¿™ç§ç‰¹ä¾‹æƒ…å†µçš„ç±»æˆ–æ•°æ®ç»“æ„ã€‚

ç»™é‡æ„ç›®æ ‡æ·»åŠ æ£€æŸ¥ç‰¹ä¾‹çš„å±æ€§ï¼Œä»¤å…¶è¿”å› falseã€‚

åˆ›å»ºä¸€ä¸ªç‰¹ä¾‹å¯¹è±¡ï¼Œå…¶ä¸­åªæœ‰æ£€æŸ¥ç‰¹ä¾‹çš„å±æ€§ï¼Œè¿”å› trueã€‚

å¯¹â€œä¸ç‰¹ä¾‹å€¼åšæ¯”å¯¹â€çš„ä»£ç è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ï¼Œç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä½¿ç”¨è¿™ä¸ªæ–°å‡½æ•°ï¼Œè€Œä¸å†ç›´æ¥åšç‰¹ä¾‹å€¼çš„æ¯”å¯¹ã€‚

å°†æ–°çš„ç‰¹ä¾‹å¯¹è±¡å¼•å…¥ä»£ç ä¸­ï¼Œå¯ä»¥ä»å‡½æ•°è°ƒç”¨ä¸­è¿”å›ï¼Œä¹Ÿå¯ä»¥åœ¨å˜æ¢å‡½æ•°ä¸­ç”Ÿæˆã€‚

ä¿®æ”¹ç‰¹ä¾‹æ¯”å¯¹å‡½æ•°çš„ä¸»ä½“ï¼Œåœ¨å…¶ä¸­ç›´æ¥ä½¿ç”¨æ£€æŸ¥ç‰¹ä¾‹çš„å±æ€§ã€‚

æµ‹è¯•ã€‚

ä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰æˆ–å‡½æ•°ç»„åˆæˆå˜æ¢ï¼ˆ149ï¼‰ï¼ŒæŠŠé€šç”¨çš„ç‰¹ä¾‹å¤„ç†é€»è¾‘éƒ½æ¬ç§»åˆ°æ–°å»ºçš„ç‰¹ä¾‹å¯¹è±¡ä¸­ã€‚

ç‰¹ä¾‹ç±»å¯¹äºç®€å•çš„è¯·æ±‚é€šå¸¸ä¼šè¿”å›å›ºå®šçš„å€¼ï¼Œå› æ­¤å¯ä»¥å°†å…¶å®ç°ä¸ºå­—é¢è®°å½•ï¼ˆliteral recordï¼‰ã€‚

å¯¹ç‰¹ä¾‹æ¯”å¯¹å‡½æ•°ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ï¼Œå°†å…¶å†…è”åˆ°ä»ç„¶éœ€è¦çš„åœ°æ–¹ã€‚

### èŒƒä¾‹

ä¸€å®¶æä¾›å…¬å…±äº‹ä¸šæœåŠ¡çš„å…¬å¸å°†è‡ªå·±çš„æœåŠ¡å®‰è£…åœ¨å„ä¸ªåœºæ‰€ï¼ˆsiteï¼‰ã€‚

#### class Site...

```js
get customer() {return this._customer;}
```

ä»£è¡¨â€œé¡¾å®¢â€çš„ Customer ç±»æœ‰å¤šä¸ªå±æ€§ï¼Œæˆ‘åªè€ƒè™‘å…¶ä¸­ 3 ä¸ªã€‚

#### class Customer...

```js
get name()           {...}
get billingPlan()    {...}
set billingPlan(arg) {...}
get paymentHistory() {...}
```

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåœºæ‰€ä¼šå¯¹åº”ä¸€ä¸ªé¡¾å®¢ï¼Œä½†æœ‰äº›åœºæ‰€æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„é¡¾å®¢ï¼Œå¯èƒ½æ˜¯å› ä¸ºä¹‹å‰çš„ä½æˆ·æ¬èµ°äº†ï¼Œè€Œæ–°æ¬æ¥çš„ä½æˆ·æˆ‘è¿˜ä¸çŸ¥é“æ˜¯è°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®è®°å½•ä¸­çš„ customer å­—æ®µä¼šè¢«å¡«å……ä¸ºå­—ç¬¦ä¸²"unknown"ã€‚å› ä¸ºè¿™ç§æƒ…å†µæ—¶æœ‰å‘ç”Ÿï¼Œæ‰€ä»¥ Site å¯¹è±¡çš„å®¢æˆ·ç«¯å¿…é¡»æœ‰åŠæ³•å¤„ç†â€œé¡¾å®¢æœªçŸ¥â€çš„æƒ…å†µã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ä»£ç ç‰‡æ®µã€‚

#### å®¢æˆ·ç«¯ 1...

```js
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan =
  aCustomer === "unknown" ? registry.billingPlans.basic : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
if (aCustomer !== "unknown") aCustomer.billingPlan = newPlan;
```

#### å®¢æˆ·ç«¯ 4...

```js
const weeksDelinquent =
  aCustomer === "unknown"
    ? 0
    : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

æµè§ˆæ•´ä¸ªä»£ç åº“ï¼Œæˆ‘çœ‹åˆ°æœ‰å¾ˆå¤šä½¿ç”¨ Site å¯¹è±¡çš„å®¢æˆ·ç«¯åœ¨å¤„ç†â€œé¡¾å®¢æœªçŸ¥â€çš„æƒ…å†µï¼Œå¤§å¤šæ•°éƒ½ç”¨äº†åŒæ ·çš„åº”å¯¹æ–¹å¼ï¼šç”¨"occupant"ï¼ˆå±…æ°‘ï¼‰ä½œä¸ºé¡¾å®¢åï¼Œä½¿ç”¨åŸºæœ¬çš„è®¡ä»·å¥—é¤ï¼Œå¹¶è®¤ä¸ºè¿™å®¶é¡¾å®¢æ²¡æœ‰æ¬ è´¹ã€‚åˆ°å¤„éƒ½åœ¨æ£€æŸ¥è¿™ç§ç‰¹ä¾‹ï¼Œå†åŠ ä¸Šå¯¹ç‰¹ä¾‹çš„å¤„ç†æ–¹å¼é«˜åº¦ä¸€è‡´ï¼Œè¿™äº›ç°è±¡å‘Šè¯‰æˆ‘ï¼šæ˜¯æ—¶å€™ä½¿ç”¨ç‰¹ä¾‹å¯¹è±¡ï¼ˆSpecial Case Objectï¼‰æ¨¡å¼äº†ã€‚

æˆ‘é¦–å…ˆç»™ Customer æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæŒ‡ç¤ºâ€œè¿™ä¸ªé¡¾å®¢æ˜¯å¦æœªçŸ¥â€ã€‚

#### class Customer...

```js
get isUnknown() {return false;}
```

ç„¶åæˆ‘ç»™â€œæœªçŸ¥çš„é¡¾å®¢â€ä¸“é—¨åˆ›å»ºä¸€ä¸ªç±»ã€‚

```js
class UnknownCustomer {
  get isUnknown() {
    return true;
  }
}
```

æ³¨æ„ï¼Œæˆ‘æ²¡æœ‰æŠŠ UnknownCustomer ç±»å£°æ˜ä¸º Customer çš„å­ç±»ã€‚åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼ˆå°¤å…¶æ˜¯é™æ€ç±»å‹çš„ç¼–ç¨‹è¯­è¨€ï¼‰ä¸­ï¼Œæˆ‘ä¼šéœ€è¦ç»§æ‰¿å…³ç³»ã€‚ä½† JavaScript æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹è¯­è¨€ï¼ŒæŒ‰ç…§å®ƒçš„å­ç±»åŒ–è§„åˆ™ï¼Œè¿™é‡Œä¸å£°æ˜ç»§æ‰¿å…³ç³»åè€Œæ›´å¥½ã€‚

ä¸‹é¢å°±æ˜¯éº»çƒ¦ä¹‹å¤„äº†ã€‚æˆ‘å¿…é¡»åœ¨æ‰€æœ‰æœŸæœ›å¾—åˆ°"unknown"å€¼çš„åœ°æ–¹è¿”å›è¿™ä¸ªæ–°çš„ç‰¹ä¾‹å¯¹è±¡ï¼Œå¹¶ä¿®æ”¹æ‰€æœ‰æ£€æŸ¥"unknown"å€¼çš„åœ°æ–¹ï¼Œä»¤å…¶ä½¿ç”¨æ–°çš„ isUnknown å‡½æ•°ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘æ€»æ˜¯å¸Œæœ›ç»†å¿ƒå®‰æ’ä¿®æ”¹è¿‡ç¨‹ï¼Œä½¿æˆ‘å¯ä»¥æ¯æ¬¡åšä¸€ç‚¹å°ä¿®æ”¹ï¼Œç„¶åé©¬ä¸Šæµ‹è¯•ã€‚ä½†å¦‚æœæˆ‘ä¿®æ”¹äº† Customer ç±»ï¼Œä½¿å…¶è¿”å› UnknownCustomer å¯¹è±¡ï¼ˆè€Œé"unknown"å­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆå°±å¿…é¡»åŒæ—¶ä¿®æ”¹æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œè®©å®ƒä»¬ä¸è¦æ£€æŸ¥"unknown"å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è°ƒç”¨ isUnknown å‡½æ•°â€”â€”è¿™ä¸¤ä¸ªä¿®æ”¹å¿…é¡»ä¸€æ¬¡å®Œæˆã€‚æˆ‘æ„Ÿè§‰è¿™ä¸€å¤§æ­¥ä¿®æ”¹å°±åƒä¸€å¤§å—éš¾åƒçš„é£Ÿç‰©ä¸€æ ·éš¾ä»¥ä¸‹å’½ã€‚

è¿˜å¥½ï¼Œé‡åˆ°è¿™ç§å›°å¢ƒæ—¶ï¼Œæœ‰ä¸€ä¸ªå¸¸ç”¨çš„æŠ€å·§å¯ä»¥å¸®å¿™ã€‚å¦‚æœæœ‰ä¸€æ®µä»£ç éœ€è¦åœ¨å¾ˆå¤šåœ°æ–¹åšä¿®æ”¹ï¼ˆä¾‹å¦‚æˆ‘ä»¬è¿™é‡Œçš„â€œä¸ç‰¹ä¾‹åšæ¯”å¯¹â€çš„ä»£ç ï¼‰ï¼Œæˆ‘ä¼šå…ˆå¯¹å…¶ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```js
function isUnknown(arg) {
  if (!(arg instanceof Customer || arg === "unknown"))
    throw new Error(`investigate bad value: &lt;${arg}&gt;`);
  return arg === "unknown";
}
```

æˆ‘ä¼šæ”¾ä¸€ä¸ªé™·é˜±ï¼Œæ•æ‰æ„æ–™ä¹‹å¤–çš„å€¼ã€‚å¦‚æœåœ¨é‡æ„è¿‡ç¨‹ä¸­æˆ‘çŠ¯äº†é”™è¯¯ï¼Œå¼•å…¥äº†å¥‡æ€ªçš„è¡Œä¸ºï¼Œè¿™ä¸ªé™·é˜±ä¼šå¸®æˆ‘å‘ç°ã€‚

ç°åœ¨ï¼Œå‡¡æ˜¯æ£€æŸ¥æœªçŸ¥é¡¾å®¢çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥æ”¹ç”¨è¿™ä¸ªå‡½æ•°äº†ã€‚æˆ‘å¯ä»¥é€ä¸€ä¿®æ”¹è¿™äº›åœ°æ–¹ï¼Œæ¯æ¬¡ä¿®æ”¹ä¹‹åéƒ½å¯ä»¥æ‰§è¡Œæµ‹è¯•ã€‚

#### å®¢æˆ·ç«¯ 1...

```js
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

æ²¡ç”¨å¤šä¹…ï¼Œå°±å…¨éƒ¨ä¿®æ”¹å®Œäº†ã€‚

#### å®¢æˆ·ç«¯ 2...

```js
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
if (!isUnknown(aCustomer)) aCustomer.billingPlan = newPlan;
```

#### å®¢æˆ·ç«¯ 4...

```js
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

å°†æ‰€æœ‰è°ƒç”¨å¤„éƒ½æ”¹ä¸ºä½¿ç”¨ isUnknown å‡½æ•°ä¹‹åï¼Œå°±å¯ä»¥ä¿®æ”¹ Site ç±»ï¼Œä»¤å…¶åœ¨é¡¾å®¢æœªçŸ¥æ—¶è¿”å› UnknownCustomer å¯¹è±¡ã€‚

#### class Site...

```js
get customer() {
  return (this._customer === "unknown") ? new UnknownCustomer() : this._customer;
}
```

ç„¶åä¿®æ”¹ isUnknown å‡½æ•°çš„åˆ¤æ–­é€»è¾‘ã€‚åšå®Œè¿™æ­¥ä¿®æ”¹ä¹‹åæˆ‘å¯ä»¥åšä¸€æ¬¡å…¨æ–‡æœç´¢ï¼Œåº”è¯¥æ²¡æœ‰ä»»ä½•åœ°æ–¹ä½¿ç”¨"unknown"å­—ç¬¦ä¸²äº†ã€‚

#### å®¢æˆ·ç«¯ 1...

```js
function isUnknown(arg) {
  if (!(arg instanceof Customer || arg instanceof UnknownCustomer))
    throw new Error(`investigate bad value: &lt;${arg}&gt;`);
  return arg.isUnknown;
}
```

æµ‹è¯•ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡è¿è½¬å¦‚å¸¸ã€‚

ç°åœ¨ï¼Œæœ‰è¶£çš„éƒ¨åˆ†å¼€å§‹äº†ã€‚æˆ‘å¯ä»¥é€ä¸€æŸ¥çœ‹å®¢æˆ·ç«¯æ£€æŸ¥ç‰¹ä¾‹çš„ä»£ç ï¼Œçœ‹å®ƒä»¬å¤„ç†ç‰¹ä¾‹çš„é€»è¾‘ï¼Œå¹¶è€ƒè™‘æ˜¯å¦èƒ½ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªå…±åŒçš„ã€ç¬¦åˆé¢„æœŸçš„å€¼ã€‚æ­¤åˆ»ï¼Œæœ‰å¤šå¤„å®¢æˆ·ç«¯ä»£ç ç”¨å­—ç¬¦ä¸²"occupant"æ¥ä½œä¸ºæœªçŸ¥é¡¾å®¢çš„åå­—ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

#### å®¢æˆ·ç«¯ 1...

```js
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

æˆ‘å¯ä»¥åœ¨ UnknownCustomer ç±»ä¸­æ·»åŠ ä¸€ä¸ªåˆé€‚çš„å‡½æ•°ã€‚

#### class UnknownCustomer...

```js
get name() {return "occupant";}
```

ç„¶åæˆ‘å°±å¯ä»¥å»æ‰æ‰€æœ‰æ¡ä»¶ä»£ç ã€‚

#### å®¢æˆ·ç«¯ 1...

```js
const customerName = aCustomer.name;
```

æµ‹è¯•é€šè¿‡ä¹‹åï¼Œæˆ‘å¯èƒ½ä¼šç”¨å†…è”å˜é‡ï¼ˆ123ï¼‰æŠŠ customerName å˜é‡ä¹Ÿæ¶ˆé™¤æ‰ã€‚

æ¥ä¸‹æ¥å¤„ç†ä»£è¡¨â€œè®¡ä»·å¥—é¤â€çš„ billingPlan å±æ€§ã€‚

#### å®¢æˆ·ç«¯ 2...

```js
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
if (!isUnknown(aCustomer)) aCustomer.billingPlan = newPlan;
```

å¯¹äºè¯»å–è¯¥å±æ€§çš„è¡Œä¸ºï¼Œæˆ‘çš„å¤„ç†æ–¹æ³•è·Ÿå‰é¢å¤„ç† name å±æ€§ä¸€æ ·â€”â€”æ‰¾åˆ°é€šç”¨çš„åº”å¯¹æ–¹å¼ï¼Œå¹¶åœ¨ UnknownCustomer ä¸­ä½¿ç”¨ä¹‹ã€‚è‡³äºå¯¹è¯¥å±æ€§çš„å†™æ“ä½œï¼Œå½“å‰çš„ä»£ç æ²¡æœ‰å¯¹æœªçŸ¥é¡¾å®¢è°ƒç”¨è¿‡è®¾å€¼å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ç‰¹ä¾‹å¯¹è±¡ä¸­ï¼Œæˆ‘ä¼šä¿ç•™è®¾å€¼å‡½æ•°ï¼Œä½†å…¶ä¸­ä»€ä¹ˆéƒ½ä¸åšã€‚

#### class UnknownCustomer...

```js
get billingPlan()  {return registry.billingPlans.basic;}
set billingPlan(arg) { /* ignore */ }
```

#### è¯»å–çš„ä¾‹å­...

```js
const plan = aCustomer.billingPlan;
```

#### æ›´æ–°çš„ä¾‹å­...

```js
aCustomer.billingPlan = newPlan;
```

ç‰¹ä¾‹å¯¹è±¡æ˜¯å€¼å¯¹è±¡ï¼Œå› æ­¤åº”è¯¥å§‹ç»ˆæ˜¯ä¸å¯å˜çš„ï¼Œå³ä¾¿å®ƒä»¬æ›¿ä»£çš„åŸå¯¹è±¡æœ¬èº«æ˜¯å¯å˜çš„ã€‚

æœ€åä¸€ä¸ªä¾‹å­åˆ™æ›´éº»çƒ¦ä¸€äº›ï¼Œå› ä¸ºç‰¹ä¾‹å¯¹è±¡éœ€è¦è¿”å›å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåè€…åˆæœ‰å…¶è‡ªå·±çš„å±æ€§ã€‚

#### å®¢æˆ·ç«¯...

```js
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

ä¸€èˆ¬çš„åŸåˆ™æ˜¯ï¼šå¦‚æœç‰¹ä¾‹å¯¹è±¡éœ€è¦è¿”å›å…³è”å¯¹è±¡ï¼Œè¢«è¿”å›çš„é€šå¸¸ä¹Ÿæ˜¯ç‰¹ä¾‹å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ªä»£è¡¨â€œç©ºæ”¯ä»˜è®°å½•â€çš„ç‰¹ä¾‹ç±» NullPaymentHistoryã€‚

#### class UnknownCustomer...

```js
get paymentHistory() {return new NullPaymentHistory();}
```

#### class NullPaymentHistory...

```js
get weeksDelinquentInLastYear() {return 0;}
```

#### å®¢æˆ·ç«¯...

```js
const weeksDelinquent = aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

æˆ‘ç»§ç»­æŸ¥çœ‹å®¢æˆ·ç«¯ä»£ç ï¼Œå¯»æ‰¾æ˜¯å¦æœ‰èƒ½ç”¨å¤šæ€è¡Œä¸ºå–ä»£çš„åœ°æ–¹ã€‚ä½†ä¹Ÿä¼šæœ‰ä¾‹å¤–æƒ…å†µâ€”â€”å®¢æˆ·ç«¯ä¸æƒ³ä½¿ç”¨ç‰¹ä¾‹å¯¹è±¡æä¾›çš„é€»è¾‘ï¼Œè€Œæ˜¯æƒ³åšä¸€äº›åˆ«çš„å¤„ç†ã€‚æˆ‘å¯èƒ½æœ‰ 23 å¤„å®¢æˆ·ç«¯ä»£ç ç”¨"occupant"ä½œä¸ºæœªçŸ¥é¡¾å®¢çš„åå­—ï¼Œä½†è¿˜æœ‰ä¸€å¤„ç”¨äº†åˆ«çš„å€¼ã€‚

#### å®¢æˆ·ç«¯...

```js
const name = !isUnknown(aCustomer) ? aCustomer.name : "unknown occupant";
```

è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘åªèƒ½åœ¨å®¢æˆ·ç«¯ä¿ç•™ç‰¹ä¾‹æ£€æŸ¥çš„é€»è¾‘ã€‚æˆ‘ä¼šå¯¹å…¶åšäº›ä¿®æ”¹ï¼Œè®©å®ƒä½¿ç”¨ aCustomer å¯¹è±¡èº«ä¸Šçš„ isUnknown å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¹å…¨å±€çš„ isUnknown å‡½æ•°ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

#### å®¢æˆ·ç«¯...

```js
const name = aCustomer.isUnknown ? "unknown occupant" : aCustomer.name;
```

å¤„ç†å®Œæ‰€æœ‰å®¢æˆ·ç«¯ä»£ç åï¼Œå…¨å±€çš„ isUnknown å‡½æ•°åº”è¯¥æ²¡äººå†è°ƒç”¨äº†ï¼Œå¯ä»¥ç”¨ç§»é™¤æ­»ä»£ç ï¼ˆ237ï¼‰å°†å…¶ç§»é™¤ã€‚

### èŒƒä¾‹ï¼šä½¿ç”¨å¯¹è±¡å­—é¢é‡

æˆ‘ä»¬åœ¨ä¸Šé¢å¤„ç†çš„å…¶å®æ˜¯ä¸€äº›å¾ˆç®€å•çš„å€¼ï¼Œå´è¦åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ç±»ï¼Œæœªå…æœ‰ç‚¹å„¿å¤§åŠ¨å¹²æˆˆã€‚ä½†åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å¿…é¡»åˆ›å»ºè¿™æ ·ä¸€ä¸ªç±»ï¼Œå› ä¸º Customer ç±»æ˜¯å…è®¸ä½¿ç”¨è€…æ›´æ–°å…¶å†…å®¹çš„ã€‚ä½†å¦‚æœé¢å¯¹ä¸€ä¸ªåªè¯»çš„æ•°æ®ç»“æ„ï¼Œæˆ‘å°±å¯ä»¥æ”¹ç”¨å­—é¢é‡å¯¹è±¡ï¼ˆliteral objectï¼‰ã€‚

è¿˜æ˜¯å‰é¢è¿™ä¸ªä¾‹å­â€”â€”å‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œé™¤äº†ä¸€ä»¶äº‹ï¼šè¿™æ¬¡æ²¡æœ‰å®¢æˆ·ç«¯å¯¹ Customer å¯¹è±¡åšæ›´æ–°æ“ä½œï¼š

#### class Site...

```js
get customer() {return this._customer;}
```

#### class Customer...

```js
get name()           {...}
get billingPlan()    {...}
set billingPlan(arg) {...}
get paymentHistory() {...}
```

#### å®¢æˆ·ç«¯ 1...

```js
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan =
  aCustomer === "unknown" ? registry.billingPlans.basic : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
const weeksDelinquent =
  aCustomer === "unknown"
    ? 0
    : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

å’Œå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œæˆ‘é¦–å…ˆåœ¨ Customer ä¸­æ·»åŠ  isUnknown å±æ€§ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŒ…å«åŒåå­—æ®µçš„ç‰¹ä¾‹å¯¹è±¡ã€‚è¿™æ¬¡çš„åŒºåˆ«åœ¨äºï¼Œç‰¹ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªå­—é¢é‡ã€‚

#### class Customer...

```js
get isUnknown() {return false;}
```

#### é¡¶å±‚ä½œç”¨åŸŸ...

```js
function createUnknownCustomer() {
  return {
    isUnknown: true,
  };
}
```

ç„¶åæˆ‘å¯¹æ£€æŸ¥ç‰¹ä¾‹çš„æ¡ä»¶é€»è¾‘è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```js
function isUnknown(arg) {
  return arg === "unknown";
}
```

#### å®¢æˆ·ç«¯ 1...

```js
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

ä¿®æ”¹ Site ç±»å’Œåšæ¡ä»¶åˆ¤æ–­çš„ isUnknown å‡½æ•°ï¼Œå¼€å§‹ä½¿ç”¨ç‰¹ä¾‹å¯¹è±¡ã€‚

#### class Site...

```js
get customer() {
  return (this._customer === "unknown") ? createUnknownCustomer() : this._customer;
}
```

#### é¡¶å±‚ä½œç”¨åŸŸ...

```js
function isUnknown(arg) {
  return arg.isUnknown;
}
```

ç„¶åæŠŠâ€œä»¥æ ‡å‡†æ–¹å¼åº”å¯¹ç‰¹ä¾‹â€çš„åœ°æ–¹éƒ½æ›¿æ¢æˆä½¿ç”¨ç‰¹ä¾‹å­—é¢é‡çš„å€¼ã€‚é¦–å…ˆä»â€œåå­—â€å¼€å§‹ï¼š

```js
function createUnknownCustomer() {
  return {
    isUnknown: true,
    name: "occupant",
  };
}
```

#### å®¢æˆ·ç«¯ 1...

```js
const customerName = aCustomer.name;
```

æ¥ç€æ˜¯â€œè®¡ä»·å¥—é¤â€ï¼š

```js
function createUnknownCustomer() {
  return {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
  };
}
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan = aCustomer.billingPlan;
```

åŒæ ·ï¼Œæˆ‘å¯ä»¥åœ¨å­—é¢é‡å¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªåµŒå¥—çš„ç©ºæ”¯ä»˜è®°å½•å¯¹è±¡ï¼š

```js
function createUnknownCustomer() {
  return {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
    paymentHistory: {
      weeksDelinquentInLastYear: 0,
    },
  };
}
```

#### å®¢æˆ·ç«¯ 3...

```js
const weeksDelinquent = aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

å¦‚æœä½¿ç”¨äº†è¿™æ ·çš„å­—é¢é‡ï¼Œåº”è¯¥ä½¿ç”¨è¯¸å¦‚ Object.freeze çš„æ–¹æ³•å°†å…¶å†»ç»“ï¼Œä½¿å…¶ä¸å¯å˜ã€‚é€šå¸¸ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢ç”¨ç±»å¤šä¸€ç‚¹ã€‚

### èŒƒä¾‹ï¼šä½¿ç”¨å˜æ¢

å‰é¢ä¸¤ä¸ªä¾‹å­éƒ½æ¶‰åŠäº†ä¸€ä¸ªç±»ï¼Œå…¶å®æœ¬é‡æ„æ‰‹æ³•ä¹ŸåŒæ ·é€‚ç”¨äºè®°å½•ï¼Œåªè¦å¢åŠ ä¸€ä¸ªå˜æ¢æ­¥éª¤å³å¯ã€‚

å‡è®¾æˆ‘ä»¬çš„è¾“å…¥æ˜¯ä¸€ä¸ªç®€å•çš„è®°å½•ç»“æ„ï¼Œå¤§æ¦‚åƒè¿™æ ·ï¼š

```js
{
 name: "Acme Boston",
 location: "Malden MA",
 // more site details
 customer: {
  name: "Acme Industries",
  billingPlan: "plan-451",
  paymentHistory: {
   weeksDelinquentInLastYear: 7
   //more
  },
  // more
 }
}
```

æœ‰æ—¶é¡¾å®¢çš„åå­—æœªçŸ¥ï¼Œæ­¤æ—¶æ ‡è®°çš„æ–¹å¼ä¸å‰é¢ä¸€æ ·ï¼šå°† customer å­—æ®µæ ‡è®°ä¸ºå­—ç¬¦ä¸²"unknown"ã€‚

```js
{
name: "Warehouse Unit 15",
location: "Malden MA",
// more site details
customer: "unknown",
}
```

å®¢æˆ·ç«¯ä»£ç ä¹Ÿç±»ä¼¼ï¼Œä¼šæ£€æŸ¥â€œæœªçŸ¥é¡¾å®¢â€çš„æƒ…å†µï¼š

#### å®¢æˆ·ç«¯ 1...

```js
const site = acquireSiteData();
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan =
  aCustomer === "unknown" ? registry.billingPlans.basic : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
const weeksDelinquent =
  aCustomer === "unknown"
    ? 0
    : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

æˆ‘é¦–å…ˆè¦è®© Site æ•°æ®ç»“æ„ç»è¿‡ä¸€æ¬¡å˜æ¢ï¼Œç›®å‰å˜æ¢ä¸­åªåšäº†æ·±å¤åˆ¶ï¼Œæ²¡æœ‰å¯¹æ•°æ®åšä»»ä½•å¤„ç†ã€‚

#### å®¢æˆ·ç«¯ 1...

```js
const rawSite = acquireSiteData();
const site = enrichSite(rawSite);
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;

function enrichSite(inputSite) {
  return _.cloneDeep(inputSite);
}
```

ç„¶åå¯¹â€œæ£€æŸ¥æœªçŸ¥é¡¾å®¢â€çš„ä»£ç è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```js
function isUnknown(aCustomer) {
  return aCustomer === "unknown";
}
```

#### å®¢æˆ·ç«¯ 1...

```js
const rawSite = acquireSiteData();
const site = enrichSite(rawSite);
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

#### å®¢æˆ·ç«¯ 3...

```js
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

ç„¶åå¼€å§‹å¯¹ Site æ•°æ®åšå¢å¼ºï¼Œé¦–å…ˆæ˜¯ç»™ customer å­—æ®µåŠ ä¸Š isUnknown å±æ€§ã€‚

```js
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

éšåä¿®æ”¹æ£€æŸ¥ç‰¹ä¾‹çš„æ¡ä»¶é€»è¾‘ï¼Œå¼€å§‹ä½¿ç”¨æ–°çš„å±æ€§ã€‚åŸæ¥çš„æ£€æŸ¥é€»è¾‘ä¹Ÿä¿ç•™ä¸åŠ¨ï¼Œæ‰€ä»¥ç°åœ¨çš„æ£€æŸ¥é€»è¾‘åº”è¯¥æ—¢èƒ½åº”å¯¹åŸæ¥çš„ Site æ•°æ®ï¼Œä¹Ÿèƒ½åº”å¯¹å¢å¼ºåçš„ Site æ•°æ®ã€‚

```js
function isUnknown(aCustomer) {
  if (aCustomer === "unknown") return true;
  else return aCustomer.isUnknown;
}
```

æµ‹è¯•ï¼Œç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶åé’ˆå¯¹ç‰¹ä¾‹ä½¿ç”¨å‡½æ•°ç»„åˆæˆå˜æ¢ï¼ˆ149ï¼‰ã€‚é¦–å…ˆæŠŠâ€œæœªçŸ¥é¡¾å®¢çš„åå­—â€çš„å¤„ç†é€»è¾‘æ¬è¿›å¢å¼ºå‡½æ•°ã€‚

```js
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
    name: "occupant",
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

#### å®¢æˆ·ç«¯ 1...

```js
const rawSite = acquireSiteData();
const site = enrichSite(rawSite);
const aCustomer = site.customer;
// ... lots of intervening code ...
const customerName = aCustomer.name;
```

æµ‹è¯•ï¼Œç„¶åæ˜¯â€œæœªçŸ¥é¡¾å®¢çš„è®¡ä»·å¥—é¤â€çš„å¤„ç†é€»è¾‘ã€‚

```js
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

#### å®¢æˆ·ç«¯ 2...

```js
const plan = aCustomer.billingPlan;
```

å†æ¬¡æµ‹è¯•ï¼Œç„¶åå¤„ç†æœ€åä¸€å¤„å®¢æˆ·ç«¯ä»£ç ã€‚

```js
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
    paymentHistory: {
      weeksDelinquentInLastYear: 0,
    },
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

#### å®¢æˆ·ç«¯ 3...

```js
const weeksDelinquent = aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

## 10.6 å¼•å…¥æ–­è¨€ï¼ˆIntroduce Assertionï¼‰

```js
  if (this.discountRate)
  base = base - (this.discountRate * base);


  assert(this.discountRate&gt;= 0);
if (this.discountRate)
  base = base - (this.discountRate * base);
```

### åŠ¨æœº

å¸¸å¸¸ä¼šæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼šåªæœ‰å½“æŸä¸ªæ¡ä»¶ä¸ºçœŸæ—¶ï¼Œè¯¥æ®µä»£ç æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå¹³æ–¹æ ¹è®¡ç®—åªå¯¹æ­£å€¼æ‰èƒ½è¿›è¡Œï¼Œåˆä¾‹å¦‚ï¼ŒæŸä¸ªå¯¹è±¡å¯èƒ½å‡è®¾ä¸€ç»„å­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ç­‰äº nullã€‚

è¿™æ ·çš„å‡è®¾é€šå¸¸å¹¶æ²¡æœ‰åœ¨ä»£ç ä¸­æ˜ç¡®è¡¨ç°å‡ºæ¥ï¼Œä½ å¿…é¡»é˜…è¯»æ•´ä¸ªç®—æ³•æ‰èƒ½çœ‹å‡ºã€‚æœ‰æ—¶ç¨‹åºå‘˜ä¼šä»¥æ³¨é‡Šå†™å‡ºè¿™æ ·çš„å‡è®¾ï¼Œè€Œæˆ‘è¦ä»‹ç»çš„æ˜¯ä¸€ç§æ›´å¥½çš„æŠ€æœ¯â€”â€”ä½¿ç”¨æ–­è¨€æ˜ç¡®æ ‡æ˜è¿™äº›å‡è®¾ã€‚

æ–­è¨€æ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œåº”è¯¥æ€»æ˜¯ä¸ºçœŸã€‚å¦‚æœå®ƒå¤±è´¥ï¼Œè¡¨ç¤ºç¨‹åºå‘˜çŠ¯äº†é”™è¯¯ã€‚æ–­è¨€çš„å¤±è´¥ä¸åº”è¯¥è¢«ç³»ç»Ÿä»»ä½•åœ°æ–¹æ•æ‰ã€‚æ•´ä¸ªç¨‹åºçš„è¡Œä¸ºåœ¨æœ‰æ²¡æœ‰æ–­è¨€å‡ºç°çš„æ—¶å€™éƒ½åº”è¯¥å®Œå…¨ä¸€æ ·ã€‚å®é™…ä¸Šï¼Œæœ‰äº›ç¼–ç¨‹è¯­è¨€ä¸­çš„æ–­è¨€å¯ä»¥åœ¨ç¼–è¯‘æœŸç”¨ä¸€ä¸ªå¼€å…³å®Œå…¨ç¦ç”¨æ‰ã€‚

æˆ‘å¸¸çœ‹è§æœ‰äººé¼“åŠ±ç”¨æ–­è¨€æ¥å‘ç°ç¨‹åºä¸­çš„é”™è¯¯ã€‚è¿™å›ºç„¶æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä½†å´ä¸æ˜¯ä½¿ç”¨æ–­è¨€çš„å”¯ä¸€ç†ç”±ã€‚æ–­è¨€æ˜¯ä¸€ç§å¾ˆæœ‰ä»·å€¼çš„äº¤æµå½¢å¼â€”â€”å®ƒä»¬å‘Šè¯‰é˜…è¯»è€…ï¼Œç¨‹åºåœ¨æ‰§è¡Œåˆ°è¿™ä¸€ç‚¹æ—¶ï¼Œå¯¹å½“å‰çŠ¶æ€åšäº†ä½•ç§å‡è®¾ã€‚å¦å¤–æ–­è¨€å¯¹è°ƒè¯•ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚è€Œä¸”ï¼Œå› ä¸ºå®ƒä»¬åœ¨äº¤æµä¸Šå¾ˆæœ‰ä»·å€¼ï¼Œå³ä½¿è§£å†³äº†å½“ä¸‹æ­£åœ¨è¿½è¸ªçš„é”™è¯¯ï¼Œæˆ‘è¿˜æ˜¯å€¾å‘äºæŠŠæ–­è¨€ç•™ç€ã€‚è‡ªæµ‹è¯•çš„ä»£ç é™ä½äº†æ–­è¨€åœ¨è°ƒè¯•æ–¹é¢çš„ä»·å€¼ï¼Œå› ä¸ºé€æ­¥é€¼è¿‘çš„å•å…ƒæµ‹è¯•é€šå¸¸èƒ½æ›´å¥½åœ°å¸®åŠ©è°ƒè¯•ï¼Œä½†æˆ‘ä»ç„¶çœ‹é‡æ–­è¨€åœ¨äº¤æµæ–¹é¢çš„ä»·å€¼ã€‚

### åšæ³•

å¦‚æœä½ å‘ç°ä»£ç å‡è®¾æŸä¸ªæ¡ä»¶å§‹ç»ˆä¸ºçœŸï¼Œå°±åŠ å…¥ä¸€ä¸ªæ–­è¨€æ˜ç¡®è¯´æ˜è¿™ç§æƒ…å†µã€‚

å› ä¸ºæ–­è¨€åº”è¯¥ä¸ä¼šå¯¹ç³»ç»Ÿè¿è¡Œé€ æˆä»»ä½•å½±å“ï¼Œæ‰€ä»¥â€œåŠ å…¥æ–­è¨€â€æ°¸è¿œéƒ½åº”è¯¥æ˜¯è¡Œä¸ºä¿æŒçš„ã€‚

### èŒƒä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šæŠ˜æ‰£ã€‚é¡¾å®¢ï¼ˆcustomerï¼‰ä¼šè·å¾—ä¸€ä¸ªæŠ˜æ‰£ç‡ï¼ˆdiscount rateï¼‰ï¼Œå¯ä»¥ç”¨äºæ‰€æœ‰å…¶è´­ä¹°çš„å•†å“ã€‚

#### class Customer...

```js
applyDiscount(aNumber) {
  return (this.discountRate)
    ? aNumber - (this.discountRate * aNumber)
    : aNumber;
}
```

è¿™é‡Œæœ‰ä¸€ä¸ªå‡è®¾ï¼šæŠ˜æ‰£ç‡æ°¸è¿œæ˜¯æ­£æ•°ã€‚æˆ‘å¯ä»¥ç”¨æ–­è¨€æ˜ç¡®æ ‡ç¤ºå‡ºè¿™ä¸ªå‡è®¾ã€‚ä½†åœ¨ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ä¸­æ²¡åŠæ³•å¾ˆç®€å•åœ°æ’å…¥æ–­è¨€ï¼Œæ‰€ä»¥æˆ‘é¦–å…ˆè¦æŠŠè¿™ä¸ªè¡¨è¾¾å¼è½¬æ¢æˆ if-else çš„å½¢å¼ã€‚

#### class Customer...

```js
applyDiscount(aNumber) {
  if (!this.discountRate) return aNumber;
  else return aNumber - (this.discountRate * aNumber);
}
```

ç°åœ¨æˆ‘å°±å¯ä»¥è½»æ¾åœ°åŠ å…¥æ–­è¨€äº†ã€‚

#### class Customer...

```js
applyDiscount(aNumber) {
  if (!this.discountRate) return aNumber;
  else {
    assert(this.discountRate &gt;= 0);
    return aNumber - (this.discountRate * aNumber);
  }
}
```

å¯¹è¿™ä¸ªä¾‹å­è€Œè¨€ï¼Œæˆ‘æ›´æ„¿æ„æŠŠæ–­è¨€æ”¾åœ¨è®¾å€¼å‡½æ•°ä¸Šã€‚å¦‚æœåœ¨ applyDiscount å‡½æ•°å¤„å‘ç”Ÿæ–­è¨€å¤±è´¥ï¼Œæˆ‘è¿˜å¾—å…ˆè´¹åŠ›ææ¸…æ¥šéæ³•çš„æŠ˜æ‰£ç‡å€¼èµ·åˆæ˜¯ä»å“ªå„¿æ”¾è¿›å»çš„ã€‚

#### class Customer...

```js
set discountRate(aNumber) {
  assert(null === aNumber || aNumber &gt;= 0);
  this._discountRate = aNumber;
}
```

çœŸæ­£å¼•èµ·é”™è¯¯çš„æºå¤´æœ‰å¯èƒ½å¾ˆéš¾å‘ç°â€”â€”ä¹Ÿè®¸æ˜¯è¾“å…¥æ•°æ®ä¸­è¯¯å†™äº†ä¸€ä¸ªå‡å·ï¼Œä¹Ÿè®¸æ˜¯æŸå¤„ä»£ç åšæ•°æ®è½¬æ¢æ—¶çŠ¯äº†é”™è¯¯ã€‚åƒè¿™æ ·çš„æ–­è¨€å¯¹äºå‘ç°é”™è¯¯æºå¤´ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚

æ³¨æ„ï¼Œä¸è¦æ»¥ç”¨æ–­è¨€ã€‚æˆ‘ä¸ä¼šä½¿ç”¨æ–­è¨€æ¥æ£€æŸ¥æ‰€æœ‰â€œæˆ‘è®¤ä¸ºåº”è¯¥ä¸ºçœŸâ€çš„æ¡ä»¶ï¼Œåªç”¨æ¥æ£€æŸ¥â€œå¿…é¡»ä¸ºçœŸâ€çš„æ¡ä»¶ã€‚æ»¥ç”¨æ–­è¨€å¯èƒ½ä¼šé€ æˆä»£ç é‡å¤ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ä¸Šé¢è¿™æ ·çš„æ¡ä»¶é€»è¾‘æ—¶ã€‚æ‰€ä»¥æˆ‘å‘ç°ï¼Œå¾ˆæœ‰å¿…è¦å»æ‰æ¡ä»¶é€»è¾‘ä¸­çš„é‡å¤ï¼Œé€šå¸¸å¯ä»¥å€ŸåŠ©æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ‰‹æ³•ã€‚

æˆ‘åªç”¨æ–­è¨€é¢„é˜²ç¨‹åºå‘˜çš„é”™è¯¯ã€‚å¦‚æœè¦ä»æŸä¸ªå¤–éƒ¨æ•°æ®æºè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹è¾“å…¥å€¼çš„æ£€æŸ¥éƒ½åº”è¯¥æ˜¯ç¨‹åºçš„ä¸€ç­‰å…¬æ°‘ï¼Œè€Œä¸èƒ½ç”¨æ–­è¨€å®ç°â€”â€”é™¤éæˆ‘å¯¹è¿™ä¸ªå¤–éƒ¨æ•°æ®æºæœ‰ç»å¯¹çš„ä¿¡å¿ƒã€‚æ–­è¨€æ˜¯å¸®åŠ©æˆ‘ä»¬è·Ÿè¸ª bug çš„æœ€åä¸€æ‹›ï¼Œæ‰€ä»¥ï¼Œæˆ–è®¸å¬æ¥è®½åˆºï¼Œåªæœ‰å½“æˆ‘è®¤ä¸ºæ–­è¨€ç»å¯¹ä¸ä¼šå¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘æ‰ä¼šä½¿ç”¨æ–­è¨€ã€‚
